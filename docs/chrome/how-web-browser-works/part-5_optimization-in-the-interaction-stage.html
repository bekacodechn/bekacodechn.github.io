<!DOCTYPE html>
  <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <link rel="icon" href="" type="image/svg+xml"></link>
      <script  id="check-dark-light">
        ;(() => {
          const saved = localStorage.getItem('island-theme-appearance')
          const prefereDark = window.matchMedia('(prefers-color-scheme: dark)').matches
          if (!saved || saved === 'auto' ? prefereDark : saved === 'dark') {
            document.documentElement.classList.add('dark')
          }
        })()
      </script>
      <title data-rh="true">References</title>
      <meta data-rh="true" name="description" content="Island"/>
      
      
      <script defer src='https://ga.jspm.io/npm:es-module-shims@1.6.0/dist/es-module-shims.js'></script>
      <script type="importmap">
        {
          "imports": {
            "react": "/react.js","react-dom": "/react-dom.js","react-dom/client": "/react-dom_client.js","react/jsx-runtime": "/react_jsx-runtime.js"
          }
        }
      </script>

      <link rel="stylesheet" href="/assets/style.71d86141.css">

    </head>
    <body>
      <div id="root"><div style="height:100%"><header relative="" z="4" fixed="md:~" class="top-0 left-0" w="100%"><div relative="" p="l-8 sm:x-8" transition="background-color duration-500" class="divider-bottom md:border-b-transparent lg:border-b-transparent" nav-h="mobile lg:desktop"><div flex="" justify="between" m="0 auto" nav-h="mobile lg:desktop" class="_container_1ic07_52  _has-sidebar_1ic07_16"><div border="border t-0 b-1 border-solid transparent" class="_nav-bar-title_1ic07_16"><a href="/" w="100%" h="100%" text="1rem" font="semibold" transition="opacity duration-300" hover="opacity-60" class="flex items-center"><span>beka的博客</span></a></div><div class="_content_1ic07_24" flex="~ 1" justify="end" items-center=""><div class="search" flex="sm:1" pl="sm:8"><div flex="" items-center="~" relative="" mr="2" font="semibold"><svg width="32" height="32" viewBox="0 0 32 32" w="5" h="5" fill="currentColor"><path fill="#888888" d="m29 27.586l-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9a9.01 9.01 0 0 1-9-9Z"></path></svg><input disabled="" cursor="text focus:auto" placeholder="Search" height="8" border="none" type="text" text="sm" p="t-0 r-2 b-0 l-2" transition="all duration-200 ease" class="rounded-sm _searchInput_y03a3_1 " aria-label="Search" autoComplete="off"/><div m="r-3" w="10" h="6" p="x-1.5" rounded="md" border="1px solid gray-light-3" text="xs gray-light-3" flex="~" items-center="~" justify="around" class="_searchCommand_y03a3_7"><span>⌘</span><span>K</span></div></div></div><div class="_rightNav_1ic07_42"><div class="menu"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article</a></div><div text="sm" font="medium" m="x-3" class="text-brand"><a class="_link_r3fql_1 " target="" cursor="pointer">Chrome</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Design-pattern</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Open-source</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Promise</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Webpack</a></div></div><div class="appearance" before="menu-item-before" display="none sm:flex" items-center="center"><button class="_switch_1tqe3_1 undefined" id="" type="button" role="switch"><span class="_check_1tqe3_17"><span class="_icon_1tqe3_34"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_sun_8e60k_1"><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_moon_8e60k_5"><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg></span></span></button></div></div><button class=" _navHamburger_14nz8_1"><span class="_container_14nz8_14"><span class="_top_14nz8_21"></span><span class="_middle_14nz8_27"></span><span class="_bottom_14nz8_33"></span></span></button><div class="_navScreen_1mkpq_1 " id="navScreen"><div class="_container_1mkpq_21"><div class="_navMenu_1mkpq_27"><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class="text-brand"><a class="_link_r3fql_1 " target="" cursor="pointer">Chrome</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Design-pattern</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Open-source</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Promise</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Webpack</a></div></div></div><div class="_socialAndAppearance_1mkpq_50" flex="~" justify="center" items-center="center"><div class="items-center appearance pa-2 _navAppearance_1mkpq_46" flex="~" justify="center"><button class="_switch_1tqe3_1 undefined" id="" type="button" role="switch"><span class="_check_1tqe3_17"><span class="_icon_1tqe3_34"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_sun_8e60k_1"><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_moon_8e60k_5"><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg></span></span></button></div></div></div></div></div></div></div></header><section style="padding-top:var(--island-nav-height)"><div p="t-0 x-6 b-24 sm:6" class="_docLayout_5cssi_8"><div class="_localNav_ncerp_1"><button flex="center" class="_menu_ncerp_16"><div text="md" mr="2" class="i-carbon:menu"></div><span text="md ">Menu</span></button></div><aside class="_sidebar_iav29_1 "><nav><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">Chorme lala</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:28px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">以用户为中心的效果指标</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">浏览器工作原理</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:168px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">高级体系结构（第 1 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">导航阶段（第 2 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">渲染阶段（第 3 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">加载阶段的优化（第 4 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-brand"><a class="_link_r3fql_1 " target="" cursor="pointer">交互阶段的优化（第 5 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">什么强制了重排/回流</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">Html</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:84px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Metadata</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">html</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer"># 文档结构</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">关键指标</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:84px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">First Contentful Paint (FCP)</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Largest Contentful Paint (LCP)</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Time to First Byte (TTFB)</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">性能</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:140px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">一般 HTML 性能注意事项</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">optimize-resource-loading 优化资源负载</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">asdf</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Welcome to Lean performance</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">速度为什么重要</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">性能技巧</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:448px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Web 上的多进程：浏览器进程模型</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Browser Rendering Pipeline</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">通过火焰图找到有问题的代码</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">如何收集 Web 性能跟踪</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">事件循环基础知识</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">深度讲解火焰图 🔥🔥</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">长任务：它们是什么以及为什么应该避免它们</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">performance 查看主线程（颜色含义）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">检测浏览器何时在 JavaScript 中绘制Frame</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">如何阅读 Chromium Profiler</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">使用 Chromium 网络标签页获取性能详情</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">使用性能时序标记进行📏测量</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Chromium F12 性能分析器的基本概述</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">传输大小 vs 资源大小</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">如何阅读火焰图 🔥</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">识别 Web 应用中的未压缩资源</a></div></div></div></div></section></nav></aside><div flex="~ 1 shrink-0" m="x-auto" class="_content_5cssi_2"><div m="x-auto" flex="~ col" class="max-w-100%"><div relative="~" m="x-auto" p="l-2" class="w-100% md:max-w-712px lg:min-w-640px "><div class="island-doc "><!--$--><h1 id="浏览器如何一步一步地工作--交互阶段的优化第-5-部分"><a class="header-anchor" aria-hidden="true" href="#浏览器如何一步一步地工作--交互阶段的优化第-5-部分">#</a>浏览器如何一步一步地工作 — 交互阶段的优化（第 5 部分）</h1>
<p><code>metadata:</code></p>
<p><strong>原标题:</strong> How does browser work step by step [latest] — optimization in the interaction stage (part 5)</p>
<p><strong>链接:</strong> <a href="https://cabulous.medium.com/how-does-browser-work-in-2019-part-5-optimization-in-the-interaction-stage-66b53b8ec0ad" target="_blank" rel="nofollow">https://cabulous.medium.com/how-does-browser-work-in-2019-part-5-optimization-in-the-interaction-stage-66b53b8ec0ad</a></p>
<p><strong>文章副标题:</strong> 交互阶段的优化（第 5 部分）</p>
<hr/>
<p>交互阶段的优化是关于优化帧。</p>
<p>与页面交互时，用户会触发事件。一些事件会修改页面布局和样式。根据脚本的不同，浏览器可能需要多次经历渲染阶段，以不断地向我们的屏幕交付新的位图或合成帧。</p>
<h2 id="fps-and-lag-fps-和延迟"><a class="header-anchor" aria-hidden="true" href="#fps-and-lag-fps-和延迟">#</a>FPS and lag (FPS 和延迟)</h2>
<p>人眼最多可以看到每秒 1,000 帧 （FPS）。在慢速或静态场景中，我们很少分辨出超过 30 FPS 的差异。但是，它在动态场景中变得很明显，例如玩第一人称射击视频游戏。如今，大多数显示器的刷新率为 60 FPS 或 60 赫兹。</p>
<p>理想情况下，浏览器需要完成渲染阶段并在 1/60 秒内交付一帧。即 16.67 毫秒。如果是这样，用户将看到流畅的动画，并且不会感到滞后。</p>
<p>在交互阶段，通常通过执行JavaScript来触发页面更新。大多数时候，它可能会触发回流和重新绘制。</p>
<h2 id="reflow-and-repaint-回流和重绘"><a class="header-anchor" aria-hidden="true" href="#reflow-and-repaint-回流和重绘">#</a>Reflow and repaint (回流和重绘)</h2>
<p>当一行 JavaScript 更改元素高度时会发生什么？</p>
<p>高度修改不会影响 DOM 树。相反，它需要样式计算。</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231108203608.png" alt="20231108203608"/></p>
<p>在样式计算结束时，渲染过程将高度变化反映到布局阶段，从而导致元素几何信息的转换。因此，需要生成布局树。</p>
<p>布局树是其余阶段的依赖关系，因此渲染流程需要经历所有步骤。</p>
<p>此过程称为回流。</p>
<p>在 JavaScript 中调用时，许多属性检查可能会触发重排，例如“element.offsetLeft”。这是它们的<a href="/chrome/how-web-browser-works/what-forces-layout-reflow">完整列表</a>。</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231108212931.png" alt="20231108212931"/></p>
<p>重排的最坏情况是修改 DOM。例如“document.body.appendChild（node）”。回流过程从第一阶段开始，构建 DOM 树。</p>
<p>如何更改元素的背景颜色？</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231108213013.png" alt="20231108213013"/></p>
<p>同样，让我们从样式计算开始。新的背景颜色不会修改元素的几何图形信息，因此渲染进程会跳过它。它也不会创建新图层，因此让我们跳过图层阶段。在绘制阶段，渲染进程需要生成新的绘制记录以反映背景颜色更新。然后，它经历了其余的阶段。</p>
<p>此过程称为重绘。</p>
<p>重排和重绘都会降低渲染性能，原因有二：</p>
<ul>
<li>The reflow and repaint process is happening in the main thread, so it cannot take care of any events triggered by users’ interaction. When it happens, the users feel lagging.<br/>
<!-- -->重排和重绘过程发生在主线程中，因此它无法处理用户交互触发的任何事件。当它发生时，用户会感到滞后。</li>
<li>computation process in the layout, layer, and paint phases are expensive.
重排和绘制阶段的计算过程非常昂贵。</li>
</ul>
<p>Since the repaint skips the layout and layer phases, it is a relatively better option than reflow.</p>
<h2 id="are-there-any-changes-that-dont-trigger-reflow-and-repaint-at-all--是否有任何更改根本不会触发重排和重绘"><a class="header-anchor" aria-hidden="true" href="#are-there-any-changes-that-dont-trigger-reflow-and-repaint-at-all--是否有任何更改根本不会触发重排和重绘">#</a>Are there any changes that don’t trigger reflow and repaint at all?  (是否有任何更改根本不会触发重排和重绘？)</h2>
<p>是的。CSS动画就是一个很好的例子。</p>
<p>A typical CSS animation uses a “transform” property. Modifying “transform” value skips the layout, layer, and paint phases, and starts with the tilling in the compositor thread(合成线程).</p>
<p>Without occupying the main thread, CSS animation doesn’t block users’ interaction. It is the reason that you still see smooth CSS animation even if the page freezes.(在不占用主线程的情况下，CSS动画不会阻止用户的交互。这就是为什么即使页面冻结，您仍然可以看到流畅的CSS动画的原因。)</p>
<h2 id="optimization-in-the-interaction-stage-is-about-increasing-the-speed-of-frame-generation-交互阶段的优化是关于提高帧生成速度"><a class="header-anchor" aria-hidden="true" href="#optimization-in-the-interaction-stage-is-about-increasing-the-speed-of-frame-generation-交互阶段的优化是关于提高帧生成速度">#</a>Optimization in the interaction stage is about increasing the speed of frame generation (交互阶段的优化是关于提高帧生成速度)</h2>
<p>JavaScript 执行、重排和重绘可能会减慢帧生成速度。</p>
<p>执行时，JavaScript 在主线程中运行。这里的想法是尽可能少地使用主线程。</p>
<h3 id="reduce-the-length-of-time-executing-javascript--缩短执行-javascript-的时间长度"><a class="header-anchor" aria-hidden="true" href="#reduce-the-length-of-time-executing-javascript--缩短执行-javascript-的时间长度">#</a>Reduce the length of time executing JavaScript  (缩短执行 JavaScript 的时间长度)</h3>
<p>例如，一个重要的函数可能需要数百毫秒才能完成。它会阻塞主线程并降低性能。</p>
<p>我们可以将函数分成较小的函数，因此每个函数都不会花费很长时间。浏览器有助于在运行函数时优化任务。</p>
<p>Web Worker 是另一种选择。您可以在渲染器进程中将其作为独立线程进行操作。当脚本在 Web Worker 中运行时，主线程是空闲的。如果一段 JavaScript 没有访问 DOM 和样式表，您可以将其移动到 Web Worker。</p>
<h3 id="avoid-the-reflow-and-repaint-when-executing-javascript-避免在执行-javascript-时重排和重绘"><a class="header-anchor" aria-hidden="true" href="#avoid-the-reflow-and-repaint-when-executing-javascript-避免在执行-javascript-时重排和重绘">#</a>Avoid the reflow and repaint when executing JavaScript (避免在执行 JavaScript 时重排和重绘)</h3>
<p>当 DOM 树被修改时，渲染器进程将重新计算样式和布局。通常，计算在另一个任务中异步运行。</p>
<p>让我们看一个例子。</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231108214535.png" alt="20231108214535"/></p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231108214543.png" alt="20231108214543"/></p>
<p>第一个任务完成JavaScript执行。然后另一个任务异步运行以计算样式和布局。</p>
<p>如果我们检查脚本末尾的元素高度会怎样？</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231108214926.png" alt="20231108214926"/></p>
<p>当计算元素“offsetHeight”时，该值仍然是旧的，因为渲染器进程尚未计算样式和布局。渲染器进程同步开始计算，以便它可以接收更新的值。</p>
<div class="island-directive tip"><p class="island-directive-title">原文</p><div class="island-directive-content"><p>When evaluating the element “offsetHeight,” the value is still the old one because the renderer process has not yet computed the style and layout. The renderer process starts the calculation synchronously so it can receive the updated value.</p><p>意思是因为计算样式和布局是异步执行的，所以获取<code>offsetHeight</code>时是旧值，所以渲染进程不得已同步计算了一遍？</p></div></div>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231108215719.png" alt="20231108215719"/></p>
<p>在这种情况下，我们强制在 JavaScript 执行任务中进行样式和布局计算。计算会阻塞主线程，直到执行完成。</p>
<p>更糟糕的是？我们在for循环中评估属性。上一个过程会持续发生，直到执行结束。大多数情况下，页面上会出现明显的延迟。</p>
<p>在现实生活中的项目中，很难完全避免评估属性。但是，我们可以尝试尽量减少使用量。</p>
<h2 id="using-css-animation-and-will-change-使用-css-动画和will-change"><a class="header-anchor" aria-hidden="true" href="#using-css-animation-and-will-change-使用-css-动画和will-change">#</a>Using CSS animation and “will-change” (使用 CSS 动画和“will-change”)</h2>
<p>CSS动画根本不使用主线程，所以我们可以尽可能多地使用它。</p>
<p>同时，我们可以将“will-change”属性附加到动画元素上。具有“意志更改”的元素将渲染在层树中的独立层上，从而进一步优化合成器线程中的帧生成。</p>
<h1 id="references"><a class="header-anchor" aria-hidden="true" href="#references">#</a>References</h1>
<ul>
<li><a href="https://developers.google.com/web/updates/2018/09/inside-browser-part3" target="_blank" rel="nofollow">Inside look at modern web browser (part 3)<br/>
<!-- -->现代 Web 浏览器内部介绍（第 3 部分）</a></li>
<li><a href="https://www.html5rocks.com/en/tutorials/speed/high-performance-animations/" target="_blank" rel="nofollow">High Performance Animations — HTML5 Rocks<br/>
<!-- -->高性能动画 — HTML5 Rocks</a></li>
<li><a href="https://www.quora.com/What-is-the-highest-frame-rate-fps-that-can-be-recognized-by-human-perception-At-what-rate-do-we-essentially-stop-noticing-the-difference" target="_blank" rel="nofollow">What is the highest frame rate (fps) that can be recognized by human perception?<br/>
<!-- -->人类感知可以识别的最高帧率（fps）是多少？</a></li>
</ul><!--/$--></div><footer mt="8"><div class="xs:flex" p="b-5" justify="between" items-center="~"><div flex="" text="sm text-2" leading-6="~" leading-8="sm:~" font-medium=""><p>Last Updated: </p><span>2023/11/9 01:52:20</span></div></div><div flex="~ col sm:row" justify="sm:around" gap="2" divider-top="" pt="6"><div flex="~ col" class="_prev_1f77m_13"><a href="/chrome/how-web-browser-works/part-4_optimization-in-the-loading-stage" class="_pager-link_1f77m_20"><span class="_desc_1f77m_43">Previous Page</span><span class="_title_1f77m_34">加载阶段的优化（第 4 部分）</span></a></div><div flex="~ col" class="_next_1f77m_16"><a href="/chrome/how-web-browser-works/what-forces-layout-reflow" class="_pager-link_1f77m_20 _next_1f77m_16"><span class="_desc_1f77m_43">Next page</span><span class="_title_1f77m_34">什么强制了重排/回流</span></a></div></div></footer></div></div><div relative="~" display="none lg:block" order="2" flex="1" p="l-8" class="max-w-256px"><div class="_aside-container_5cssi_32"><div flex="~ col" p="b-8" style="min-height:calc(100vh - (var(--island-nav-height-desktop) + 32px))"><div><div flex="~ col 1"><div display="lg:block"><div relative="" divider-left="" p="l-4" text="13px" font-medium="" id="aside-container"><div absolute="" pos="top-33px" opacity="0" w="1px" h="18px" bg="brand" style="left:-1px;transition:top 0.25s cubic-bezier(0, 1, 0.5, 1), background-color 0.5s, opacity 0.25s" id="aside-marker"></div><div block="~" leading-7="" text="13px" font="semibold">目录</div><nav><ul relative=""><li><a href="#fps-and-lag-fps-和延迟" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">FPS and lag (FPS 和延迟)</a></li><li><a href="#reflow-and-repaint-回流和重绘" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Reflow and repaint (回流和重绘)</a></li><li><a href="#are-there-any-changes-that-dont-trigger-reflow-and-repaint-at-all--是否有任何更改根本不会触发重排和重绘" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Are there any changes that don’t trigger reflow and repaint at all?  (是否有任何更改根本不会触发重排和重绘？)</a></li><li><a href="#optimization-in-the-interaction-stage-is-about-increasing-the-speed-of-frame-generation-交互阶段的优化是关于提高帧生成速度" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Optimization in the interaction stage is about increasing the speed of frame generation (交互阶段的优化是关于提高帧生成速度)</a></li><li><a href="#reduce-the-length-of-time-executing-javascript--缩短执行-javascript-的时间长度" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">Reduce the length of time executing JavaScript  (缩短执行 JavaScript 的时间长度)</a></li><li><a href="#avoid-the-reflow-and-repaint-when-executing-javascript-避免在执行-javascript-时重排和重绘" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">Avoid the reflow and repaint when executing JavaScript (避免在执行 JavaScript 时重排和重绘)</a></li><li><a href="#using-css-animation-and-will-change-使用-css-动画和will-change" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Using CSS animation and “will-change” (使用 CSS 动画和“will-change”)</a></li></ul></nav></div></div></div></div></div></div></div></div></div></section></div></div>
      <script>window.ISLAND_PAGE_DATA={"siteData":{"lang":"en-US","title":"beka的博客","description":"Island","themeConfig":{"lastUpdatedText":"上次更新","outlineTitle":"目录","nav":[{"text":"Article","link":"/article/astro","activeMatch":"/article/"},{"text":"Chrome","link":"/chrome/fast-load-time/user-centric-performance-metrics","activeMatch":"/chrome/"},{"text":"Design-pattern","link":"/design-pattern/indexs","activeMatch":"/design-pattern/"},{"text":"Open-source","link":"/open-source/delay","activeMatch":"/open-source/"},{"text":"Promise","link":"/promise/first-resolved","activeMatch":"/promise/"},{"text":"Webpack","link":"/webpack/build-result","activeMatch":"/webpack/"}],"sidebar":{"article":[{"text":"Article","items":[{"text":"Astro","link":"/article/astro"},{"text":"新一代全栈框架 Fresh","link":"/article/fresh"}],"collapsable":true}],"chrome":[{"text":"Chorme lala","items":[{"text":"以用户为中心的效果指标","link":"/chrome/fast-load-time/user-centric-performance-metrics"}],"collapsable":true},{"text":"浏览器工作原理","items":[{"text":"高级体系结构（第 1 部分）","link":"/chrome/how-web-browser-works/part-1_high-level-architecture"},{"text":"导航阶段（第 2 部分）","link":"/chrome/how-web-browser-works/part-2_navigation-phase"},{"text":"渲染阶段（第 3 部分）","link":"/chrome/how-web-browser-works/part-3_rendering-phase"},{"text":"加载阶段的优化（第 4 部分）","link":"/chrome/how-web-browser-works/part-4_optimization-in-the-loading-stage"},{"text":"交互阶段的优化（第 5 部分）","link":"/chrome/how-web-browser-works/part-5_optimization-in-the-interaction-stage"},{"text":"什么强制了重排/回流","link":"/chrome/how-web-browser-works/what-forces-layout-reflow"}],"collapsable":true},{"text":"Html","items":[{"text":"Metadata","link":"/chrome/html/metadata"},{"text":"html","link":"/chrome/html/overview"},{"text":"# 文档结构","link":"/chrome/html/structure"}],"collapsable":true},{"text":"关键指标","items":[{"text":"First Contentful Paint (FCP)","link":"/chrome/metrics/FCP"},{"text":"Largest Contentful Paint (LCP)","link":"/chrome/metrics/LCP"},{"text":"Time to First Byte (TTFB)","link":"/chrome/metrics/TTFB"}],"collapsable":true},{"text":"性能","items":[{"text":"一般 HTML 性能注意事项","link":"/chrome/performance/general-html-performance"},{"text":"optimize-resource-loading 优化资源负载","link":"/chrome/performance/optimize-resource-loading"},{"text":"asdf","link":"/chrome/performance/welcome-copy"},{"text":"Welcome to Lean performance","link":"/chrome/performance/welcome"},{"text":"速度为什么重要","link":"/chrome/performance/why-speed-matters"}],"collapsable":true},{"text":"性能技巧","items":[{"text":"Web 上的多进程：浏览器进程模型","link":"/chrome/performance/tips/browser-process-model"},{"text":"Browser Rendering Pipeline","link":"/chrome/performance/tips/browser-rendering-pipeline"},{"text":"通过火焰图找到有问题的代码","link":"/chrome/performance/tips/codepath-scoping"},{"text":"如何收集 Web 性能跟踪","link":"/chrome/performance/tips/collect-a-trace"},{"text":"事件循环基础知识","link":"/chrome/performance/tips/event-loop"},{"text":"深度讲解火焰图 🔥🔥","link":"/chrome/performance/tips/flamegraphs-in-depth"},{"text":"长任务：它们是什么以及为什么应该避免它们","link":"/chrome/performance/tips/long-tasks"},{"text":"performance 查看主线程（颜色含义）","link":"/chrome/performance/tips/main-profiler-pane"},{"text":"检测浏览器何时在 JavaScript 中绘制Frame","link":"/chrome/performance/tips/measuring-paint-time"},{"text":"如何阅读 Chromium Profiler","link":"/chrome/performance/tips/network-profiler-pane"},{"text":"使用 Chromium 网络标签页获取性能详情","link":"/chrome/performance/tips/network-tab"},{"text":"使用性能时序标记进行📏测量","link":"/chrome/performance/tips/performance-timing-markers"},{"text":"Chromium F12 性能分析器的基本概述","link":"/chrome/performance/tips/profiler-basic-ui"},{"text":"传输大小 vs 资源大小","link":"/chrome/performance/tips/resource-size-vs-transfer-size"},{"text":"如何阅读火焰图 🔥","link":"/chrome/performance/tips/understanding-flamegraphs"},{"text":"识别 Web 应用中的未压缩资源","link":"/chrome/performance/tips/validating-compression"}],"collapsable":true}],"design-pattern":[{"text":"Design-pattern","items":[{"text":"资源列表","link":"/design-pattern/indexs"},{"text":"代理模式","link":"/design-pattern/proxy-pattern"},{"text":"Singleton Pattern","link":"/design-pattern/singleton-pattern"},{"text":"状态模式","link":"/design-pattern/state-pattern"},{"text":"策略模式","link":"/design-pattern/strategy-pattern"}],"collapsable":true}],"open-source":[{"text":"Open-source","items":[{"text":"delay","link":"/open-source/delay"},{"text":"dot-prop","link":"/open-source/dot-prop"},{"text":"glob-to-regexp","link":"/open-source/glob-to-regexp"},{"text":"koa 洋葱模型","link":"/open-source/koa-compose"},{"text":"quick-lru","link":"/open-source/lru-cache"},{"text":"p-defer","link":"/open-source/p-defer"},{"text":"p-lazy","link":"/open-source/p-lazy"},{"text":"p-limit","link":"/open-source/p-limit"},{"text":"p-locate","link":"/open-source/p-locate"},{"text":"p-settle","link":"/open-source/p-settle"},{"text":"yocto-queue","link":"/open-source/yocto-queue"}],"collapsable":true}],"promise":[{"text":"Promise","items":[{"text":"顺序执行任务直到第一个resolved","link":"/promise/first-resolved"},{"text":"reduce实现多个promise顺序执行","link":"/promise/sequential-execution"}],"collapsable":true}],"webpack":[{"text":"Webpack","items":[{"text":"webpack 打包结果解析","link":"/webpack/build-result"},{"text":"mini-webpack","link":"/webpack/mini-webpack"},{"text":"minipack","link":"/webpack/minipack"},{"text":"[todo]tapable","link":"/webpack/tapable"}],"collapsable":true}]},"footer":{"message":"Released under the MIT License.","copyright":"Copyright © 2022-present Beka"}},"head":[["script",{"id":"check-dark-light"},"\n        ;(() => {\n          const saved = localStorage.getItem('island-theme-appearance')\n          const prefereDark = window.matchMedia('(prefers-color-scheme: dark)').matches\n          if (!saved || saved === 'auto' ? prefereDark : saved === 'dark') {\n            document.documentElement.classList.add('dark')\n          }\n        })()\n      "]],"base":"","icon":"","root":"/Users/beka/Desktop/code/bekacodechn.github.io/blog","appearance":true},"pagePath":"/Users/beka/Desktop/code/bekacodechn.github.io/blog/chrome/how-web-browser-works/part-5_optimization-in-the-interaction-stage.md","relativePagePath":"chrome/how-web-browser-works/part-5_optimization-in-the-interaction-stage.md","toc":[{"id":"fps-and-lag-fps-和延迟","text":"FPS and lag (FPS 和延迟)","depth":2},{"id":"reflow-and-repaint-回流和重绘","text":"Reflow and repaint (回流和重绘)","depth":2},{"id":"are-there-any-changes-that-dont-trigger-reflow-and-repaint-at-all--是否有任何更改根本不会触发重排和重绘","text":"Are there any changes that don’t trigger reflow and repaint at all?  (是否有任何更改根本不会触发重排和重绘？)","depth":2},{"id":"optimization-in-the-interaction-stage-is-about-increasing-the-speed-of-frame-generation-交互阶段的优化是关于提高帧生成速度","text":"Optimization in the interaction stage is about increasing the speed of frame generation (交互阶段的优化是关于提高帧生成速度)","depth":2},{"id":"reduce-the-length-of-time-executing-javascript--缩短执行-javascript-的时间长度","text":"Reduce the length of time executing JavaScript  (缩短执行 JavaScript 的时间长度)","depth":3},{"id":"avoid-the-reflow-and-repaint-when-executing-javascript-避免在执行-javascript-时重排和重绘","text":"Avoid the reflow and repaint when executing JavaScript (避免在执行 JavaScript 时重排和重绘)","depth":3},{"id":"using-css-animation-and-will-change-使用-css-动画和will-change","text":"Using CSS animation and “will-change” (使用 CSS 动画和“will-change”)","depth":2}],"title":"References","lastUpdatedTime":"2023/11/9 01:52:20","content":"# 浏览器如何一步一步地工作 — 交互阶段的优化（第 5 部分）\n\n`metadata:`\n\n**原标题:** How does browser work step by step [latest] — optimization in the interaction stage (part 5)\n\n**链接:** https://cabulous.medium.com/how-does-browser-work-in-2019-part-5-optimization-in-the-interaction-stage-66b53b8ec0ad\n\n**文章副标题:** 交互阶段的优化（第 5 部分）\n\n---\n\n交互阶段的优化是关于优化帧。\n\n与页面交互时，用户会触发事件。一些事件会修改页面布局和样式。根据脚本的不同，浏览器可能需要多次经历渲染阶段，以不断地向我们的屏幕交付新的位图或合成帧。\n\n## FPS and lag (FPS 和延迟)\n\n人眼最多可以看到每秒 1,000 帧 （FPS）。在慢速或静态场景中，我们很少分辨出超过 30 FPS 的差异。但是，它在动态场景中变得很明显，例如玩第一人称射击视频游戏。如今，大多数显示器的刷新率为 60 FPS 或 60 赫兹。\n\n理想情况下，浏览器需要完成渲染阶段并在 1/60 秒内交付一帧。即 16.67 毫秒。如果是这样，用户将看到流畅的动画，并且不会感到滞后。\n\n在交互阶段，通常通过执行JavaScript来触发页面更新。大多数时候，它可能会触发回流和重新绘制。\n\n## Reflow and repaint (回流和重绘)\n\n当一行 JavaScript 更改元素高度时会发生什么？\n\n高度修改不会影响 DOM 树。相反，它需要样式计算。\n\n![20231108203608](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231108203608.png)\n\n在样式计算结束时，渲染过程将高度变化反映到布局阶段，从而导致元素几何信息的转换。因此，需要生成布局树。\n\n布局树是其余阶段的依赖关系，因此渲染流程需要经历所有步骤。\n\n此过程称为回流。 \n\n在 JavaScript 中调用时，许多属性检查可能会触发重排，例如“element.offsetLeft”。这是它们的[完整列表](chrome/how-web-browser-works/what-forces-layout-reflow)。\n\n![20231108212931](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231108212931.png)\n\n重排的最坏情况是修改 DOM。例如“document.body.appendChild（node）”。回流过程从第一阶段开始，构建 DOM 树。\n\n如何更改元素的背景颜色？\n\n![20231108213013](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231108213013.png)\n\n同样，让我们从样式计算开始。新的背景颜色不会修改元素的几何图形信息，因此渲染进程会跳过它。它也不会创建新图层，因此让我们跳过图层阶段。在绘制阶段，渲染进程需要生成新的绘制记录以反映背景颜色更新。然后，它经历了其余的阶段。\n\n此过程称为重绘。\n\n重排和重绘都会降低渲染性能，原因有二：\n\n- The reflow and repaint process is happening in the main thread, so it cannot take care of any events triggered by users’ interaction. When it happens, the users feel lagging.  \n重排和重绘过程发生在主线程中，因此它无法处理用户交互触发的任何事件。当它发生时，用户会感到滞后。\n- computation process in the layout, layer, and paint phases are expensive.\n  重排和绘制阶段的计算过程非常昂贵。\n\nSince the repaint skips the layout and layer phases, it is a relatively better option than reflow.\n\n## Are there any changes that don’t trigger reflow and repaint at all?  (是否有任何更改根本不会触发重排和重绘？)\n\n是的。CSS动画就是一个很好的例子。\n\nA typical CSS animation uses a “transform” property. Modifying “transform” value skips the layout, layer, and paint phases, and starts with the tilling in the compositor thread(合成线程).\n\nWithout occupying the main thread, CSS animation doesn’t block users’ interaction. It is the reason that you still see smooth CSS animation even if the page freezes.(在不占用主线程的情况下，CSS动画不会阻止用户的交互。这就是为什么即使页面冻结，您仍然可以看到流畅的CSS动画的原因。)\n\n## Optimization in the interaction stage is about increasing the speed of frame generation (交互阶段的优化是关于提高帧生成速度)\n\nJavaScript 执行、重排和重绘可能会减慢帧生成速度。\n\n执行时，JavaScript 在主线程中运行。这里的想法是尽可能少地使用主线程。\n\n### Reduce the length of time executing JavaScript  (缩短执行 JavaScript 的时间长度)\n\n例如，一个重要的函数可能需要数百毫秒才能完成。它会阻塞主线程并降低性能。\n\n我们可以将函数分成较小的函数，因此每个函数都不会花费很长时间。浏览器有助于在运行函数时优化任务。\n\nWeb Worker 是另一种选择。您可以在渲染器进程中将其作为独立线程进行操作。当脚本在 Web Worker 中运行时，主线程是空闲的。如果一段 JavaScript 没有访问 DOM 和样式表，您可以将其移动到 Web Worker。\n\n### Avoid the reflow and repaint when executing JavaScript (避免在执行 JavaScript 时重排和重绘)\n\n当 DOM 树被修改时，渲染器进程将重新计算样式和布局。通常，计算在另一个任务中异步运行。\n\n让我们看一个例子。\n\n![20231108214535](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231108214535.png)\n\n![20231108214543](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231108214543.png)\n\n第一个任务完成JavaScript执行。然后另一个任务异步运行以计算样式和布局。\n\n如果我们检查脚本末尾的元素高度会怎样？\n\n![20231108214926](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231108214926.png)\n\n当计算元素“offsetHeight”时，该值仍然是旧的，因为渲染器进程尚未计算样式和布局。渲染器进程同步开始计算，以便它可以接收更新的值。\n\n:::tip{title=原文}\nWhen evaluating the element “offsetHeight,” the value is still the old one because the renderer process has not yet computed the style and layout. The renderer process starts the calculation synchronously so it can receive the updated value.\n\n意思是因为计算样式和布局是异步执行的，所以获取`offsetHeight`时是旧值，所以渲染进程不得已同步计算了一遍？\n:::\n\n![20231108215719](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231108215719.png)\n\n在这种情况下，我们强制在 JavaScript 执行任务中进行样式和布局计算。计算会阻塞主线程，直到执行完成。\n\n更糟糕的是？我们在for循环中评估属性。上一个过程会持续发生，直到执行结束。大多数情况下，页面上会出现明显的延迟。\n\n在现实生活中的项目中，很难完全避免评估属性。但是，我们可以尝试尽量减少使用量。\n\n## Using CSS animation and “will-change” (使用 CSS 动画和“will-change”)\n\nCSS动画根本不使用主线程，所以我们可以尽可能多地使用它。\n\n同时，我们可以将“will-change”属性附加到动画元素上。具有“意志更改”的元素将渲染在层树中的独立层上，从而进一步优化合成器线程中的帧生成。\n\n# References\n\n*   [Inside look at modern web browser (part 3)  \n    现代 Web 浏览器内部介绍（第 3 部分）](https://developers.google.com/web/updates/2018/09/inside-browser-part3)\n*   [High Performance Animations — HTML5 Rocks  \n    高性能动画 — HTML5 Rocks](https://www.html5rocks.com/en/tutorials/speed/high-performance-animations/)\n*   [What is the highest frame rate (fps) that can be recognized by human perception?  \n    人类感知可以识别的最高帧率（fps）是多少？](https://www.quora.com/What-is-the-highest-frame-rate-fps-that-can-be-recognized-by-human-perception-At-what-rate-do-we-essentially-stop-noticing-the-difference)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","pageType":"doc","routePath":"/chrome/how-web-browser-works/part-5_optimization-in-the-interaction-stage"};</script>
      
      <script type="module" src="/client-entry.js"></script>
    </body>
  </html>