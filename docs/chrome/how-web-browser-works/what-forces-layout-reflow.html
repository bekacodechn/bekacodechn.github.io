<!DOCTYPE html>
  <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <link rel="icon" href="" type="image/svg+xml"></link>
      <script  id="check-dark-light">
        ;(() => {
          const saved = localStorage.getItem('island-theme-appearance')
          const prefereDark = window.matchMedia('(prefers-color-scheme: dark)').matches
          if (!saved || saved === 'auto' ? prefereDark : saved === 'dark') {
            document.documentElement.classList.add('dark')
          }
        })()
      </script>
      <title data-rh="true">What forces layout / reflow</title>
      <meta data-rh="true" name="description" content="Island"/>
      
      
      <script defer src='https://ga.jspm.io/npm:es-module-shims@1.6.0/dist/es-module-shims.js'></script>
      <script type="importmap">
        {
          "imports": {
            "react": "/react.js","react-dom": "/react-dom.js","react-dom/client": "/react-dom_client.js","react/jsx-runtime": "/react_jsx-runtime.js"
          }
        }
      </script>

      <link rel="stylesheet" href="/assets/style.71d86141.css">

    </head>
    <body>
      <div id="root"><div style="height:100%"><header relative="" z="4" fixed="md:~" class="top-0 left-0" w="100%"><div relative="" p="l-8 sm:x-8" transition="background-color duration-500" class="divider-bottom md:border-b-transparent lg:border-b-transparent" nav-h="mobile lg:desktop"><div flex="" justify="between" m="0 auto" nav-h="mobile lg:desktop" class="_container_1ic07_52  _has-sidebar_1ic07_16"><div border="border t-0 b-1 border-solid transparent" class="_nav-bar-title_1ic07_16"><a href="/" w="100%" h="100%" text="1rem" font="semibold" transition="opacity duration-300" hover="opacity-60" class="flex items-center"><span>beka的博客</span></a></div><div class="_content_1ic07_24" flex="~ 1" justify="end" items-center=""><div class="search" flex="sm:1" pl="sm:8"><div flex="" items-center="~" relative="" mr="2" font="semibold"><svg width="32" height="32" viewBox="0 0 32 32" w="5" h="5" fill="currentColor"><path fill="#888888" d="m29 27.586l-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9a9.01 9.01 0 0 1-9-9Z"></path></svg><input disabled="" cursor="text focus:auto" placeholder="Search" height="8" border="none" type="text" text="sm" p="t-0 r-2 b-0 l-2" transition="all duration-200 ease" class="rounded-sm _searchInput_y03a3_1 " aria-label="Search" autoComplete="off"/><div m="r-3" w="10" h="6" p="x-1.5" rounded="md" border="1px solid gray-light-3" text="xs gray-light-3" flex="~" items-center="~" justify="around" class="_searchCommand_y03a3_7"><span>⌘</span><span>K</span></div></div></div><div class="_rightNav_1ic07_42"><div class="menu"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article</a></div><div text="sm" font="medium" m="x-3" class="text-brand"><a class="_link_r3fql_1 " target="" cursor="pointer">Chrome</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Design-pattern</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Open-source</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Promise</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Webpack</a></div></div><div class="appearance" before="menu-item-before" display="none sm:flex" items-center="center"><button class="_switch_1tqe3_1 undefined" id="" type="button" role="switch"><span class="_check_1tqe3_17"><span class="_icon_1tqe3_34"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_sun_8e60k_1"><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_moon_8e60k_5"><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg></span></span></button></div></div><button class=" _navHamburger_14nz8_1"><span class="_container_14nz8_14"><span class="_top_14nz8_21"></span><span class="_middle_14nz8_27"></span><span class="_bottom_14nz8_33"></span></span></button><div class="_navScreen_1mkpq_1 " id="navScreen"><div class="_container_1mkpq_21"><div class="_navMenu_1mkpq_27"><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class="text-brand"><a class="_link_r3fql_1 " target="" cursor="pointer">Chrome</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Design-pattern</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Open-source</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Promise</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Webpack</a></div></div></div><div class="_socialAndAppearance_1mkpq_50" flex="~" justify="center" items-center="center"><div class="items-center appearance pa-2 _navAppearance_1mkpq_46" flex="~" justify="center"><button class="_switch_1tqe3_1 undefined" id="" type="button" role="switch"><span class="_check_1tqe3_17"><span class="_icon_1tqe3_34"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_sun_8e60k_1"><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_moon_8e60k_5"><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg></span></span></button></div></div></div></div></div></div></div></header><section style="padding-top:var(--island-nav-height)"><div p="t-0 x-6 b-24 sm:6" class="_docLayout_5cssi_8"><div class="_localNav_ncerp_1"><button flex="center" class="_menu_ncerp_16"><div text="md" mr="2" class="i-carbon:menu"></div><span text="md ">Menu</span></button></div><aside class="_sidebar_iav29_1 "><nav><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">Chorme lala</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:28px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">以用户为中心的效果指标</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">浏览器工作原理</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:168px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">高级体系结构（第 1 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">导航阶段（第 2 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">渲染阶段（第 3 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">加载阶段的优化（第 4 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">交互阶段的优化（第 5 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-brand"><a class="_link_r3fql_1 " target="" cursor="pointer">什么强制了重排/回流</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">Html</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:84px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Metadata</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">html</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer"># 文档结构</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">关键指标</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:84px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">First Contentful Paint (FCP)</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Largest Contentful Paint (LCP)</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Time to First Byte (TTFB)</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">性能</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:140px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">一般 HTML 性能注意事项</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">optimize-resource-loading 优化资源负载</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">asdf</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Welcome to Lean performance</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">速度为什么重要</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">性能技巧</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:448px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Web 上的多进程：浏览器进程模型</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Browser Rendering Pipeline</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">通过火焰图找到有问题的代码</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">如何收集 Web 性能跟踪</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">事件循环基础知识</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">深度讲解火焰图 🔥🔥</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">长任务：它们是什么以及为什么应该避免它们</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">performance 查看主线程（颜色含义）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">检测浏览器何时在 JavaScript 中绘制Frame</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">如何阅读 Chromium Profiler</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">使用 Chromium 网络标签页获取性能详情</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">使用性能时序标记进行📏测量</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Chromium F12 性能分析器的基本概述</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">传输大小 vs 资源大小</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">如何阅读火焰图 🔥</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">识别 Web 应用中的未压缩资源</a></div></div></div></div></section></nav></aside><div flex="~ 1 shrink-0" m="x-auto" class="_content_5cssi_2"><div m="x-auto" flex="~ col" class="max-w-100%"><div relative="~" m="x-auto" p="l-2" class="w-100% md:max-w-712px lg:min-w-640px "><div class="island-doc "><!--$--><h1 id="什么强制了重排回流"><a class="header-anchor" aria-hidden="true" href="#什么强制了重排回流">#</a>什么强制了重排/回流</h1>
<p><code>metadata:</code></p>
<p><strong>原标题:</strong> What forces layout / reflow</p>
<p><strong>链接:</strong> <a href="https://gist.github.com/paulirish/5d52fb081b3570c81e3a" target="_blank" rel="nofollow">https://gist.github.com/paulirish/5d52fb081b3570c81e3a</a></p>
<hr/>
<h1 id="what-forces-layout--reflow"><a class="header-anchor" aria-hidden="true" href="#what-forces-layout--reflow">#</a>What forces layout / reflow</h1>
<p>All of the below properties or methods, when requested/called in JavaScript, will trigger the browser to synchronously calculate the style and layout. This is also called reflow or <a href="http://www.kellegous.com/j/2013/01/26/layout-performance/" target="_blank" rel="nofollow">layout thrashing</a>, and is common performance bottleneck.</p>
<p>Generally, all APIs that synchronously provide layout metrics will trigger forced reflow / layout. Read on for additional cases and details.</p>
<h3 id="element-apis"><a class="header-anchor" aria-hidden="true" href="#element-apis">#</a>Element APIs</h3>
<h5 id="getting-box-metrics"><a class="header-anchor" aria-hidden="true" href="#getting-box-metrics">#</a>Getting box metrics</h5>
<ul>
<li><code>elem.offsetLeft</code>, <code>elem.offsetTop</code>, <code>elem.offsetWidth</code>, <code>elem.offsetHeight</code>, <code>elem.offsetParent</code></li>
<li><code>elem.clientLeft</code>, <code>elem.clientTop</code>, <code>elem.clientWidth</code>, <code>elem.clientHeight</code></li>
<li><code>elem.getClientRects()</code>, <code>elem.getBoundingClientRect()</code></li>
</ul>
<h5 id="scroll-stuff"><a class="header-anchor" aria-hidden="true" href="#scroll-stuff">#</a>Scroll stuff</h5>
<ul>
<li><code>elem.scrollBy()</code>, <code>elem.scrollTo()</code></li>
<li><code>elem.scrollIntoView()</code>, <code>elem.scrollIntoViewIfNeeded()</code></li>
<li><code>elem.scrollWidth</code>, <code>elem.scrollHeight</code></li>
<li><code>elem.scrollLeft</code>, <code>elem.scrollTop</code> also, setting them</li>
</ul>
<h5 id="setting-focus"><a class="header-anchor" aria-hidden="true" href="#setting-focus">#</a>Setting focus</h5>
<ul>
<li><code>elem.focus()</code>   (<a href="https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/dom/element.cc;l=4206-4225;drc=d685ea3c9ffcb18c781bc3a0bdbb92eb88842b1b" target="_blank" rel="nofollow">source</a>)</li>
</ul>
<h5 id="also"><a class="header-anchor" aria-hidden="true" href="#also">#</a>Also…</h5>
<ul>
<li><code>elem.computedRole</code>, <code>elem.computedName</code></li>
<li><code>elem.innerText</code> (<a href="https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/editing/element_inner_text.cc;l=462-468;drc=d685ea3c9ffcb18c781bc3a0bdbb92eb88842b1b" target="_blank" rel="nofollow">source</a>)</li>
</ul>
<h3 id="getting-window-dimensions"><a class="header-anchor" aria-hidden="true" href="#getting-window-dimensions">#</a>Getting window dimensions</h3>
<ul>
<li><code>window.scrollX</code>, <code>window.scrollY</code></li>
<li><code>window.innerHeight</code>, <code>window.innerWidth</code></li>
<li>window.visualViewport.height / width / offsetTop / offsetLeft (<a href="https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/frame/visual_viewport.cc;l=435-461;drc=a3c165458e524bdc55db15d2a5714bb9a0c69c70?originalUrl=https:%2F%2Fcs.chromium.org%2F" target="_blank" rel="nofollow">source</a>)</li>
</ul>
<h3 id="document"><a class="header-anchor" aria-hidden="true" href="#document">#</a>document</h3>
<ul>
<li><code>document.scrollingElement</code> only forces style</li>
<li><code>document.elementFromPoint</code></li>
</ul>
<h3 id="forms-setting-selection--focus"><a class="header-anchor" aria-hidden="true" href="#forms-setting-selection--focus">#</a>Forms: Setting selection + focus</h3>
<ul>
<li><code>inputElem.focus()</code></li>
<li><code>inputElem.select()</code>, <code>textareaElem.select()</code></li>
</ul>
<h3 id="mouse-events-reading-offset-data"><a class="header-anchor" aria-hidden="true" href="#mouse-events-reading-offset-data">#</a>Mouse events: Reading offset data</h3>
<ul>
<li><code>mouseEvt.layerX</code>, <code>mouseEvt.layerY</code>, <code>mouseEvt.offsetX</code>, <code>mouseEvt.offsetY</code> (<a href="https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/events/mouse_event.cc;l=476-487;drc=52fd700fb07a43b740d24595d42d8a6a57a43f81" target="_blank" rel="nofollow">source</a>)</li>
</ul>
<h3 id="calling-getcomputedstyle"><a class="header-anchor" aria-hidden="true" href="#calling-getcomputedstyle">#</a>Calling getComputedStyle()</h3>
<p><code>window.getComputedStyle()</code> will typically force style recalc.</p>
<p><code>window.getComputedStyle()</code> will often force layout, as well.</p>
<!-- -->
<p><code>window.getComputedStyle()</code> will force layout in one of 3 conditions:</p>
<ol>
<li>The element is in a shadow tree</li>
<li>There are media queries (viewport-related ones). Specifically, one of the following: (<a href="https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/css/media_query_exp.cc;l=240-256;drc=4c8db70889f2d2fae8338b16f553c646dd20bf78" target="_blank" rel="nofollow">source</a>
<ul>
<li><code>min-width</code>, <code>min-height</code>, <code>max-width</code>, <code>max-height</code>, <code>width</code>, <code>height</code></li>
<li><code>aspect-ratio</code>, <code>min-aspect-ratio</code>, <code>max-aspect-ratio</code></li>
<li><code>device-pixel-ratio</code>, <code>resolution</code>, <code>orientation</code> , <code>min-device-pixel-ratio</code>, <code>max-device-pixel-ratio</code></li>
</ul>
</li>
<li>The property requested is one of the following:  (<a href="https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/css/properties/css_property.h;l=69;drc=d685ea3c9ffcb18c781bc3a0bdbb92eb88842b1b" target="_blank" rel="nofollow">source</a>)<!-- -->
<ul>
<li><code>height</code>, <code>width</code></li>
<li><code>top</code>, <code>right</code>, <code>bottom</code>, <code>left</code></li>
<li><code>margin</code> [<code>-top</code>, <code>-right</code>, <code>-bottom</code>, <code>-left</code>, or <em>shorthand</em>] only if the margin is fixed.</li>
<li><code>padding</code> [<code>-top</code>, <code>-right</code>, <code>-bottom</code>, <code>-left</code>, or <em>shorthand</em>] only if the padding is fixed.</li>
<li><code>transform</code>, <code>transform-origin</code>, <code>perspective-origin</code></li>
<li><code>translate</code>, <code>rotate</code>, <code>scale</code></li>
<li><code>grid</code>, <code>grid-template</code>, <code>grid-template-columns</code>, <code>grid-template-rows</code></li>
<li><code>perspective-origin</code></li>
<li>These items were previously in the list but appear to not be any longer (as of Feb 2018): <code>motion-path</code>, <code>motion-offset</code>, <code>motion-rotation</code>, <code>x</code>, <code>y</code>, <code>rx</code>, <code>ry</code></li>
</ul>
</li>
</ol>
<!-- -->
<h3 id="getting-range-dimensions"><a class="header-anchor" aria-hidden="true" href="#getting-range-dimensions">#</a>Getting <code>Range</code> dimensions</h3>
<ul>
<li><code>range.getClientRects()</code>, <code>range.getBoundingClientRect()</code></li>
</ul>
<h3 id="svg"><a class="header-anchor" aria-hidden="true" href="#svg">#</a>SVG</h3>
<p>Quite a lot of properties/methods force, but I haven&#x27;t made an exhaustive list.
This list in incomplete:</p>
<ul>
<li>SVGLocatable: <code>computeCTM()</code>, <code>getBBox()</code></li>
<li>SVGTextContent: <code>getCharNumAtPosition()</code>, <code>getComputedTextLength()</code>, <code>getEndPositionOfChar()</code>, <code>getExtentOfChar()</code>, <code>getNumberOfChars()</code>, <code>getRotationOfChar()</code>, <code>getStartPositionOfChar()</code>, <code>getSubStringLength()</code>, <code>selectSubString()</code></li>
<li>SVGUse: <code>instanceRoot</code></li>
</ul>
<p>Use the &quot;chromium source tree link&quot; below to explore on your own!</p>
<h3 id="contenteditable"><a class="header-anchor" aria-hidden="true" href="#contenteditable">#</a>contenteditable</h3>
<ul>
<li>Lots &amp; lots of stuff, …including copying an image to clipboard (<a href="https://source.chromium.org/search?q=UpdateStyleAndLayout%20-f:test&amp;ss=chromium%2Fchromium%2Fsrc:third_party%2Fblink%2Frenderer%2Fcore%2Fediting%2F" target="_blank" rel="nofollow">source</a>)</li>
</ul>
<h2 id="appendix-附录"><a class="header-anchor" aria-hidden="true" href="#appendix-附录">#</a>Appendix (附录)</h2>
<ul>
<li>Reflow only has a cost if the document has changed and invalidated the style or layout. Typically, this is because the DOM was changed (classes modified, nodes added/removed, even adding a psuedo-class like <div></div>).</li>
<li>If layout is forced, style must be recalculated first. So forced layout triggers both operations. Their costs are very dependent on the content/situation, but typically both operations are similar in cost.</li>
<li>What should you do about all this? Well, the <code>More on forced layout</code> section below covers everything in more detail, but the short version is:<!-- -->
<ol>
<li><code>for</code> loops that force layout &amp; change the DOM are the worst, avoid them.</li>
<li>Use DevTools Performance Panel to see where this happens. You may be surprised to see how often your app code and library code hits this.</li>
<li>Batch your writes &amp; reads to the DOM (via <a href="https://github.com/wilsonpage/fastdom" target="_blank" rel="nofollow">FastDOM</a> or a virtual DOM implementation). Read your metrics at the begininng of the frame (very very start of <code>rAF</code>, scroll handler, etc), when the numbers are still identical to the last time layout was done.</li>
</ol>
</li>
</ul>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231108210606.png" alt="20231108210606"/>
<!-- -->Timeline trace of The Guardian. Outbrain is forcing layout repeatedly, probably in a loop.</p>
<h5 id="cross-browser"><a class="header-anchor" aria-hidden="true" href="#cross-browser">#</a>Cross-browser</h5>
<ul>
<li>The above data was built by reading the Blink source, so it&#x27;s true for Chrome, Opera, Brave, Edge and most android browsers. You can browse them <a href="https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/dom/document.h;l=657-680;drc=d685ea3c9ffcb18c781bc3a0bdbb92eb88842b1b" target="_blank" rel="nofollow">yourself in the Chromium source tree</a>.</li>
<li><a href="http://gent.ilcore.com/2011/03/how-not-to-trigger-layout-in-webkit.html" target="_blank" rel="nofollow">Tony Gentilcore&#x27;s Layout Triggering List</a> was for 2011 WebKit and generally aligns with the above.</li>
<li>Modern WebKit&#x27;s instances of forced layout are mostly consistent: <a href="https://github.com/WebKit/webkit/search?q=updateLayoutIgnorePendingStylesheets&amp;utf8=%E2%9C%93" target="_blank" rel="nofollow"><code>updateLayoutIgnorePendingStylesheets</code> - GitHub search - WebKit/WebKit </a></li>
<li>Gecko&#x27;s reflow appears to be requested via FrameNeedsReflow. Results: <a href="https://searchfox.org/mozilla-central/search?q=FrameNeedsReflow&amp;case=false&amp;regexp=false&amp;path=%5E%5B%5E%5C0%5D" target="_blank" rel="nofollow"><code>FrameNeedsReflow</code> - mozilla-central searchfox</a></li>
<li>No concrete data on IE or EdgeHTML, but they likely were roughly the same, as the return values for these properties are spec&#x27;d.</li>
</ul>
<h4 id="more-on-forced-layout"><a class="header-anchor" aria-hidden="true" href="#more-on-forced-layout">#</a>More on forced layout</h4>
<ul>
<li><strong><a href="https://developers.google.com/web/fundamentals/performance/rendering/avoid-large-complex-layouts-and-layout-thrashing" target="_blank" rel="nofollow">Avoiding layout thrashing — Web Fundamentals</a></strong> The <strong>best</strong> resource on identifying and fixing this topic.</li>
<li><a href="https://mattandre.ws/2014/05/really-fixing-layout-thrashing/" target="_blank" rel="nofollow">Fixing Layout thrashing in the real world | Matt Andrews</a></li>
<li><a href="https://developer.chrome.com/devtools/docs/demos/too-much-layout" target="_blank" rel="nofollow">Timeline demo: Diagnosing forced synchronous layouts - Google Chrome</a></li>
<li><a href="http://wilsonpage.co.uk/preventing-layout-thrashing/" target="_blank" rel="nofollow">Preventing &#x27;layout thrashing&#x27; | Wilson Page</a></li>
<li><a href="https://github.com/wilsonpage/fastdom" target="_blank" rel="nofollow">wilsonpage/fastdom</a></li>
<li><a href="http://www.phpied.com/rendering-repaint-reflowrelayout-restyle/" target="_blank" rel="nofollow">Rendering: repaint, reflow/relayout, restyle / Stoyan</a></li>
<li><a href="https://web.archive.org/web/20180401153527/https://blog.fogcreek.com/we-spent-a-week-making-trello-boards-load-extremely-fast-heres-how-we-did-it/" target="_blank" rel="nofollow">We spent a week making Trello boards load extremely fast. Here’s how we did it. - Fog Creek Blog</a></li>
<li><a href="https://developers.google.com/speed/articles/reflow?hl=en" target="_blank" rel="nofollow">Minimizing browser reflow  |  PageSpeed Insights  |  Google Developers</a></li>
<li><a href="https://developer.apple.com/videos/wwdc/2012/?id=601" target="_blank" rel="nofollow">Optimizing Web Content in UIWebViews and Websites on iOS</a></li>
<li><a href="http://www.html5rocks.com/en/tutorials/speed/layers/" target="_blank" rel="nofollow">Accelerated Rendering in Chrome</a></li>
<li><a href="https://www.igvita.com/slides/2012/web-performance-for-the-curious/" target="_blank" rel="nofollow">web performance for the curious</a></li>
<li><a href="http://jankfree.org/" target="_blank" rel="nofollow">Jank Free</a></li>
</ul>
<hr/>
<p>Updated slightly April 2020. Codesearch links and a few changes to relevant element properties.</p><!--/$--></div><footer mt="8"><div class="xs:flex" p="b-5" justify="between" items-center="~"><div flex="" text="sm text-2" leading-6="~" leading-8="sm:~" font-medium=""><p>Last Updated: </p><span>2023/11/9 01:52:20</span></div></div><div flex="~ col sm:row" justify="sm:around" gap="2" divider-top="" pt="6"><div flex="~ col" class="_prev_1f77m_13"><a href="/chrome/how-web-browser-works/part-5_optimization-in-the-interaction-stage" class="_pager-link_1f77m_20"><span class="_desc_1f77m_43">Previous Page</span><span class="_title_1f77m_34">交互阶段的优化（第 5 部分）</span></a></div><div flex="~ col" class="_next_1f77m_16"><a href="/chrome/html/metadata" class="_pager-link_1f77m_20 _next_1f77m_16"><span class="_desc_1f77m_43">Next page</span><span class="_title_1f77m_34">Metadata</span></a></div></div></footer></div></div><div relative="~" display="none lg:block" order="2" flex="1" p="l-8" class="max-w-256px"><div class="_aside-container_5cssi_32"><div flex="~ col" p="b-8" style="min-height:calc(100vh - (var(--island-nav-height-desktop) + 32px))"><div><div flex="~ col 1"><div display="lg:block"><div relative="" divider-left="" p="l-4" text="13px" font-medium="" id="aside-container"><div absolute="" pos="top-33px" opacity="0" w="1px" h="18px" bg="brand" style="left:-1px;transition:top 0.25s cubic-bezier(0, 1, 0.5, 1), background-color 0.5s, opacity 0.25s" id="aside-marker"></div><div block="~" leading-7="" text="13px" font="semibold">目录</div><nav><ul relative=""><li><a href="#element-apis" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">Element APIs</a></li><li><a href="#getting-window-dimensions" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">Getting window dimensions</a></li><li><a href="#document" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">document</a></li><li><a href="#forms-setting-selection--focus" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">Forms: Setting selection + focus</a></li><li><a href="#mouse-events-reading-offset-data" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">Mouse events: Reading offset data</a></li><li><a href="#calling-getcomputedstyle" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">Calling getComputedStyle()</a></li><li><a href="#getting-range-dimensions" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">Getting Range dimensions</a></li><li><a href="#svg" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">SVG</a></li><li><a href="#contenteditable" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">contenteditable</a></li><li><a href="#appendix-附录" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Appendix (附录)</a></li><li><a href="#more-on-forced-layout" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:24px">More on forced layout</a></li></ul></nav></div></div></div></div></div></div></div></div></div></section></div></div>
      <script>window.ISLAND_PAGE_DATA={"siteData":{"lang":"en-US","title":"beka的博客","description":"Island","themeConfig":{"lastUpdatedText":"上次更新","outlineTitle":"目录","nav":[{"text":"Article","link":"/article/astro","activeMatch":"/article/"},{"text":"Chrome","link":"/chrome/fast-load-time/user-centric-performance-metrics","activeMatch":"/chrome/"},{"text":"Design-pattern","link":"/design-pattern/indexs","activeMatch":"/design-pattern/"},{"text":"Open-source","link":"/open-source/delay","activeMatch":"/open-source/"},{"text":"Promise","link":"/promise/first-resolved","activeMatch":"/promise/"},{"text":"Webpack","link":"/webpack/build-result","activeMatch":"/webpack/"}],"sidebar":{"article":[{"text":"Article","items":[{"text":"Astro","link":"/article/astro"},{"text":"新一代全栈框架 Fresh","link":"/article/fresh"}],"collapsable":true}],"chrome":[{"text":"Chorme lala","items":[{"text":"以用户为中心的效果指标","link":"/chrome/fast-load-time/user-centric-performance-metrics"}],"collapsable":true},{"text":"浏览器工作原理","items":[{"text":"高级体系结构（第 1 部分）","link":"/chrome/how-web-browser-works/part-1_high-level-architecture"},{"text":"导航阶段（第 2 部分）","link":"/chrome/how-web-browser-works/part-2_navigation-phase"},{"text":"渲染阶段（第 3 部分）","link":"/chrome/how-web-browser-works/part-3_rendering-phase"},{"text":"加载阶段的优化（第 4 部分）","link":"/chrome/how-web-browser-works/part-4_optimization-in-the-loading-stage"},{"text":"交互阶段的优化（第 5 部分）","link":"/chrome/how-web-browser-works/part-5_optimization-in-the-interaction-stage"},{"text":"什么强制了重排/回流","link":"/chrome/how-web-browser-works/what-forces-layout-reflow"}],"collapsable":true},{"text":"Html","items":[{"text":"Metadata","link":"/chrome/html/metadata"},{"text":"html","link":"/chrome/html/overview"},{"text":"# 文档结构","link":"/chrome/html/structure"}],"collapsable":true},{"text":"关键指标","items":[{"text":"First Contentful Paint (FCP)","link":"/chrome/metrics/FCP"},{"text":"Largest Contentful Paint (LCP)","link":"/chrome/metrics/LCP"},{"text":"Time to First Byte (TTFB)","link":"/chrome/metrics/TTFB"}],"collapsable":true},{"text":"性能","items":[{"text":"一般 HTML 性能注意事项","link":"/chrome/performance/general-html-performance"},{"text":"optimize-resource-loading 优化资源负载","link":"/chrome/performance/optimize-resource-loading"},{"text":"asdf","link":"/chrome/performance/welcome-copy"},{"text":"Welcome to Lean performance","link":"/chrome/performance/welcome"},{"text":"速度为什么重要","link":"/chrome/performance/why-speed-matters"}],"collapsable":true},{"text":"性能技巧","items":[{"text":"Web 上的多进程：浏览器进程模型","link":"/chrome/performance/tips/browser-process-model"},{"text":"Browser Rendering Pipeline","link":"/chrome/performance/tips/browser-rendering-pipeline"},{"text":"通过火焰图找到有问题的代码","link":"/chrome/performance/tips/codepath-scoping"},{"text":"如何收集 Web 性能跟踪","link":"/chrome/performance/tips/collect-a-trace"},{"text":"事件循环基础知识","link":"/chrome/performance/tips/event-loop"},{"text":"深度讲解火焰图 🔥🔥","link":"/chrome/performance/tips/flamegraphs-in-depth"},{"text":"长任务：它们是什么以及为什么应该避免它们","link":"/chrome/performance/tips/long-tasks"},{"text":"performance 查看主线程（颜色含义）","link":"/chrome/performance/tips/main-profiler-pane"},{"text":"检测浏览器何时在 JavaScript 中绘制Frame","link":"/chrome/performance/tips/measuring-paint-time"},{"text":"如何阅读 Chromium Profiler","link":"/chrome/performance/tips/network-profiler-pane"},{"text":"使用 Chromium 网络标签页获取性能详情","link":"/chrome/performance/tips/network-tab"},{"text":"使用性能时序标记进行📏测量","link":"/chrome/performance/tips/performance-timing-markers"},{"text":"Chromium F12 性能分析器的基本概述","link":"/chrome/performance/tips/profiler-basic-ui"},{"text":"传输大小 vs 资源大小","link":"/chrome/performance/tips/resource-size-vs-transfer-size"},{"text":"如何阅读火焰图 🔥","link":"/chrome/performance/tips/understanding-flamegraphs"},{"text":"识别 Web 应用中的未压缩资源","link":"/chrome/performance/tips/validating-compression"}],"collapsable":true}],"design-pattern":[{"text":"Design-pattern","items":[{"text":"资源列表","link":"/design-pattern/indexs"},{"text":"代理模式","link":"/design-pattern/proxy-pattern"},{"text":"Singleton Pattern","link":"/design-pattern/singleton-pattern"},{"text":"状态模式","link":"/design-pattern/state-pattern"},{"text":"策略模式","link":"/design-pattern/strategy-pattern"}],"collapsable":true}],"open-source":[{"text":"Open-source","items":[{"text":"delay","link":"/open-source/delay"},{"text":"dot-prop","link":"/open-source/dot-prop"},{"text":"glob-to-regexp","link":"/open-source/glob-to-regexp"},{"text":"koa 洋葱模型","link":"/open-source/koa-compose"},{"text":"quick-lru","link":"/open-source/lru-cache"},{"text":"p-defer","link":"/open-source/p-defer"},{"text":"p-lazy","link":"/open-source/p-lazy"},{"text":"p-limit","link":"/open-source/p-limit"},{"text":"p-locate","link":"/open-source/p-locate"},{"text":"p-settle","link":"/open-source/p-settle"},{"text":"yocto-queue","link":"/open-source/yocto-queue"}],"collapsable":true}],"promise":[{"text":"Promise","items":[{"text":"顺序执行任务直到第一个resolved","link":"/promise/first-resolved"},{"text":"reduce实现多个promise顺序执行","link":"/promise/sequential-execution"}],"collapsable":true}],"webpack":[{"text":"Webpack","items":[{"text":"webpack 打包结果解析","link":"/webpack/build-result"},{"text":"mini-webpack","link":"/webpack/mini-webpack"},{"text":"minipack","link":"/webpack/minipack"},{"text":"[todo]tapable","link":"/webpack/tapable"}],"collapsable":true}]},"footer":{"message":"Released under the MIT License.","copyright":"Copyright © 2022-present Beka"}},"head":[["script",{"id":"check-dark-light"},"\n        ;(() => {\n          const saved = localStorage.getItem('island-theme-appearance')\n          const prefereDark = window.matchMedia('(prefers-color-scheme: dark)').matches\n          if (!saved || saved === 'auto' ? prefereDark : saved === 'dark') {\n            document.documentElement.classList.add('dark')\n          }\n        })()\n      "]],"base":"","icon":"","root":"/Users/beka/Desktop/code/bekacodechn.github.io/blog","appearance":true},"pagePath":"/Users/beka/Desktop/code/bekacodechn.github.io/blog/chrome/how-web-browser-works/what-forces-layout-reflow.md","relativePagePath":"chrome/how-web-browser-works/what-forces-layout-reflow.md","toc":[{"id":"element-apis","text":"Element APIs","depth":3},{"id":"getting-window-dimensions","text":"Getting window dimensions","depth":3},{"id":"document","text":"document","depth":3},{"id":"forms-setting-selection--focus","text":"Forms: Setting selection + focus","depth":3},{"id":"mouse-events-reading-offset-data","text":"Mouse events: Reading offset data","depth":3},{"id":"calling-getcomputedstyle","text":"Calling getComputedStyle()","depth":3},{"id":"getting-range-dimensions","text":"Getting Range dimensions","depth":3},{"id":"svg","text":"SVG","depth":3},{"id":"contenteditable","text":"contenteditable","depth":3},{"id":"appendix-附录","text":"Appendix (附录)","depth":2},{"id":"more-on-forced-layout","text":"More on forced layout","depth":4}],"title":"What forces layout / reflow","lastUpdatedTime":"2023/11/9 01:52:20","content":"# 什么强制了重排/回流\n\n`metadata:`\n\n**原标题:** What forces layout / reflow\n\n**链接:** https://gist.github.com/paulirish/5d52fb081b3570c81e3a\n\n---\n\n# What forces layout / reflow\n\nAll of the below properties or methods, when requested/called in JavaScript, will trigger the browser to synchronously calculate the style and layout. This is also called reflow or [layout thrashing](http://www.kellegous.com/j/2013/01/26/layout-performance/), and is common performance bottleneck.\n\nGenerally, all APIs that synchronously provide layout metrics will trigger forced reflow / layout. Read on for additional cases and details.\n\n### Element APIs\n\n##### Getting box metrics\n* `elem.offsetLeft`, `elem.offsetTop`, `elem.offsetWidth`, `elem.offsetHeight`, `elem.offsetParent`\n* `elem.clientLeft`, `elem.clientTop`, `elem.clientWidth`, `elem.clientHeight`\n* `elem.getClientRects()`, `elem.getBoundingClientRect()`\n\n##### Scroll stuff\n* `elem.scrollBy()`, `elem.scrollTo()`\n* `elem.scrollIntoView()`, `elem.scrollIntoViewIfNeeded()`  \n* `elem.scrollWidth`, `elem.scrollHeight`\n* `elem.scrollLeft`, `elem.scrollTop` also, setting them\n\n##### Setting focus\n* `elem.focus()`   ([source](https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/dom/element.cc;l=4206-4225;drc=d685ea3c9ffcb18c781bc3a0bdbb92eb88842b1b))\n\n##### Also…\n* `elem.computedRole`, `elem.computedName`  \n* `elem.innerText` ([source](https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/editing/element_inner_text.cc;l=462-468;drc=d685ea3c9ffcb18c781bc3a0bdbb92eb88842b1b))\n\n### Getting window dimensions\n\n* `window.scrollX`, `window.scrollY`\n* `window.innerHeight`, `window.innerWidth`\n* window.visualViewport.height / width / offsetTop / offsetLeft ([source](https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/frame/visual_viewport.cc;l=435-461;drc=a3c165458e524bdc55db15d2a5714bb9a0c69c70?originalUrl=https:%2F%2Fcs.chromium.org%2F))\n\n### document \n\n* `document.scrollingElement` only forces style\n* `document.elementFromPoint`\n\n### Forms: Setting selection + focus\n\n* `inputElem.focus()`\n* `inputElem.select()`, `textareaElem.select()`\n\n### Mouse events: Reading offset data\n\n* `mouseEvt.layerX`, `mouseEvt.layerY`, `mouseEvt.offsetX`, `mouseEvt.offsetY` ([source](https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/events/mouse_event.cc;l=476-487;drc=52fd700fb07a43b740d24595d42d8a6a57a43f81))\n\n\n### Calling getComputedStyle()\n\n`window.getComputedStyle()` will typically force style recalc.\n\n`window.getComputedStyle()` will often force layout, as well.\n\n<details>\n<summary>Details of the conditions where gCS() forces layout</summary>\n\n`window.getComputedStyle()` will force layout in one of 3 conditions:\n\n1. The element is in a shadow tree\n1. There are media queries (viewport-related ones). Specifically, one of the following: ([source](https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/css/media_query_exp.cc;l=240-256;drc=4c8db70889f2d2fae8338b16f553c646dd20bf78)\n   * `min-width`, `min-height`, `max-width`, `max-height`, `width`, `height`\n   * `aspect-ratio`, `min-aspect-ratio`, `max-aspect-ratio`\n   * `device-pixel-ratio`, `resolution`, `orientation` , `min-device-pixel-ratio`, `max-device-pixel-ratio`\n1. The property requested is one of the following:  ([source](https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/css/properties/css_property.h;l=69;drc=d685ea3c9ffcb18c781bc3a0bdbb92eb88842b1b))\n   * `height`, `width`\n   * `top`, `right`, `bottom`, `left`\n   * `margin` [`-top`, `-right`, `-bottom`, `-left`, or *shorthand*] only if the margin is fixed.\n   * `padding` [`-top`, `-right`, `-bottom`, `-left`, or *shorthand*] only if the padding is fixed.\n   * `transform`, `transform-origin`, `perspective-origin`\n   * `translate`, `rotate`, `scale`\n   * `grid`, `grid-template`, `grid-template-columns`, `grid-template-rows`\n   * `perspective-origin`\n   * These items were previously in the list but appear to not be any longer (as of Feb 2018): `motion-path`, `motion-offset`, `motion-rotation`, `x`, `y`, `rx`, `ry`\n\n</details>\n\n### Getting `Range` dimensions\n\n* `range.getClientRects()`, `range.getBoundingClientRect()`\n\n### SVG\n\nQuite a lot of properties/methods force, but I haven't made an exhaustive list. \nThis list in incomplete:\n\n* SVGLocatable: `computeCTM()`, `getBBox()`\n* SVGTextContent: `getCharNumAtPosition()`, `getComputedTextLength()`, `getEndPositionOfChar()`, `getExtentOfChar()`, `getNumberOfChars()`, `getRotationOfChar()`, `getStartPositionOfChar()`, `getSubStringLength()`, `selectSubString()`\n* SVGUse: `instanceRoot`\n\nUse the \"chromium source tree link\" below to explore on your own!\n\n\n### contenteditable\n  \n* Lots & lots of stuff, …including copying an image to clipboard ([source](https://source.chromium.org/search?q=UpdateStyleAndLayout%20-f:test&ss=chromium%2Fchromium%2Fsrc:third_party%2Fblink%2Frenderer%2Fcore%2Fediting%2F))\n  \n\n## Appendix (附录)\n\n* Reflow only has a cost if the document has changed and invalidated the style or layout. Typically, this is because the DOM was changed (classes modified, nodes added/removed, even adding a psuedo-class like :focus).\n* If layout is forced, style must be recalculated first. So forced layout triggers both operations. Their costs are very dependent on the content/situation, but typically both operations are similar in cost.\n* What should you do about all this? Well, the `More on forced layout` section below covers everything in more detail, but the short version is: \n  1. `for` loops that force layout & change the DOM are the worst, avoid them. \n  1. Use DevTools Performance Panel to see where this happens. You may be surprised to see how often your app code and library code hits this.\n  1. Batch your writes & reads to the DOM (via [FastDOM](https://github.com/wilsonpage/fastdom) or a virtual DOM implementation). Read your metrics at the begininng of the frame (very very start of `rAF`, scroll handler, etc), when the numbers are still identical to the last time layout was done. \n\n![20231108210606](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231108210606.png)\n<i>Timeline trace of The Guardian. Outbrain is forcing layout repeatedly, probably in a loop.</i>\n\n##### Cross-browser \n* The above data was built by reading the Blink source, so it's true for Chrome, Opera, Brave, Edge and most android browsers. You can browse them [yourself in the Chromium source tree](https://source.chromium.org/chromium/chromium/src/+/master:third_party/blink/renderer/core/dom/document.h;l=657-680;drc=d685ea3c9ffcb18c781bc3a0bdbb92eb88842b1b).\n* [Tony Gentilcore's Layout Triggering List](http://gent.ilcore.com/2011/03/how-not-to-trigger-layout-in-webkit.html) was for 2011 WebKit and generally aligns with the above. \n* Modern WebKit's instances of forced layout are mostly consistent: [`updateLayoutIgnorePendingStylesheets` - GitHub search - WebKit/WebKit ](https://github.com/WebKit/webkit/search?q=updateLayoutIgnorePendingStylesheets&utf8=%E2%9C%93)\n* Gecko's reflow appears to be requested via FrameNeedsReflow. Results: [`FrameNeedsReflow` - mozilla-central searchfox](https://searchfox.org/mozilla-central/search?q=FrameNeedsReflow&case=false&regexp=false&path=%5E%5B%5E%5C0%5D)\n* No concrete data on IE or EdgeHTML, but they likely were roughly the same, as the return values for these properties are spec'd.\n\n\n#### More on forced layout\n\n* **[Avoiding layout thrashing — Web Fundamentals](https://developers.google.com/web/fundamentals/performance/rendering/avoid-large-complex-layouts-and-layout-thrashing)** The **best** resource on identifying and fixing this topic.\n* [Fixing Layout thrashing in the real world | Matt Andrews](https://mattandre.ws/2014/05/really-fixing-layout-thrashing/)\n* [Timeline demo: Diagnosing forced synchronous layouts - Google Chrome](https://developer.chrome.com/devtools/docs/demos/too-much-layout)\n* [Preventing &apos;layout thrashing&apos; | Wilson Page](http://wilsonpage.co.uk/preventing-layout-thrashing/)\n* [wilsonpage/fastdom](https://github.com/wilsonpage/fastdom)\n* [Rendering: repaint, reflow/relayout, restyle / Stoyan](http://www.phpied.com/rendering-repaint-reflowrelayout-restyle/)\n* [We spent a week making Trello boards load extremely fast. Here’s how we did it. - Fog Creek Blog](https://web.archive.org/web/20180401153527/https://blog.fogcreek.com/we-spent-a-week-making-trello-boards-load-extremely-fast-heres-how-we-did-it/)\n* [Minimizing browser reflow  |  PageSpeed Insights  |  Google Developers](https://developers.google.com/speed/articles/reflow?hl=en)\n* [Optimizing Web Content in UIWebViews and Websites on iOS](https://developer.apple.com/videos/wwdc/2012/?id=601)\n* [Accelerated Rendering in Chrome](http://www.html5rocks.com/en/tutorials/speed/layers/)\n* [web performance for the curious](https://www.igvita.com/slides/2012/web-performance-for-the-curious/)\n* [Jank Free](http://jankfree.org/)\n\n-------------\n\nUpdated slightly April 2020. Codesearch links and a few changes to relevant element properties.\n\n\n\n\n\n\n\n\n\n\n\n","pageType":"doc","routePath":"/chrome/how-web-browser-works/what-forces-layout-reflow"};</script>
      
      <script type="module" src="/client-entry.js"></script>
    </body>
  </html>