<!DOCTYPE html>
  <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <link rel="icon" href="" type="image/svg+xml"></link>
      <script  id="check-dark-light">
        ;(() => {
          const saved = localStorage.getItem('island-theme-appearance')
          const prefereDark = window.matchMedia('(prefers-color-scheme: dark)').matches
          if (!saved || saved === 'auto' ? prefereDark : saved === 'dark') {
            document.documentElement.classList.add('dark')
          }
        })()
      </script>
      <title data-rh="true">通过摇树减少 JavaScript 有效负载</title>
      <meta data-rh="true" name="description" content="Island"/>
      
      
      <script defer src='https://ga.jspm.io/npm:es-module-shims@1.6.0/dist/es-module-shims.js'></script>
      <script type="importmap">
        {
          "imports": {
            "react": "/react.js","react-dom": "/react-dom.js","react-dom/client": "/react-dom_client.js","react/jsx-runtime": "/react_jsx-runtime.js"
          }
        }
      </script>

      <link rel="stylesheet" href="/assets/style.81be0ec3.css">

    </head>
    <body>
      <div id="root"><div style="height:100%"><header relative="" z="4" fixed="md:~" class="top-0 left-0" w="100%"><div relative="" p="l-8 sm:x-8" transition="background-color duration-500" class="divider-bottom md:border-b-transparent lg:border-b-transparent" nav-h="mobile lg:desktop"><div flex="" justify="between" m="0 auto" nav-h="mobile lg:desktop" class="_container_1ic07_52  _has-sidebar_1ic07_16"><div border="border t-0 b-1 border-solid transparent" class="_nav-bar-title_1ic07_16"><a href="/" w="100%" h="100%" text="1rem" font="semibold" transition="opacity duration-300" hover="opacity-60" class="flex items-center"><span>beka的博客</span></a></div><div class="_content_1ic07_24" flex="~ 1" justify="end" items-center=""><div class="search" flex="sm:1" pl="sm:8"><div flex="" items-center="~" relative="" mr="2" font="semibold"><svg width="32" height="32" viewBox="0 0 32 32" w="5" h="5" fill="currentColor"><path fill="#888888" d="m29 27.586l-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9a9.01 9.01 0 0 1-9-9Z"></path></svg><input disabled="" cursor="text focus:auto" placeholder="Search" height="8" border="none" type="text" text="sm" p="t-0 r-2 b-0 l-2" transition="all duration-200 ease" class="rounded-sm _searchInput_y03a3_1 " aria-label="Search" autoComplete="off"/><div m="r-3" w="10" h="6" p="x-1.5" rounded="md" border="1px solid gray-light-3" text="xs gray-light-3" flex="~" items-center="~" justify="around" class="_searchCommand_y03a3_7"><span>⌘</span><span>K</span></div></div></div><div class="_rightNav_1ic07_42"><div class="menu"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article-set</a></div><div text="sm" font="medium" m="x-3" class="text-brand"><a class="_link_r3fql_1 " target="" cursor="pointer">Chrome</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Design-pattern</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Open-source</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Promise</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Typescript</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Webpack</a></div></div><div class="appearance" before="menu-item-before" display="none sm:flex" items-center="center"><button class="_switch_1tqe3_1 undefined" id="" type="button" role="switch"><span class="_check_1tqe3_17"><span class="_icon_1tqe3_34"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_sun_8e60k_1"><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_moon_8e60k_5"><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg></span></span></button></div></div><button class=" _navHamburger_14nz8_1"><span class="_container_14nz8_14"><span class="_top_14nz8_21"></span><span class="_middle_14nz8_27"></span><span class="_bottom_14nz8_33"></span></span></button><div class="_navScreen_1mkpq_1 " id="navScreen"><div class="_container_1mkpq_21"><div class="_navMenu_1mkpq_27"><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article-set</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class="text-brand"><a class="_link_r3fql_1 " target="" cursor="pointer">Chrome</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Design-pattern</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Open-source</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Promise</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Typescript</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Webpack</a></div></div></div><div class="_socialAndAppearance_1mkpq_50" flex="~" justify="center" items-center="center"><div class="items-center appearance pa-2 _navAppearance_1mkpq_46" flex="~" justify="center"><button class="_switch_1tqe3_1 undefined" id="" type="button" role="switch"><span class="_check_1tqe3_17"><span class="_icon_1tqe3_34"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_sun_8e60k_1"><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_moon_8e60k_5"><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg></span></span></button></div></div></div></div></div></div></div></header><section style="padding-top:var(--island-nav-height)"><div p="t-0 x-6 b-24 sm:6" class="_docLayout_5cssi_8"><div class="_localNav_ncerp_1"><button flex="center" class="_menu_ncerp_16"><div text="md" mr="2" class="i-carbon:menu"></div><span text="md ">Menu</span></button></div><aside class="_sidebar_iav29_1 "><nav><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">Chrome</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:28px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">以用户为中心的效果指标</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">浏览器工作原理</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:168px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Web 浏览器如何逐步工作 — 高级体系结构（第 1 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Web 浏览器如何逐步工作 — 导航阶段（第 2 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">浏览器如何逐步工作 — 渲染阶段（第 3 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">浏览器如何逐步工作 — 加载阶段的优化（第 4 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">浏览器如何一步一步地工作 — 交互阶段的优化（第 5 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">什么强制了重排/回流</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">Html</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:84px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Metadata</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">html</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer"># 文档结构</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">关键指标</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:84px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">First Contentful Paint (FCP) 首次内容绘制</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Largest Contentful Paint (LCP) 最大内容填充</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Time to First Byte (TTFB) 首次字节加载时间</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">现代网络浏览器内幕</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:112px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">现代网络浏览器内幕 — 1</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">现代网络浏览器内幕 — 2</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">现代网络浏览器内幕 — 3</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">现代网络浏览器内幕 — 4</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">性能</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:224px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">1. Welcome to Lean performance</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">2. 一般 HTML 性能注意事项</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">使用导航定时和资源定时评估现场的负载性能</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">优化长任务</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">optimize-resource-loading 优化资源负载</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-brand"><a class="_link_r3fql_1 " target="" cursor="pointer">通过摇树减少 JavaScript 有效负载</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">asdf</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">速度为什么重要</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">性能技巧</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:476px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Web 上的多进程：浏览器进程模型</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Browser Rendering Pipeline</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">通过火焰图找到有问题的代码</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">如何收集 Web 性能跟踪</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">事件循环基础知识</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">深度讲解火焰图 🔥🔥</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">长任务：它们是什么以及为什么应该避免它们</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">performance 查看主线程（颜色含义）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">检测浏览器何时在 JavaScript 中绘制Frame</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">如何阅读 Chromium Profiler</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">使用 Chromium 网络标签页获取性能详情</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">使用性能时序标记进行📏测量</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Chromium F12 性能分析器的基本概述</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">【--空文件--】: performance/tips/resource-size-vs-transfer-size.md</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">如何阅读火焰图 🔥</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">识别 Web 应用中的未压缩资源</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">asdfadsasdsdfasdf</a></div></div></div></div></section></nav></aside><div flex="~ 1 shrink-0" m="x-auto" class="_content_5cssi_2"><div m="x-auto" flex="~ col" class="max-w-100%"><div relative="~" m="x-auto" p="l-2" class="w-100% md:max-w-712px lg:min-w-640px "><div class="island-doc "><!--$--><h1 id="通过摇树减少-javascript-有效负载"><a class="header-anchor" aria-hidden="true" href="#通过摇树减少-javascript-有效负载">#</a>通过摇树减少 JavaScript 有效负载</h1>
<p><code>metadata:</code></p>
<p><strong>原标题:</strong> Reduce JavaScript payloads with tree shaking</p>
<p><strong>链接:</strong> <a href="https://web.dev/articles/reduce-javascript-payloads-with-tree-shaking" target="_blank" rel="nofollow">https://web.dev/articles/reduce-javascript-payloads-with-tree-shaking</a></p>
<hr/>
<p>Today&#x27;s web applications can get pretty big, especially the JavaScript part of them. As of mid-2018, HTTP Archive puts the <a href="https://httparchive.org/reports/state-of-javascript#bytesJs" target="_blank" rel="nofollow">median transfer size of JavaScript on mobile devices</a> at approximately 350 KB. And this is just transfer size! JavaScript is often compressed when sent over the network, meaning that the <em>actual</em> amount of JavaScript is quite a bit more after the browser decompresses it. That&#x27;s important to point out, because as far as resource <em>processing</em> is concerned, compression is irrelevant. 900 KB of decompressed JavaScript is still 900 KB to the parser and compiler, even though it may be roughly 300 KB when compressed.</p>
<p>今天的 Web 应用程序可能会变得非常大，尤其是其中的 JavaScript 部分。截至 2018 年年中，HTTP Archive 将 JavaScript 在移动设备上的传输大小中位数定为约 350 KB。而这只是传输大小！JavaScript 在通过网络发送时通常会被压缩，这意味着在浏览器解压缩后，JavaScript 的实际数量会多得多。需要指出的是，就资源处理而言，压缩是无关紧要的。900 KB 的解压缩 JavaScript 对于解析器和编译器来说仍然是 900 KB，即使压缩后可能大约 300 KB。</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116112020.png" alt="20231116112020"/>
<em>The process of downloading and running JavaScript. Note that even though the transfer size of the script is 300 KB compressed, it is still 900 KB worth of JavaScript that must be parsed, compiled, and executed.</em></p>
<p><em>下载和运行 JavaScript 的过程。请注意，即使脚本的传输大小压缩为 300 KB，但仍必须解析、编译和执行 900 KB 的 JavaScript。</em></p>
<p>JavaScript is an expensive resource to process. Unlike images which only incur relatively trivial decode time once downloaded, JavaScript must be parsed, compiled, and then finally executed. Byte for byte, this makes JavaScript more expensive than other types of resources.</p>
<p>JavaScript 是一种昂贵的处理资源。与下载后仅产生相对微不足道的解码时间的图像不同，JavaScript 必须经过解析、编译，然后最终执行。逐字节，这使得 JavaScript 比其他类型的资源更昂贵。</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116112125.png" alt="20231116112125"/>
<em>The processing cost of parsing/compiling 170 KB of JavaScript vs decode time of an equivalently sized JPEG. (<a href="https://medium.com/dev-channel/the-cost-of-javascript-84009f51e99e" target="_blank" rel="nofollow">source</a>).</em></p>
<p><em>解析/编译 170 KB JavaScript 的处理成本与同等大小的 JPEG 的解码时间之比。（来源）.</em></p>
<p><a href="https://v8.dev/blog/background-compilation" target="_blank" rel="nofollow">While improvements are continually being made</a> to <a href="https://blog.mozilla.org/javascript/2017/12/12/javascript-startup-bytecode-cache/" target="_blank" rel="nofollow">improve the efficiency of JavaScript engines</a>, improving JavaScript performance is—as always—a task for developers.</p>
<p>虽然不断进行改进以提高 JavaScript 引擎的效率，但提高 JavaScript 性能一如既往地是开发人员的任务。</p>
<p>To that end, there are techniques to improve JavaScript performance. <a href="https://web.dev/articles/reduce-javascript-payloads-with-code-splitting" target="_blank" rel="nofollow">Code splitting</a>, is one such technique that improves performance by partitioning application JavaScript into chunks, and serving those chunks to only the routes of an application that need them.</p>
<p>为此，有一些技术可以提高 JavaScript 性能。代码拆分就是这样一种技术，它通过将应用程序 JavaScript 划分为多个块，并将这些块仅提供给需要它们的应用程序的路由来提高性能。</p>
<p>While this technique works, it doesn&#x27;t address a common problem of JavaScript-heavy applications, which is the inclusion of code that&#x27;s never used. Tree shaking attempts to solve this problem.</p>
<p>虽然这种技术有效，但它并没有解决 JavaScript 密集型应用程序的常见问题，即包含从未使用过的代码。摇树试图解决这个问题。</p>
<h2 id="what-is-tree-shaking--什么是摇树"><a class="header-anchor" aria-hidden="true" href="#what-is-tree-shaking--什么是摇树">#</a>What is tree shaking?  什么是摇树？</h2>
<p><a href="https://en.wikipedia.org/wiki/Tree_shaking" target="_blank" rel="nofollow">Tree shaking</a> is a form of dead code elimination. <a href="https://github.com/rollup/rollup#tree-shaking" target="_blank" rel="nofollow">The term was popularized by Rollup</a>, but the concept of dead code elimination has existed for some time. The concept has also found purchase in <a href="https://webpack.js.org/guides/tree-shaking/" target="_blank" rel="nofollow">webpack</a>, which is demonstrated in this article by way of a sample app.</p>
<p>摇树是消除死代码的一种形式。该术语由 Rollup 推广，但死代码消除的概念已经存在了一段时间。这个概念在 webpack 中也得到了购买，本文通过一个示例应用程序进行了演示。</p>
<p>The term &quot;tree shaking&quot; comes from the mental model of your application and its dependencies as a tree-like structure. Each node in the tree represents a dependency that provides distinct functionality for your app. In modern apps, these dependencies are brought in via <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/import" target="_blank" rel="nofollow">static <code>import</code> statements</a> like so:</p>
<p>术语“摇树”来自应用程序的心智模型及其作为树状结构的依赖关系。树中的每个节点都表示一个依赖项，该依赖项为应用提供不同的功能。在现代应用中，这些依赖项是通过静态 <code>import</code> 语句引入的，如下所示：</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#616E88">// Import all the array utilities!</span></span>
<span class="line"><span style="color:#81A1C1">import</span><span style="color:#D8DEE9FF"> </span><span style="color:#8FBCBB">arrayUtils</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">from</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">array-utils</span><span style="color:#ECEFF4">&quot;</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span></div></div>
<div class="island-directive info"><p class="island-directive-title">INFO</p><div class="island-directive-content"><p><strong>Note:</strong> If you&#x27;re not sure what ES6 modules are, <a href="https://ponyfoo.com/articles/es6-modules-in-depth" target="_blank" rel="nofollow">this explainer at Pony Foo</a> is worth a look. This guide assumes you have working knowledge of how ES6 modules work, so if you don&#x27;t know anything about them, give that article a read!</p><p>注意：如果您不确定 ES6 模块是什么，Pony Foo 的这个解释器值得一看。本指南假设您对 ES6 模块的工作原理有一定的了解，所以如果你对它们一无所知，请阅读这篇文章！</p></div></div>
<p>When an app is young—a sapling, if you will—it may have few dependencies. It&#x27;s also using most—if not all—the dependencies you add. As your app matures, however, more dependencies can get added. To compound matters, older dependencies fall out of use, but may not get pruned from your codebase. The end result is that an app ends up shipping with a lot of <a href="https://web.dev/unused-javascript" target="_blank" rel="nofollow">unused JavaScript</a>. Tree shaking addresses this by taking advantage of how static <code>import</code> statements pull in specific parts of ES6 modules:</p>
<p>当一个应用程序还很年轻时（如果你愿意的话，它是一棵树苗），它可能几乎没有依赖关系。它还使用您添加的大多数（如果不是全部）依赖项。但是，随着应用的成熟，可以添加更多依赖项。雪上加霜的是，较旧的依赖项不再使用，但可能不会从代码库中删除。最终结果是，一个应用程序最终会附带大量未使用的 JavaScript。摇树通过利用静态 <code>import</code> 语句如何拉入 ES6 模块的特定部分来解决这个问题：</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#616E88">// Import only some of the utilities!</span></span>
<span class="line"><span style="color:#81A1C1">import</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span><span style="color:#D8DEE9FF"> </span><span style="color:#8FBCBB">unique</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#8FBCBB">implode</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#8FBCBB">explode</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">from</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">array-utils</span><span style="color:#ECEFF4">&quot;</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span></div></div>
<p>The difference between this <code>import</code> example and the previous one is that rather than importing <em>everything</em> from the <code>&quot;array-utils&quot;</code> module—which could be a lot of code)—this example imports only specific parts of it. In dev builds, this doesn&#x27;t change anything, as the entire module gets imported regardless. In production builds, webpack can be configured to &quot;shake&quot; off <a href="https://developer.mozilla.org/docs/web/javascript/reference/statements/export" target="_blank" rel="nofollow">exports</a> from ES6 modules that weren&#x27;t explicitly imported, making those production builds smaller. In this guide, you&#x27;ll learn how to do just that!</p>
<p>此示例与上一个示例的区别在于，此 <code>import</code> 示例不是从模块中导入所有内容（可能是大量代码），而是仅导入 <code>&quot;array-utils&quot;</code> 模块的特定部分。在开发版本中，这不会改变任何事情，因为无论如何都会导入整个模块。在生产版本中，webpack 可以配置为“摆脱”未显式导入的 ES6 模块的导出，从而使这些生产版本更小。在本指南中，您将学习如何做到这一点！</p>
<h2 id="finding-opportunities-to-shake-a-tree--寻找机会摇晃一棵树"><a class="header-anchor" aria-hidden="true" href="#finding-opportunities-to-shake-a-tree--寻找机会摇晃一棵树">#</a>Finding opportunities to shake a tree  寻找机会摇晃一棵树</h2>
<p>For illustrative purposes, <a href="https://github.com/malchata/webpack-tree-shaking-example" target="_blank" rel="nofollow">a sample one-page app</a> is available that demonstrates how tree shaking works. You can clone it and follow along if you like, but we&#x27;ll cover every step of the way together in this guide, so cloning isn&#x27;t necessary (unless hands-on learning is your thing).</p>
<p>为了便于说明，提供了一个示例单页应用程序，用于演示摇树的工作原理。如果您愿意，您可以克隆它并跟随它，但我们将在本指南中一起介绍每一步，因此克隆不是必需的（除非您喜欢动手学习）。</p>
<p>The sample app is a searchable database of guitar effect pedals. You enter a query and a list of effect pedals will appear.</p>
<p>示例应用是吉他效果踏板的可搜索数据库。您输入查询，将出现效果踏板列表。</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116112856.png" alt="20231116112856"/></p>
<p>The behavior that drives this app is separated into vendor (i.e., <a href="https://preactjs.com/" target="_blank" rel="nofollow">Preact</a> and <a href="https://emotion.sh/" target="_blank" rel="nofollow">Emotion</a>) and app-specific code bundles (or &quot;chunks&quot;, as webpack calls them):</p>
<p>驱动此应用程序的行为分为供应商（即 Preact 和 Emotion）和特定于应用程序的代码包（或 webpack 称之为“块”）：</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116112919.png" alt="20231116112919"/></p>
<p>The JavaScript bundles shown in the figure above are production builds, meaning they&#x27;re optimized through uglification. 21.1 KB for an app-specific bundle isn&#x27;t bad, but it should be noted that no tree shaking is occurring whatsoever. Let&#x27;s look at the app code and see what can be done to fix that.</p>
<p>上图中显示的 JavaScript 包是生产版本，这意味着它们通过丑化进行了优化。21.1 KB 对于特定于应用程序的捆绑包来说还不错，但应该注意的是，没有发生任何摇树。让我们看一下应用代码，看看可以做些什么来解决这个问题。</p>
<div class="island-directive info"><p class="island-directive-title">INFO</p><div class="island-directive-content"><p><strong>Note:</strong> If you don&#x27;t care for a long-winded explanation, and want to dive into code, go ahead and check out <a href="https://github.com/malchata/webpack-tree-shaking-example/tree/tree-shake" target="_blank" rel="nofollow">the <code>tree-shake</code> branch</a> in the app&#x27;s GitHub repo. You can also <a href="https://github.com/malchata/webpack-tree-shaking-example/compare/tree-shake" target="_blank" rel="nofollow">diff this branch</a> to see exactly what was changed to make tree shaking work!</p><p>注意：如果您不关心冗长的解释，并且想要深入研究代码，请继续查看应用程序的 GitHub 存储库中的 <code>tree-shake</code> 分支。您还可以比较此分支，以确切地查看为使摇树工作而更改的内容！</p></div></div>
<p>In any application, finding tree shaking opportunities are going to involve looking for static <code>import</code> statements. <a href="https://github.com/malchata/webpack-tree-shaking-example/blob/master/src/components/FilterablePedalList/FilterablePedalList.js#L4" target="_blank" rel="nofollow">Near the top of the main component file</a>, you&#x27;ll see a line like this:</p>
<p>在任何应用程序中，寻找摇树机会都将涉及寻找静态 <code>import</code> 语句。在主组件文件的顶部附近，您会看到如下行：</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#81A1C1">import</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">*</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">as</span><span style="color:#D8DEE9FF"> </span><span style="color:#8FBCBB">utils</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">from</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">../../utils/utils</span><span style="color:#ECEFF4">&quot;</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span></div></div>
<p>You can <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/import#description" target="_blank" rel="nofollow">import ES6 modules in a variety of ways</a>, but ones like this should get your attention. This specific line says &quot;<code>import</code> <em>everything</em> from the <code>utils</code> module, and put it in a namespace called <code>utils</code>.&quot; The big question to ask here is, &quot;just how much <em>stuff</em> is in that module?&quot;</p>
<p>您可以通过多种方式导入 ES6 模块，但像这样的模块应该引起您的注意。这一行说“ <code>import</code> <code>utils</code> 模块中的所有内容，并将其放在名为 <code>utils</code> 的命名空间中。这里要问的一个大问题是，“那个模块中到底有多少东西？</p>
<p>If you look at <a href="https://github.com/malchata/webpack-tree-shaking-example/blob/master/src/utils/utils.js" target="_blank" rel="nofollow">the <code>utils</code> module source code</a>, you&#x27;ll find there&#x27;s about 1,300 lines of code.</p>
<p>如果你看一下 <code>utils</code> 模块的源代码，你会发现大约有 1,300 行代码。</p>
<p>Do you <em>need</em> all that stuff? Let&#x27;s double check by searching <a href="https://github.com/malchata/webpack-tree-shaking-example/blob/master/src/components/FilterablePedalList/FilterablePedalList.js" target="_blank" rel="nofollow">the main component file</a> that imports the <code>utils</code> module to see how many instances of that namespace come up.</p>
<p>你需要所有这些东西吗？让我们通过搜索导入 <code>utils</code> 模块的主组件文件来仔细检查，看看该命名空间有多少个实例。</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116113023.png" alt="20231116113023"/>
<em>The <code>utils</code> namespace we&#x27;ve imported tons of modules from is only invoked three times within the main component file.</em></p>
<p><em>我们从中导入了大量模块的 <code>utils</code> 命名空间在主组件文件中只调用了三次。</em></p>
<p>As it turns out, the <code>utils</code> namespace appears in only three spots in our application—but for what functions? If you take a look at the main component file again, it appears to be only one function, which is <code>utils.simpleSort</code>, which is used to sort the search results list by a number of criteria when the sorting dropdowns are changed:</p>
<p>事实证明， <code>utils</code> 命名空间在我们的应用程序中只出现在三个位置，但用于什么功能？如果再次查看主组件文件，它似乎只有一个函数，即 <code>utils.simpleSort</code> ，用于在更改排序下拉列表时按多个条件对搜索结果列表进行排序：</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#81A1C1">if</span><span style="color:#D8DEE9FF"> (</span><span style="color:#81A1C1">this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">state</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">sortBy</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">===</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">model</span><span style="color:#ECEFF4">&quot;</span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">  </span><span style="color:#616E88">// `simpleSort` gets used here...</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#D8DEE9">json</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">utils</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">simpleSort</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">json</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">model</span><span style="color:#ECEFF4">&quot;</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">state</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">sortOrder</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">else</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">if</span><span style="color:#D8DEE9FF"> (</span><span style="color:#81A1C1">this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">state</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">sortBy</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">===</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">type</span><span style="color:#ECEFF4">&quot;</span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">  </span><span style="color:#616E88">// ..and here...</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#D8DEE9">json</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">utils</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">simpleSort</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">json</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">type</span><span style="color:#ECEFF4">&quot;</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">state</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">sortOrder</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">else</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">  </span><span style="color:#616E88">// ..and here.</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#D8DEE9">json</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">utils</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">simpleSort</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">json</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">manufacturer</span><span style="color:#ECEFF4">&quot;</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">state</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">sortOrder</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span></div></div>
<p>Out of a 1,300 line file with a bunch of exports, only one of them is used. This results in shipping a lot of unused JavaScript.</p>
<p>在包含一堆导出的 1,300 行文件中，只使用了其中一个。这导致大量未使用的 JavaScript 发布。</p>
<div class="island-directive info"><p class="island-directive-title">INFO</p><div class="island-directive-content"><p><strong>Note:</strong> This project is purposefully kept simple, so it&#x27;s a bit easier in this case to find out where the bloat is coming from. In large projects with many modules, however, things get more complicated. Tools such as <a href="https://www.npmjs.com/package/webpack-bundle-analyzer" target="_blank" rel="nofollow">Webpack Bundle Analyzer</a> and <a href="https://www.npmjs.com/package/source-map-explorer" target="_blank" rel="nofollow">source-map-explorer</a> may provide further insight.</p><p>注意：这个项目特意保持简单，所以在这种情况下，找出膨胀的来源会更容易一些。然而，在具有许多模块的大型项目中，事情变得更加复杂。Webpack Bundle Analyzer 和 source-map-explorer 等工具可能会提供进一步的见解。</p></div></div>
<p>While this example app is admittedly a bit contrived, it doesn&#x27;t change the fact that this synthetic sort of scenario resembles actual optimization opportunities you may encounter in a production web app. Now that you&#x27;ve identified an opportunity for tree shaking to be useful, how is it actually done?</p>
<p>虽然此示例应用确实有点做作，但它并没有改变这样一个事实，即这种合成类型的方案类似于您在生产 Web 应用中可能遇到的实际优化机会。既然您已经确定了摇树有用的机会，那么它实际上是如何完成的？</p>
<h2 id="keeping-babel-from-transpiling-es6-modules-to-commonjs-modules--防止-babel-将-es6-模块转译为-commonjs-模块"><a class="header-anchor" aria-hidden="true" href="#keeping-babel-from-transpiling-es6-modules-to-commonjs-modules--防止-babel-将-es6-模块转译为-commonjs-模块">#</a>Keeping Babel from transpiling ES6 modules to CommonJS modules  防止 Babel 将 ES6 模块转译为 CommonJS 模块</h2>
<p><a href="https://babeljs.io/" target="_blank" rel="nofollow">Babel</a> is an indispensable tool, but it may make the effects of tree shaking a bit more difficult to observe. If you&#x27;re using <a href="https://babeljs.io/docs/en/babel-preset-env" target="_blank" rel="nofollow"><code>@babel/preset-env</code></a>, Babel <em>may</em> transform ES6 modules into more widely compatible CommonJS modules—that is, modules you <code>require</code> instead of <code>import</code>.</p>
<p>巴别塔是不可或缺的工具，但它可能会使树木摇晃的影响更难观察。如果您使用的 <code>@babel/preset-env</code> 是 ，Babel 可能会将 ES6 模块转换为更广泛兼容的 CommonJS 模块，即 u <code>require</code> 模块而不是 <code>import</code> .</p>
<p>Because tree shaking is more difficult to do for CommonJS modules, webpack won&#x27;t know what to prune from bundles if you decide to use them. The solution is to configure <code>@babel/preset-env</code> to explicitly leave ES6 modules alone. Wherever you configure Babel—be it in <code>babel.config.js</code> or <code>package.json</code>—this involves adding a little something extra:</p>
<p>因为 CommonJS 模块更难做摇树，所以如果你决定使用它们，webpack 将不知道要从捆绑包中删除什么。解决方案是配置为 <code>@babel/preset-env</code> 显式保留 ES6 模块。无论你在什么地方配置 Babel——无论是在 in <code>babel.config.js</code> 中还是在 <code>package.json</code> - 这都涉及添加一些额外的东西：</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#616E88">// babel.config.js</span></span>
<span class="line"><span style="color:#81A1C1">export</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">default</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#88C0D0">presets</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> [</span></span>
<span class="line"><span style="color:#D8DEE9FF">    [</span></span>
<span class="line"><span style="color:#D8DEE9FF">      </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">@babel/preset-env</span><span style="color:#ECEFF4">&quot;</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">        </span><span style="color:#88C0D0">modules</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">false</span></span>
<span class="line"><span style="color:#D8DEE9FF">      </span><span style="color:#ECEFF4">}</span></span>
<span class="line"><span style="color:#D8DEE9FF">    ]</span></span>
<span class="line"><span style="color:#D8DEE9FF">  ]</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span></div></div>
<p>Specifying <code>modules: false</code> in your <code>@babel/preset-env</code> config gets Babel to behave as desired, which allows webpack to analyze your dependency tree and shake off unused dependencies.</p>
<p>在你的 <code>@babel/preset-env</code> 配置中指定 <code>modules: false</code> 可以让 Babel 按照预期运行，这允许 webpack 分析你的依赖树并摆脱未使用的依赖。</p>
<h2 id="keeping-side-effects-in-mind--牢记副作用"><a class="header-anchor" aria-hidden="true" href="#keeping-side-effects-in-mind--牢记副作用">#</a>Keeping side effects in mind  牢记副作用</h2>
<p>Another aspect to consider when shaking dependencies from your app is whether your project&#x27;s modules have side effects. An example of a side effect is when a function modifies something outside of its own scope, which is a <em>side effect</em> of its execution:</p>
<p>从应用中摇动依赖项时要考虑的另一个方面是项目的模块是否有副作用。副作用的一个例子是，当一个函数修改了它自己的范围之外的东西时，这是其执行的副作用：</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#81A1C1">let</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">fruits</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> [</span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">apple</span><span style="color:#ECEFF4">&quot;</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">orange</span><span style="color:#ECEFF4">&quot;</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">pear</span><span style="color:#ECEFF4">&quot;</span><span style="color:#D8DEE9FF">]</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9">console</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">log</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">fruits</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span><span style="color:#D8DEE9FF"> </span><span style="color:#616E88">// (3) [&quot;apple&quot;, &quot;orange&quot;, &quot;pear&quot;]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0">addFruit</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">function</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">fruit</span><span style="color:#ECEFF4">)</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#D8DEE9">fruits</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">push</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">fruit</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#ECEFF4">}</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0">addFruit</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">kiwi</span><span style="color:#ECEFF4">&quot;</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9">console</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">log</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">fruits</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span><span style="color:#D8DEE9FF"> </span><span style="color:#616E88">// (4) [&quot;apple&quot;, &quot;orange&quot;, &quot;pear&quot;, &quot;kiwi&quot;]</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span></div></div>
<p>In this example, <code>addFruit</code> produces a side effect when it modifies the <code>fruits</code> array, which is outside its scope.</p>
<p>在此示例中，当它修改 <code>fruits</code> 数组时会产生副作用， <code>addFruit</code> 这超出了其范围。</p>
<p>Side effects also apply to ES6 modules, and that matters in the context of tree shaking. Modules that take predictable inputs and produce equally predictable outputs without modifying anything outside of their own scope are dependencies that can be safely dropped if we&#x27;re not using them. They&#x27;re self-contained, <em>modular</em> pieces of code. Hence, &quot;modules&quot;.</p>
<p>副作用也适用于 ES6 模块，这在摇树的背景下很重要。采用可预测的输入并产生同样可预测的输出而不修改其自身范围之外的任何内容的模块是依赖项，如果我们不使用它们，则可以安全地删除它们。它们是独立的模块化代码片段。因此，“模块”。</p>
<p>Where webpack is concerned, a hint can be used to specify that a package and its dependencies are free of side effects by specifying <code>&quot;sideEffects&quot;: false</code> in a project&#x27;s <code>package.json</code> file:</p>
<p>就 webpack 而言，可以通过在项目 <code>package.json</code> 文件中指定来指定 <code>&quot;sideEffects&quot;: false</code> 包及其依赖项没有副作用：</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">name</span><span style="color:#ECEFF4">&quot;</span><span style="color:#D8DEE9FF">: </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">webpack-tree-shaking-example</span><span style="color:#ECEFF4">&quot;</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">version</span><span style="color:#ECEFF4">&quot;</span><span style="color:#D8DEE9FF">: </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">1.0.0</span><span style="color:#ECEFF4">&quot;</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">sideEffects</span><span style="color:#ECEFF4">&quot;</span><span style="color:#D8DEE9FF">: </span><span style="color:#81A1C1">false</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span></div></div>
<p>Alternatively, you can tell webpack which specific files are not side effect-free:</p>
<p>或者，你可以告诉 webpack 哪些特定文件不是没有副作用的：</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">name</span><span style="color:#ECEFF4">&quot;</span><span style="color:#D8DEE9FF">: </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">webpack-tree-shaking-example</span><span style="color:#ECEFF4">&quot;</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">version</span><span style="color:#ECEFF4">&quot;</span><span style="color:#D8DEE9FF">: </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">1.0.0</span><span style="color:#ECEFF4">&quot;</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">sideEffects</span><span style="color:#ECEFF4">&quot;</span><span style="color:#D8DEE9FF">: [</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">./src/utils/utils.js</span><span style="color:#ECEFF4">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF">  ]</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span></div></div>
<p>In the latter example, any file that isn&#x27;t specified will be assumed to be free of side effects. If you don&#x27;t want to add this to your <code>package.json</code> file, <a href="https://github.com/webpack/webpack/issues/6065#issuecomment-351060570" target="_blank" rel="nofollow">you can also specify this flag in your webpack config via <code>module.rules</code></a>.</p>
<p>在后一个示例中，任何未指定的文件都将被假定为没有副作用。如果您不想将其添加到文件中 <code>package.json</code> ，也可以通过 <code>module.rules</code> 在 webpack 配置中指定此标志。</p>
<h2 id="importing-only-whats-needed--仅导入所需内容"><a class="header-anchor" aria-hidden="true" href="#importing-only-whats-needed--仅导入所需内容">#</a>Importing only what&#x27;s needed  仅导入所需内容</h2>
<p>After instructing Babel to leave ES6 modules alone, a slight adjustment to our <code>import</code> syntax is required to bring in only the functions needed from the <code>utils</code> module. In this guide&#x27;s example, all that&#x27;s needed is the <code>simpleSort</code> function:</p>
<p>在指示 Babel 不理会 ES6 模块之后，需要对我们的 <code>import</code> 语法稍作调整，以仅引入 <code>utils</code> 模块所需的函数。在本指南的示例中，只需要函数 <code>simpleSort</code> ：</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#81A1C1">import</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span><span style="color:#D8DEE9FF"> </span><span style="color:#8FBCBB">simpleSort</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">from</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">../../utils/utils</span><span style="color:#ECEFF4">&quot;</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span></div></div>
<p>Because only <code>simpleSort</code> is being imported instead of the entire <code>utils</code> module, every instance of <code>utils.simpleSort</code> will need to changed to <code>simpleSort</code>:</p>
<p>因为只 <code>simpleSort</code> 导入而不是导入整个 <code>utils</code> 模块，所以每个 <code>utils.simpleSort</code> 实例都需要更改为 <code>simpleSort</code> ：</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#81A1C1">if</span><span style="color:#D8DEE9FF"> (</span><span style="color:#81A1C1">this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">state</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">sortBy</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">===</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">model</span><span style="color:#ECEFF4">&quot;</span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#D8DEE9">json</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0">simpleSort</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">json</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">model</span><span style="color:#ECEFF4">&quot;</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">state</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">sortOrder</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">else</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">if</span><span style="color:#D8DEE9FF"> (</span><span style="color:#81A1C1">this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">state</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">sortBy</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">===</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">type</span><span style="color:#ECEFF4">&quot;</span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#D8DEE9">json</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0">simpleSort</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">json</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">type</span><span style="color:#ECEFF4">&quot;</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">state</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">sortOrder</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">else</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#D8DEE9">json</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0">simpleSort</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">json</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&quot;</span><span style="color:#A3BE8C">manufacturer</span><span style="color:#ECEFF4">&quot;</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">this</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">state</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">sortOrder</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span></div></div>
<p>This should be all that&#x27;s needed for tree shaking to work in this example. This is the webpack output before shaking the dependency tree:</p>
<p>在此示例中，这应该是摇树工作所需的全部内容。这是动摇依赖树之前的 webpack 输出：</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#D8DEE9FF">                 </span><span style="color:#D8DEE9">Asset</span><span style="color:#D8DEE9FF">      </span><span style="color:#D8DEE9">Size</span><span style="color:#D8DEE9FF">  </span><span style="color:#D8DEE9">Chunks</span><span style="color:#D8DEE9FF">             </span><span style="color:#D8DEE9">Chunk</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">Names</span></span>
<span class="line"><span style="color:#D8DEE9">js</span><span style="color:#81A1C1">/</span><span style="color:#D8DEE9">vendors</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9FF">16262743</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">js</span><span style="color:#D8DEE9FF">  </span><span style="color:#B48EAD">37.1</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">KiB</span><span style="color:#D8DEE9FF">       </span><span style="color:#B48EAD">0</span><span style="color:#D8DEE9FF">  [</span><span style="color:#D8DEE9">emitted</span><span style="color:#D8DEE9FF">]  </span><span style="color:#D8DEE9">vendors</span></span>
<span class="line"><span style="color:#D8DEE9FF">   </span><span style="color:#D8DEE9">js</span><span style="color:#81A1C1">/</span><span style="color:#D8DEE9">main</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9FF">797</span><span style="color:#D8DEE9">ebb8b</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">js</span><span style="color:#D8DEE9FF">  </span><span style="color:#B48EAD">20.8</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">KiB</span><span style="color:#D8DEE9FF">       </span><span style="color:#B48EAD">1</span><span style="color:#D8DEE9FF">  [</span><span style="color:#D8DEE9">emitted</span><span style="color:#D8DEE9FF">]  </span><span style="color:#D8DEE9">main</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span></div></div>
<p>This is the output <em>after</em> tree shaking is successful:</p>
<p>这是摇树成功后的输出：</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#D8DEE9FF">                 </span><span style="color:#D8DEE9">Asset</span><span style="color:#D8DEE9FF">      </span><span style="color:#D8DEE9">Size</span><span style="color:#D8DEE9FF">  </span><span style="color:#D8DEE9">Chunks</span><span style="color:#D8DEE9FF">             </span><span style="color:#D8DEE9">Chunk</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">Names</span></span>
<span class="line"><span style="color:#D8DEE9">js</span><span style="color:#81A1C1">/</span><span style="color:#D8DEE9">vendors</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9FF">45</span><span style="color:#D8DEE9">ce9b64</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">js</span><span style="color:#D8DEE9FF">  </span><span style="color:#B48EAD">36.9</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">KiB</span><span style="color:#D8DEE9FF">       </span><span style="color:#B48EAD">0</span><span style="color:#D8DEE9FF">  [</span><span style="color:#D8DEE9">emitted</span><span style="color:#D8DEE9FF">]  </span><span style="color:#D8DEE9">vendors</span></span>
<span class="line"><span style="color:#D8DEE9FF">   </span><span style="color:#D8DEE9">js</span><span style="color:#81A1C1">/</span><span style="color:#D8DEE9">main</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9FF">559652</span><span style="color:#D8DEE9">be</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">js</span><span style="color:#D8DEE9FF">  </span><span style="color:#B48EAD">8.46</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">KiB</span><span style="color:#D8DEE9FF">       </span><span style="color:#B48EAD">1</span><span style="color:#D8DEE9FF">  [</span><span style="color:#D8DEE9">emitted</span><span style="color:#D8DEE9FF">]  </span><span style="color:#D8DEE9">main</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span></div></div>
<p>While both bundles shrank, it&#x27;s really the <code>main</code> bundle that benefits most. By shaking off the unused parts of the <code>utils</code> module, the <code>main</code> bundle shrinks by about 60%. This not only lowers the amount of time the script takes to the download, but processing time as well.</p>
<p>虽然两个捆绑包都缩小了，但受益最大的确实是 <code>main</code> 捆绑包。通过甩掉 <code>utils</code> 模块中未使用的部分， <code>main</code> 束收缩约60%。这不仅减少了脚本下载所需的时间，还减少了处理时间。</p>
<h2 id="go-shake-some-trees去摇晃一些树"><a class="header-anchor" aria-hidden="true" href="#go-shake-some-trees去摇晃一些树">#</a>Go shake some trees! 去摇晃一些树！</h2>
<p>Whatever mileage you get out of tree shaking depends on your app and its dependencies and architecture. Try it! If you know for a fact you haven&#x27;t set up your module bundler to perform this optimization, there&#x27;s no harm trying and seeing how it benefits your application.</p>
<p>无论您从摇树中获得什么好处，都取决于您的应用及其依赖项和体系结构。试试吧！如果您知道您还没有设置模块捆绑器来执行此优化，那么尝试并了解它如何使您的应用程序受益并没有什么坏处。</p>
<p>You may realize a significant performance gain from tree shaking, or not much at all. But by configuring your build system to take advantage of this optimization in production builds and selectively importing only what your application needs, you&#x27;ll be proactively keeping your application bundles as small as possible.</p>
<p>您可能会从摇树中获得显着的性能提升，或者根本没有实现。但是，通过配置构建系统以在生产构建中利用此优化，并有选择地仅导入应用程序所需的内容，您将主动保持应用程序捆绑包尽可能小。</p>
<p>_Special thanks to Kristofer Baxter, <a href="https://web.dev/authors/developit" target="_blank" rel="nofollow">Jason Miller</a>, <a href="https://web.dev/authors/addyosmani" target="_blank" rel="nofollow">Addy Osmani</a>, <a href="https://web.dev/authors/jeffposnick" target="_blank" rel="nofollow">Jeff Posnick</a>, Sam Saccone, and <a href="https://web.dev/authors/philipwalton" target="_blank" rel="nofollow">Philip Walton</a> for their valuable feedback, which significantly improved the quality of this article.</p>
<p>特别感谢 Kristofer Baxter、Jason Miller、Addy Osmani、Jeff Posnick、Sam Saccone 和 Philip Walton 的宝贵反馈，这大大提高了本文的质量。_</p><!--/$--></div><footer mt="8"><div class="xs:flex" p="b-5" justify="between" items-center="~"><div flex="" text="sm text-2" leading-6="~" leading-8="sm:~" font-medium=""><p>Last Updated: </p><span>2023/11/16 20:32:02</span></div></div><div flex="~ col sm:row" justify="sm:around" gap="2" divider-top="" pt="6"><div flex="~ col" class="_prev_1f77m_13"><a href="/chrome/performance/optimize-resource-loading" class="_pager-link_1f77m_20"><span class="_desc_1f77m_43">Previous Page</span><span class="_title_1f77m_34">optimize-resource-loading 优化资源负载</span></a></div><div flex="~ col" class="_next_1f77m_16"><a href="/chrome/performance/welcome-copy" class="_pager-link_1f77m_20 _next_1f77m_16"><span class="_desc_1f77m_43">Next page</span><span class="_title_1f77m_34">asdf</span></a></div></div></footer></div></div><div relative="~" display="none lg:block" order="2" flex="1" p="l-8" class="max-w-256px"><div class="_aside-container_5cssi_32"><div flex="~ col" p="b-8" style="min-height:calc(100vh - (var(--island-nav-height-desktop) + 32px))"><div><div flex="~ col 1"><div display="lg:block"><div relative="" divider-left="" p="l-4" text="13px" font-medium="" id="aside-container"><div absolute="" pos="top-33px" opacity="0" w="1px" h="18px" bg="brand" style="left:-1px;transition:top 0.25s cubic-bezier(0, 1, 0.5, 1), background-color 0.5s, opacity 0.25s" id="aside-marker"></div><div block="~" leading-7="" text="13px" font="semibold">目录</div><nav><ul relative=""><li><a href="#what-is-tree-shaking--什么是摇树" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">What is tree shaking?  什么是摇树？</a></li><li><a href="#finding-opportunities-to-shake-a-tree--寻找机会摇晃一棵树" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Finding opportunities to shake a tree  寻找机会摇晃一棵树</a></li><li><a href="#keeping-babel-from-transpiling-es6-modules-to-commonjs-modules--防止-babel-将-es6-模块转译为-commonjs-模块" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Keeping Babel from transpiling ES6 modules to CommonJS modules  防止 Babel 将 ES6 模块转译为 CommonJS 模块</a></li><li><a href="#keeping-side-effects-in-mind--牢记副作用" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Keeping side effects in mind  牢记副作用</a></li><li><a href="#importing-only-whats-needed--仅导入所需内容" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Importing only what&#x27;s needed  仅导入所需内容</a></li><li><a href="#go-shake-some-trees去摇晃一些树" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Go shake some trees! 去摇晃一些树！</a></li></ul></nav></div></div></div></div></div></div></div></div></div></section></div></div>
      <script>window.ISLAND_PAGE_DATA={"siteData":{"lang":"en-US","title":"beka的博客","description":"Island","themeConfig":{"lastUpdatedText":"上次更新","outlineTitle":"目录","nav":[{"text":"Article","link":"/article/astro","activeMatch":"/article/"},{"text":"Article-set","link":"/article-set/URL-SET","activeMatch":"/article-set/"},{"text":"Chrome","link":"/chrome/fast-load-time/user-centric-performance-metrics","activeMatch":"/chrome/"},{"text":"Design-pattern","link":"/design-pattern/indexs","activeMatch":"/design-pattern/"},{"text":"Open-source","link":"/open-source/delay","activeMatch":"/open-source/"},{"text":"Promise","link":"/promise/first-resolved","activeMatch":"/promise/"},{"text":"Typescript","link":"/typescript/tip","activeMatch":"/typescript/"},{"text":"Webpack","link":"/webpack/build-result","activeMatch":"/webpack/"}],"sidebar":{"article":[{"text":"Article","items":[{"text":"Astro","link":"/article/astro"},{"text":"新一代全栈框架 Fresh","link":"/article/fresh"}],"collapsable":true}],"article-set":[{"text":"Article-set","items":[{"text":"外链合集","link":"/article-set/URL-SET"},{"text":"requestAnimationFrame","link":"/article-set/raf"}],"collapsable":true}],"chrome":[{"text":"Chrome","items":[{"text":"以用户为中心的效果指标","link":"/chrome/fast-load-time/user-centric-performance-metrics"}],"collapsable":true},{"text":"浏览器工作原理","items":[{"text":"Web 浏览器如何逐步工作 — 高级体系结构（第 1 部分）","link":"/chrome/how-web-browser-works/part-1_high-level-architecture"},{"text":"Web 浏览器如何逐步工作 — 导航阶段（第 2 部分）","link":"/chrome/how-web-browser-works/part-2_navigation-phase"},{"text":"浏览器如何逐步工作 — 渲染阶段（第 3 部分）","link":"/chrome/how-web-browser-works/part-3_rendering-phase"},{"text":"浏览器如何逐步工作 — 加载阶段的优化（第 4 部分）","link":"/chrome/how-web-browser-works/part-4_optimization-in-the-loading-stage"},{"text":"浏览器如何一步一步地工作 — 交互阶段的优化（第 5 部分）","link":"/chrome/how-web-browser-works/part-5_optimization-in-the-interaction-stage"},{"text":"什么强制了重排/回流","link":"/chrome/how-web-browser-works/what-forces-layout-reflow"}],"collapsable":true},{"text":"Html","items":[{"text":"Metadata","link":"/chrome/html/metadata"},{"text":"html","link":"/chrome/html/overview"},{"text":"# 文档结构","link":"/chrome/html/structure"}],"collapsable":true},{"text":"关键指标","items":[{"text":"First Contentful Paint (FCP) 首次内容绘制","link":"/chrome/metrics/FCP"},{"text":"Largest Contentful Paint (LCP) 最大内容填充","link":"/chrome/metrics/LCP"},{"text":"Time to First Byte (TTFB) 首次字节加载时间","link":"/chrome/metrics/TTFB"}],"collapsable":true},{"text":"现代网络浏览器内幕","items":[{"text":"现代网络浏览器内幕 — 1","link":"/chrome/modern-web-browser/inside-browser-part-1"},{"text":"现代网络浏览器内幕 — 2","link":"/chrome/modern-web-browser/inside-browser-part-2"},{"text":"现代网络浏览器内幕 — 3","link":"/chrome/modern-web-browser/inside-browser-part-3"},{"text":"现代网络浏览器内幕 — 4","link":"/chrome/modern-web-browser/inside-browser-part-4"}],"collapsable":true},{"text":"性能","items":[{"text":"1. Welcome to Lean performance","link":"/chrome/performance/1-welcome"},{"text":"2. 一般 HTML 性能注意事项","link":"/chrome/performance/2-general-html-performance"},{"text":"使用导航定时和资源定时评估现场的负载性能","link":"/chrome/performance/navigation-and-resource-timing"},{"text":"优化长任务","link":"/chrome/performance/optimize-long-tasks"},{"text":"optimize-resource-loading 优化资源负载","link":"/chrome/performance/optimize-resource-loading"},{"text":"通过摇树减少 JavaScript 有效负载","link":"/chrome/performance/reduce-javascript-payloads-with-tree-shaking"},{"text":"asdf","link":"/chrome/performance/welcome-copy"},{"text":"速度为什么重要","link":"/chrome/performance/why-speed-matters"}],"collapsable":true},{"text":"性能技巧","items":[{"text":"Web 上的多进程：浏览器进程模型","link":"/chrome/performance/tips/browser-process-model"},{"text":"Browser Rendering Pipeline","link":"/chrome/performance/tips/browser-rendering-pipeline"},{"text":"通过火焰图找到有问题的代码","link":"/chrome/performance/tips/codepath-scoping"},{"text":"如何收集 Web 性能跟踪","link":"/chrome/performance/tips/collect-a-trace"},{"text":"事件循环基础知识","link":"/chrome/performance/tips/event-loop"},{"text":"深度讲解火焰图 🔥🔥","link":"/chrome/performance/tips/flamegraphs-in-depth"},{"text":"长任务：它们是什么以及为什么应该避免它们","link":"/chrome/performance/tips/long-tasks"},{"text":"performance 查看主线程（颜色含义）","link":"/chrome/performance/tips/main-profiler-pane"},{"text":"检测浏览器何时在 JavaScript 中绘制Frame","link":"/chrome/performance/tips/measuring-paint-time"},{"text":"如何阅读 Chromium Profiler","link":"/chrome/performance/tips/network-profiler-pane"},{"text":"使用 Chromium 网络标签页获取性能详情","link":"/chrome/performance/tips/network-tab"},{"text":"使用性能时序标记进行📏测量","link":"/chrome/performance/tips/performance-timing-markers"},{"text":"Chromium F12 性能分析器的基本概述","link":"/chrome/performance/tips/profiler-basic-ui"},{"text":"【--空文件--】: performance/tips/resource-size-vs-transfer-size.md","link":"/chrome/performance/tips/resource-size-vs-transfer-size"},{"text":"如何阅读火焰图 🔥","link":"/chrome/performance/tips/understanding-flamegraphs"},{"text":"识别 Web 应用中的未压缩资源","link":"/chrome/performance/tips/validating-compression"},{"text":"asdfadsasdsdfasdf","link":"/chrome/performance/tips/aa/a"}],"collapsable":true}],"design-pattern":[{"text":"Design-pattern","items":[{"text":"# 资源列表","link":"/design-pattern/indexs"},{"text":"代理模式","link":"/design-pattern/proxy-pattern"},{"text":"Singleton Pattern","link":"/design-pattern/singleton-pattern"},{"text":"状态模式","link":"/design-pattern/state-pattern"},{"text":"策略模式","link":"/design-pattern/strategy-pattern"}],"collapsable":true}],"open-source":[{"text":"Open-source","items":[{"text":"delay","link":"/open-source/delay"},{"text":"dot-prop","link":"/open-source/dot-prop"},{"text":"glob-to-regexp","link":"/open-source/glob-to-regexp"},{"text":"koa 洋葱模型","link":"/open-source/koa-compose"},{"text":"quick-lru","link":"/open-source/lru-cache"},{"text":"p-defer","link":"/open-source/p-defer"},{"text":"p-lazy","link":"/open-source/p-lazy"},{"text":"p-limit","link":"/open-source/p-limit"},{"text":"p-locate","link":"/open-source/p-locate"},{"text":"p-settle","link":"/open-source/p-settle"},{"text":"yocto-queue","link":"/open-source/yocto-queue"}],"collapsable":true}],"promise":[{"text":"Promise","items":[{"text":"顺序执行任务直到第一个resolved。","link":"/promise/first-resolved"},{"text":"reduce实现多个promise顺序执行.","link":"/promise/sequential-execution"}],"collapsable":true}],"typescript":[{"text":"Typescript","items":[{"text":"Typescript 技巧","link":"/typescript/tip"}],"collapsable":true}],"webpack":[{"text":"Webpack","items":[{"text":"webpack 打包代码分析","link":"/webpack/build-result"},{"text":"mini-webpack","link":"/webpack/mini-webpack"},{"text":"minipack-explain","link":"/webpack/minipack"},{"text":"tapable","link":"/webpack/tapable"}],"collapsable":true}]},"footer":{"message":"Released under the MIT License.","copyright":"Copyright © 2022-present Beka"}},"head":[["script",{"id":"check-dark-light"},"\n        ;(() => {\n          const saved = localStorage.getItem('island-theme-appearance')\n          const prefereDark = window.matchMedia('(prefers-color-scheme: dark)').matches\n          if (!saved || saved === 'auto' ? prefereDark : saved === 'dark') {\n            document.documentElement.classList.add('dark')\n          }\n        })()\n      "]],"base":"","icon":"","root":"/Users/beka/Desktop/code/bekacodechn.github.io/blog","appearance":true},"pagePath":"/Users/beka/Desktop/code/bekacodechn.github.io/blog/chrome/performance/reduce-javascript-payloads-with-tree-shaking.md","relativePagePath":"chrome/performance/reduce-javascript-payloads-with-tree-shaking.md","toc":[{"id":"what-is-tree-shaking--什么是摇树","text":"What is tree shaking?  什么是摇树？","depth":2},{"id":"finding-opportunities-to-shake-a-tree--寻找机会摇晃一棵树","text":"Finding opportunities to shake a tree  寻找机会摇晃一棵树","depth":2},{"id":"keeping-babel-from-transpiling-es6-modules-to-commonjs-modules--防止-babel-将-es6-模块转译为-commonjs-模块","text":"Keeping Babel from transpiling ES6 modules to CommonJS modules  防止 Babel 将 ES6 模块转译为 CommonJS 模块","depth":2},{"id":"keeping-side-effects-in-mind--牢记副作用","text":"Keeping side effects in mind  牢记副作用","depth":2},{"id":"importing-only-whats-needed--仅导入所需内容","text":"Importing only what's needed  仅导入所需内容","depth":2},{"id":"go-shake-some-trees去摇晃一些树","text":"Go shake some trees! 去摇晃一些树！","depth":2}],"title":"通过摇树减少 JavaScript 有效负载","lastUpdatedTime":"2023/11/16 20:32:02","content":"# 通过摇树减少 JavaScript 有效负载\n\n\n`metadata:`\n\n**原标题:** Reduce JavaScript payloads with tree shaking\n\n**链接:** https://web.dev/articles/reduce-javascript-payloads-with-tree-shaking\n\n---\n\nToday's web applications can get pretty big, especially the JavaScript part of them. As of mid-2018, HTTP Archive puts the [median transfer size of JavaScript on mobile devices](https://httparchive.org/reports/state-of-javascript#bytesJs) at approximately 350 KB. And this is just transfer size! JavaScript is often compressed when sent over the network, meaning that the _actual_ amount of JavaScript is quite a bit more after the browser decompresses it. That's important to point out, because as far as resource _processing_ is concerned, compression is irrelevant. 900 KB of decompressed JavaScript is still 900 KB to the parser and compiler, even though it may be roughly 300 KB when compressed.  \n\n今天的 Web 应用程序可能会变得非常大，尤其是其中的 JavaScript 部分。截至 2018 年年中，HTTP Archive 将 JavaScript 在移动设备上的传输大小中位数定为约 350 KB。而这只是传输大小！JavaScript 在通过网络发送时通常会被压缩，这意味着在浏览器解压缩后，JavaScript 的实际数量会多得多。需要指出的是，就资源处理而言，压缩是无关紧要的。900 KB 的解压缩 JavaScript 对于解析器和编译器来说仍然是 900 KB，即使压缩后可能大约 300 KB。\n\n![20231116112020](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116112020.png)\n*The process of downloading and running JavaScript. Note that even though the transfer size of the script is 300 KB compressed, it is still 900 KB worth of JavaScript that must be parsed, compiled, and executed.*\n\n*下载和运行 JavaScript 的过程。请注意，即使脚本的传输大小压缩为 300 KB，但仍必须解析、编译和执行 900 KB 的 JavaScript。*\n\nJavaScript is an expensive resource to process. Unlike images which only incur relatively trivial decode time once downloaded, JavaScript must be parsed, compiled, and then finally executed. Byte for byte, this makes JavaScript more expensive than other types of resources.  \n\nJavaScript 是一种昂贵的处理资源。与下载后仅产生相对微不足道的解码时间的图像不同，JavaScript 必须经过解析、编译，然后最终执行。逐字节，这使得 JavaScript 比其他类型的资源更昂贵。\n\n![20231116112125](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116112125.png)\n*The processing cost of parsing/compiling 170 KB of JavaScript vs decode time of an equivalently sized JPEG. ([source](https://medium.com/dev-channel/the-cost-of-javascript-84009f51e99e)).*\n\n*解析/编译 170 KB JavaScript 的处理成本与同等大小的 JPEG 的解码时间之比。（来源）.*\n\n[While improvements are continually being made](https://v8.dev/blog/background-compilation) to [improve the efficiency of JavaScript engines](https://blog.mozilla.org/javascript/2017/12/12/javascript-startup-bytecode-cache/), improving JavaScript performance is—as always—a task for developers.  \n\n虽然不断进行改进以提高 JavaScript 引擎的效率，但提高 JavaScript 性能一如既往地是开发人员的任务。\n\nTo that end, there are techniques to improve JavaScript performance. [Code splitting](https://web.dev/articles/reduce-javascript-payloads-with-code-splitting), is one such technique that improves performance by partitioning application JavaScript into chunks, and serving those chunks to only the routes of an application that need them.  \n\n为此，有一些技术可以提高 JavaScript 性能。代码拆分就是这样一种技术，它通过将应用程序 JavaScript 划分为多个块，并将这些块仅提供给需要它们的应用程序的路由来提高性能。\n\nWhile this technique works, it doesn't address a common problem of JavaScript-heavy applications, which is the inclusion of code that's never used. Tree shaking attempts to solve this problem.  \n\n虽然这种技术有效，但它并没有解决 JavaScript 密集型应用程序的常见问题，即包含从未使用过的代码。摇树试图解决这个问题。\n\n## What is tree shaking?  什么是摇树？\n\n[Tree shaking](https://en.wikipedia.org/wiki/Tree_shaking) is a form of dead code elimination. [The term was popularized by Rollup](https://github.com/rollup/rollup#tree-shaking), but the concept of dead code elimination has existed for some time. The concept has also found purchase in [webpack](https://webpack.js.org/guides/tree-shaking/), which is demonstrated in this article by way of a sample app.  \n\n摇树是消除死代码的一种形式。该术语由 Rollup 推广，但死代码消除的概念已经存在了一段时间。这个概念在 webpack 中也得到了购买，本文通过一个示例应用程序进行了演示。\n\nThe term \"tree shaking\" comes from the mental model of your application and its dependencies as a tree-like structure. Each node in the tree represents a dependency that provides distinct functionality for your app. In modern apps, these dependencies are brought in via [static `import` statements](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/import) like so:  \n\n术语“摇树”来自应用程序的心智模型及其作为树状结构的依赖关系。树中的每个节点都表示一个依赖项，该依赖项为应用提供不同的功能。在现代应用中，这些依赖项是通过静态 `import` 语句引入的，如下所示：\n\n```js\n// Import all the array utilities!\nimport arrayUtils from \"array-utils\";\n```\n\n:::info\n**Note:** If you're not sure what ES6 modules are, [this explainer at Pony Foo](https://ponyfoo.com/articles/es6-modules-in-depth) is worth a look. This guide assumes you have working knowledge of how ES6 modules work, so if you don't know anything about them, give that article a read!  \n\n注意：如果您不确定 ES6 模块是什么，Pony Foo 的这个解释器值得一看。本指南假设您对 ES6 模块的工作原理有一定的了解，所以如果你对它们一无所知，请阅读这篇文章！\n:::\n\nWhen an app is young—a sapling, if you will—it may have few dependencies. It's also using most—if not all—the dependencies you add. As your app matures, however, more dependencies can get added. To compound matters, older dependencies fall out of use, but may not get pruned from your codebase. The end result is that an app ends up shipping with a lot of [unused JavaScript](https://web.dev/unused-javascript). Tree shaking addresses this by taking advantage of how static `import` statements pull in specific parts of ES6 modules:  \n\n当一个应用程序还很年轻时（如果你愿意的话，它是一棵树苗），它可能几乎没有依赖关系。它还使用您添加的大多数（如果不是全部）依赖项。但是，随着应用的成熟，可以添加更多依赖项。雪上加霜的是，较旧的依赖项不再使用，但可能不会从代码库中删除。最终结果是，一个应用程序最终会附带大量未使用的 JavaScript。摇树通过利用静态 `import` 语句如何拉入 ES6 模块的特定部分来解决这个问题：\n\n```js\n// Import only some of the utilities!\nimport { unique, implode, explode } from \"array-utils\";\n```\n\nThe difference between this `import` example and the previous one is that rather than importing _everything_ from the `\"array-utils\"` module—which could be a lot of code)—this example imports only specific parts of it. In dev builds, this doesn't change anything, as the entire module gets imported regardless. In production builds, webpack can be configured to \"shake\" off [exports](https://developer.mozilla.org/docs/web/javascript/reference/statements/export) from ES6 modules that weren't explicitly imported, making those production builds smaller. In this guide, you'll learn how to do just that!  \n\n此示例与上一个示例的区别在于，此 `import` 示例不是从模块中导入所有内容（可能是大量代码），而是仅导入 `\"array-utils\"` 模块的特定部分。在开发版本中，这不会改变任何事情，因为无论如何都会导入整个模块。在生产版本中，webpack 可以配置为“摆脱”未显式导入的 ES6 模块的导出，从而使这些生产版本更小。在本指南中，您将学习如何做到这一点！\n\n## Finding opportunities to shake a tree  寻找机会摇晃一棵树\n\nFor illustrative purposes, [a sample one-page app](https://github.com/malchata/webpack-tree-shaking-example) is available that demonstrates how tree shaking works. You can clone it and follow along if you like, but we'll cover every step of the way together in this guide, so cloning isn't necessary (unless hands-on learning is your thing).  \n\n为了便于说明，提供了一个示例单页应用程序，用于演示摇树的工作原理。如果您愿意，您可以克隆它并跟随它，但我们将在本指南中一起介绍每一步，因此克隆不是必需的（除非您喜欢动手学习）。\n\nThe sample app is a searchable database of guitar effect pedals. You enter a query and a list of effect pedals will appear.  \n\n示例应用是吉他效果踏板的可搜索数据库。您输入查询，将出现效果踏板列表。\n\n![20231116112856](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116112856.png)\n\nThe behavior that drives this app is separated into vendor (i.e., [Preact](https://preactjs.com/) and [Emotion](https://emotion.sh/)) and app-specific code bundles (or \"chunks\", as webpack calls them):  \n\n驱动此应用程序的行为分为供应商（即 Preact 和 Emotion）和特定于应用程序的代码包（或 webpack 称之为“块”）：\n\n![20231116112919](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116112919.png)\n\nThe JavaScript bundles shown in the figure above are production builds, meaning they're optimized through uglification. 21.1 KB for an app-specific bundle isn't bad, but it should be noted that no tree shaking is occurring whatsoever. Let's look at the app code and see what can be done to fix that.  \n\n上图中显示的 JavaScript 包是生产版本，这意味着它们通过丑化进行了优化。21.1 KB 对于特定于应用程序的捆绑包来说还不错，但应该注意的是，没有发生任何摇树。让我们看一下应用代码，看看可以做些什么来解决这个问题。\n\n:::info\n**Note:** If you don't care for a long-winded explanation, and want to dive into code, go ahead and check out [the `tree-shake` branch](https://github.com/malchata/webpack-tree-shaking-example/tree/tree-shake) in the app's GitHub repo. You can also [diff this branch](https://github.com/malchata/webpack-tree-shaking-example/compare/tree-shake) to see exactly what was changed to make tree shaking work!  \n\n注意：如果您不关心冗长的解释，并且想要深入研究代码，请继续查看应用程序的 GitHub 存储库中的 `tree-shake` 分支。您还可以比较此分支，以确切地查看为使摇树工作而更改的内容！\n:::\n\nIn any application, finding tree shaking opportunities are going to involve looking for static `import` statements. [Near the top of the main component file](https://github.com/malchata/webpack-tree-shaking-example/blob/master/src/components/FilterablePedalList/FilterablePedalList.js#L4), you'll see a line like this:  \n\n在任何应用程序中，寻找摇树机会都将涉及寻找静态 `import` 语句。在主组件文件的顶部附近，您会看到如下行：\n\n```js\nimport * as utils from \"../../utils/utils\";\n```\nYou can [import ES6 modules in a variety of ways](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/import#description), but ones like this should get your attention. This specific line says \"`import` _everything_ from the `utils` module, and put it in a namespace called `utils`.\" The big question to ask here is, \"just how much _stuff_ is in that module?\"  \n\n您可以通过多种方式导入 ES6 模块，但像这样的模块应该引起您的注意。这一行说“ `import` `utils` 模块中的所有内容，并将其放在名为 `utils` 的命名空间中。这里要问的一个大问题是，“那个模块中到底有多少东西？\n\nIf you look at [the `utils` module source code](https://github.com/malchata/webpack-tree-shaking-example/blob/master/src/utils/utils.js), you'll find there's about 1,300 lines of code.  \n\n如果你看一下 `utils` 模块的源代码，你会发现大约有 1,300 行代码。\n\nDo you _need_ all that stuff? Let's double check by searching [the main component file](https://github.com/malchata/webpack-tree-shaking-example/blob/master/src/components/FilterablePedalList/FilterablePedalList.js) that imports the `utils` module to see how many instances of that namespace come up.  \n\n你需要所有这些东西吗？让我们通过搜索导入 `utils` 模块的主组件文件来仔细检查，看看该命名空间有多少个实例。\n\n![20231116113023](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116113023.png)\n*The `utils` namespace we've imported tons of modules from is only invoked three times within the main component file.*\n\n*我们从中导入了大量模块的 `utils` 命名空间在主组件文件中只调用了三次。*\n\nAs it turns out, the `utils` namespace appears in only three spots in our application—but for what functions? If you take a look at the main component file again, it appears to be only one function, which is `utils.simpleSort`, which is used to sort the search results list by a number of criteria when the sorting dropdowns are changed:  \n\n事实证明， `utils` 命名空间在我们的应用程序中只出现在三个位置，但用于什么功能？如果再次查看主组件文件，它似乎只有一个函数，即 `utils.simpleSort` ，用于在更改排序下拉列表时按多个条件对搜索结果列表进行排序：\n\n```js\nif (this.state.sortBy === \"model\") {\n  // `simpleSort` gets used here...\n  json = utils.simpleSort(json, \"model\", this.state.sortOrder);\n} else if (this.state.sortBy === \"type\") {\n  // ..and here...\n  json = utils.simpleSort(json, \"type\", this.state.sortOrder);\n} else {\n  // ..and here.\n  json = utils.simpleSort(json, \"manufacturer\", this.state.sortOrder);\n}\n```\n\nOut of a 1,300 line file with a bunch of exports, only one of them is used. This results in shipping a lot of unused JavaScript.  \n\n在包含一堆导出的 1,300 行文件中，只使用了其中一个。这导致大量未使用的 JavaScript 发布。\n\n:::info\n**Note:** This project is purposefully kept simple, so it's a bit easier in this case to find out where the bloat is coming from. In large projects with many modules, however, things get more complicated. Tools such as [Webpack Bundle Analyzer](https://www.npmjs.com/package/webpack-bundle-analyzer) and [source-map-explorer](https://www.npmjs.com/package/source-map-explorer) may provide further insight.  \n\n注意：这个项目特意保持简单，所以在这种情况下，找出膨胀的来源会更容易一些。然而，在具有许多模块的大型项目中，事情变得更加复杂。Webpack Bundle Analyzer 和 source-map-explorer 等工具可能会提供进一步的见解。\n:::\n\nWhile this example app is admittedly a bit contrived, it doesn't change the fact that this synthetic sort of scenario resembles actual optimization opportunities you may encounter in a production web app. Now that you've identified an opportunity for tree shaking to be useful, how is it actually done?  \n\n虽然此示例应用确实有点做作，但它并没有改变这样一个事实，即这种合成类型的方案类似于您在生产 Web 应用中可能遇到的实际优化机会。既然您已经确定了摇树有用的机会，那么它实际上是如何完成的？\n\n## Keeping Babel from transpiling ES6 modules to CommonJS modules  防止 Babel 将 ES6 模块转译为 CommonJS 模块\n\n[Babel](https://babeljs.io/) is an indispensable tool, but it may make the effects of tree shaking a bit more difficult to observe. If you're using [`@babel/preset-env`](https://babeljs.io/docs/en/babel-preset-env), Babel _may_ transform ES6 modules into more widely compatible CommonJS modules—that is, modules you `require` instead of `import`.  \n\n巴别塔是不可或缺的工具，但它可能会使树木摇晃的影响更难观察。如果您使用的 `@babel/preset-env` 是 ，Babel 可能会将 ES6 模块转换为更广泛兼容的 CommonJS 模块，即 u `require` 模块而不是 `import` .\n\nBecause tree shaking is more difficult to do for CommonJS modules, webpack won't know what to prune from bundles if you decide to use them. The solution is to configure `@babel/preset-env` to explicitly leave ES6 modules alone. Wherever you configure Babel—be it in `babel.config.js` or `package.json`—this involves adding a little something extra:  \n\n因为 CommonJS 模块更难做摇树，所以如果你决定使用它们，webpack 将不知道要从捆绑包中删除什么。解决方案是配置为 `@babel/preset-env` 显式保留 ES6 模块。无论你在什么地方配置 Babel——无论是在 in `babel.config.js` 中还是在 `package.json` - 这都涉及添加一些额外的东西：\n\n```js\n// babel.config.js\nexport default {\n  presets: [\n    [\n      \"@babel/preset-env\", {\n        modules: false\n      }\n    ]\n  ]\n}\n```\n\nSpecifying `modules: false` in your `@babel/preset-env` config gets Babel to behave as desired, which allows webpack to analyze your dependency tree and shake off unused dependencies.  \n\n在你的 `@babel/preset-env` 配置中指定 `modules: false` 可以让 Babel 按照预期运行，这允许 webpack 分析你的依赖树并摆脱未使用的依赖。\n\n## Keeping side effects in mind  牢记副作用\n\nAnother aspect to consider when shaking dependencies from your app is whether your project's modules have side effects. An example of a side effect is when a function modifies something outside of its own scope, which is a _side effect_ of its execution:  \n\n从应用中摇动依赖项时要考虑的另一个方面是项目的模块是否有副作用。副作用的一个例子是，当一个函数修改了它自己的范围之外的东西时，这是其执行的副作用：\n\n```js\nlet fruits = [\"apple\", \"orange\", \"pear\"];\n\nconsole.log(fruits); // (3) [\"apple\", \"orange\", \"pear\"]\n\nconst addFruit = function(fruit) {\n  fruits.push(fruit);\n};\n\naddFruit(\"kiwi\");\n\nconsole.log(fruits); // (4) [\"apple\", \"orange\", \"pear\", \"kiwi\"]\n```\n\nIn this example, `addFruit` produces a side effect when it modifies the `fruits` array, which is outside its scope.  \n\n在此示例中，当它修改 `fruits` 数组时会产生副作用， `addFruit` 这超出了其范围。\n\nSide effects also apply to ES6 modules, and that matters in the context of tree shaking. Modules that take predictable inputs and produce equally predictable outputs without modifying anything outside of their own scope are dependencies that can be safely dropped if we're not using them. They're self-contained, _modular_ pieces of code. Hence, \"modules\".  \n\n副作用也适用于 ES6 模块，这在摇树的背景下很重要。采用可预测的输入并产生同样可预测的输出而不修改其自身范围之外的任何内容的模块是依赖项，如果我们不使用它们，则可以安全地删除它们。它们是独立的模块化代码片段。因此，“模块”。\n\nWhere webpack is concerned, a hint can be used to specify that a package and its dependencies are free of side effects by specifying `\"sideEffects\": false` in a project's `package.json` file:  \n\n就 webpack 而言，可以通过在项目 `package.json` 文件中指定来指定 `\"sideEffects\": false` 包及其依赖项没有副作用：\n\n```js\n{\n  \"name\": \"webpack-tree-shaking-example\",\n  \"version\": \"1.0.0\",\n  \"sideEffects\": false\n}\n```\n\nAlternatively, you can tell webpack which specific files are not side effect-free:  \n\n或者，你可以告诉 webpack 哪些特定文件不是没有副作用的：\n\n```js\n{\n  \"name\": \"webpack-tree-shaking-example\",\n  \"version\": \"1.0.0\",\n  \"sideEffects\": [\n    \"./src/utils/utils.js\"\n  ]\n}\n```\n\nIn the latter example, any file that isn't specified will be assumed to be free of side effects. If you don't want to add this to your `package.json` file, [you can also specify this flag in your webpack config via `module.rules`](https://github.com/webpack/webpack/issues/6065#issuecomment-351060570).  \n\n在后一个示例中，任何未指定的文件都将被假定为没有副作用。如果您不想将其添加到文件中 `package.json` ，也可以通过 `module.rules` 在 webpack 配置中指定此标志。\n\n## Importing only what's needed  仅导入所需内容\n\nAfter instructing Babel to leave ES6 modules alone, a slight adjustment to our `import` syntax is required to bring in only the functions needed from the `utils` module. In this guide's example, all that's needed is the `simpleSort` function:  \n\n在指示 Babel 不理会 ES6 模块之后，需要对我们的 `import` 语法稍作调整，以仅引入 `utils` 模块所需的函数。在本指南的示例中，只需要函数 `simpleSort` ：\n\n```js\nimport { simpleSort } from \"../../utils/utils\";\n```\n\nBecause only `simpleSort` is being imported instead of the entire `utils` module, every instance of `utils.simpleSort` will need to changed to `simpleSort`:  \n\n因为只 `simpleSort` 导入而不是导入整个 `utils` 模块，所以每个 `utils.simpleSort` 实例都需要更改为 `simpleSort` ：\n\n```js\nif (this.state.sortBy === \"model\") {\n  json = simpleSort(json, \"model\", this.state.sortOrder);\n} else if (this.state.sortBy === \"type\") {\n  json = simpleSort(json, \"type\", this.state.sortOrder);\n} else {\n  json = simpleSort(json, \"manufacturer\", this.state.sortOrder);\n}\n```\n\nThis should be all that's needed for tree shaking to work in this example. This is the webpack output before shaking the dependency tree:  \n\n在此示例中，这应该是摇树工作所需的全部内容。这是动摇依赖树之前的 webpack 输出：\n\n```js\n                 Asset      Size  Chunks             Chunk Names\njs/vendors.16262743.js  37.1 KiB       0  [emitted]  vendors\n   js/main.797ebb8b.js  20.8 KiB       1  [emitted]  main\n```\n\nThis is the output _after_ tree shaking is successful:  \n\n这是摇树成功后的输出：\n\n```js\n                 Asset      Size  Chunks             Chunk Names\njs/vendors.45ce9b64.js  36.9 KiB       0  [emitted]  vendors\n   js/main.559652be.js  8.46 KiB       1  [emitted]  main\n```\n\nWhile both bundles shrank, it's really the `main` bundle that benefits most. By shaking off the unused parts of the `utils` module, the `main` bundle shrinks by about 60%. This not only lowers the amount of time the script takes to the download, but processing time as well.  \n\n虽然两个捆绑包都缩小了，但受益最大的确实是 `main` 捆绑包。通过甩掉 `utils` 模块中未使用的部分， `main` 束收缩约60%。这不仅减少了脚本下载所需的时间，还减少了处理时间。\n\n## Go shake some trees! 去摇晃一些树！\n\nWhatever mileage you get out of tree shaking depends on your app and its dependencies and architecture. Try it! If you know for a fact you haven't set up your module bundler to perform this optimization, there's no harm trying and seeing how it benefits your application.  \n\n无论您从摇树中获得什么好处，都取决于您的应用及其依赖项和体系结构。试试吧！如果您知道您还没有设置模块捆绑器来执行此优化，那么尝试并了解它如何使您的应用程序受益并没有什么坏处。\n\nYou may realize a significant performance gain from tree shaking, or not much at all. But by configuring your build system to take advantage of this optimization in production builds and selectively importing only what your application needs, you'll be proactively keeping your application bundles as small as possible.  \n\n您可能会从摇树中获得显着的性能提升，或者根本没有实现。但是，通过配置构建系统以在生产构建中利用此优化，并有选择地仅导入应用程序所需的内容，您将主动保持应用程序捆绑包尽可能小。\n\n_Special thanks to Kristofer Baxter, [Jason Miller](https://web.dev/authors/developit), [Addy Osmani](https://web.dev/authors/addyosmani), [Jeff Posnick](https://web.dev/authors/jeffposnick), Sam Saccone, and [Philip Walton](https://web.dev/authors/philipwalton) for their valuable feedback, which significantly improved the quality of this article.  \n\n特别感谢 Kristofer Baxter、Jason Miller、Addy Osmani、Jeff Posnick、Sam Saccone 和 Philip Walton 的宝贵反馈，这大大提高了本文的质量。_\n","pageType":"doc","routePath":"/chrome/performance/reduce-javascript-payloads-with-tree-shaking"};</script>
      
      <script type="module" src="/client-entry.js"></script>
    </body>
  </html>