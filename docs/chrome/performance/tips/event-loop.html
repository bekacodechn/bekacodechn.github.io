<!DOCTYPE html>
  <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <link rel="icon" href="" type="image/svg+xml"></link>
      <script  id="check-dark-light">
        ;(() => {
          const saved = localStorage.getItem('island-theme-appearance')
          const prefereDark = window.matchMedia('(prefers-color-scheme: dark)').matches
          if (!saved || saved === 'auto' ? prefereDark : saved === 'dark') {
            document.documentElement.classList.add('dark')
          }
        })()
      </script>
      <title data-rh="true">事件循环基础知识</title>
      <meta data-rh="true" name="description" content="Island"/>
      
      
      <script defer src='https://ga.jspm.io/npm:es-module-shims@1.6.0/dist/es-module-shims.js'></script>
      <script type="importmap">
        {
          "imports": {
            "react": "/react.js","react-dom": "/react-dom.js","react-dom/client": "/react-dom_client.js","react/jsx-runtime": "/react_jsx-runtime.js"
          }
        }
      </script>

      <link rel="stylesheet" href="/assets/style.71d86141.css">

    </head>
    <body>
      <div id="root"><div style="height:100%"><header relative="" z="4" fixed="md:~" class="top-0 left-0" w="100%"><div relative="" p="l-8 sm:x-8" transition="background-color duration-500" class="divider-bottom md:border-b-transparent lg:border-b-transparent" nav-h="mobile lg:desktop"><div flex="" justify="between" m="0 auto" nav-h="mobile lg:desktop" class="_container_1ic07_52  _has-sidebar_1ic07_16"><div border="border t-0 b-1 border-solid transparent" class="_nav-bar-title_1ic07_16"><a href="/" w="100%" h="100%" text="1rem" font="semibold" transition="opacity duration-300" hover="opacity-60" class="flex items-center"><span>beka的博客</span></a></div><div class="_content_1ic07_24" flex="~ 1" justify="end" items-center=""><div class="search" flex="sm:1" pl="sm:8"><div flex="" items-center="~" relative="" mr="2" font="semibold"><svg width="32" height="32" viewBox="0 0 32 32" w="5" h="5" fill="currentColor"><path fill="#888888" d="m29 27.586l-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9a9.01 9.01 0 0 1-9-9Z"></path></svg><input disabled="" cursor="text focus:auto" placeholder="Search" height="8" border="none" type="text" text="sm" p="t-0 r-2 b-0 l-2" transition="all duration-200 ease" class="rounded-sm _searchInput_y03a3_1 " aria-label="Search" autoComplete="off"/><div m="r-3" w="10" h="6" p="x-1.5" rounded="md" border="1px solid gray-light-3" text="xs gray-light-3" flex="~" items-center="~" justify="around" class="_searchCommand_y03a3_7"><span>⌘</span><span>K</span></div></div></div><div class="_rightNav_1ic07_42"><div class="menu"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article</a></div><div text="sm" font="medium" m="x-3" class="text-brand"><a class="_link_r3fql_1 " target="" cursor="pointer">Chrome</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Design-pattern</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Open-source</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Promise</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Webpack</a></div></div><div class="appearance" before="menu-item-before" display="none sm:flex" items-center="center"><button class="_switch_1tqe3_1 undefined" id="" type="button" role="switch"><span class="_check_1tqe3_17"><span class="_icon_1tqe3_34"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_sun_8e60k_1"><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_moon_8e60k_5"><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg></span></span></button></div></div><button class=" _navHamburger_14nz8_1"><span class="_container_14nz8_14"><span class="_top_14nz8_21"></span><span class="_middle_14nz8_27"></span><span class="_bottom_14nz8_33"></span></span></button><div class="_navScreen_1mkpq_1 " id="navScreen"><div class="_container_1mkpq_21"><div class="_navMenu_1mkpq_27"><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class="text-brand"><a class="_link_r3fql_1 " target="" cursor="pointer">Chrome</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Design-pattern</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Open-source</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Promise</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Webpack</a></div></div></div><div class="_socialAndAppearance_1mkpq_50" flex="~" justify="center" items-center="center"><div class="items-center appearance pa-2 _navAppearance_1mkpq_46" flex="~" justify="center"><button class="_switch_1tqe3_1 undefined" id="" type="button" role="switch"><span class="_check_1tqe3_17"><span class="_icon_1tqe3_34"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_sun_8e60k_1"><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_moon_8e60k_5"><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg></span></span></button></div></div></div></div></div></div></div></header><section style="padding-top:var(--island-nav-height)"><div p="t-0 x-6 b-24 sm:6" class="_docLayout_5cssi_8"><div class="_localNav_ncerp_1"><button flex="center" class="_menu_ncerp_16"><div text="md" mr="2" class="i-carbon:menu"></div><span text="md ">Menu</span></button></div><aside class="_sidebar_iav29_1 "><nav><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">Chorme lala</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:28px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">以用户为中心的效果指标</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">浏览器工作原理</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:168px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">高级体系结构（第 1 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">导航阶段（第 2 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">渲染阶段（第 3 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">加载阶段的优化（第 4 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">交互阶段的优化（第 5 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">什么强制了重排/回流</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">Html</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:84px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Metadata</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">html</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer"># 文档结构</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">关键指标</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:84px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">First Contentful Paint (FCP)</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Largest Contentful Paint (LCP)</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Time to First Byte (TTFB)</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">性能</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:140px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">一般 HTML 性能注意事项</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">optimize-resource-loading 优化资源负载</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">asdf</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Welcome to Lean performance</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">速度为什么重要</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">性能技巧</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:448px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Web 上的多进程：浏览器进程模型</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Browser Rendering Pipeline</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">通过火焰图找到有问题的代码</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">如何收集 Web 性能跟踪</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-brand"><a class="_link_r3fql_1 " target="" cursor="pointer">事件循环基础知识</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">深度讲解火焰图 🔥🔥</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">长任务：它们是什么以及为什么应该避免它们</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">performance 查看主线程（颜色含义）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">检测浏览器何时在 JavaScript 中绘制Frame</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">如何阅读 Chromium Profiler</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">使用 Chromium 网络标签页获取性能详情</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">使用性能时序标记进行📏测量</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Chromium F12 性能分析器的基本概述</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">传输大小 vs 资源大小</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">如何阅读火焰图 🔥</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">识别 Web 应用中的未压缩资源</a></div></div></div></div></section></nav></aside><div flex="~ 1 shrink-0" m="x-auto" class="_content_5cssi_2"><div m="x-auto" flex="~ col" class="max-w-100%"><div relative="~" m="x-auto" p="l-2" class="w-100% md:max-w-712px lg:min-w-640px "><div class="island-doc "><!--$--><h1 id="事件循环基础知识"><a class="header-anchor" aria-hidden="true" href="#事件循环基础知识">#</a>事件循环基础知识</h1>
<p><code>metadata:</code></p>
<p><strong>原标题:</strong> Event Loop Fundamentals</p>
<p><strong>链接:</strong> <a href="https://webperf.tips/tip/event-loop/" target="_blank" rel="nofollow">https://webperf.tips/tip/event-loop/</a></p>
<hr/>
<p>浏览器事件循环可能是需要掌握的最重要的前端性能概念。它的行为决定了 Web 应用程序在运行时的行为方式。</p>
<h2 id="the-main-thread"><a class="header-anchor" aria-hidden="true" href="#the-main-thread">#</a>The Main Thread</h2>
<p>在讨论事件循环之前，我们需要介绍一些关键概念。让我们从主线程开始。</p>
<p>Web 应用程序需要在此单个主线程上执行某些关键操作。导航到 Web 应用程序时，浏览器将创建并向应用程序授予此线程，以便代码在其上执行。</p>
<p>网络应用程序的大部分运行时活动都在这个单线程上进行，线程上的每个活动都在任务中调用。</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231110010507.png" alt="20231110010507"/></p>
<div class="island-directive tip"><p class="island-directive-title">TIP</p><div class="island-directive-content"><p>注意：这并不意味着浏览器（即 Chrome）是单线程的。现代浏览器既是多<a href="https://webperf.tips/tip/browser-process-model/" target="_blank" rel="nofollow">进程的，也是多线程的</a>。</p></div></div>
<h2 id="tasks"><a class="header-anchor" aria-hidden="true" href="#tasks">#</a>Tasks</h2>
<p>任务是在主线程上执行的运行时执行单元。</p>
<p>任务的一些常见示例包括：</p>
<ul>
<li>Parsing of HTML or CSS</li>
<li>User Input Handling, such as clicking or typing</li>
<li>Compiling and Executing JavaScript</li>
<li>Receiving Network Data</li>
<li>The Render Steps (Style, Layout, and Paint; discussed later)</li>
</ul>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231110010725.png" alt="20231110010725"/></p>
<p>某些任务必须在主线程上运行。例如，任何直接需要访问 DOM（即文档）的任务都必须在主线程上运行（因为 DOM 不是线程安全的）。这包括大多数与用户界面相关的代码。</p>
<p>主线程上一次只能运行一个任务。</p>
<p>此外，一个任务必须在主线程上运行完成后，才能运行另一个任务。浏览器没有 &quot;部分 &quot;执行任务的机制--每个任务都是完整运行的。</p>
<p>在下面的示例中，两个任务依次运行，每个任务都在主线程上完成：</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231110010916.png" alt="20231110010916"/></p>
<h2 id="task-queue"><a class="header-anchor" aria-hidden="true" href="#task-queue">#</a>Task Queue</h2>
<p>在主线程上不可能同时运行多个任务，因此任何未主动运行的任务都会驻留在一个名为任务队列的数据结构中。</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231110011042.png" alt="20231110011042"/></p>
<p>当您的Web应用程序在主线程上执行时，浏览器会将任务排队到此数据结构中。</p>
<p>当主线程准备好执行下一个任务时，浏览器也会从该队列中读取数据。</p>
<div class="island-directive info"><p class="island-directive-title">INFO</p><div class="island-directive-content"><p>注意：任务队列不是先进先出队列。大多数浏览器都采用<strong>启发式调度逻辑</strong>，将某些任务排在其他任务之前。</p><p><strong>启发式调度</strong>是什么样的？</p></div></div>
<h2 id="the-render-steps-task-and-frames-渲染步骤任务和帧"><a class="header-anchor" aria-hidden="true" href="#the-render-steps-task-and-frames-渲染步骤任务和帧">#</a>The Render Steps Task and Frames (渲染步骤任务和帧)</h2>
<p>渲染步骤任务负责将活动 DOM 和 CSS 样式转换为用户屏幕上的可视像素。</p>
<p>渲染步骤任务完成后生成的内容称为 <em>Frame</em>。</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231110011446.png" alt="20231110011446"/></p>
<p><strong>对网页 DOM 或 CSS 样式的编辑会通知浏览器需要生成<em>Frame</em>。当浏览器检测到需要生成<em>Frame</em>时，它会运行渲染步骤任务，而不是从任务队列中运行任务：</strong></p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231110011553.png" alt="20231110011553"/></p>
<p>There are generally 3 key steps for the Render Steps to complete:</p>
<ol>
<li><em>Style</em> - Assign CSS colors, fonts, and other styling properties to visual elements</li>
<li><em>Layout</em> - Position visual elements with precise coordinates(精确坐标)</li>
<li><em>Paint</em> - Instruct graphics(图形) libraries on how to draw positioned, styled visual elements</li>
</ol>
<p>For more details on each step, check out my detailed tip on <a href="https://webperf.tips/tip/browser-rendering-pipeline" target="_blank" rel="nofollow">the browser rendering pipeline</a>.</p>
<h2 id="the-event-loop"><a class="header-anchor" aria-hidden="true" href="#the-event-loop">#</a>The Event Loop</h2>
<p>最后，在介绍了所有这些基础主题后，我们终于可以讨论 &quot;事件循环 &quot;了！</p>
<p>事件循环是这些基础部分之间的协调者。</p>
<p>它本质上是一个无限循环，负责以下工作：</p>
<ul>
<li>从任务队列中选择一个可用任务，并将其置于主线程中运行完成</li>
<li>偶尔选择 &quot;渲染步骤 &quot;任务，而不是从任务队列中读取来生成<em>Frame</em></li>
</ul>
<p>这个伪代码片段总结了事件循环：</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#81A1C1">while</span><span style="color:#D8DEE9FF"> (</span><span style="color:#81A1C1">true</span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#81A1C1">var</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">nextTask</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ECEFF4">    </span><span style="color:#616E88">// The browser notifies the Event Loop</span></span>
<span class="line"><span style="color:#ECEFF4">    </span><span style="color:#616E88">// when it&#x27;s time to render a frame</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#81A1C1">if</span><span style="color:#D8DEE9FF"> (</span><span style="color:#88C0D0">shouldRenderFrame</span><span style="color:#D8DEE9FF">()) </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">        </span><span style="color:#D8DEE9">nextTask</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0">getRenderStepsTask</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">else</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">        </span><span style="color:#616E88">// If it&#x27;s not ready for a frame,</span></span>
<span class="line"><span style="color:#ECEFF4">        </span><span style="color:#616E88">// the Event Loop should run the</span></span>
<span class="line"><span style="color:#ECEFF4">        </span><span style="color:#616E88">// next Task.</span></span>
<span class="line"><span style="color:#D8DEE9FF">        </span><span style="color:#D8DEE9">nextTask</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">taskQueue</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">next</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#ECEFF4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ECEFF4">    </span><span style="color:#616E88">// Run Task to completion</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#88C0D0">runOnMainThread</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">nextTask</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span><span class="line-number">17</span></div></div>
<p>在事件循环的每一轮中，它都会决定是选择一项任务还是在屏幕上呈现一个<em>Frame</em>。</p>
<p>需要了解的关键是，浏览器可以运行任务或生成<em>Frame</em>，但不能同时运行任务和<em>Frame</em>。(这一点有少数例外，但我不会在本提示中讨论）。</p>
<p>无论哪个任务最终运行，都要运行到完成为止。</p>
<p>一般来说，任务持续时间应该较短，这样浏览器就能更快地调用渲染步骤，为用户生成一个<em>Frame</em>。我的<a href="https://webperf.tips/tip/long-tasks" target="_blank" rel="nofollow">避免长任务</a>提示中对此有更详细的介绍。</p>
<div class="island-directive tip"><p class="island-directive-title">TIP</p><div class="island-directive-content"><p>注：&quot;事件循环&quot;（Event Loop）是一种 C++ 结构，并不是用 JavaScript 编写的，我只是碰巧在这个伪代码中使用了它。</p></div></div>
<h2 id="non-blocking"><a class="header-anchor" aria-hidden="true" href="#non-blocking">#</a>Non-Blocking</h2>
<p>根据设计，事件循环从不暂停或阻塞主线程；它将不断循环运行任务并产生帧。</p>
<p>但是，当我们需要执行异步任务时会发生什么呢？例如，如果我们的网络应用程序请求网络数据或使用定时器，那么在事件循环中会出现什么情况呢？</p>
<p>浏览器提供的每个异步基元都表示为与事件循环执行模型兼容的任务。</p>
<div class="island-directive tip"><p class="island-directive-title">原文</p><div class="island-directive-content"><p>Each asynchronous primitive provided by the browser is represented as a Task that is compatible with the Event Loop execution model.</p></div></div>
<p>异步浏览器 API 示例包括</p>
<ul>
<li>Loading network data via <code>XMLHttpRequest</code> or <code>fetch</code></li>
<li>Responding to events via <code>addEventListener(...)</code></li>
<li>Timers like <code>setTimeout</code> or <code>setInterval</code></li>
</ul>
<p>For example, utilizing <code>setTimeout(callback, 500)</code> does not block the Main Thread, but tells the browser to queue a Task to run <code>callback</code> on the Task Queue after 500ms. (500ms后放入任务队列)</p>
<h2 id="example-timer"><a class="header-anchor" aria-hidden="true" href="#example-timer">#</a>Example: Timer</h2>
<p>让我们用一个简单的例子来说明我们所学到的一切。</p>
<p>我们的示例将是一个简单的脚本，每 500ms 在定时器回调中编辑一次 DOM。</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#81A1C1">let</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">count</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#B48EAD">0</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span></span>
<span class="line"><span style="color:#ECEFF4">    </span><span style="color:#616E88">// Queue a Task on the Task Queue every 500ms</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#88C0D0">setInterval</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">()</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=&gt;</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">        </span><span style="color:#616E88">// This code runs in a Task</span></span>
<span class="line"><span style="color:#D8DEE9FF">        </span><span style="color:#D8DEE9">count</span><span style="color:#81A1C1">++;</span></span>
<span class="line"><span style="color:#D8DEE9FF">        </span><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">node</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">document</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">getElementById</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#A3BE8C">output</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">        </span><span style="color:#D8DEE9">node</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">innerText</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">`</span><span style="color:#81A1C1">${</span><span style="color:#D8DEE9">count</span><span style="color:#81A1C1">}</span><span style="color:#A3BE8C"> Timers Fired!</span><span style="color:#ECEFF4">`</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#ECEFF4">},</span><span style="color:#D8DEE9FF"> </span><span style="color:#B48EAD">500</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span></div></div>
<p>Since this edits the DOM in a Task, the browser will need to generate a Frame to represent the changes as pixels.</p>
<p>Initially, after this script is evaluated, our Main Thread will be free, and the Task Queue will be empty. The browser has been directed to queue a Task after 500ms.</p>
<p>Though the thread has no activity happening during this 500ms waiting time, it is free and able to respond to clicking, typing, or other Tasks if there were any queued.</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231110013457.png" alt="20231110013457"/></p>
<p>After 500ms, the browser will queue a Task for running our callback for editing the DOM:</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231110013531.png" alt="20231110013531"/></p>
<p>The Event Loop detects a Task queued to be run, and moves it from the Queue to the Main Thread to run (since the Main Thread is not busy doing anything else).</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231110013624.png" alt="20231110013624"/></p>
<p>This task is run and edits the DOM, which notifies the Event Loop to run the Render Steps:</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231110013737.png" alt="20231110013737"/></p>
<p>该<em>Frame</em>制作完成后，我们更新的文本就会出现在屏幕上！</p>
<p>每隔 500 毫秒，这些确切的阶段将持续进行，同时队列中会出现一个定时器任务。事件循环将从队列中移除每个任务，并将其置于主线程中运行。这将导致事件循环运行渲染步骤任务并生成帧。</p>
<p>您可以对该示例进行分析，并在分析器中查看任务和帧的生成情况！</p>
<p>Here&#x27;s a screenshot of it happening in the Profiler:</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231110015231.png" alt="20231110015231"/></p>
<p>实测图：
<img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231110015618.png" alt="20231110015618"/></p>
<p>虽然这个简单的示例只是一个定时器，但您可以将其推广到网络应用程序中的任何操作，无论是点击按钮还是接收网络数据。</p>
<p>Consider these tips next:</p>
<h2 id="conclusion"><a class="header-anchor" aria-hidden="true" href="#conclusion">#</a>Conclusion</h2>
<ul>
<li><a href="https://webperf.tips/tip/browser-process-model" target="_blank" rel="nofollow">Browser Process Model</a></li>
<li><a href="https://webperf.tips/tip/browser-scheduling-internals" target="_blank" rel="nofollow">Browser Scheduling Logic</a></li>
<li><a href="https://webperf.tips/tip/browser-rendering-pipeline" target="_blank" rel="nofollow">Browser Rendering Pipeline</a></li>
<li><a href="https://webperf.tips/tip/long-tasks" target="_blank" rel="nofollow">Long Tasks and Performance</a></li>
</ul><!--/$--></div><footer mt="8"><div class="xs:flex" p="b-5" justify="between" items-center="~"><div flex="" text="sm text-2" leading-6="~" leading-8="sm:~" font-medium=""><p>Last Updated: </p><span>Invalid Date</span></div></div><div flex="~ col sm:row" justify="sm:around" gap="2" divider-top="" pt="6"><div flex="~ col" class="_prev_1f77m_13"><a href="/chrome/performance/tips/collect-a-trace" class="_pager-link_1f77m_20"><span class="_desc_1f77m_43">Previous Page</span><span class="_title_1f77m_34">如何收集 Web 性能跟踪</span></a></div><div flex="~ col" class="_next_1f77m_16"><a href="/chrome/performance/tips/flamegraphs-in-depth" class="_pager-link_1f77m_20 _next_1f77m_16"><span class="_desc_1f77m_43">Next page</span><span class="_title_1f77m_34">深度讲解火焰图 🔥🔥</span></a></div></div></footer></div></div><div relative="~" display="none lg:block" order="2" flex="1" p="l-8" class="max-w-256px"><div class="_aside-container_5cssi_32"><div flex="~ col" p="b-8" style="min-height:calc(100vh - (var(--island-nav-height-desktop) + 32px))"><div><div flex="~ col 1"><div display="lg:block"><div relative="" divider-left="" p="l-4" text="13px" font-medium="" id="aside-container"><div absolute="" pos="top-33px" opacity="0" w="1px" h="18px" bg="brand" style="left:-1px;transition:top 0.25s cubic-bezier(0, 1, 0.5, 1), background-color 0.5s, opacity 0.25s" id="aside-marker"></div><div block="~" leading-7="" text="13px" font="semibold">目录</div><nav><ul relative=""><li><a href="#the-main-thread" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">The Main Thread</a></li><li><a href="#tasks" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Tasks</a></li><li><a href="#task-queue" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Task Queue</a></li><li><a href="#the-render-steps-task-and-frames-渲染步骤任务和帧" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">The Render Steps Task and Frames (渲染步骤任务和帧)</a></li><li><a href="#the-event-loop" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">The Event Loop</a></li><li><a href="#non-blocking" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Non-Blocking</a></li><li><a href="#example-timer" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Example: Timer</a></li><li><a href="#conclusion" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Conclusion</a></li></ul></nav></div></div></div></div></div></div></div></div></div></section></div></div>
      <script>window.ISLAND_PAGE_DATA={"siteData":{"lang":"en-US","title":"beka的博客","description":"Island","themeConfig":{"lastUpdatedText":"上次更新","outlineTitle":"目录","nav":[{"text":"Article","link":"/article/astro","activeMatch":"/article/"},{"text":"Chrome","link":"/chrome/fast-load-time/user-centric-performance-metrics","activeMatch":"/chrome/"},{"text":"Design-pattern","link":"/design-pattern/indexs","activeMatch":"/design-pattern/"},{"text":"Open-source","link":"/open-source/delay","activeMatch":"/open-source/"},{"text":"Promise","link":"/promise/first-resolved","activeMatch":"/promise/"},{"text":"Webpack","link":"/webpack/build-result","activeMatch":"/webpack/"}],"sidebar":{"article":[{"text":"Article","items":[{"text":"Astro","link":"/article/astro"},{"text":"新一代全栈框架 Fresh","link":"/article/fresh"}],"collapsable":true}],"chrome":[{"text":"Chorme lala","items":[{"text":"以用户为中心的效果指标","link":"/chrome/fast-load-time/user-centric-performance-metrics"}],"collapsable":true},{"text":"浏览器工作原理","items":[{"text":"高级体系结构（第 1 部分）","link":"/chrome/how-web-browser-works/part-1_high-level-architecture"},{"text":"导航阶段（第 2 部分）","link":"/chrome/how-web-browser-works/part-2_navigation-phase"},{"text":"渲染阶段（第 3 部分）","link":"/chrome/how-web-browser-works/part-3_rendering-phase"},{"text":"加载阶段的优化（第 4 部分）","link":"/chrome/how-web-browser-works/part-4_optimization-in-the-loading-stage"},{"text":"交互阶段的优化（第 5 部分）","link":"/chrome/how-web-browser-works/part-5_optimization-in-the-interaction-stage"},{"text":"什么强制了重排/回流","link":"/chrome/how-web-browser-works/what-forces-layout-reflow"}],"collapsable":true},{"text":"Html","items":[{"text":"Metadata","link":"/chrome/html/metadata"},{"text":"html","link":"/chrome/html/overview"},{"text":"# 文档结构","link":"/chrome/html/structure"}],"collapsable":true},{"text":"关键指标","items":[{"text":"First Contentful Paint (FCP)","link":"/chrome/metrics/FCP"},{"text":"Largest Contentful Paint (LCP)","link":"/chrome/metrics/LCP"},{"text":"Time to First Byte (TTFB)","link":"/chrome/metrics/TTFB"}],"collapsable":true},{"text":"性能","items":[{"text":"一般 HTML 性能注意事项","link":"/chrome/performance/general-html-performance"},{"text":"optimize-resource-loading 优化资源负载","link":"/chrome/performance/optimize-resource-loading"},{"text":"asdf","link":"/chrome/performance/welcome-copy"},{"text":"Welcome to Lean performance","link":"/chrome/performance/welcome"},{"text":"速度为什么重要","link":"/chrome/performance/why-speed-matters"}],"collapsable":true},{"text":"性能技巧","items":[{"text":"Web 上的多进程：浏览器进程模型","link":"/chrome/performance/tips/browser-process-model"},{"text":"Browser Rendering Pipeline","link":"/chrome/performance/tips/browser-rendering-pipeline"},{"text":"通过火焰图找到有问题的代码","link":"/chrome/performance/tips/codepath-scoping"},{"text":"如何收集 Web 性能跟踪","link":"/chrome/performance/tips/collect-a-trace"},{"text":"事件循环基础知识","link":"/chrome/performance/tips/event-loop"},{"text":"深度讲解火焰图 🔥🔥","link":"/chrome/performance/tips/flamegraphs-in-depth"},{"text":"长任务：它们是什么以及为什么应该避免它们","link":"/chrome/performance/tips/long-tasks"},{"text":"performance 查看主线程（颜色含义）","link":"/chrome/performance/tips/main-profiler-pane"},{"text":"检测浏览器何时在 JavaScript 中绘制Frame","link":"/chrome/performance/tips/measuring-paint-time"},{"text":"如何阅读 Chromium Profiler","link":"/chrome/performance/tips/network-profiler-pane"},{"text":"使用 Chromium 网络标签页获取性能详情","link":"/chrome/performance/tips/network-tab"},{"text":"使用性能时序标记进行📏测量","link":"/chrome/performance/tips/performance-timing-markers"},{"text":"Chromium F12 性能分析器的基本概述","link":"/chrome/performance/tips/profiler-basic-ui"},{"text":"传输大小 vs 资源大小","link":"/chrome/performance/tips/resource-size-vs-transfer-size"},{"text":"如何阅读火焰图 🔥","link":"/chrome/performance/tips/understanding-flamegraphs"},{"text":"识别 Web 应用中的未压缩资源","link":"/chrome/performance/tips/validating-compression"}],"collapsable":true}],"design-pattern":[{"text":"Design-pattern","items":[{"text":"资源列表","link":"/design-pattern/indexs"},{"text":"代理模式","link":"/design-pattern/proxy-pattern"},{"text":"Singleton Pattern","link":"/design-pattern/singleton-pattern"},{"text":"状态模式","link":"/design-pattern/state-pattern"},{"text":"策略模式","link":"/design-pattern/strategy-pattern"}],"collapsable":true}],"open-source":[{"text":"Open-source","items":[{"text":"delay","link":"/open-source/delay"},{"text":"dot-prop","link":"/open-source/dot-prop"},{"text":"glob-to-regexp","link":"/open-source/glob-to-regexp"},{"text":"koa 洋葱模型","link":"/open-source/koa-compose"},{"text":"quick-lru","link":"/open-source/lru-cache"},{"text":"p-defer","link":"/open-source/p-defer"},{"text":"p-lazy","link":"/open-source/p-lazy"},{"text":"p-limit","link":"/open-source/p-limit"},{"text":"p-locate","link":"/open-source/p-locate"},{"text":"p-settle","link":"/open-source/p-settle"},{"text":"yocto-queue","link":"/open-source/yocto-queue"}],"collapsable":true}],"promise":[{"text":"Promise","items":[{"text":"顺序执行任务直到第一个resolved","link":"/promise/first-resolved"},{"text":"reduce实现多个promise顺序执行","link":"/promise/sequential-execution"}],"collapsable":true}],"webpack":[{"text":"Webpack","items":[{"text":"webpack 打包结果解析","link":"/webpack/build-result"},{"text":"mini-webpack","link":"/webpack/mini-webpack"},{"text":"minipack","link":"/webpack/minipack"},{"text":"[todo]tapable","link":"/webpack/tapable"}],"collapsable":true}]},"footer":{"message":"Released under the MIT License.","copyright":"Copyright © 2022-present Beka"}},"head":[["script",{"id":"check-dark-light"},"\n        ;(() => {\n          const saved = localStorage.getItem('island-theme-appearance')\n          const prefereDark = window.matchMedia('(prefers-color-scheme: dark)').matches\n          if (!saved || saved === 'auto' ? prefereDark : saved === 'dark') {\n            document.documentElement.classList.add('dark')\n          }\n        })()\n      "]],"base":"","icon":"","root":"/Users/beka/Desktop/code/bekacodechn.github.io/blog","appearance":true},"pagePath":"/Users/beka/Desktop/code/bekacodechn.github.io/blog/chrome/performance/tips/event-loop.md","relativePagePath":"chrome/performance/tips/event-loop.md","toc":[{"id":"the-main-thread","text":"The Main Thread","depth":2},{"id":"tasks","text":"Tasks","depth":2},{"id":"task-queue","text":"Task Queue","depth":2},{"id":"the-render-steps-task-and-frames-渲染步骤任务和帧","text":"The Render Steps Task and Frames (渲染步骤任务和帧)","depth":2},{"id":"the-event-loop","text":"The Event Loop","depth":2},{"id":"non-blocking","text":"Non-Blocking","depth":2},{"id":"example-timer","text":"Example: Timer","depth":2},{"id":"conclusion","text":"Conclusion","depth":2}],"title":"事件循环基础知识","lastUpdatedTime":"Invalid Date","content":"# 事件循环基础知识\n\n\n`metadata:`\n\n**原标题:** Event Loop Fundamentals\n\n**链接:** https://webperf.tips/tip/event-loop/\n\n---\n\n浏览器事件循环可能是需要掌握的最重要的前端性能概念。它的行为决定了 Web 应用程序在运行时的行为方式。\n\n## The Main Thread\n\n在讨论事件循环之前，我们需要介绍一些关键概念。让我们从主线程开始。\n\nWeb 应用程序需要在此单个主线程上执行某些关键操作。导航到 Web 应用程序时，浏览器将创建并向应用程序授予此线程，以便代码在其上执行。\n\n网络应用程序的大部分运行时活动都在这个单线程上进行，线程上的每个活动都在任务中调用。\n\n![20231110010507](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231110010507.png)\n\n:::tip\n注意：这并不意味着浏览器（即 Chrome）是单线程的。现代浏览器既是多[进程的，也是多线程的](https://webperf.tips/tip/browser-process-model/)。\n:::\n\n## Tasks\n\n任务是在主线程上执行的运行时执行单元。\n\n任务的一些常见示例包括：\n\n*   Parsing of HTML or CSS  \n*   User Input Handling, such as clicking or typing  \n*   Compiling and Executing JavaScript  \n*   Receiving Network Data\n*   The Render Steps (Style, Layout, and Paint; discussed later)  \n\n![20231110010725](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231110010725.png)\n\n某些任务必须在主线程上运行。例如，任何直接需要访问 DOM（即文档）的任务都必须在主线程上运行（因为 DOM 不是线程安全的）。这包括大多数与用户界面相关的代码。\n\n主线程上一次只能运行一个任务。\n\n此外，一个任务必须在主线程上运行完成后，才能运行另一个任务。浏览器没有 \"部分 \"执行任务的机制--每个任务都是完整运行的。\n\n在下面的示例中，两个任务依次运行，每个任务都在主线程上完成：\n\n![20231110010916](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231110010916.png)\n\n## Task Queue\n\n在主线程上不可能同时运行多个任务，因此任何未主动运行的任务都会驻留在一个名为任务队列的数据结构中。\n\n![20231110011042](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231110011042.png)\n\n当您的Web应用程序在主线程上执行时，浏览器会将任务排队到此数据结构中。\n\n当主线程准备好执行下一个任务时，浏览器也会从该队列中读取数据。\n\n:::info\n注意：任务队列不是先进先出队列。大多数浏览器都采用**启发式调度逻辑**，将某些任务排在其他任务之前。\n\n**启发式调度**是什么样的？\n:::\n\n## The Render Steps Task and Frames (渲染步骤任务和帧)\n\n渲染步骤任务负责将活动 DOM 和 CSS 样式转换为用户屏幕上的可视像素。\n\n渲染步骤任务完成后生成的内容称为 *Frame*。\n\n![20231110011446](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231110011446.png)\n\n**对网页 DOM 或 CSS 样式的编辑会通知浏览器需要生成*Frame*。当浏览器检测到需要生成*Frame*时，它会运行渲染步骤任务，而不是从任务队列中运行任务：**\n\n![20231110011553](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231110011553.png)\n\nThere are generally 3 key steps for the Render Steps to complete:\n\n1.  *Style* - Assign CSS colors, fonts, and other styling properties to visual elements\n2.  *Layout* - Position visual elements with precise coordinates(精确坐标)\n3.  *Paint* - Instruct graphics(图形) libraries on how to draw positioned, styled visual elements\n\nFor more details on each step, check out my detailed tip on [the browser rendering pipeline](https://webperf.tips/tip/browser-rendering-pipeline).\n\n## The Event Loop\n\n最后，在介绍了所有这些基础主题后，我们终于可以讨论 \"事件循环 \"了！\n\n事件循环是这些基础部分之间的协调者。\n\n它本质上是一个无限循环，负责以下工作：\n\n- 从任务队列中选择一个可用任务，并将其置于主线程中运行完成\n- 偶尔选择 \"渲染步骤 \"任务，而不是从任务队列中读取来生成*Frame*\n\n这个伪代码片段总结了事件循环：\n\n```js\nwhile (true) {\n    var nextTask;\n\n    // The browser notifies the Event Loop\n    // when it's time to render a frame\n    if (shouldRenderFrame()) {\n        nextTask = getRenderStepsTask();\n    } else {\n        // If it's not ready for a frame,\n        // the Event Loop should run the\n        // next Task.\n        nextTask = taskQueue.next();\n    }\n\n    // Run Task to completion\n    runOnMainThread(nextTask);\n}\n```\n\n在事件循环的每一轮中，它都会决定是选择一项任务还是在屏幕上呈现一个*Frame*。\n\n需要了解的关键是，浏览器可以运行任务或生成*Frame*，但不能同时运行任务和*Frame*。(这一点有少数例外，但我不会在本提示中讨论）。\n\n无论哪个任务最终运行，都要运行到完成为止。\n\n一般来说，任务持续时间应该较短，这样浏览器就能更快地调用渲染步骤，为用户生成一个*Frame*。我的[避免长任务](https://webperf.tips/tip/long-tasks)提示中对此有更详细的介绍。\n\n:::tip\n注：\"事件循环\"（Event Loop）是一种 C++ 结构，并不是用 JavaScript 编写的，我只是碰巧在这个伪代码中使用了它。\n:::\n\n## Non-Blocking\n\n根据设计，事件循环从不暂停或阻塞主线程；它将不断循环运行任务并产生帧。\n\n但是，当我们需要执行异步任务时会发生什么呢？例如，如果我们的网络应用程序请求网络数据或使用定时器，那么在事件循环中会出现什么情况呢？\n\n浏览器提供的每个异步基元都表示为与事件循环执行模型兼容的任务。\n\n:::tip{title=原文}\nEach asynchronous primitive provided by the browser is represented as a Task that is compatible with the Event Loop execution model.\n:::\n\n异步浏览器 API 示例包括\n\n*   Loading network data via `XMLHttpRequest` or `fetch`\n*   Responding to events via `addEventListener(...)`\n*   Timers like `setTimeout` or `setInterval`\n\nFor example, utilizing `setTimeout(callback, 500)` does not block the Main Thread, but tells the browser to queue a Task to run `callback` on the Task Queue after 500ms. (500ms后放入任务队列)\n\n## Example: Timer\n\n让我们用一个简单的例子来说明我们所学到的一切。\n\n我们的示例将是一个简单的脚本，每 500ms 在定时器回调中编辑一次 DOM。\n\n```js\n    let count = 0;\n    \n    // Queue a Task on the Task Queue every 500ms\n    setInterval(() => {\n        // This code runs in a Task\n        count++;\n        const node = document.getElementById('output');\n        node.innerText = `${count} Timers Fired!`\n    }, 500);\n```\n\nSince this edits the DOM in a Task, the browser will need to generate a Frame to represent the changes as pixels.\n\nInitially, after this script is evaluated, our Main Thread will be free, and the Task Queue will be empty. The browser has been directed to queue a Task after 500ms.\n\nThough the thread has no activity happening during this 500ms waiting time, it is free and able to respond to clicking, typing, or other Tasks if there were any queued.\n\n![20231110013457](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231110013457.png)\n\nAfter 500ms, the browser will queue a Task for running our callback for editing the DOM:\n\n![20231110013531](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231110013531.png)\n\nThe Event Loop detects a Task queued to be run, and moves it from the Queue to the Main Thread to run (since the Main Thread is not busy doing anything else).\n\n![20231110013624](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231110013624.png)\n\nThis task is run and edits the DOM, which notifies the Event Loop to run the Render Steps:\n\n![20231110013737](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231110013737.png)\n\n该*Frame*制作完成后，我们更新的文本就会出现在屏幕上！\n\n每隔 500 毫秒，这些确切的阶段将持续进行，同时队列中会出现一个定时器任务。事件循环将从队列中移除每个任务，并将其置于主线程中运行。这将导致事件循环运行渲染步骤任务并生成帧。\n\n您可以对该示例进行分析，并在分析器中查看任务和帧的生成情况！\n\nHere's a screenshot of it happening in the Profiler:\n\n![20231110015231](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231110015231.png)\n\n实测图：\n![20231110015618](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231110015618.png)\n\n虽然这个简单的示例只是一个定时器，但您可以将其推广到网络应用程序中的任何操作，无论是点击按钮还是接收网络数据。\n\nConsider these tips next:\n\n## Conclusion\n\n*   [Browser Process Model](https://webperf.tips/tip/browser-process-model)\n*   [Browser Scheduling Logic](https://webperf.tips/tip/browser-scheduling-internals)\n*   [Browser Rendering Pipeline](https://webperf.tips/tip/browser-rendering-pipeline)\n*   [Long Tasks and Performance](https://webperf.tips/tip/long-tasks)\n","pageType":"doc","routePath":"/chrome/performance/tips/event-loop"};</script>
      
      <script type="module" src="/client-entry.js"></script>
    </body>
  </html>