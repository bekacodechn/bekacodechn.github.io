<!DOCTYPE html>
  <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <link rel="icon" href="" type="image/svg+xml"></link>
      <script  id="check-dark-light">
        ;(() => {
          const saved = localStorage.getItem('island-theme-appearance')
          const prefereDark = window.matchMedia('(prefers-color-scheme: dark)').matches
          if (!saved || saved === 'auto' ? prefereDark : saved === 'dark') {
            document.documentElement.classList.add('dark')
          }
        })()
      </script>
      <title data-rh="true">ä¼˜åŒ–é•¿ä»»åŠ¡</title>
      <meta data-rh="true" name="description" content="Island"/>
      
      
      <script defer src='https://ga.jspm.io/npm:es-module-shims@1.6.0/dist/es-module-shims.js'></script>
      <script type="importmap">
        {
          "imports": {
            "react": "/react.js","react-dom": "/react-dom.js","react-dom/client": "/react-dom_client.js","react/jsx-runtime": "/react_jsx-runtime.js"
          }
        }
      </script>

      <link rel="stylesheet" href="/assets/style.81be0ec3.css">

    </head>
    <body>
      <div id="root"><div style="height:100%"><header relative="" z="4" fixed="md:~" class="top-0 left-0" w="100%"><div relative="" p="l-8 sm:x-8" transition="background-color duration-500" class="divider-bottom md:border-b-transparent lg:border-b-transparent" nav-h="mobile lg:desktop"><div flex="" justify="between" m="0 auto" nav-h="mobile lg:desktop" class="_container_1ic07_52  _has-sidebar_1ic07_16"><div border="border t-0 b-1 border-solid transparent" class="_nav-bar-title_1ic07_16"><a href="/" w="100%" h="100%" text="1rem" font="semibold" transition="opacity duration-300" hover="opacity-60" class="flex items-center"><span>bekaçš„åšå®¢</span></a></div><div class="_content_1ic07_24" flex="~ 1" justify="end" items-center=""><div class="search" flex="sm:1" pl="sm:8"><div flex="" items-center="~" relative="" mr="2" font="semibold"><svg width="32" height="32" viewBox="0 0 32 32" w="5" h="5" fill="currentColor"><path fill="#888888" d="m29 27.586l-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9a9.01 9.01 0 0 1-9-9Z"></path></svg><input disabled="" cursor="text focus:auto" placeholder="Search" height="8" border="none" type="text" text="sm" p="t-0 r-2 b-0 l-2" transition="all duration-200 ease" class="rounded-sm _searchInput_y03a3_1 " aria-label="Search" autoComplete="off"/><div m="r-3" w="10" h="6" p="x-1.5" rounded="md" border="1px solid gray-light-3" text="xs gray-light-3" flex="~" items-center="~" justify="around" class="_searchCommand_y03a3_7"><span>âŒ˜</span><span>K</span></div></div></div><div class="_rightNav_1ic07_42"><div class="menu"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article-set</a></div><div text="sm" font="medium" m="x-3" class="text-brand"><a class="_link_r3fql_1 " target="" cursor="pointer">Chrome</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Design-pattern</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Open-source</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Promise</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Typescript</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Webpack</a></div></div><div class="appearance" before="menu-item-before" display="none sm:flex" items-center="center"><button class="_switch_1tqe3_1 undefined" id="" type="button" role="switch"><span class="_check_1tqe3_17"><span class="_icon_1tqe3_34"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_sun_8e60k_1"><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_moon_8e60k_5"><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg></span></span></button></div></div><button class=" _navHamburger_14nz8_1"><span class="_container_14nz8_14"><span class="_top_14nz8_21"></span><span class="_middle_14nz8_27"></span><span class="_bottom_14nz8_33"></span></span></button><div class="_navScreen_1mkpq_1 " id="navScreen"><div class="_container_1mkpq_21"><div class="_navMenu_1mkpq_27"><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article-set</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class="text-brand"><a class="_link_r3fql_1 " target="" cursor="pointer">Chrome</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Design-pattern</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Open-source</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Promise</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Typescript</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Webpack</a></div></div></div><div class="_socialAndAppearance_1mkpq_50" flex="~" justify="center" items-center="center"><div class="items-center appearance pa-2 _navAppearance_1mkpq_46" flex="~" justify="center"><button class="_switch_1tqe3_1 undefined" id="" type="button" role="switch"><span class="_check_1tqe3_17"><span class="_icon_1tqe3_34"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_sun_8e60k_1"><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_moon_8e60k_5"><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg></span></span></button></div></div></div></div></div></div></div></header><section style="padding-top:var(--island-nav-height)"><div p="t-0 x-6 b-24 sm:6" class="_docLayout_5cssi_8"><div class="_localNav_ncerp_1"><button flex="center" class="_menu_ncerp_16"><div text="md" mr="2" class="i-carbon:menu"></div><span text="md ">Menu</span></button></div><aside class="_sidebar_iav29_1 "><nav><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">Chrome</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:28px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒçš„æ•ˆæœæŒ‡æ ‡</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">æµè§ˆå™¨å·¥ä½œåŸç†</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:168px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Web æµè§ˆå™¨å¦‚ä½•é€æ­¥å·¥ä½œ â€” é«˜çº§ä½“ç³»ç»“æ„ï¼ˆç¬¬ 1 éƒ¨åˆ†ï¼‰</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Web æµè§ˆå™¨å¦‚ä½•é€æ­¥å·¥ä½œ â€” å¯¼èˆªé˜¶æ®µï¼ˆç¬¬ 2 éƒ¨åˆ†ï¼‰</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">æµè§ˆå™¨å¦‚ä½•é€æ­¥å·¥ä½œ â€” æ¸²æŸ“é˜¶æ®µï¼ˆç¬¬ 3 éƒ¨åˆ†ï¼‰</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">æµè§ˆå™¨å¦‚ä½•é€æ­¥å·¥ä½œ â€” åŠ è½½é˜¶æ®µçš„ä¼˜åŒ–ï¼ˆç¬¬ 4 éƒ¨åˆ†ï¼‰</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">æµè§ˆå™¨å¦‚ä½•ä¸€æ­¥ä¸€æ­¥åœ°å·¥ä½œ â€” äº¤äº’é˜¶æ®µçš„ä¼˜åŒ–ï¼ˆç¬¬ 5 éƒ¨åˆ†ï¼‰</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">ä»€ä¹ˆå¼ºåˆ¶äº†é‡æ’/å›æµ</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">Html</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:84px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Metadata</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">html</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer"># æ–‡æ¡£ç»“æ„</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">å…³é”®æŒ‡æ ‡</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:84px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">First Contentful Paint (FCP) é¦–æ¬¡å†…å®¹ç»˜åˆ¶</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Largest Contentful Paint (LCP) æœ€å¤§å†…å®¹å¡«å……</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Time to First Byte (TTFB) é¦–æ¬¡å­—èŠ‚åŠ è½½æ—¶é—´</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">ç°ä»£ç½‘ç»œæµè§ˆå™¨å†…å¹•</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:112px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">ç°ä»£ç½‘ç»œæµè§ˆå™¨å†…å¹• â€” 1</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">ç°ä»£ç½‘ç»œæµè§ˆå™¨å†…å¹• â€” 2</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">ç°ä»£ç½‘ç»œæµè§ˆå™¨å†…å¹• â€” 3</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">ç°ä»£ç½‘ç»œæµè§ˆå™¨å†…å¹• â€” 4</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">æ€§èƒ½</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:224px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">1. Welcome to Lean performance</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">2. ä¸€èˆ¬ HTML æ€§èƒ½æ³¨æ„äº‹é¡¹</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">ä½¿ç”¨å¯¼èˆªå®šæ—¶å’Œèµ„æºå®šæ—¶è¯„ä¼°ç°åœºçš„è´Ÿè½½æ€§èƒ½</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-brand"><a class="_link_r3fql_1 " target="" cursor="pointer">ä¼˜åŒ–é•¿ä»»åŠ¡</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">optimize-resource-loading ä¼˜åŒ–èµ„æºè´Ÿè½½</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">é€šè¿‡æ‘‡æ ‘å‡å°‘ JavaScript æœ‰æ•ˆè´Ÿè½½</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">asdf</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">é€Ÿåº¦ä¸ºä»€ä¹ˆé‡è¦</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">æ€§èƒ½æŠ€å·§</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:476px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Web ä¸Šçš„å¤šè¿›ç¨‹ï¼šæµè§ˆå™¨è¿›ç¨‹æ¨¡å‹</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Browser Rendering Pipeline</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">é€šè¿‡ç«ç„°å›¾æ‰¾åˆ°æœ‰é—®é¢˜çš„ä»£ç </a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">å¦‚ä½•æ”¶é›† Web æ€§èƒ½è·Ÿè¸ª</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">äº‹ä»¶å¾ªç¯åŸºç¡€çŸ¥è¯†</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">æ·±åº¦è®²è§£ç«ç„°å›¾ ğŸ”¥ğŸ”¥</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">é•¿ä»»åŠ¡ï¼šå®ƒä»¬æ˜¯ä»€ä¹ˆä»¥åŠä¸ºä»€ä¹ˆåº”è¯¥é¿å…å®ƒä»¬</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">performance æŸ¥çœ‹ä¸»çº¿ç¨‹ï¼ˆé¢œè‰²å«ä¹‰ï¼‰</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">æ£€æµ‹æµè§ˆå™¨ä½•æ—¶åœ¨ JavaScript ä¸­ç»˜åˆ¶Frame</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">å¦‚ä½•é˜…è¯» Chromium Profiler</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">ä½¿ç”¨ Chromium ç½‘ç»œæ ‡ç­¾é¡µè·å–æ€§èƒ½è¯¦æƒ…</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">ä½¿ç”¨æ€§èƒ½æ—¶åºæ ‡è®°è¿›è¡ŒğŸ“æµ‹é‡</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Chromium F12 æ€§èƒ½åˆ†æå™¨çš„åŸºæœ¬æ¦‚è¿°</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">ã€--ç©ºæ–‡ä»¶--ã€‘: performance/tips/resource-size-vs-transfer-size.md</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">å¦‚ä½•é˜…è¯»ç«ç„°å›¾ ğŸ”¥</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">è¯†åˆ« Web åº”ç”¨ä¸­çš„æœªå‹ç¼©èµ„æº</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">asdfadsasdsdfasdf</a></div></div></div></div></section></nav></aside><div flex="~ 1 shrink-0" m="x-auto" class="_content_5cssi_2"><div m="x-auto" flex="~ col" class="max-w-100%"><div relative="~" m="x-auto" p="l-2" class="w-100% md:max-w-712px lg:min-w-640px "><div class="island-doc "><!--$--><h1 id="ä¼˜åŒ–é•¿ä»»åŠ¡"><a class="header-anchor" aria-hidden="true" href="#ä¼˜åŒ–é•¿ä»»åŠ¡">#</a>ä¼˜åŒ–é•¿ä»»åŠ¡</h1>
<p><code>metadata:</code></p>
<p><strong>åŸæ ‡é¢˜:</strong> Optimize long tasks</p>
<p><strong>é“¾æ¥:</strong> <a href="https://web.dev/articles/optimize-long-tasks" target="_blank" rel="nofollow">https://web.dev/articles/optimize-long-tasks</a></p>
<hr/>
<p>You&#x27;ve been told &quot;don&#x27;t block the main thread&quot; and &quot;break up your long tasks&quot;, but what does it mean to do those things?</p>
<p>ä½ è¢«å‘ŠçŸ¥â€œä¸è¦é˜»å¡ä¸»çº¿ç¨‹â€å’Œâ€œåˆ†è§£ä½ çš„é•¿ä»»åŠ¡â€ï¼Œä½†æ˜¯åšè¿™äº›äº‹æƒ…æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>If you read lots of stuff about web performance, the advice for keeping your JavaScript apps fast tends to involve some of these tidbits:</p>
<p>å¦‚æœä½ è¯»è¿‡å¾ˆå¤šå…³äº Web æ€§èƒ½çš„æ–‡ç« ï¼Œé‚£ä¹ˆä¿æŒ JavaScript åº”ç”¨ç¨‹åºå¿«é€Ÿè¿è¡Œçš„å»ºè®®å¾€å¾€ä¼šæ¶‰åŠä»¥ä¸‹ä¸€äº›èŠ±çµ®ï¼š</p>
<ul>
<li>
<p>&quot;Don&#x27;t block the main thread.&quot;</p>
<p>â€œä¸è¦é˜»å¡ä¸»çº¿ç¨‹ã€‚â€</p>
</li>
<li>
<p>&quot;Break up your long tasks.&quot;</p>
<p>â€œåˆ†è§£ä½ çš„é•¿æœŸä»»åŠ¡ã€‚â€</p>
</li>
</ul>
<p>What does any of that mean? ShippingÂ <em>less</em>Â JavaScript is good, but does that automatically equate to snappier user interfaces throughout the page lifecycle? Maybe, but maybe not.</p>
<p>è¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿå‡å°‘ JavaScript çš„å‘å¸ƒæ˜¯ä»¶å¥½äº‹ï¼Œä½†è¿™æ˜¯å¦è‡ªåŠ¨ç­‰åŒäºåœ¨æ•´ä¸ªé¡µé¢ç”Ÿå‘½å‘¨æœŸä¸­æä¾›æ›´å¿«æ·çš„ç”¨æˆ·ç•Œé¢ï¼Ÿä¹Ÿè®¸ï¼Œä½†ä¹Ÿè®¸ä¸æ˜¯ã€‚</p>
<p>To get your head around why it&#x27;s important to optimize tasks in JavaScript, you need to understand the role of tasks and how the browser handles themâ€”and that starts with understanding what a task is.</p>
<p>è¦å¼„æ¸…æ¥šä¸ºä»€ä¹ˆåœ¨ JavaScript ä¸­ä¼˜åŒ–ä»»åŠ¡å¾ˆé‡è¦ï¼Œæ‚¨éœ€è¦äº†è§£ä»»åŠ¡çš„è§’è‰²ä»¥åŠæµè§ˆå™¨å¦‚ä½•å¤„ç†å®ƒä»¬â€”â€”è¿™é¦–å…ˆè¦äº†è§£ä»»åŠ¡æ˜¯ä»€ä¹ˆã€‚</p>
<h2 id="what-is-a-taskä»€ä¹ˆæ˜¯ä»»åŠ¡"><a class="header-anchor" aria-hidden="true" href="#what-is-a-taskä»€ä¹ˆæ˜¯ä»»åŠ¡">#</a>What is a task?Â ä»€ä¹ˆæ˜¯ä»»åŠ¡ï¼Ÿ</h2>
<p>AÂ <em>task</em>Â is any discrete piece of work that the browser does. Tasks involve work such as rendering, parsing HTML and CSS, running the JavaScript code you write, and other things you may not have direct control over. Of all of this, the JavaScript you write and deploy to the web is a major source of tasks.</p>
<p>ä»»åŠ¡æ˜¯æµè§ˆå™¨æ‰§è¡Œçš„ä»»ä½•ç¦»æ•£å·¥ä½œã€‚ä»»åŠ¡æ¶‰åŠæ¸²æŸ“ã€è§£æ HTML å’Œ CSSã€è¿è¡Œæ‚¨ç¼–å†™çš„ JavaScript ä»£ç ä»¥åŠæ‚¨å¯èƒ½æ— æ³•ç›´æ¥æ§åˆ¶çš„å…¶ä»–å·¥ä½œã€‚åœ¨æ‰€æœ‰è¿™äº›ä¸­ï¼Œæ‚¨ç¼–å†™å¹¶éƒ¨ç½²åˆ° Web çš„ JavaScript æ˜¯ä»»åŠ¡çš„ä¸»è¦æ¥æºã€‚</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116193519.png" alt="20231116193519"/>
<em>A depiction of a task kicked off by aÂ <code>click</code>Â event handler in the performance profiler in Chrome DevTools.</em>
(<em>å¯¹ç”± Chrome DevTools ä¸­æ€§èƒ½æ¢æŸ¥å™¨ä¸­çš„Â <code>click</code>Â äº‹ä»¶å¤„ç†ç¨‹åºå¯åŠ¨çš„ä»»åŠ¡çš„æè¿°ã€‚</em>)</p>
<p>Tasks impact performance in a couple of ways. For example, when a browser downloads a JavaScript file during startup, it queues tasks to parse and compile that JavaScript so it can be executed. Later on in the page lifecycle, tasks are kicked off when your JavaScript does work such as driving interactions through event handlers, JavaScript-driven animations, and background activity such as analytics collection. All of this stuffâ€”with the exception ofÂ <a href="https://developer.mozilla.org/docs/Web/API/Web_Workers_API/Using_web_workers" target="_blank" rel="nofollow">web workers</a>Â and similar APIsâ€”happens on the main thread.<br/>
<!-- -->ä»»åŠ¡ä»¥å¤šç§æ–¹å¼å½±å“æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œå½“æµè§ˆå™¨åœ¨å¯åŠ¨æœŸé—´ä¸‹è½½ JavaScript æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šå°†ä»»åŠ¡æ’é˜Ÿä»¥è§£æå’Œç¼–è¯‘è¯¥ JavaScriptï¼Œä»¥ä¾¿å¯ä»¥æ‰§è¡Œå®ƒã€‚åœ¨é¡µé¢ç”Ÿå‘½å‘¨æœŸçš„åæœŸï¼Œå½“ JavaScript æ­£å¸¸å·¥ä½œæ—¶ï¼Œä»»åŠ¡å°†å¯åŠ¨ï¼Œä¾‹å¦‚é€šè¿‡äº‹ä»¶å¤„ç†ç¨‹åºã€JavaScript é©±åŠ¨çš„åŠ¨ç”»å’Œåå°æ´»åŠ¨ï¼ˆå¦‚åˆ†ææ”¶é›†ï¼‰é©±åŠ¨äº¤äº’ã€‚é™¤äº† Web Worker å’Œç±»ä¼¼çš„ API ä¹‹å¤–ï¼Œæ‰€æœ‰è¿™äº›ä¸œè¥¿éƒ½å‘ç”Ÿåœ¨ä¸»çº¿ç¨‹ä¸Šã€‚</p>
<h2 id="what-is-the-main-thread--ä¸»çº¿æ˜¯ä»€ä¹ˆ"><a class="header-anchor" aria-hidden="true" href="#what-is-the-main-thread--ä¸»çº¿æ˜¯ä»€ä¹ˆ">#</a>What is the main thread?  ä¸»çº¿æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>TheÂ <em>main thread</em>Â is where most tasks are run in the browser. It&#x27;s called the main thread for a reason: it&#x27;s the one thread where nearly all the JavaScript you write does its work.</p>
<p>ä¸»çº¿ç¨‹æ˜¯å¤§å¤šæ•°ä»»åŠ¡åœ¨æµè§ˆå™¨ä¸­è¿è¡Œçš„åœ°æ–¹ã€‚å®ƒè¢«ç§°ä¸ºä¸»çº¿ç¨‹æ˜¯æœ‰åŸå› çš„ï¼šå®ƒæ˜¯ä½ ç¼–å†™çš„å‡ ä¹æ‰€æœ‰ JavaScript éƒ½å®Œæˆå…¶å·¥ä½œçš„çº¿ç¨‹ã€‚</p>
<p>The main thread can only process one task at a time. When tasks stretch beyond a certain pointâ€”50 milliseconds to be exactâ€”they&#x27;re classified asÂ <em>long tasks</em>. If the user is attempting to interact with the page while a long task runsâ€”or if an important rendering update needs to happenâ€”the browser will be delayed in handling that work. This results in interaction or rendering latency.</p>
<p>ä¸»çº¿ç¨‹ä¸€æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªä»»åŠ¡ã€‚å½“ä»»åŠ¡è¶…è¿‡æŸä¸ªç‚¹ï¼ˆå‡†ç¡®åœ°è¯´æ˜¯ 50 æ¯«ç§’ï¼‰æ—¶ï¼Œå®ƒä»¬è¢«å½’ç±»ä¸ºé•¿ä»»åŠ¡ã€‚å¦‚æœç”¨æˆ·åœ¨é•¿æ—¶é—´ä»»åŠ¡è¿è¡Œæ—¶å°è¯•ä¸é¡µé¢äº¤äº’ï¼Œæˆ–è€…éœ€è¦è¿›è¡Œé‡è¦çš„å‘ˆç°æ›´æ–°ï¼Œåˆ™æµè§ˆå™¨åœ¨å¤„ç†è¯¥å·¥ä½œæ—¶å°†å»¶è¿Ÿã€‚è¿™ä¼šå¯¼è‡´äº¤äº’æˆ–æ¸²æŸ“å»¶è¿Ÿã€‚</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116193905.png" alt="20231116193905"/></p>
<p><em>A long task as depicted in Chrome&#x27;s performance profiler. Long tasks are indicated by a red triangle in the corner of the task, with the blocking portion of the task filled in with a pattern of diagonal red stripes.</em></p>
<p><em>è¿™æ˜¯ä¸€é¡¹æ¼«é•¿çš„ä»»åŠ¡ï¼Œå¦‚ Chrome çš„æ€§èƒ½åˆ†æå™¨ä¸­æ‰€è¿°ã€‚é•¿ä»»åŠ¡ç”±ä»»åŠ¡ä¸€è§’çš„çº¢è‰²ä¸‰è§’å½¢è¡¨ç¤ºï¼Œä»»åŠ¡çš„é˜»å¡éƒ¨åˆ†ç”¨å¯¹è§’çº¿çº¢è‰²æ¡çº¹å›¾æ¡ˆå¡«å……ã€‚</em></p>
<p>You need toÂ <em>break up</em>Â tasks. This means taking a single long task and dividing it into smaller tasks that take less time to run individually.</p>
<p>æ‚¨éœ€è¦åˆ†è§£ä»»åŠ¡ã€‚è¿™æ„å‘³ç€å°†å•ä¸ªé•¿ä»»åŠ¡åˆ’åˆ†ä¸ºè¾ƒå°çš„ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡å•ç‹¬è¿è¡Œæ‰€éœ€çš„æ—¶é—´æ›´å°‘ã€‚</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116193949.png" alt="20231116193949"/></p>
<p><em>A visualization of a single long task versus that same task broken up into five shorter tasks.</em></p>
<p><em>å•ä¸ªé•¿ä»»åŠ¡ä¸åŒä¸€ä»»åŠ¡çš„å¯è§†åŒ–ï¼Œåˆ†è§£ä¸ºäº”ä¸ªè¾ƒçŸ­çš„ä»»åŠ¡ã€‚</em></p>
<p>This matters because when tasks are broken up, the browser has more opportunities to respond to higher-priority workâ€”and that includes user interactions.</p>
<p>è¿™å¾ˆé‡è¦ï¼Œå› ä¸ºå½“ä»»åŠ¡è¢«åˆ†è§£æ—¶ï¼Œæµè§ˆå™¨æœ‰æ›´å¤šæœºä¼šå“åº”æ›´é«˜ä¼˜å…ˆçº§çš„å·¥ä½œï¼Œå…¶ä¸­åŒ…æ‹¬ç”¨æˆ·äº¤äº’ã€‚</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116194020.png" alt="20231116194020"/>
<em>A visualization of what happens to interactions when tasks are too long and the browser can&#x27;t respond quickly enough to interactions, versus when longer tasks are broken up into smaller tasks.</em></p>
<p><em>å½“ä»»åŠ¡å¤ªé•¿ä¸”æµè§ˆå™¨æ— æ³•è¶³å¤Ÿå¿«åœ°å“åº”äº¤äº’æ—¶ï¼Œä¸å°†è¾ƒé•¿çš„ä»»åŠ¡åˆ†è§£ä¸ºè¾ƒå°çš„ä»»åŠ¡æ—¶ï¼Œäº¤äº’ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µçš„å¯è§†åŒ–ã€‚</em></p>
<p>At the top of the preceding figure, an event handler queued up by a user interaction had to wait for a single long task before it could run, This delays the interaction from taking place. At the bottom, the event handler has a chance to run sooner. Because the event handler had an opportunity to run in between smaller tasks, it runs sooner than if it had to wait for a long task to finish. In the top example, the user might have noticed lag; in the bottom, the interaction might have feltÂ <em>instant</em>.</p>
<p>åœ¨ä¸Šå›¾çš„é¡¶éƒ¨ï¼Œç”±ç”¨æˆ·äº¤äº’æ’é˜Ÿçš„äº‹ä»¶å¤„ç†ç¨‹åºå¿…é¡»ç­‰å¾…å•ä¸ªé•¿ä»»åŠ¡æ‰èƒ½è¿è¡Œï¼Œè¿™ä¼šå»¶è¿Ÿäº¤äº’çš„å‘ç”Ÿã€‚åœ¨åº•éƒ¨ï¼Œäº‹ä»¶å¤„ç†ç¨‹åºæœ‰æœºä¼šæ›´å¿«åœ°è¿è¡Œã€‚ç”±äºäº‹ä»¶å¤„ç†ç¨‹åºæœ‰æœºä¼šåœ¨è¾ƒå°çš„ä»»åŠ¡ä¹‹é—´è¿è¡Œï¼Œå› æ­¤å®ƒæ¯”å¿…é¡»ç­‰å¾…é•¿æ—¶é—´ä»»åŠ¡å®Œæˆæ—¶è¿è¡Œå¾—æ›´å¿«ã€‚åœ¨é¡¶éƒ¨ç¤ºä¾‹ä¸­ï¼Œç”¨æˆ·å¯èƒ½å·²ç»æ³¨æ„åˆ°å»¶è¿Ÿ;åœ¨åº•éƒ¨ï¼Œäº¤äº’å¯èƒ½æ„Ÿè§‰æ˜¯å³æ—¶çš„ã€‚</p>
<p>The problem, though, is that the advice of &quot;break up your long tasks&quot; and &quot;don&#x27;t block the main thread&quot; isn&#x27;t specific enough unless you already knowÂ <em>how</em>Â to do those things. That&#x27;s what this guide will explain.</p>
<p>ç„¶è€Œï¼Œé—®é¢˜åœ¨äºï¼Œâ€œåˆ†è§£ä½ çš„é•¿ä»»åŠ¡â€å’Œâ€œä¸è¦é˜»å¡ä¸»çº¿ç¨‹â€çš„å»ºè®®ä¸å¤Ÿå…·ä½“ï¼Œé™¤éä½ å·²ç»çŸ¥é“å¦‚ä½•åšè¿™äº›äº‹æƒ…ã€‚è¿™å°±æ˜¯æœ¬æŒ‡å—å°†è¦è§£é‡Šçš„å†…å®¹ã€‚</p>
<h2 id="task-management-strategies--ä»»åŠ¡ç®¡ç†ç­–ç•¥"><a class="header-anchor" aria-hidden="true" href="#task-management-strategies--ä»»åŠ¡ç®¡ç†ç­–ç•¥">#</a>Task management strategies  ä»»åŠ¡ç®¡ç†ç­–ç•¥</h2>
<p>A common bit of advice in software architecture is to break up your work into smaller functions. This gives you the benefits of better code readability, and project maintainability. This also makes tests easier to write.</p>
<p>è½¯ä»¶æ¶æ„ä¸­ä¸€ä¸ªå¸¸è§çš„å»ºè®®æ˜¯å°†ä½ çš„å·¥ä½œåˆ†è§£æˆæ›´å°çš„åŠŸèƒ½ã€‚è¿™ä¸ºæ‚¨æä¾›äº†æ›´å¥½çš„ä»£ç å¯è¯»æ€§å’Œé¡¹ç›®å¯ç»´æŠ¤æ€§çš„å¥½å¤„ã€‚è¿™ä¹Ÿä½¿æµ‹è¯•æ›´æ˜“äºç¼–å†™ã€‚</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#81A1C1">function</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0">saveSettings</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">()</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#88C0D0">validateForm</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#88C0D0">showSpinner</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#88C0D0">saveToDatabase</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#88C0D0">updateUI</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#88C0D0">sendAnalytics</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span></div></div>
<p>In this example, there&#x27;s a function namedÂ <code>saveSettings()</code>Â that calls five functions within it to do the work, such as validating a form, showing a spinner, sending data, and so on. Conceptually, this is well architected. If you need to debug one of these functions, you can traverse the project tree to figure out what each function does.</p>
<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæœ‰ä¸€ä¸ªåä¸ºçš„å‡½æ•°ï¼Œè¯¥å‡½æ•°è°ƒç”¨å…¶ä¸­çš„Â <code>saveSettings()</code>Â äº”ä¸ªå‡½æ•°æ¥æ‰§è¡Œå·¥ä½œï¼Œä¾‹å¦‚éªŒè¯è¡¨å•ã€æ˜¾ç¤ºå¾®è°ƒå™¨ã€å‘é€æ•°æ®ç­‰ã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œè¿™æ˜¯å¾ˆå¥½çš„æ¶æ„ã€‚å¦‚æœéœ€è¦è°ƒè¯•å…¶ä¸­ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥éå†é¡¹ç›®æ ‘ä»¥æ‰¾å‡ºæ¯ä¸ªå‡½æ•°çš„ä½œç”¨ã€‚</p>
<p>The problem, however, is that JavaScript doesn&#x27;t run each of these functions as separate tasks because they are being executed within theÂ <code>saveSettings()</code>Â function.Â <strong>This means that all five functions run as a single task.</strong></p>
<p>ç„¶è€Œï¼Œé—®é¢˜åœ¨äº JavaScript ä¸ä¼šå°†è¿™äº›å‡½æ•°ä¸­çš„æ¯ä¸€ä¸ªä½œä¸ºå•ç‹¬çš„ä»»åŠ¡è¿è¡Œï¼Œå› ä¸ºå®ƒä»¬æ˜¯åœ¨Â <code>saveSettings()</code>Â å‡½æ•°ä¸­æ‰§è¡Œçš„ã€‚è¿™æ„å‘³ç€æ‰€æœ‰äº”ä¸ªå‡½æ•°éƒ½ä½œä¸ºå•ä¸ªä»»åŠ¡è¿è¡Œã€‚</p>
<div class="island-directive info"><p class="island-directive-title">INFO</p><div class="island-directive-content"><p><strong>Key point:</strong>Â JavaScript works this way because it uses theÂ <a href="https://developer.mozilla.org/docs/Web/JavaScript/EventLoop#run-to-completion" target="_blank" rel="nofollow">run-to-completion model</a>Â of task execution. This means that each task will run until it finishes, regardless of how long it blocks the main thread.</p><p>å…³é”®ç‚¹ï¼šJavaScript ä¹‹æ‰€ä»¥ä»¥è¿™ç§æ–¹å¼å·¥ä½œï¼Œæ˜¯å› ä¸ºå®ƒä½¿ç”¨ä»»åŠ¡æ‰§è¡Œçš„è¿è¡Œåˆ°å®Œæˆæ¨¡å‹ã€‚è¿™æ„å‘³ç€æ¯ä¸ªä»»åŠ¡éƒ½å°†è¿è¡Œç›´åˆ°å®Œæˆï¼Œæ— è®ºå®ƒé˜»å¡ä¸»çº¿ç¨‹å¤šé•¿æ—¶é—´ã€‚</p></div></div>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116194228.png" alt="20231116194228"/>
<em>A single functionÂ <code>saveSettings()</code>Â that calls five functions. The work is run as part of one long monolithic task.</em></p>
<p><em>è°ƒç”¨äº”ä¸ªå‡½æ•°çš„å•ä¸ªå‡½æ•°Â <code>saveSettings()</code>Â ã€‚è¯¥å·¥ä½œå°†ä½œä¸ºä¸€é¡¹é•¿æœŸæ•´ä½“ä»»åŠ¡çš„ä¸€éƒ¨åˆ†è¿è¡Œã€‚</em></p>
<p>In the best case scenario, even just one of those functions can contribute 50 milliseconds or more to the total length of the task. In the worst case, more of those tasks can run quite a bit longerâ€”especially on resource-constrained devices. What follows is a set of strategies you can use to break up and prioritize tasks.</p>
<p>åœ¨æœ€å¥½çš„æƒ…å†µä¸‹ï¼Œå³ä½¿åªæœ‰ä¸€ä¸ªå‡½æ•°ä¹Ÿä¼šä¸ºä»»åŠ¡çš„æ€»é•¿åº¦è´¡çŒ® 50 æ¯«ç§’æˆ–æ›´å¤šã€‚åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œè¿™äº›ä»»åŠ¡ä¸­çš„æ›´å¤šä»»åŠ¡å¯èƒ½ä¼šè¿è¡Œæ›´é•¿çš„æ—¶é—´ï¼Œå°¤å…¶æ˜¯åœ¨èµ„æºå—é™çš„è®¾å¤‡ä¸Šã€‚ä»¥ä¸‹æ˜¯ä¸€ç»„å¯ç”¨äºåˆ†è§£ä»»åŠ¡å¹¶ç¡®å®šä»»åŠ¡ä¼˜å…ˆçº§çš„ç­–ç•¥ã€‚</p>
<h3 id="manually-defer-code-execution--æ‰‹åŠ¨å»¶è¿Ÿä»£ç æ‰§è¡Œ"><a class="header-anchor" aria-hidden="true" href="#manually-defer-code-execution--æ‰‹åŠ¨å»¶è¿Ÿä»£ç æ‰§è¡Œ">#</a>Manually defer code execution  æ‰‹åŠ¨å»¶è¿Ÿä»£ç æ‰§è¡Œ</h3>
<p>One method developers have used to break up tasks into smaller ones involvesÂ <code>setTimeout()</code>. With this technique, you pass the function toÂ <code>setTimeout()</code>. This postpones execution of the callback into a separate task, even if you specify a timeout ofÂ <code>0</code>.</p>
<p>å¼€å‘äººå‘˜ç”¨æ¥å°†ä»»åŠ¡åˆ†è§£ä¸ºæ›´å°ä»»åŠ¡çš„ä¸€ç§æ–¹æ³•åŒ…æ‹¬Â <code>setTimeout()</code>Â .ä½¿ç”¨æ­¤æŠ€æœ¯ï¼Œå¯ä»¥å°†å‡½æ•°ä¼ é€’ç»™Â <code>setTimeout()</code>Â ã€‚è¿™ä¼šå°†å›è°ƒçš„æ‰§è¡Œæ¨è¿Ÿåˆ°å•ç‹¬çš„ä»»åŠ¡ä¸­ï¼Œå³ä½¿æ‚¨æŒ‡å®šäº†è¶…æ—¶Â <code>0</code>Â ã€‚</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#81A1C1">function</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0">saveSettings</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">()</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">  </span><span style="color:#616E88">// Do critical work that is user-visible:</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#88C0D0">validateForm</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#88C0D0">showSpinner</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#88C0D0">updateUI</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ECEFF4">  </span><span style="color:#616E88">// Defer work that isn&#x27;t user-visible to a separate task:</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#88C0D0">setTimeout</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">()</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=&gt;</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#88C0D0">saveToDatabase</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#88C0D0">sendAnalytics</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#ECEFF4">},</span><span style="color:#D8DEE9FF"> </span><span style="color:#B48EAD">0</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span></div></div>
<p>This works well if you have a series of functions that need to run sequentially, but your code may not always be organized this way. For example, you could have a large amount of data that needs to be processed in a loop, and that task could take a very long time if you have millions of items.</p>
<p>å¦‚æœæ‚¨æœ‰ä¸€ç³»åˆ—éœ€è¦æŒ‰é¡ºåºè¿è¡Œçš„å‡½æ•°ï¼Œè¿™å¾ˆæœ‰æ•ˆï¼Œä½†æ‚¨çš„ä»£ç å¯èƒ½å¹¶ä¸æ€»æ˜¯ä»¥è¿™ç§æ–¹å¼ç»„ç»‡ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½æœ‰å¤§é‡æ•°æ®éœ€è¦åœ¨å¾ªç¯ä¸­å¤„ç†ï¼Œå¦‚æœæ‚¨æœ‰æ•°ç™¾ä¸‡ä¸ªé¡¹ç›®ï¼Œåˆ™è¯¥ä»»åŠ¡å¯èƒ½éœ€è¦å¾ˆé•¿æ—¶é—´ã€‚</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#81A1C1">function</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0">processData</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">()</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#81A1C1">for</span><span style="color:#D8DEE9FF"> (</span><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">item</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">of</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">largeDataArray</span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">    </span><span style="color:#616E88">// Process the individual item here.</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#ECEFF4">}</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span></div></div>
<p>UsingÂ <code>setTimeout()</code>Â here is problematic, because the ergonomics of it make it difficult to implement, and the entire array of data could take a very long time to process, even if each item can be processed very quickly. It all adds up, andÂ <code>setTimeout()</code>Â isn&#x27;t the right tool for the jobâ€”at least not when used this way.</p>
<p>åœ¨è¿™é‡Œä½¿ç”¨Â <code>setTimeout()</code>Â æ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºå®ƒçš„äººä½“å·¥ç¨‹å­¦ä½¿å…¶éš¾ä»¥å®ç°ï¼Œå¹¶ä¸”æ•´ä¸ªæ•°æ®æ•°ç»„å¯èƒ½éœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½å¤„ç†ï¼Œå³ä½¿æ¯ä¸ªé¡¹ç›®éƒ½å¯ä»¥éå¸¸å¿«é€Ÿåœ°å¤„ç†ã€‚è¿™ä¸€åˆ‡åŠ èµ·æ¥ï¼ŒÂ <code>setTimeout()</code>Â å¹¶ä¸æ˜¯è¿™é¡¹å·¥ä½œçš„æ­£ç¡®å·¥å…·â€”â€”è‡³å°‘åœ¨ä»¥è¿™ç§æ–¹å¼ä½¿ç”¨æ—¶ä¸æ˜¯ã€‚</p>
<p>In addition toÂ <code>setTimeout()</code>, there are a few other APIs that allow you to defer code execution to a subsequent task. OneÂ <a href="https://dbaron.org/log/20100309-faster-timeouts" target="_blank" rel="nofollow">involves usingÂ <code>postMessage()</code>Â for faster timeouts</a>. You can also break up work usingÂ <code>requestIdleCallback()</code>â€”but beware!â€”<code>requestIdleCallback()</code>Â schedules tasks at the lowest possible priority, and only during browser idle time. When the main thread is congested, tasks scheduled withÂ <code>requestIdleCallback()</code>Â may never get to run.</p>
<p>é™¤äº†Â <code>setTimeout()</code>Â ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»– API å…è®¸æ‚¨å°†ä»£ç æ‰§è¡Œæ¨è¿Ÿåˆ°åç»­ä»»åŠ¡ã€‚ä¸€ç§æ˜¯ç”¨äºÂ <code>postMessage()</code>Â æ›´å¿«çš„è¶…æ—¶ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ï¼ˆä½†è¦æ³¨æ„ï¼‰Â <code>requestIdleCallback()</code>Â ä»¥Â <code>requestIdleCallback()</code>Â å°½å¯èƒ½ä½çš„ä¼˜å…ˆçº§å®‰æ’ä»»åŠ¡ï¼Œå¹¶ä¸”ä»…åœ¨æµè§ˆå™¨ç©ºé—²æ—¶é—´å®‰æ’ä»»åŠ¡æ¥åˆ†è§£å·¥ä½œã€‚å½“ä¸»çº¿ç¨‹æ‹¥å¡æ—¶ï¼Œè®¡åˆ’çš„ä»»åŠ¡Â <code>requestIdleCallback()</code>Â å¯èƒ½æ°¸è¿œæ— æ³•è¿è¡Œã€‚</p>
<h3 id="useasyncawaitto-create-yield-points--ä½¿ç”¨--åˆ›å»ºå±ˆæœç‚¹"><a class="header-anchor" aria-hidden="true" href="#useasyncawaitto-create-yield-points--ä½¿ç”¨--åˆ›å»ºå±ˆæœç‚¹">#</a>UseÂ <code>async</code>/<code>await</code>Â to create yield points  (ä½¿ç”¨ / åˆ›å»ºå±ˆæœç‚¹)</h3>
<p>A phrase you&#x27;ll see throughout the rest of this guide is &quot;yield to the main thread&quot;â€”but what does that mean? Why should you do it? When should you do it?</p>
<p>åœ¨æœ¬æŒ‡å—çš„å…¶ä½™éƒ¨åˆ†ï¼Œæ‚¨å°†çœ‹åˆ°ä¸€å¥è¯æ˜¯â€œå±ˆæœäºä¸»çº¿ç¨‹â€â€”â€”ä½†è¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Ÿä»€ä¹ˆæ—¶å€™åº”è¯¥åšï¼Ÿ</p>
<div class="island-directive info"><p class="island-directive-title">INFO</p><div class="island-directive-content"><p><strong>Key point:</strong>Â When youÂ <em>yield</em>Â to the main thread, you&#x27;re giving it an opportunity to handle more important tasks than the ones that are currently queued up. Ideally, you should yield to the main thread whenever you have some crucial user-facing work that needs to execute sooner than if you didn&#x27;t yield.Â <strong>Yielding to the main thread creates opportunities for critical work to run sooner.</strong></p><p>å…³é”®ç‚¹ï¼šå½“ä½ å±ˆæœäºä¸»çº¿ç¨‹æ—¶ï¼Œä½ å°±ç»™äº†å®ƒä¸€ä¸ªæœºä¼šæ¥å¤„ç†æ¯”å½“å‰æ’é˜Ÿçš„ä»»åŠ¡æ›´é‡è¦çš„ä»»åŠ¡ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæ¯å½“æ‚¨æœ‰ä¸€äº›é¢å‘ç”¨æˆ·çš„å…³é”®å·¥ä½œéœ€è¦æ¯”ä¸è®©æ­¥æ—¶æ›´å¿«åœ°æ‰§è¡Œæ—¶ï¼Œæ‚¨éƒ½åº”è¯¥å±ˆæœäºä¸»çº¿ç¨‹ã€‚å±ˆæœäºä¸»çº¿ç¨‹ä¸ºå…³é”®å·¥ä½œåˆ›é€ äº†æ›´å¿«è¿è¡Œçš„æœºä¼šã€‚</p></div></div>
<p>When tasks are broken up, other tasks can be prioritized better by the browser&#x27;s internal prioritization scheme. One way to yield to the main thread involves using a combination of aÂ <code>Promise</code>Â that resolves with a call toÂ <code>setTimeout()</code>:</p>
<p>å½“ä»»åŠ¡è¢«åˆ†è§£æ—¶ï¼Œæµè§ˆå™¨çš„å†…éƒ¨ä¼˜å…ˆçº§æ–¹æ¡ˆå¯ä»¥æ›´å¥½åœ°ç¡®å®šå…¶ä»–ä»»åŠ¡çš„ä¼˜å…ˆçº§ã€‚å±ˆæœäºä¸»çº¿ç¨‹çš„ä¸€ç§æ–¹æ³•æ¶‰åŠä½¿ç”¨ aÂ <code>Promise</code>Â çš„ç»„åˆï¼Œè¯¥ç»„åˆé€šè¿‡è°ƒç”¨ to è§£æÂ <code>setTimeout()</code>Â ï¼š</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#81A1C1">function</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0">yieldToMain</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">()</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#81A1C1">return</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">new</span><span style="color:#D8DEE9FF"> </span><span style="color:#8FBCBB">Promise</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">resolve</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=&gt;</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#88C0D0">setTimeout</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">resolve</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#B48EAD">0</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span></div></div>
<div class="island-directive warning"><p class="island-directive-title">WARNING</p><div class="island-directive-content"><p>Caution: While this code example returns a Promise that resolves after a call to setTimeout(), it&#x27;s not the Promise that is responsible for running the rest of the code in a new task, it&#x27;s the setTimeout() call. Promise callbacks run as microtasks rather than tasks, and therefore don&#x27;t yield to the main thread.</p><p>æ³¨æ„ï¼šè™½ç„¶æ­¤ä»£ç ç¤ºä¾‹è¿”å›åœ¨è°ƒç”¨setTimeoutï¼ˆï¼‰åè§£æçš„Promiseï¼Œä½†ä¸æ˜¯Promiseè´Ÿè´£åœ¨æ–°ä»»åŠ¡ä¸­è¿è¡Œå…¶ä½™ä»£ç ï¼Œè€Œæ˜¯setTimeoutï¼ˆï¼‰è°ƒç”¨ã€‚Promiseå›è°ƒä½œä¸ºå¾®ä»»åŠ¡è€Œä¸æ˜¯ä»»åŠ¡è¿è¡Œï¼Œå› æ­¤ä¸ä¼šå±ˆæœäºä¸»çº¿ç¨‹ã€‚</p></div></div>
<p>In theÂ <code>saveSettings()</code>Â function, you can yield to the main thread after each bit of work if youÂ <code>await</code>Â theÂ <code>yieldToMain()</code>Â function after each function call:</p>
<p>åœ¨å‡½æ•°ä¸­Â <code>saveSettings()</code>Â ï¼Œå¦‚æœÂ <code>await</code>Â <code>yieldToMain()</code>Â å‡½æ•°åœ¨æ¯æ¬¡å‡½æ•°è°ƒç”¨åï¼Œå¯ä»¥åœ¨æ¯æ¬¡ä½å·¥ä½œåè®©æ­¥ç»™ä¸»çº¿ç¨‹ï¼š</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#81A1C1">async</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">function</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0">saveSettings</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">()</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">  </span><span style="color:#616E88">// Create an array of functions to run:</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">tasks</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> [</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#D8DEE9">validateForm</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#D8DEE9">showSpinner</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#D8DEE9">saveToDatabase</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#D8DEE9">updateUI</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#D8DEE9">sendAnalytics</span></span>
<span class="line"><span style="color:#D8DEE9FF">  ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ECEFF4">  </span><span style="color:#616E88">// Loop over the tasks:</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#81A1C1">while</span><span style="color:#D8DEE9FF"> (</span><span style="color:#D8DEE9">tasks</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9FF">length </span><span style="color:#81A1C1">&gt;</span><span style="color:#D8DEE9FF"> </span><span style="color:#B48EAD">0</span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">    </span><span style="color:#616E88">// Shift the first task off the tasks array:</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">task</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">tasks</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">shift</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ECEFF4">    </span><span style="color:#616E88">// Run the task:</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#88C0D0">task</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ECEFF4">    </span><span style="color:#616E88">// Yield to the main thread:</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#81A1C1">await</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0">yieldToMain</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#ECEFF4">}</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span><span class="line-number">17</span><span class="line-number">18</span><span class="line-number">19</span><span class="line-number">20</span><span class="line-number">21</span><span class="line-number">22</span></div></div>
<div class="island-directive info"><p class="island-directive-title">INFO</p><div class="island-directive-content"><p><strong>Key point:</strong>Â You don&#x27;t have to yield afterÂ <em>every</em>Â function call. For example, if you run two functions that result in critical updates to the user interface, you probably don&#x27;t want to yield in between them. If you can, let that work run first,Â <em>then</em>Â consider yielding in between functions that do less critical or background work that the user doesn&#x27;t see.</p><p>æ‚¨ä¸å¿…åœ¨_æ¯ä¸ª_å‡½æ•°è°ƒç”¨åå±ˆæœã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨è¿è¡Œä¸¤ä¸ªå¯¼è‡´ç”¨æˆ·ç•Œé¢å‘ç”Ÿå…³é”®æ›´æ–°çš„å‡½æ•°ï¼Œæ‚¨å¯èƒ½ä¸å¸Œæœ›åœ¨å®ƒä»¬ä¹‹é—´åšå‡ºè®©æ­¥ã€‚å¦‚æœå¯ä»¥çš„è¯ï¼Œè¯·å…ˆè¿è¡Œè¯¥å·¥ä½œï¼Œç„¶åè€ƒè™‘åœ¨æ‰§è¡Œç”¨æˆ·çœ‹ä¸åˆ°çš„ä¸å¤ªé‡è¦æˆ–åå°å·¥ä½œçš„å‡½æ•°ä¹‹é—´è¿›è¡Œè®©æ­¥ã€‚</p></div></div>
<p>The result is that the once-monolithic task is now broken up into separate tasks.</p>
<p>ç»“æœæ˜¯ï¼Œæ›¾ç»å•ä¸€çš„ä»»åŠ¡ç°åœ¨è¢«åˆ†è§£ä¸ºå•ç‹¬çš„ä»»åŠ¡ã€‚</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116195416.png" alt="20231116195416"/>
<em>TheÂ <code>saveSettings()</code>Â function now executes its child functions as separate tasks.</em></p>
<p><em>è¯¥Â <code>saveSettings()</code>Â å‡½æ•°ç°åœ¨å°†å…¶å­å‡½æ•°ä½œä¸ºå•ç‹¬çš„ä»»åŠ¡æ‰§è¡Œã€‚</em></p>
<p>The benefit of using a promise-based approach to yielding rather than manual use ofÂ <code>setTimeout()</code>Â is better ergonomics. Yield points become declarative, and therefore easier to write, read, and understand.</p>
<p>ä½¿ç”¨åŸºäºæ‰¿è¯ºçš„å±ˆæœæ–¹æ³•è€Œä¸æ˜¯æ‰‹åŠ¨ä½¿ç”¨çš„å¥½å¤„Â <code>setTimeout()</code>Â æ˜¯æ›´å¥½çš„äººä½“å·¥ç¨‹å­¦ã€‚å±ˆæœç‚¹å˜å¾—å…·æœ‰å£°æ˜æ€§ï¼Œå› æ­¤æ›´æ˜“äºç¼–å†™ã€é˜…è¯»å’Œç†è§£ã€‚</p>
<h3 id="yield-only-when-necessary--ä»…åœ¨å¿…è¦æ—¶æ‰å±ˆæœ"><a class="header-anchor" aria-hidden="true" href="#yield-only-when-necessary--ä»…åœ¨å¿…è¦æ—¶æ‰å±ˆæœ">#</a>Yield only when necessary  ä»…åœ¨å¿…è¦æ—¶æ‰å±ˆæœ</h3>
<p>What if you have a bunch of tasks, but you only want to yield if the user attempts to interact with the page? That&#x27;s the kind of thing thatÂ <a href="https://developer.chrome.com/articles/isinputpending/" target="_blank" rel="nofollow"><code>isInputPending()</code></a>Â was made for.</p>
<p>å¦‚æœä½ æœ‰ä¸€å †ä»»åŠ¡ï¼Œä½†ä½ åªæƒ³åœ¨ç”¨æˆ·å°è¯•ä¸é¡µé¢äº¤äº’æ—¶è®©æ­¥ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿè¿™å°±æ˜¯ä¸ºä¹‹è€Œç”Ÿçš„é‚£ç§ä¸œè¥¿Â <code>isInputPending()</code>Â ã€‚</p>
<p><code>isInputPending()</code>Â is a function you can run at any time to determine if the user is attempting to interact with a page element: a call toÂ <code>isInputPending()</code>Â will returnÂ <code>true</code>. It returnsÂ <code>false</code>Â otherwise.</p>
<p><code>isInputPending()</code>Â æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ‚¨å¯ä»¥éšæ—¶è¿è¡Œä»¥ç¡®å®šç”¨æˆ·æ˜¯å¦æ­£åœ¨å°è¯•ä¸é¡µé¢å…ƒç´ è¿›è¡Œäº¤äº’ï¼šå¯¹Â <code>isInputPending()</code>Â çš„è°ƒç”¨å°†è¿”å›Â <code>true</code>Â ã€‚å¦åˆ™è¿”å›Â <code>false</code>Â ã€‚</p>
<p>Say you have a queue of tasks you need to run, but you don&#x27;t want to get in the way of any inputs. This codeâ€”which uses bothÂ <code>isInputPending()</code>Â and our customÂ <code>yieldToMain()</code>Â functionâ€”ensures that an input won&#x27;t be delayed while the user is trying to interact with the page:</p>
<p>å‡è®¾æ‚¨æœ‰ä¸€ä¸ªéœ€è¦è¿è¡Œçš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œä½†æ‚¨ä¸æƒ³å¦¨ç¢ä»»ä½•è¾“å…¥ã€‚æ­¤ä»£ç ï¼ˆåŒæ—¶ä½¿ç”¨ä¸¤è€…Â <code>isInputPending()</code>Â å’Œæˆ‘ä»¬çš„è‡ªå®šä¹‰Â <code>yieldToMain()</code>Â å‡½æ•°ï¼‰å¯ç¡®ä¿åœ¨ç”¨æˆ·å°è¯•ä¸é¡µé¢äº¤äº’æ—¶è¾“å…¥ä¸ä¼šå»¶è¿Ÿï¼š</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#81A1C1">async</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">function</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0">saveSettings</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">()</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">  </span><span style="color:#616E88">// A task queue of functions</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">tasks</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> [</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#D8DEE9">validateForm</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#D8DEE9">showSpinner</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#D8DEE9">saveToDatabase</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#D8DEE9">updateUI</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#D8DEE9">sendAnalytics</span></span>
<span class="line"><span style="color:#D8DEE9FF">  ]</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#81A1C1">while</span><span style="color:#D8DEE9FF"> (</span><span style="color:#D8DEE9">tasks</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9FF">length </span><span style="color:#81A1C1">&gt;</span><span style="color:#D8DEE9FF"> </span><span style="color:#B48EAD">0</span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">    </span><span style="color:#616E88">// Yield to a pending user input:</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#81A1C1">if</span><span style="color:#D8DEE9FF"> (</span><span style="color:#D8DEE9">navigator</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">scheduling</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">isInputPending</span><span style="color:#D8DEE9FF">()) </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">      </span><span style="color:#616E88">// There&#x27;s a pending user input. Yield here:</span></span>
<span class="line"><span style="color:#D8DEE9FF">      </span><span style="color:#81A1C1">await</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0">yieldToMain</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">else</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">      </span><span style="color:#616E88">// Shift the task out of the queue:</span></span>
<span class="line"><span style="color:#D8DEE9FF">      </span><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">task</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">tasks</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">shift</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ECEFF4">      </span><span style="color:#616E88">// Run the task:</span></span>
<span class="line"><span style="color:#D8DEE9FF">      </span><span style="color:#88C0D0">task</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#ECEFF4">}</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#ECEFF4">}</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span><span class="line-number">17</span><span class="line-number">18</span><span class="line-number">19</span><span class="line-number">20</span><span class="line-number">21</span><span class="line-number">22</span><span class="line-number">23</span><span class="line-number">24</span></div></div>
<p>WhileÂ <code>saveSettings()</code>Â runs, it will loop over the tasks in the queue. IfÂ <code>isInputPending()</code>Â returnsÂ <code>true</code>Â during the loop,Â <code>saveSettings()</code>Â will callÂ <code>yieldToMain()</code>Â so the user input can be handled. Otherwise, it will shift the next task off the front of the queue and run it continuously. It will do this until no more tasks are left.</p>
<p>åœ¨Â <code>saveSettings()</code>Â è¿è¡Œæ—¶ï¼Œå®ƒå°†éå†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚å¦‚æœÂ <code>isInputPending()</code>Â åœ¨å¾ªç¯æœŸé—´è¿”å›Â <code>true</code>Â ï¼ŒÂ <code>saveSettings()</code>Â å°†è°ƒç”¨Â <code>yieldToMain()</code>Â ä»¥ä¾¿å¯ä»¥å¤„ç†ç”¨æˆ·è¾“å…¥ã€‚å¦åˆ™ï¼Œå®ƒä¼šå°†ä¸‹ä¸€ä¸ªä»»åŠ¡ä»é˜Ÿåˆ—çš„å‰é¢ç§»å¼€å¹¶è¿ç»­è¿è¡Œã€‚å®ƒå°†è¿™æ ·åšï¼Œç›´åˆ°æ²¡æœ‰æ›´å¤šä»»åŠ¡ç•™ä¸‹ã€‚</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116195750.png" alt="20231116195750"/>
<em><code>saveSettings()</code>Â runs a task queue for five tasks, but the user has clicked to open a menu while the second work item was running.Â <code>isInputPending()</code>Â yields to the main thread to handle the interaction, and resume running the rest of the tasks.</em></p>
<p><em><code>saveSettings()</code>Â ä¸ºäº”ä¸ªä»»åŠ¡è¿è¡Œä»»åŠ¡é˜Ÿåˆ—ï¼Œä½†ç”¨æˆ·åœ¨ç¬¬äºŒä¸ªå·¥ä½œé¡¹è¿è¡Œæ—¶å•å‡»ä»¥æ‰“å¼€èœå•ã€‚Â <code>isInputPending()</code>Â è®©ä½äºä¸»çº¿ç¨‹æ¥å¤„ç†äº¤äº’ï¼Œå¹¶ç»§ç»­è¿è¡Œå…¶ä½™ä»»åŠ¡ã€‚</em></p>
<div class="island-directive info"><p class="island-directive-title">INFO</p><div class="island-directive-content"><p><strong>Note:</strong>Â <code>isInputPending()</code>Â may not always returnÂ <code>true</code>Â immediately after user input. This is because it takes time for the operating system to tell the browser that the interaction occurred. This means that other code may have already started executing (as you can see with theÂ <code>saveToDatabase()</code>Â function in the above screenshot). Even if you useÂ <code>isInputPending()</code>Â it&#x27;s still crucial that you limit the amount of work you do in each function.</p><p>æ³¨æ„ï¼šÂ <code>isInputPending()</code>Â ç”¨æˆ·è¾“å…¥åå¯èƒ½å¹¶ä¸æ€»æ˜¯ç«‹å³è¿”å›Â <code>true</code>Â ã€‚è¿™æ˜¯å› ä¸ºæ“ä½œç³»ç»Ÿéœ€è¦æ—¶é—´æ¥å‘ŠçŸ¥æµè§ˆå™¨å‘ç”Ÿäº†äº¤äº’ã€‚è¿™æ„å‘³ç€å…¶ä»–ä»£ç å¯èƒ½å·²ç»å¼€å§‹æ‰§è¡Œï¼ˆå¦‚ä¸Šé¢å±å¹•æˆªå›¾ä¸­çš„Â <code>saveToDatabase()</code>Â å‡½æ•°æ‰€ç¤ºï¼‰ã€‚å³ä½¿ä½ ä½¿ç”¨Â <code>isInputPending()</code>Â ï¼Œé™åˆ¶ä½ åœ¨æ¯ä¸ªåŠŸèƒ½ä¸­æ‰€åšçš„å·¥ä½œé‡ä»ç„¶å¾ˆé‡è¦ã€‚</p></div></div>
<p>UsingÂ <code>isInputPending()</code>Â in combination with a yielding mechanism is a great way to get the browser to stop whatever tasks it&#x27;s processing so that it can respond to critical user-facing interactions. That can help improve your page&#x27;s ability to respond to the user in many situations when a lot of tasks are in flight.</p>
<p>ä¸ç”Ÿæˆæœºåˆ¶ç»“åˆä½¿ç”¨Â <code>isInputPending()</code>Â æ˜¯è®©æµè§ˆå™¨åœæ­¢å®ƒæ­£åœ¨å¤„ç†çš„ä»»ä½•ä»»åŠ¡çš„å¥½æ–¹æ³•ï¼Œä»¥ä¾¿å®ƒå¯ä»¥å“åº”é¢å‘ç”¨æˆ·çš„å…³é”®äº¤äº’ã€‚è¿™æœ‰åŠ©äºæé«˜é¡µé¢åœ¨å¤§é‡ä»»åŠ¡æ­£åœ¨ä¼ è¾“çš„æƒ…å†µä¸‹å“åº”ç”¨æˆ·çš„èƒ½åŠ›ã€‚</p>
<p>Another way to useÂ <code>isInputPending()</code>â€”particularly if you&#x27;re concerned about providing a fallback for browsers that don&#x27;t support itâ€”is to use a time-based approach in conjunction with theÂ <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Operators/Optional_chaining" target="_blank" rel="nofollow">optional chaining operator</a>:</p>
<p>å¦ä¸€ç§ä½¿ç”¨Â <code>isInputPending()</code>Â æ–¹å¼ï¼ˆç‰¹åˆ«æ˜¯å¦‚æœæ‚¨æ‹…å¿ƒä¸ºä¸æ”¯æŒå®ƒçš„æµè§ˆå™¨æä¾›å›é€€ï¼‰æ˜¯å°†åŸºäºæ—¶é—´çš„æ–¹æ³•ä¸å¯é€‰çš„é“¾æ¥è¿ç®—ç¬¦ç»“åˆä½¿ç”¨ï¼š</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#81A1C1">async</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">function</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0">saveSettings</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">()</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">  </span><span style="color:#616E88">// A task queue of functions</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">tasks</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> [</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#D8DEE9">validateForm</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#D8DEE9">showSpinner</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#D8DEE9">saveToDatabase</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#D8DEE9">updateUI</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#D8DEE9">sendAnalytics</span></span>
<span class="line"><span style="color:#D8DEE9FF">  ]</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#81A1C1">let</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">deadline</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">performance</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">now</span><span style="color:#D8DEE9FF">() </span><span style="color:#81A1C1">+</span><span style="color:#D8DEE9FF"> </span><span style="color:#B48EAD">50</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#81A1C1">while</span><span style="color:#D8DEE9FF"> (</span><span style="color:#D8DEE9">tasks</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9FF">length </span><span style="color:#81A1C1">&gt;</span><span style="color:#D8DEE9FF"> </span><span style="color:#B48EAD">0</span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">    </span><span style="color:#616E88">// Optional chaining operator used here helps to avoid</span></span>
<span class="line"><span style="color:#ECEFF4">    </span><span style="color:#616E88">// errors in browsers that don&#x27;t support `isInputPending`:</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#81A1C1">if</span><span style="color:#D8DEE9FF"> (</span><span style="color:#D8DEE9">navigator</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">scheduling</span><span style="color:#ECEFF4">?.</span><span style="color:#88C0D0">isInputPending</span><span style="color:#D8DEE9FF">() </span><span style="color:#81A1C1">||</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">performance</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">now</span><span style="color:#D8DEE9FF">() </span><span style="color:#81A1C1">&gt;=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">deadline</span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">      </span><span style="color:#616E88">// There&#x27;s a pending user input, or the</span></span>
<span class="line"><span style="color:#ECEFF4">      </span><span style="color:#616E88">// deadline has been reached. Yield here:</span></span>
<span class="line"><span style="color:#D8DEE9FF">      </span><span style="color:#81A1C1">await</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0">yieldToMain</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ECEFF4">      </span><span style="color:#616E88">// Extend the deadline:</span></span>
<span class="line"><span style="color:#D8DEE9FF">      </span><span style="color:#D8DEE9">deadline</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">performance</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">now</span><span style="color:#D8DEE9FF">() </span><span style="color:#81A1C1">+</span><span style="color:#D8DEE9FF"> </span><span style="color:#B48EAD">50</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ECEFF4">      </span><span style="color:#616E88">// Stop the execution of the current loop and</span></span>
<span class="line"><span style="color:#ECEFF4">      </span><span style="color:#616E88">// move onto the next iteration:</span></span>
<span class="line"><span style="color:#D8DEE9FF">      </span><span style="color:#81A1C1">continue;</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#ECEFF4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ECEFF4">    </span><span style="color:#616E88">// Shift the task out of the queue:</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">task</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">tasks</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">shift</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ECEFF4">    </span><span style="color:#616E88">// Run the task:</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#88C0D0">task</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#ECEFF4">}</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span><span class="line-number">17</span><span class="line-number">18</span><span class="line-number">19</span><span class="line-number">20</span><span class="line-number">21</span><span class="line-number">22</span><span class="line-number">23</span><span class="line-number">24</span><span class="line-number">25</span><span class="line-number">26</span><span class="line-number">27</span><span class="line-number">28</span><span class="line-number">29</span><span class="line-number">30</span><span class="line-number">31</span><span class="line-number">32</span><span class="line-number">33</span><span class="line-number">34</span><span class="line-number">35</span></div></div>
<p>With this approach, you get a fallback for browsers that don&#x27;t supportÂ <code>isInputPending()</code>Â by using a time-based approach that uses (and adjusts) a deadline so that work will be broken up where necessary, whether by yielding to user input, or by a certain point in time.</p>
<p>ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨åŸºäºæ—¶é—´çš„æ–¹æ³•ä¸ºä¸æ”¯æŒÂ <code>isInputPending()</code>Â çš„æµè§ˆå™¨æä¾›å›é€€ï¼Œè¯¥æ–¹æ³•ä½¿ç”¨ï¼ˆå¹¶è°ƒæ•´ï¼‰æˆªæ­¢æ—¶é—´ï¼Œä»¥ä¾¿åœ¨å¿…è¦æ—¶åˆ†è§£å·¥ä½œï¼Œæ— è®ºæ˜¯é€šè¿‡å±ˆæœäºç”¨æˆ·è¾“å…¥ï¼Œè¿˜æ˜¯åœ¨æŸä¸ªæ—¶é—´ç‚¹ã€‚</p>
<h2 id="gaps-in-current-apis"><a class="header-anchor" aria-hidden="true" href="#gaps-in-current-apis">#</a>Gaps in current APIs</h2>
<p>The APIs mentioned so far can help you break up tasks, but they have a significant downside: when you yield to the main thread by deferring code to run in a subsequent task, that code gets added to the very end of the task queue.<br/>
<!-- -->åˆ°ç›®å‰ä¸ºæ­¢æåˆ°çš„ API å¯ä»¥å¸®åŠ©æ‚¨åˆ†è§£ä»»åŠ¡ï¼Œä½†å®ƒä»¬æœ‰ä¸€ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹ï¼šå½“æ‚¨é€šè¿‡å°†ä»£ç å»¶è¿Ÿåˆ°åç»­ä»»åŠ¡ä¸­è¿è¡Œæ—¶æ¥å±ˆæœäºä¸»çº¿ç¨‹æ—¶ï¼Œè¯¥ä»£ç ä¼šè¢«æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—çš„æœ€æœ«å°¾ã€‚</p>
<p>If you control all the code on your page, it&#x27;s possible to create your own scheduler with the ability to prioritize tasks, but third-party scripts won&#x27;t use your scheduler. In effect, you&#x27;re not really able toÂ <em>prioritize</em>Â work in such environments. You can only chunk it up, or explicitly yield to user interactions.<br/>
<!-- -->å¦‚æœæ‚¨æ§åˆ¶é¡µé¢ä¸Šçš„æ‰€æœ‰ä»£ç ï¼Œåˆ™å¯ä»¥åˆ›å»ºè‡ªå·±çš„è®¡åˆ’ç¨‹åºï¼Œå¹¶èƒ½å¤Ÿç¡®å®šä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œä½†ç¬¬ä¸‰æ–¹è„šæœ¬ä¸ä¼šä½¿ç”¨æ‚¨çš„è®¡åˆ’ç¨‹åºã€‚å®é™…ä¸Šï¼Œåœ¨è¿™æ ·çš„ç¯å¢ƒä¸­ï¼Œæ‚¨å®é™…ä¸Šæ— æ³•ç¡®å®šå·¥ä½œçš„ä¼˜å…ˆçº§ã€‚æ‚¨åªèƒ½å°†å…¶åˆ†å—ï¼Œæˆ–æ˜¾å¼åœ°å±ˆæœäºç”¨æˆ·äº¤äº’ã€‚</p>
<p>Fortunately, there is a dedicated scheduler API that is currently in development that addresses these problems.<br/>
<!-- -->å¹¸è¿çš„æ˜¯ï¼Œç›®å‰æ­£åœ¨å¼€å‘ä¸€ä¸ªä¸“ç”¨çš„è°ƒåº¦ç¨‹åº API æ¥è§£å†³è¿™äº›é—®é¢˜ã€‚</p>
<h3 id="a-dedicated-scheduler-api--ä¸“ç”¨è°ƒåº¦ç¨‹åº-api"><a class="header-anchor" aria-hidden="true" href="#a-dedicated-scheduler-api--ä¸“ç”¨è°ƒåº¦ç¨‹åº-api">#</a>A dedicated scheduler API  ä¸“ç”¨è°ƒåº¦ç¨‹åº API</h3>
<p>The scheduler API currently offers theÂ <code>postTask()</code>Â function which, at the time of writing, is available in Chromium browsers, and in Firefox behind a flag.Â <code>postTask()</code>Â allows for finer-grained scheduling of tasks, and is one way to help the browser prioritize work so that low priority tasks yield to the main thread.Â <code>postTask()</code>Â uses promises, and accepts aÂ <code>priority</code>Â setting.</p>
<p>è°ƒåº¦ç¨‹åº API ç›®å‰æä¾›äº†è¯¥Â <code>postTask()</code>Â åŠŸèƒ½ï¼Œåœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œè¯¥åŠŸèƒ½åœ¨ Chromium æµè§ˆå™¨å’Œ Firefox ä¸­å¯ç”¨ã€‚Â <code>postTask()</code>Â å…è®¸å¯¹ä»»åŠ¡è¿›è¡Œæ›´ç»†ç²’åº¦çš„è°ƒåº¦ï¼Œå¹¶ä¸”æ˜¯å¸®åŠ©æµè§ˆå™¨ç¡®å®šå·¥ä½œä¼˜å…ˆçº§çš„ä¸€ç§æ–¹å¼ï¼Œä»¥ä¾¿ä½ä¼˜å…ˆçº§ä»»åŠ¡è®©ä½äºä¸»çº¿ç¨‹ã€‚Â <code>postTask()</code>Â ä½¿ç”¨ promisesï¼Œå¹¶æ¥å—è®¾ç½®Â <code>priority</code>Â ã€‚</p>
<p>TheÂ <code>postTask()</code>Â API has three priorities you can use:</p>
<p>è¯¥Â <code>postTask()</code>Â API æœ‰ä¸‰ä¸ªå¯ä»¥ä½¿ç”¨çš„ä¼˜å…ˆçº§ï¼š</p>
<ul>
<li>
<p><code>&#x27;background&#x27;</code>Â for the lowest priority tasks.</p>
<p><code>&#x27;background&#x27;</code>Â å¯¹äºä¼˜å…ˆçº§æœ€ä½çš„ä»»åŠ¡ã€‚</p>
</li>
<li>
<p><code>&#x27;user-visible&#x27;</code>Â for medium priority tasks. This is the default if noÂ <code>priority</code>Â is set.</p>
<p><code>&#x27;user-visible&#x27;</code>Â å¯¹äºä¸­ç­‰ä¼˜å…ˆçº§çš„ä»»åŠ¡ã€‚å¦‚æœè®¾ç½®äº† noÂ <code>priority</code>Â ï¼Œåˆ™è¿™æ˜¯é»˜è®¤å€¼ã€‚</p>
</li>
<li>
<p><code>&#x27;user-blocking&#x27;</code>Â for critical tasks that need to run at high priority.</p>
<p><code>&#x27;user-blocking&#x27;</code>Â é€‚ç”¨äºéœ€è¦ä»¥é«˜ä¼˜å…ˆçº§è¿è¡Œçš„å…³é”®ä»»åŠ¡ã€‚</p>
</li>
</ul>
<p>Take the following code as an example, where theÂ <code>postTask()</code>Â API is used to run three tasks at the highest possible priority, and the remaining two tasks at the lowest possible priority.</p>
<p>ä»¥ä»¥ä¸‹ä»£ç ä¸ºä¾‹ï¼ŒÂ <code>postTask()</code>Â å…¶ä¸­ API ç”¨äºä»¥å°½å¯èƒ½é«˜çš„ä¼˜å…ˆçº§è¿è¡Œä¸‰ä¸ªä»»åŠ¡ï¼Œå¹¶ä»¥å°½å¯èƒ½ä½çš„ä¼˜å…ˆçº§è¿è¡Œå…¶ä½™ä¸¤ä¸ªä»»åŠ¡ã€‚</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#81A1C1">function</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0">saveSettings</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">()</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">  </span><span style="color:#616E88">// Validate the form at high priority</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#D8DEE9">scheduler</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">postTask</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">validateForm</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span><span style="color:#88C0D0">priority</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&#x27;</span><span style="color:#A3BE8C">user-blocking</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ECEFF4">  </span><span style="color:#616E88">// Show the spinner at high priority:</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#D8DEE9">scheduler</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">postTask</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">showSpinner</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span><span style="color:#88C0D0">priority</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&#x27;</span><span style="color:#A3BE8C">user-blocking</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ECEFF4">  </span><span style="color:#616E88">// Update the database in the background:</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#D8DEE9">scheduler</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">postTask</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">saveToDatabase</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span><span style="color:#88C0D0">priority</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&#x27;</span><span style="color:#A3BE8C">background</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ECEFF4">  </span><span style="color:#616E88">// Update the user interface at high priority:</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#D8DEE9">scheduler</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">postTask</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">updateUI</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span><span style="color:#88C0D0">priority</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&#x27;</span><span style="color:#A3BE8C">user-blocking</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ECEFF4">  </span><span style="color:#616E88">// Send analytics data in the background:</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#D8DEE9">scheduler</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">postTask</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">sendAnalytics</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span><span style="color:#88C0D0">priority</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&#x27;</span><span style="color:#A3BE8C">background</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#ECEFF4">}</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span></div></div>
<p>Here, the priority of tasks is scheduled in such a way that browser-prioritized tasksâ€”such as user interactionsâ€”can work their way in.</p>
<p>åœ¨è¿™é‡Œï¼Œä»»åŠ¡çš„ä¼˜å…ˆçº§æ˜¯ä»¥è¿™æ ·ä¸€ç§æ–¹å¼å®‰æ’çš„ï¼Œå³æµè§ˆå™¨ä¼˜å…ˆçš„ä»»åŠ¡ï¼ˆä¾‹å¦‚ç”¨æˆ·äº¤äº’ï¼‰å¯ä»¥å‘æŒ¥ä½œç”¨ã€‚</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116200045.png" alt="20231116200045"/>
<em>WhenÂ <code>saveSettings()</code>Â is run, the function schedules the individual functions usingÂ <code>postTask()</code>. The critical user-facing work is scheduled at high priority, while work the user doesn&#x27;t know about is scheduled to run in the background. This allows for user interactions to execute more quickly, as the work is both broken upÂ <em>and</em>Â prioritized appropriately.</em></p>
<p><em><code>saveSettings()</code>Â è¿è¡Œæ—¶ï¼Œè¯¥å‡½æ•°ä½¿ç”¨Â <code>postTask()</code>Â è°ƒåº¦å„ä¸ªå‡½æ•°ã€‚é¢å‘ç”¨æˆ·çš„å…³é”®å·¥ä½œè¢«å®‰æ’ä¸ºé«˜ä¼˜å…ˆçº§ï¼Œè€Œç”¨æˆ·ä¸çŸ¥é“çš„å·¥ä½œè¢«å®‰æ’åœ¨åå°è¿è¡Œã€‚è¿™å…è®¸ç”¨æˆ·äº¤äº’æ›´å¿«åœ°æ‰§è¡Œï¼Œå› ä¸ºå·¥ä½œè¢«é€‚å½“åœ°åˆ†è§£å’Œç¡®å®šä¼˜å…ˆçº§ã€‚</em></p>
<p>This is a simplistic example of howÂ <code>postTask()</code>Â can be used. It&#x27;s possible to instantiate differentÂ <code>TaskController</code>Â objects that can share priorities between tasks, including the ability to change priorities for differentÂ <code>TaskController</code>Â instances as needed.</p>
<p>è¿™æ˜¯ä¸€ä¸ªå¦‚ä½•ä½¿ç”¨çš„ç®€å•ç¤ºä¾‹Â <code>postTask()</code>Â ã€‚å¯ä»¥å®ä¾‹åŒ–å¯ä»¥åœ¨ä»»åŠ¡ä¹‹é—´å…±äº«ä¼˜å…ˆçº§çš„ä¸åŒÂ <code>TaskController</code>Â å¯¹è±¡ï¼ŒåŒ…æ‹¬æ ¹æ®éœ€è¦æ›´æ”¹ä¸åŒÂ <code>TaskController</code>Â å®ä¾‹çš„ä¼˜å…ˆçº§çš„èƒ½åŠ›ã€‚</p>
<div class="island-directive info"><p class="island-directive-title">INFO</p><div class="island-directive-content"><p><strong>Key point:</strong>Â <a href="https://caniuse.com/mdn-api_scheduler_posttask" target="_blank" rel="nofollow"><code>postTask()</code>Â is not supported in all browsers</a>. You can use feature detection to see if it&#x27;s available, or consider usingÂ <a href="https://www.npmjs.com/package/scheduler-polyfill" target="_blank" rel="nofollow">a polyfill</a>.</p><p>å…³é”®ç‚¹ï¼šÂ <code>postTask()</code>Â å¹¶éæ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒã€‚æ‚¨å¯ä»¥ä½¿ç”¨ç‰¹å¾æ£€æµ‹æ¥æŸ¥çœ‹å®ƒæ˜¯å¦å¯ç”¨ï¼Œæˆ–è€…è€ƒè™‘ä½¿ç”¨ polyfillã€‚</p></div></div>
<h3 id="built-in-yield-with-continuation-via-å†…ç½®äº§é‡é€šè¿‡ä»¥ä¸‹æ–¹å¼å»¶ç»­scheduleryield"><a class="header-anchor" aria-hidden="true" href="#built-in-yield-with-continuation-via-å†…ç½®äº§é‡é€šè¿‡ä»¥ä¸‹æ–¹å¼å»¶ç»­scheduleryield">#</a>Built-in yield with continuation via (å†…ç½®äº§é‡ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼å»¶ç»­<code>scheduler.yield</code>)</h3>
<div class="island-directive info"><p class="island-directive-title">INFO</p><div class="island-directive-content"><p><strong>Key point:</strong>Â For a more detailed explanation onÂ <code>scheduler.yield</code>, readÂ <a href="https://developer.chrome.com/blog/introducing-scheduler-yield-origin-trial/" target="_blank" rel="nofollow">this post about its origin trial</a>, as well asÂ <a href="https://github.com/WICG/scheduling-apis/blob/main/explainers/yield-and-continuation.md" target="_blank" rel="nofollow">its explainer</a>.</p><p>å…³é”®ç‚¹ï¼šæœ‰å…³æ›´Â <code>scheduler.yield</code>Â è¯¦ç»†çš„è§£é‡Šï¼Œè¯·é˜…è¯»è¿™ç¯‡å…³äºå…¶èµ·æºè¯•éªŒåŠå…¶è§£é‡Šå™¨çš„æ–‡ç« ã€‚</p></div></div>
<p><em>One proposed part of the scheduler API isÂ <code>scheduler.yield</code>, an API specifically designed for yielding to the main thread in the browserÂ <a href="https://developer.chrome.com/origintrials/#/view_trial/836543630784069633" target="_blank" rel="nofollow">which is currently available to try as an origin trial</a>. Its use resembles theÂ <code>yieldToMain()</code>Â function demonstrated earlier in this article:</em></p>
<p><em>è°ƒåº¦ç¨‹åº API çš„ä¸€ä¸ªå»ºè®®éƒ¨åˆ†æ˜¯ ï¼Œè¯¥ API ä¸“é—¨è®¾è®¡ç”¨äºå±ˆæœäºæµè§ˆå™¨ä¸­çš„ä¸»çº¿ç¨‹Â <code>scheduler.yield</code>Â ï¼Œç›®å‰å¯ä½œä¸ºæºè¯•ç”¨è¿›è¡Œå°è¯•ã€‚å®ƒçš„ç”¨æ³•ç±»ä¼¼äºæœ¬æ–‡å‰é¢æ¼”ç¤ºçš„Â <code>yieldToMain()</code>Â å‡½æ•°ï¼š</em></p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#81A1C1">async</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">function</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0">saveSettings</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">()</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">  </span><span style="color:#616E88">// Create an array of functions to run:</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">tasks</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> [</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#D8DEE9">validateForm</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#D8DEE9">showSpinner</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#D8DEE9">saveToDatabase</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#D8DEE9">updateUI</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#D8DEE9">sendAnalytics</span></span>
<span class="line"><span style="color:#D8DEE9FF">  ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ECEFF4">  </span><span style="color:#616E88">// Loop over the tasks:</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#81A1C1">while</span><span style="color:#D8DEE9FF"> (</span><span style="color:#D8DEE9">tasks</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9FF">length </span><span style="color:#81A1C1">&gt;</span><span style="color:#D8DEE9FF"> </span><span style="color:#B48EAD">0</span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">    </span><span style="color:#616E88">// Shift the first task off the tasks array:</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">task</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">tasks</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">shift</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ECEFF4">    </span><span style="color:#616E88">// Run the task:</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#88C0D0">task</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ECEFF4">    </span><span style="color:#616E88">// Yield to the main thread with the scheduler</span></span>
<span class="line"><span style="color:#ECEFF4">    </span><span style="color:#616E88">// API&#x27;s own yielding mechanism:</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#81A1C1">await</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">scheduler</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">yield</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#ECEFF4">}</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span><span class="line-number">17</span><span class="line-number">18</span><span class="line-number">19</span><span class="line-number">20</span><span class="line-number">21</span><span class="line-number">22</span><span class="line-number">23</span></div></div>
<p>You&#x27;ll note that the code above is largely familiar, but instead of usingÂ <code>yieldToMain()</code>, you call andÂ <code>await scheduler.yield()</code>Â instead.</p>
<p>æ‚¨ä¼šæ³¨æ„åˆ°ï¼Œä¸Šé¢çš„ä»£ç åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ç†Ÿæ‚‰çš„ï¼Œä½†ä¸æ˜¯ä½¿ç”¨Â <code>yieldToMain()</code>Â ï¼Œè€Œæ˜¯è°ƒç”¨ å’ŒÂ <code>await scheduler.yield()</code>Â ã€‚</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116201606.png" alt="20231116201606"/>
<em>A visualization of task execution without yielding, with yielding, and with yielding and continuation. WhenÂ <code>scheduler.yield()</code>Â is used, task execution picks up where it left off even after the yield point.</em></p>
<p><em>ä»»åŠ¡æ‰§è¡Œçš„å¯è§†åŒ–ï¼Œä¸å±ˆæœï¼Œå±ˆæœï¼Œå±ˆæœå’Œå»¶ç»­ã€‚ä½¿ç”¨æ—¶Â <code>scheduler.yield()</code>Â ï¼Œå³ä½¿åœ¨å±ˆæœç‚¹ä¹‹åï¼Œä»»åŠ¡æ‰§è¡Œä¹Ÿä¼šä»ä¸­æ–­çš„åœ°æ–¹ç»§ç»­æ‰§è¡Œã€‚</em></p>
<div class="island-directive info"><p class="island-directive-title">INFO</p><div class="island-directive-content"><p>ä½¿ç”¨<code>scheduler.yield()</code>åˆ†å‰²çš„ä»»åŠ¡åœ¨ç´§æ€¥ä»»åŠ¡ï¼ˆå¦‚ç”¨æˆ·äº¤äº’ï¼‰ç»“æŸåä¼šæ¥ç€è¿è¡Œï¼Œä½†æ˜¯è¢«<code>yieldToMain()</code>å’Œ<code>await scheduler.yield()</code>åˆ†å‰²çš„ä»»åŠ¡ä¼šè¿›å…¥äº‹ä»¶å¾ªç¯çš„æœ«å°¾ã€‚</p></div></div>
<p>The benefit ofÂ <code>scheduler.yield()</code>Â is continuation, which means that if you yield in the middle of a set of tasks, the other scheduled tasks will continue in the same order after the yield point.Â <strong>This avoids code from third-party scripts from usurping the order of your code&#x27;s execution.</strong></p>
<p>è¿™æ ·åšçš„å¥½å¤„Â <code>scheduler.yield()</code>Â æ˜¯å»¶ç»­ï¼Œè¿™æ„å‘³ç€å¦‚æœæ‚¨åœ¨ä¸€ç»„ä»»åŠ¡çš„ä¸­é—´è®©æ­¥ï¼Œå…¶ä»–è®¡åˆ’ä»»åŠ¡å°†åœ¨è®©æ­¥ç‚¹ä¹‹åä»¥ç›¸åŒçš„é¡ºåºç»§ç»­ã€‚è¿™æ ·å¯ä»¥é¿å…æ¥è‡ªç¬¬ä¸‰æ–¹è„šæœ¬çš„ä»£ç ç¯¡å¤ºä»£ç çš„æ‰§è¡Œé¡ºåºã€‚</p>
<h2 id="conclusion"><a class="header-anchor" aria-hidden="true" href="#conclusion">#</a>Conclusion</h2>
<p>Managing tasks is challenging, but doing so helps your page respond more quickly to user interactions. There&#x27;s no one single piece of advice for managing and prioritizing tasks. Rather, it&#x27;s a number of different techniques. To reiterate, these are the main things you&#x27;ll want to consider when managing tasks:</p>
<p>ç®¡ç†ä»»åŠ¡å…·æœ‰æŒ‘æˆ˜æ€§ï¼Œä½†è¿™æ ·åšæœ‰åŠ©äºé¡µé¢æ›´å¿«åœ°å“åº”ç”¨æˆ·äº¤äº’ã€‚æ²¡æœ‰ä¸€æ¡å…³äºç®¡ç†å’Œç¡®å®šä»»åŠ¡ä¼˜å…ˆçº§çš„å»ºè®®ã€‚ç›¸åï¼Œå®ƒæ˜¯è®¸å¤šä¸åŒçš„æŠ€æœ¯ã€‚é‡ç”³ä¸€ä¸‹ï¼Œè¿™äº›æ˜¯ç®¡ç†ä»»åŠ¡æ—¶è¦è€ƒè™‘çš„ä¸»è¦äº‹é¡¹ï¼š</p>
<ul>
<li>
<p>Yield to the main thread for critical, user-facing tasks.</p>
<p>è®©ä½äºä¸»çº¿ç¨‹æ‰§è¡Œé¢å‘ç”¨æˆ·çš„å…³é”®ä»»åŠ¡ã€‚</p>
</li>
<li>
<p>UseÂ <code>isInputPending()</code>Â to yield to the main thread when the user is trying to interact with the page.</p>
<p>ç”¨äºÂ <code>isInputPending()</code>Â åœ¨ç”¨æˆ·å°è¯•ä¸é¡µé¢äº¤äº’æ—¶å±ˆæœäºä¸»çº¿ç¨‹ã€‚</p>
</li>
<li>
<p>Prioritize tasks withÂ <code>postTask()</code>.</p>
<p>ä½¿ç”¨Â <code>postTask()</code>Â ç¡®å®šä»»åŠ¡çš„ä¼˜å…ˆçº§ã€‚</p>
</li>
<li>
<p>Finally,Â <strong>do as little work as possible in your functions.</strong></p>
<p>æœ€åï¼Œåœ¨å‡½æ•°ä¸­å°½å¯èƒ½å°‘åœ°åšå·¥ä½œã€‚</p>
</li>
</ul>
<p>With one or more of these tools, you should be able to structure the work in your application so that it prioritizes the user&#x27;s needs, while ensuring that less critical work still gets done. That&#x27;s going to create a better user experience which is more responsive and more enjoyable to use.</p>
<p>ä½¿ç”¨è¿™äº›å·¥å…·ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿæ„å»ºåº”ç”¨ç¨‹åºä¸­çš„å·¥ä½œï¼Œä»¥ä¾¿å®ƒä¼˜å…ˆè€ƒè™‘ç”¨æˆ·çš„éœ€æ±‚ï¼ŒåŒæ—¶ç¡®ä¿ä»ç„¶å®Œæˆä¸å¤ªé‡è¦çš„å·¥ä½œã€‚è¿™å°†åˆ›é€ æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œå“åº”é€Ÿåº¦æ›´å¿«ï¼Œä½¿ç”¨èµ·æ¥æ›´æ„‰å¿«ã€‚</p>
<p>_Special thanks toÂ <a href="https://philipwalton.com/" target="_blank" rel="nofollow">Philip Walton</a>Â for his technical vetting of this article.</p>
<p>ç‰¹åˆ«æ„Ÿè°¢ Philip Walton å¯¹æœ¬æ–‡çš„æŠ€æœ¯å®¡æŸ¥ã€‚_</p>
<p>_Hero image sourced fromÂ <a href="https://unsplash.com/" target="_blank" rel="nofollow">Unsplash</a>, courtesy ofÂ <a href="https://unsplash.com/@amir_v_ali" target="_blank" rel="nofollow">Amirali Mirhashemian</a>.</p>
<p>ä¸»å›¾ç‰‡æ¥è‡ª Unsplashï¼Œç”± Amirali Mirhashemian æä¾›ã€‚_</p><!--/$--></div><footer mt="8"><div class="xs:flex" p="b-5" justify="between" items-center="~"><div flex="" text="sm text-2" leading-6="~" leading-8="sm:~" font-medium=""><p>Last Updated: </p><span>2023/11/16 20:32:02</span></div></div><div flex="~ col sm:row" justify="sm:around" gap="2" divider-top="" pt="6"><div flex="~ col" class="_prev_1f77m_13"><a href="/chrome/performance/navigation-and-resource-timing" class="_pager-link_1f77m_20"><span class="_desc_1f77m_43">Previous Page</span><span class="_title_1f77m_34">ä½¿ç”¨å¯¼èˆªå®šæ—¶å’Œèµ„æºå®šæ—¶è¯„ä¼°ç°åœºçš„è´Ÿè½½æ€§èƒ½</span></a></div><div flex="~ col" class="_next_1f77m_16"><a href="/chrome/performance/optimize-resource-loading" class="_pager-link_1f77m_20 _next_1f77m_16"><span class="_desc_1f77m_43">Next page</span><span class="_title_1f77m_34">optimize-resource-loading ä¼˜åŒ–èµ„æºè´Ÿè½½</span></a></div></div></footer></div></div><div relative="~" display="none lg:block" order="2" flex="1" p="l-8" class="max-w-256px"><div class="_aside-container_5cssi_32"><div flex="~ col" p="b-8" style="min-height:calc(100vh - (var(--island-nav-height-desktop) + 32px))"><div><div flex="~ col 1"><div display="lg:block"><div relative="" divider-left="" p="l-4" text="13px" font-medium="" id="aside-container"><div absolute="" pos="top-33px" opacity="0" w="1px" h="18px" bg="brand" style="left:-1px;transition:top 0.25s cubic-bezier(0, 1, 0.5, 1), background-color 0.5s, opacity 0.25s" id="aside-marker"></div><div block="~" leading-7="" text="13px" font="semibold">ç›®å½•</div><nav><ul relative=""><li><a href="#what-is-a-taskä»€ä¹ˆæ˜¯ä»»åŠ¡" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">What is a task?Â ä»€ä¹ˆæ˜¯ä»»åŠ¡ï¼Ÿ</a></li><li><a href="#what-is-the-main-thread--ä¸»çº¿æ˜¯ä»€ä¹ˆ" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">What is the main thread?  ä¸»çº¿æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><li><a href="#task-management-strategies--ä»»åŠ¡ç®¡ç†ç­–ç•¥" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Task management strategies  ä»»åŠ¡ç®¡ç†ç­–ç•¥</a></li><li><a href="#manually-defer-code-execution--æ‰‹åŠ¨å»¶è¿Ÿä»£ç æ‰§è¡Œ" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">Manually defer code execution  æ‰‹åŠ¨å»¶è¿Ÿä»£ç æ‰§è¡Œ</a></li><li><a href="#useasyncawaitto-create-yield-points--ä½¿ç”¨--åˆ›å»ºå±ˆæœç‚¹" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">UseÂ async/awaitÂ to create yield points  (ä½¿ç”¨ / åˆ›å»ºå±ˆæœç‚¹)</a></li><li><a href="#yield-only-when-necessary--ä»…åœ¨å¿…è¦æ—¶æ‰å±ˆæœ" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">Yield only when necessary  ä»…åœ¨å¿…è¦æ—¶æ‰å±ˆæœ</a></li><li><a href="#gaps-in-current-apis" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Gaps in current APIs</a></li><li><a href="#a-dedicated-scheduler-api--ä¸“ç”¨è°ƒåº¦ç¨‹åº-api" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">A dedicated scheduler API  ä¸“ç”¨è°ƒåº¦ç¨‹åº API</a></li><li><a href="#built-in-yield-with-continuation-via-å†…ç½®äº§é‡é€šè¿‡ä»¥ä¸‹æ–¹å¼å»¶ç»­scheduleryield" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">Built-in yield with continuation via (å†…ç½®äº§é‡ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼å»¶ç»­scheduler.yield)</a></li><li><a href="#conclusion" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Conclusion</a></li></ul></nav></div></div></div></div></div></div></div></div></div></section></div></div>
      <script>window.ISLAND_PAGE_DATA={"siteData":{"lang":"en-US","title":"bekaçš„åšå®¢","description":"Island","themeConfig":{"lastUpdatedText":"ä¸Šæ¬¡æ›´æ–°","outlineTitle":"ç›®å½•","nav":[{"text":"Article","link":"/article/astro","activeMatch":"/article/"},{"text":"Article-set","link":"/article-set/URL-SET","activeMatch":"/article-set/"},{"text":"Chrome","link":"/chrome/fast-load-time/user-centric-performance-metrics","activeMatch":"/chrome/"},{"text":"Design-pattern","link":"/design-pattern/indexs","activeMatch":"/design-pattern/"},{"text":"Open-source","link":"/open-source/delay","activeMatch":"/open-source/"},{"text":"Promise","link":"/promise/first-resolved","activeMatch":"/promise/"},{"text":"Typescript","link":"/typescript/tip","activeMatch":"/typescript/"},{"text":"Webpack","link":"/webpack/build-result","activeMatch":"/webpack/"}],"sidebar":{"article":[{"text":"Article","items":[{"text":"Astro","link":"/article/astro"},{"text":"æ–°ä¸€ä»£å…¨æ ˆæ¡†æ¶ Fresh","link":"/article/fresh"}],"collapsable":true}],"article-set":[{"text":"Article-set","items":[{"text":"å¤–é“¾åˆé›†","link":"/article-set/URL-SET"},{"text":"requestAnimationFrame","link":"/article-set/raf"}],"collapsable":true}],"chrome":[{"text":"Chrome","items":[{"text":"ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒçš„æ•ˆæœæŒ‡æ ‡","link":"/chrome/fast-load-time/user-centric-performance-metrics"}],"collapsable":true},{"text":"æµè§ˆå™¨å·¥ä½œåŸç†","items":[{"text":"Web æµè§ˆå™¨å¦‚ä½•é€æ­¥å·¥ä½œ â€” é«˜çº§ä½“ç³»ç»“æ„ï¼ˆç¬¬ 1 éƒ¨åˆ†ï¼‰","link":"/chrome/how-web-browser-works/part-1_high-level-architecture"},{"text":"Web æµè§ˆå™¨å¦‚ä½•é€æ­¥å·¥ä½œ â€” å¯¼èˆªé˜¶æ®µï¼ˆç¬¬ 2 éƒ¨åˆ†ï¼‰","link":"/chrome/how-web-browser-works/part-2_navigation-phase"},{"text":"æµè§ˆå™¨å¦‚ä½•é€æ­¥å·¥ä½œ â€” æ¸²æŸ“é˜¶æ®µï¼ˆç¬¬ 3 éƒ¨åˆ†ï¼‰","link":"/chrome/how-web-browser-works/part-3_rendering-phase"},{"text":"æµè§ˆå™¨å¦‚ä½•é€æ­¥å·¥ä½œ â€” åŠ è½½é˜¶æ®µçš„ä¼˜åŒ–ï¼ˆç¬¬ 4 éƒ¨åˆ†ï¼‰","link":"/chrome/how-web-browser-works/part-4_optimization-in-the-loading-stage"},{"text":"æµè§ˆå™¨å¦‚ä½•ä¸€æ­¥ä¸€æ­¥åœ°å·¥ä½œ â€” äº¤äº’é˜¶æ®µçš„ä¼˜åŒ–ï¼ˆç¬¬ 5 éƒ¨åˆ†ï¼‰","link":"/chrome/how-web-browser-works/part-5_optimization-in-the-interaction-stage"},{"text":"ä»€ä¹ˆå¼ºåˆ¶äº†é‡æ’/å›æµ","link":"/chrome/how-web-browser-works/what-forces-layout-reflow"}],"collapsable":true},{"text":"Html","items":[{"text":"Metadata","link":"/chrome/html/metadata"},{"text":"html","link":"/chrome/html/overview"},{"text":"# æ–‡æ¡£ç»“æ„","link":"/chrome/html/structure"}],"collapsable":true},{"text":"å…³é”®æŒ‡æ ‡","items":[{"text":"First Contentful Paint (FCP) é¦–æ¬¡å†…å®¹ç»˜åˆ¶","link":"/chrome/metrics/FCP"},{"text":"Largest Contentful Paint (LCP) æœ€å¤§å†…å®¹å¡«å……","link":"/chrome/metrics/LCP"},{"text":"Time to First Byte (TTFB) é¦–æ¬¡å­—èŠ‚åŠ è½½æ—¶é—´","link":"/chrome/metrics/TTFB"}],"collapsable":true},{"text":"ç°ä»£ç½‘ç»œæµè§ˆå™¨å†…å¹•","items":[{"text":"ç°ä»£ç½‘ç»œæµè§ˆå™¨å†…å¹• â€” 1","link":"/chrome/modern-web-browser/inside-browser-part-1"},{"text":"ç°ä»£ç½‘ç»œæµè§ˆå™¨å†…å¹• â€” 2","link":"/chrome/modern-web-browser/inside-browser-part-2"},{"text":"ç°ä»£ç½‘ç»œæµè§ˆå™¨å†…å¹• â€” 3","link":"/chrome/modern-web-browser/inside-browser-part-3"},{"text":"ç°ä»£ç½‘ç»œæµè§ˆå™¨å†…å¹• â€” 4","link":"/chrome/modern-web-browser/inside-browser-part-4"}],"collapsable":true},{"text":"æ€§èƒ½","items":[{"text":"1. Welcome to Lean performance","link":"/chrome/performance/1-welcome"},{"text":"2. ä¸€èˆ¬ HTML æ€§èƒ½æ³¨æ„äº‹é¡¹","link":"/chrome/performance/2-general-html-performance"},{"text":"ä½¿ç”¨å¯¼èˆªå®šæ—¶å’Œèµ„æºå®šæ—¶è¯„ä¼°ç°åœºçš„è´Ÿè½½æ€§èƒ½","link":"/chrome/performance/navigation-and-resource-timing"},{"text":"ä¼˜åŒ–é•¿ä»»åŠ¡","link":"/chrome/performance/optimize-long-tasks"},{"text":"optimize-resource-loading ä¼˜åŒ–èµ„æºè´Ÿè½½","link":"/chrome/performance/optimize-resource-loading"},{"text":"é€šè¿‡æ‘‡æ ‘å‡å°‘ JavaScript æœ‰æ•ˆè´Ÿè½½","link":"/chrome/performance/reduce-javascript-payloads-with-tree-shaking"},{"text":"asdf","link":"/chrome/performance/welcome-copy"},{"text":"é€Ÿåº¦ä¸ºä»€ä¹ˆé‡è¦","link":"/chrome/performance/why-speed-matters"}],"collapsable":true},{"text":"æ€§èƒ½æŠ€å·§","items":[{"text":"Web ä¸Šçš„å¤šè¿›ç¨‹ï¼šæµè§ˆå™¨è¿›ç¨‹æ¨¡å‹","link":"/chrome/performance/tips/browser-process-model"},{"text":"Browser Rendering Pipeline","link":"/chrome/performance/tips/browser-rendering-pipeline"},{"text":"é€šè¿‡ç«ç„°å›¾æ‰¾åˆ°æœ‰é—®é¢˜çš„ä»£ç ","link":"/chrome/performance/tips/codepath-scoping"},{"text":"å¦‚ä½•æ”¶é›† Web æ€§èƒ½è·Ÿè¸ª","link":"/chrome/performance/tips/collect-a-trace"},{"text":"äº‹ä»¶å¾ªç¯åŸºç¡€çŸ¥è¯†","link":"/chrome/performance/tips/event-loop"},{"text":"æ·±åº¦è®²è§£ç«ç„°å›¾ ğŸ”¥ğŸ”¥","link":"/chrome/performance/tips/flamegraphs-in-depth"},{"text":"é•¿ä»»åŠ¡ï¼šå®ƒä»¬æ˜¯ä»€ä¹ˆä»¥åŠä¸ºä»€ä¹ˆåº”è¯¥é¿å…å®ƒä»¬","link":"/chrome/performance/tips/long-tasks"},{"text":"performance æŸ¥çœ‹ä¸»çº¿ç¨‹ï¼ˆé¢œè‰²å«ä¹‰ï¼‰","link":"/chrome/performance/tips/main-profiler-pane"},{"text":"æ£€æµ‹æµè§ˆå™¨ä½•æ—¶åœ¨ JavaScript ä¸­ç»˜åˆ¶Frame","link":"/chrome/performance/tips/measuring-paint-time"},{"text":"å¦‚ä½•é˜…è¯» Chromium Profiler","link":"/chrome/performance/tips/network-profiler-pane"},{"text":"ä½¿ç”¨ Chromium ç½‘ç»œæ ‡ç­¾é¡µè·å–æ€§èƒ½è¯¦æƒ…","link":"/chrome/performance/tips/network-tab"},{"text":"ä½¿ç”¨æ€§èƒ½æ—¶åºæ ‡è®°è¿›è¡ŒğŸ“æµ‹é‡","link":"/chrome/performance/tips/performance-timing-markers"},{"text":"Chromium F12 æ€§èƒ½åˆ†æå™¨çš„åŸºæœ¬æ¦‚è¿°","link":"/chrome/performance/tips/profiler-basic-ui"},{"text":"ã€--ç©ºæ–‡ä»¶--ã€‘: performance/tips/resource-size-vs-transfer-size.md","link":"/chrome/performance/tips/resource-size-vs-transfer-size"},{"text":"å¦‚ä½•é˜…è¯»ç«ç„°å›¾ ğŸ”¥","link":"/chrome/performance/tips/understanding-flamegraphs"},{"text":"è¯†åˆ« Web åº”ç”¨ä¸­çš„æœªå‹ç¼©èµ„æº","link":"/chrome/performance/tips/validating-compression"},{"text":"asdfadsasdsdfasdf","link":"/chrome/performance/tips/aa/a"}],"collapsable":true}],"design-pattern":[{"text":"Design-pattern","items":[{"text":"# èµ„æºåˆ—è¡¨","link":"/design-pattern/indexs"},{"text":"ä»£ç†æ¨¡å¼","link":"/design-pattern/proxy-pattern"},{"text":"Singleton Pattern","link":"/design-pattern/singleton-pattern"},{"text":"çŠ¶æ€æ¨¡å¼","link":"/design-pattern/state-pattern"},{"text":"ç­–ç•¥æ¨¡å¼","link":"/design-pattern/strategy-pattern"}],"collapsable":true}],"open-source":[{"text":"Open-source","items":[{"text":"delay","link":"/open-source/delay"},{"text":"dot-prop","link":"/open-source/dot-prop"},{"text":"glob-to-regexp","link":"/open-source/glob-to-regexp"},{"text":"koa æ´‹è‘±æ¨¡å‹","link":"/open-source/koa-compose"},{"text":"quick-lru","link":"/open-source/lru-cache"},{"text":"p-defer","link":"/open-source/p-defer"},{"text":"p-lazy","link":"/open-source/p-lazy"},{"text":"p-limit","link":"/open-source/p-limit"},{"text":"p-locate","link":"/open-source/p-locate"},{"text":"p-settle","link":"/open-source/p-settle"},{"text":"yocto-queue","link":"/open-source/yocto-queue"}],"collapsable":true}],"promise":[{"text":"Promise","items":[{"text":"é¡ºåºæ‰§è¡Œä»»åŠ¡ç›´åˆ°ç¬¬ä¸€ä¸ªresolvedã€‚","link":"/promise/first-resolved"},{"text":"reduceå®ç°å¤šä¸ªpromiseé¡ºåºæ‰§è¡Œ.","link":"/promise/sequential-execution"}],"collapsable":true}],"typescript":[{"text":"Typescript","items":[{"text":"Typescript æŠ€å·§","link":"/typescript/tip"}],"collapsable":true}],"webpack":[{"text":"Webpack","items":[{"text":"webpack æ‰“åŒ…ä»£ç åˆ†æ","link":"/webpack/build-result"},{"text":"mini-webpack","link":"/webpack/mini-webpack"},{"text":"minipack-explain","link":"/webpack/minipack"},{"text":"tapable","link":"/webpack/tapable"}],"collapsable":true}]},"footer":{"message":"Released under the MIT License.","copyright":"Copyright Â© 2022-present Beka"}},"head":[["script",{"id":"check-dark-light"},"\n        ;(() => {\n          const saved = localStorage.getItem('island-theme-appearance')\n          const prefereDark = window.matchMedia('(prefers-color-scheme: dark)').matches\n          if (!saved || saved === 'auto' ? prefereDark : saved === 'dark') {\n            document.documentElement.classList.add('dark')\n          }\n        })()\n      "]],"base":"","icon":"","root":"/Users/beka/Desktop/code/bekacodechn.github.io/blog","appearance":true},"pagePath":"/Users/beka/Desktop/code/bekacodechn.github.io/blog/chrome/performance/optimize-long-tasks.md","relativePagePath":"chrome/performance/optimize-long-tasks.md","toc":[{"id":"what-is-a-taskä»€ä¹ˆæ˜¯ä»»åŠ¡","text":"What is a task?Â ä»€ä¹ˆæ˜¯ä»»åŠ¡ï¼Ÿ","depth":2},{"id":"what-is-the-main-thread--ä¸»çº¿æ˜¯ä»€ä¹ˆ","text":"What is the main thread?  ä¸»çº¿æ˜¯ä»€ä¹ˆï¼Ÿ","depth":2},{"id":"task-management-strategies--ä»»åŠ¡ç®¡ç†ç­–ç•¥","text":"Task management strategies  ä»»åŠ¡ç®¡ç†ç­–ç•¥","depth":2},{"id":"manually-defer-code-execution--æ‰‹åŠ¨å»¶è¿Ÿä»£ç æ‰§è¡Œ","text":"Manually defer code execution  æ‰‹åŠ¨å»¶è¿Ÿä»£ç æ‰§è¡Œ","depth":3},{"id":"useasyncawaitto-create-yield-points--ä½¿ç”¨--åˆ›å»ºå±ˆæœç‚¹","text":"UseÂ async/awaitÂ to create yield points  (ä½¿ç”¨ / åˆ›å»ºå±ˆæœç‚¹)","depth":3},{"id":"yield-only-when-necessary--ä»…åœ¨å¿…è¦æ—¶æ‰å±ˆæœ","text":"Yield only when necessary  ä»…åœ¨å¿…è¦æ—¶æ‰å±ˆæœ","depth":3},{"id":"gaps-in-current-apis","text":"Gaps in current APIs","depth":2},{"id":"a-dedicated-scheduler-api--ä¸“ç”¨è°ƒåº¦ç¨‹åº-api","text":"A dedicated scheduler API  ä¸“ç”¨è°ƒåº¦ç¨‹åº API","depth":3},{"id":"built-in-yield-with-continuation-via-å†…ç½®äº§é‡é€šè¿‡ä»¥ä¸‹æ–¹å¼å»¶ç»­scheduleryield","text":"Built-in yield with continuation via (å†…ç½®äº§é‡ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼å»¶ç»­scheduler.yield)","depth":3},{"id":"conclusion","text":"Conclusion","depth":2}],"title":"ä¼˜åŒ–é•¿ä»»åŠ¡","lastUpdatedTime":"2023/11/16 20:32:02","content":"# ä¼˜åŒ–é•¿ä»»åŠ¡\n\n`metadata:`\n\n**åŸæ ‡é¢˜:** Optimize long tasks\n\n**é“¾æ¥:** https://web.dev/articles/optimize-long-tasks\n\n---\n\nYou've been told \"don't block the main thread\" and \"break up your long tasks\", but what does it mean to do those things?\n\nä½ è¢«å‘ŠçŸ¥â€œä¸è¦é˜»å¡ä¸»çº¿ç¨‹â€å’Œâ€œåˆ†è§£ä½ çš„é•¿ä»»åŠ¡â€ï¼Œä½†æ˜¯åšè¿™äº›äº‹æƒ…æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿ\n\nIf you read lots of stuff about web performance, the advice for keeping your JavaScript apps fast tends to involve some of these tidbits:  \n\nå¦‚æœä½ è¯»è¿‡å¾ˆå¤šå…³äº Web æ€§èƒ½çš„æ–‡ç« ï¼Œé‚£ä¹ˆä¿æŒ JavaScript åº”ç”¨ç¨‹åºå¿«é€Ÿè¿è¡Œçš„å»ºè®®å¾€å¾€ä¼šæ¶‰åŠä»¥ä¸‹ä¸€äº›èŠ±çµ®ï¼š\n\n*   \"Don't block the main thread.\"  \n\n    â€œä¸è¦é˜»å¡ä¸»çº¿ç¨‹ã€‚â€\n*   \"Break up your long tasks.\"  \n\n    â€œåˆ†è§£ä½ çš„é•¿æœŸä»»åŠ¡ã€‚â€\n\nWhat does any of that mean? ShippingÂ _less_Â JavaScript is good, but does that automatically equate to snappier user interfaces throughout the page lifecycle? Maybe, but maybe not.  \n\nè¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿå‡å°‘ JavaScript çš„å‘å¸ƒæ˜¯ä»¶å¥½äº‹ï¼Œä½†è¿™æ˜¯å¦è‡ªåŠ¨ç­‰åŒäºåœ¨æ•´ä¸ªé¡µé¢ç”Ÿå‘½å‘¨æœŸä¸­æä¾›æ›´å¿«æ·çš„ç”¨æˆ·ç•Œé¢ï¼Ÿä¹Ÿè®¸ï¼Œä½†ä¹Ÿè®¸ä¸æ˜¯ã€‚\n\nTo get your head around why it's important to optimize tasks in JavaScript, you need to understand the role of tasks and how the browser handles themâ€”and that starts with understanding what a task is.  \n\nè¦å¼„æ¸…æ¥šä¸ºä»€ä¹ˆåœ¨ JavaScript ä¸­ä¼˜åŒ–ä»»åŠ¡å¾ˆé‡è¦ï¼Œæ‚¨éœ€è¦äº†è§£ä»»åŠ¡çš„è§’è‰²ä»¥åŠæµè§ˆå™¨å¦‚ä½•å¤„ç†å®ƒä»¬â€”â€”è¿™é¦–å…ˆè¦äº†è§£ä»»åŠ¡æ˜¯ä»€ä¹ˆã€‚\n\n## What is a task?Â ä»€ä¹ˆæ˜¯ä»»åŠ¡ï¼Ÿ\n\nAÂ _task_Â is any discrete piece of work that the browser does. Tasks involve work such as rendering, parsing HTML and CSS, running the JavaScript code you write, and other things you may not have direct control over. Of all of this, the JavaScript you write and deploy to the web is a major source of tasks.  \n\nä»»åŠ¡æ˜¯æµè§ˆå™¨æ‰§è¡Œçš„ä»»ä½•ç¦»æ•£å·¥ä½œã€‚ä»»åŠ¡æ¶‰åŠæ¸²æŸ“ã€è§£æ HTML å’Œ CSSã€è¿è¡Œæ‚¨ç¼–å†™çš„ JavaScript ä»£ç ä»¥åŠæ‚¨å¯èƒ½æ— æ³•ç›´æ¥æ§åˆ¶çš„å…¶ä»–å·¥ä½œã€‚åœ¨æ‰€æœ‰è¿™äº›ä¸­ï¼Œæ‚¨ç¼–å†™å¹¶éƒ¨ç½²åˆ° Web çš„ JavaScript æ˜¯ä»»åŠ¡çš„ä¸»è¦æ¥æºã€‚\n\n![20231116193519](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116193519.png)\n*A depiction of a task kicked off by aÂ `click`Â event handler in the performance profiler in Chrome DevTools.*\n(*å¯¹ç”± Chrome DevTools ä¸­æ€§èƒ½æ¢æŸ¥å™¨ä¸­çš„Â `click`Â äº‹ä»¶å¤„ç†ç¨‹åºå¯åŠ¨çš„ä»»åŠ¡çš„æè¿°ã€‚*)\n\nTasks impact performance in a couple of ways. For example, when a browser downloads a JavaScript file during startup, it queues tasks to parse and compile that JavaScript so it can be executed. Later on in the page lifecycle, tasks are kicked off when your JavaScript does work such as driving interactions through event handlers, JavaScript-driven animations, and background activity such as analytics collection. All of this stuffâ€”with the exception ofÂ [web workers](https://developer.mozilla.org/docs/Web/API/Web_Workers_API/Using_web_workers)Â and similar APIsâ€”happens on the main thread.  \nä»»åŠ¡ä»¥å¤šç§æ–¹å¼å½±å“æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œå½“æµè§ˆå™¨åœ¨å¯åŠ¨æœŸé—´ä¸‹è½½ JavaScript æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šå°†ä»»åŠ¡æ’é˜Ÿä»¥è§£æå’Œç¼–è¯‘è¯¥ JavaScriptï¼Œä»¥ä¾¿å¯ä»¥æ‰§è¡Œå®ƒã€‚åœ¨é¡µé¢ç”Ÿå‘½å‘¨æœŸçš„åæœŸï¼Œå½“ JavaScript æ­£å¸¸å·¥ä½œæ—¶ï¼Œä»»åŠ¡å°†å¯åŠ¨ï¼Œä¾‹å¦‚é€šè¿‡äº‹ä»¶å¤„ç†ç¨‹åºã€JavaScript é©±åŠ¨çš„åŠ¨ç”»å’Œåå°æ´»åŠ¨ï¼ˆå¦‚åˆ†ææ”¶é›†ï¼‰é©±åŠ¨äº¤äº’ã€‚é™¤äº† Web Worker å’Œç±»ä¼¼çš„ API ä¹‹å¤–ï¼Œæ‰€æœ‰è¿™äº›ä¸œè¥¿éƒ½å‘ç”Ÿåœ¨ä¸»çº¿ç¨‹ä¸Šã€‚\n\n## What is the main thread?  ä¸»çº¿æ˜¯ä»€ä¹ˆï¼Ÿ\n\nTheÂ _main thread_Â is where most tasks are run in the browser. It's called the main thread for a reason: it's the one thread where nearly all the JavaScript you write does its work.  \n\nä¸»çº¿ç¨‹æ˜¯å¤§å¤šæ•°ä»»åŠ¡åœ¨æµè§ˆå™¨ä¸­è¿è¡Œçš„åœ°æ–¹ã€‚å®ƒè¢«ç§°ä¸ºä¸»çº¿ç¨‹æ˜¯æœ‰åŸå› çš„ï¼šå®ƒæ˜¯ä½ ç¼–å†™çš„å‡ ä¹æ‰€æœ‰ JavaScript éƒ½å®Œæˆå…¶å·¥ä½œçš„çº¿ç¨‹ã€‚\n\nThe main thread can only process one task at a time. When tasks stretch beyond a certain pointâ€”50 milliseconds to be exactâ€”they're classified asÂ _long tasks_. If the user is attempting to interact with the page while a long task runsâ€”or if an important rendering update needs to happenâ€”the browser will be delayed in handling that work. This results in interaction or rendering latency.  \n\nä¸»çº¿ç¨‹ä¸€æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªä»»åŠ¡ã€‚å½“ä»»åŠ¡è¶…è¿‡æŸä¸ªç‚¹ï¼ˆå‡†ç¡®åœ°è¯´æ˜¯ 50 æ¯«ç§’ï¼‰æ—¶ï¼Œå®ƒä»¬è¢«å½’ç±»ä¸ºé•¿ä»»åŠ¡ã€‚å¦‚æœç”¨æˆ·åœ¨é•¿æ—¶é—´ä»»åŠ¡è¿è¡Œæ—¶å°è¯•ä¸é¡µé¢äº¤äº’ï¼Œæˆ–è€…éœ€è¦è¿›è¡Œé‡è¦çš„å‘ˆç°æ›´æ–°ï¼Œåˆ™æµè§ˆå™¨åœ¨å¤„ç†è¯¥å·¥ä½œæ—¶å°†å»¶è¿Ÿã€‚è¿™ä¼šå¯¼è‡´äº¤äº’æˆ–æ¸²æŸ“å»¶è¿Ÿã€‚\n\n![20231116193905](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116193905.png)\n\n*A long task as depicted in Chrome's performance profiler. Long tasks are indicated by a red triangle in the corner of the task, with the blocking portion of the task filled in with a pattern of diagonal red stripes.*\n\n*è¿™æ˜¯ä¸€é¡¹æ¼«é•¿çš„ä»»åŠ¡ï¼Œå¦‚ Chrome çš„æ€§èƒ½åˆ†æå™¨ä¸­æ‰€è¿°ã€‚é•¿ä»»åŠ¡ç”±ä»»åŠ¡ä¸€è§’çš„çº¢è‰²ä¸‰è§’å½¢è¡¨ç¤ºï¼Œä»»åŠ¡çš„é˜»å¡éƒ¨åˆ†ç”¨å¯¹è§’çº¿çº¢è‰²æ¡çº¹å›¾æ¡ˆå¡«å……ã€‚*\n\nYou need toÂ _break up_Â tasks. This means taking a single long task and dividing it into smaller tasks that take less time to run individually.  \n\næ‚¨éœ€è¦åˆ†è§£ä»»åŠ¡ã€‚è¿™æ„å‘³ç€å°†å•ä¸ªé•¿ä»»åŠ¡åˆ’åˆ†ä¸ºè¾ƒå°çš„ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡å•ç‹¬è¿è¡Œæ‰€éœ€çš„æ—¶é—´æ›´å°‘ã€‚\n\n![20231116193949](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116193949.png)\n\n*A visualization of a single long task versus that same task broken up into five shorter tasks.*\n\n*å•ä¸ªé•¿ä»»åŠ¡ä¸åŒä¸€ä»»åŠ¡çš„å¯è§†åŒ–ï¼Œåˆ†è§£ä¸ºäº”ä¸ªè¾ƒçŸ­çš„ä»»åŠ¡ã€‚*\n\nThis matters because when tasks are broken up, the browser has more opportunities to respond to higher-priority workâ€”and that includes user interactions.  \n\nè¿™å¾ˆé‡è¦ï¼Œå› ä¸ºå½“ä»»åŠ¡è¢«åˆ†è§£æ—¶ï¼Œæµè§ˆå™¨æœ‰æ›´å¤šæœºä¼šå“åº”æ›´é«˜ä¼˜å…ˆçº§çš„å·¥ä½œï¼Œå…¶ä¸­åŒ…æ‹¬ç”¨æˆ·äº¤äº’ã€‚\n\n![20231116194020](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116194020.png)\n*A visualization of what happens to interactions when tasks are too long and the browser can't respond quickly enough to interactions, versus when longer tasks are broken up into smaller tasks.*\n\n*å½“ä»»åŠ¡å¤ªé•¿ä¸”æµè§ˆå™¨æ— æ³•è¶³å¤Ÿå¿«åœ°å“åº”äº¤äº’æ—¶ï¼Œä¸å°†è¾ƒé•¿çš„ä»»åŠ¡åˆ†è§£ä¸ºè¾ƒå°çš„ä»»åŠ¡æ—¶ï¼Œäº¤äº’ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µçš„å¯è§†åŒ–ã€‚*\n\nAt the top of the preceding figure, an event handler queued up by a user interaction had to wait for a single long task before it could run, This delays the interaction from taking place. At the bottom, the event handler has a chance to run sooner. Because the event handler had an opportunity to run in between smaller tasks, it runs sooner than if it had to wait for a long task to finish. In the top example, the user might have noticed lag; in the bottom, the interaction might have feltÂ _instant_.  \n\nåœ¨ä¸Šå›¾çš„é¡¶éƒ¨ï¼Œç”±ç”¨æˆ·äº¤äº’æ’é˜Ÿçš„äº‹ä»¶å¤„ç†ç¨‹åºå¿…é¡»ç­‰å¾…å•ä¸ªé•¿ä»»åŠ¡æ‰èƒ½è¿è¡Œï¼Œè¿™ä¼šå»¶è¿Ÿäº¤äº’çš„å‘ç”Ÿã€‚åœ¨åº•éƒ¨ï¼Œäº‹ä»¶å¤„ç†ç¨‹åºæœ‰æœºä¼šæ›´å¿«åœ°è¿è¡Œã€‚ç”±äºäº‹ä»¶å¤„ç†ç¨‹åºæœ‰æœºä¼šåœ¨è¾ƒå°çš„ä»»åŠ¡ä¹‹é—´è¿è¡Œï¼Œå› æ­¤å®ƒæ¯”å¿…é¡»ç­‰å¾…é•¿æ—¶é—´ä»»åŠ¡å®Œæˆæ—¶è¿è¡Œå¾—æ›´å¿«ã€‚åœ¨é¡¶éƒ¨ç¤ºä¾‹ä¸­ï¼Œç”¨æˆ·å¯èƒ½å·²ç»æ³¨æ„åˆ°å»¶è¿Ÿ;åœ¨åº•éƒ¨ï¼Œäº¤äº’å¯èƒ½æ„Ÿè§‰æ˜¯å³æ—¶çš„ã€‚\n\nThe problem, though, is that the advice of \"break up your long tasks\" and \"don't block the main thread\" isn't specific enough unless you already knowÂ _how_Â to do those things. That's what this guide will explain.  \n\nç„¶è€Œï¼Œé—®é¢˜åœ¨äºï¼Œâ€œåˆ†è§£ä½ çš„é•¿ä»»åŠ¡â€å’Œâ€œä¸è¦é˜»å¡ä¸»çº¿ç¨‹â€çš„å»ºè®®ä¸å¤Ÿå…·ä½“ï¼Œé™¤éä½ å·²ç»çŸ¥é“å¦‚ä½•åšè¿™äº›äº‹æƒ…ã€‚è¿™å°±æ˜¯æœ¬æŒ‡å—å°†è¦è§£é‡Šçš„å†…å®¹ã€‚\n\n## Task management strategies  ä»»åŠ¡ç®¡ç†ç­–ç•¥\n\nA common bit of advice in software architecture is to break up your work into smaller functions. This gives you the benefits of better code readability, and project maintainability. This also makes tests easier to write.  \n\nè½¯ä»¶æ¶æ„ä¸­ä¸€ä¸ªå¸¸è§çš„å»ºè®®æ˜¯å°†ä½ çš„å·¥ä½œåˆ†è§£æˆæ›´å°çš„åŠŸèƒ½ã€‚è¿™ä¸ºæ‚¨æä¾›äº†æ›´å¥½çš„ä»£ç å¯è¯»æ€§å’Œé¡¹ç›®å¯ç»´æŠ¤æ€§çš„å¥½å¤„ã€‚è¿™ä¹Ÿä½¿æµ‹è¯•æ›´æ˜“äºç¼–å†™ã€‚\n\n```js\nfunction saveSettings () {\n  validateForm();\n  showSpinner();\n  saveToDatabase();\n  updateUI();\n  sendAnalytics();\n}\n```\n\nIn this example, there's a function namedÂ `saveSettings()`Â that calls five functions within it to do the work, such as validating a form, showing a spinner, sending data, and so on. Conceptually, this is well architected. If you need to debug one of these functions, you can traverse the project tree to figure out what each function does.  \n\nåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæœ‰ä¸€ä¸ªåä¸ºçš„å‡½æ•°ï¼Œè¯¥å‡½æ•°è°ƒç”¨å…¶ä¸­çš„Â `saveSettings()`Â äº”ä¸ªå‡½æ•°æ¥æ‰§è¡Œå·¥ä½œï¼Œä¾‹å¦‚éªŒè¯è¡¨å•ã€æ˜¾ç¤ºå¾®è°ƒå™¨ã€å‘é€æ•°æ®ç­‰ã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œè¿™æ˜¯å¾ˆå¥½çš„æ¶æ„ã€‚å¦‚æœéœ€è¦è°ƒè¯•å…¶ä¸­ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥éå†é¡¹ç›®æ ‘ä»¥æ‰¾å‡ºæ¯ä¸ªå‡½æ•°çš„ä½œç”¨ã€‚\n\nThe problem, however, is that JavaScript doesn't run each of these functions as separate tasks because they are being executed within theÂ `saveSettings()`Â function.Â **This means that all five functions run as a single task.**  \n\nç„¶è€Œï¼Œé—®é¢˜åœ¨äº JavaScript ä¸ä¼šå°†è¿™äº›å‡½æ•°ä¸­çš„æ¯ä¸€ä¸ªä½œä¸ºå•ç‹¬çš„ä»»åŠ¡è¿è¡Œï¼Œå› ä¸ºå®ƒä»¬æ˜¯åœ¨Â `saveSettings()`Â å‡½æ•°ä¸­æ‰§è¡Œçš„ã€‚è¿™æ„å‘³ç€æ‰€æœ‰äº”ä¸ªå‡½æ•°éƒ½ä½œä¸ºå•ä¸ªä»»åŠ¡è¿è¡Œã€‚\n\n:::info\n**Key point:**Â JavaScript works this way because it uses theÂ [run-to-completion model](https://developer.mozilla.org/docs/Web/JavaScript/EventLoop#run-to-completion)Â of task execution. This means that each task will run until it finishes, regardless of how long it blocks the main thread.  \n\nå…³é”®ç‚¹ï¼šJavaScript ä¹‹æ‰€ä»¥ä»¥è¿™ç§æ–¹å¼å·¥ä½œï¼Œæ˜¯å› ä¸ºå®ƒä½¿ç”¨ä»»åŠ¡æ‰§è¡Œçš„è¿è¡Œåˆ°å®Œæˆæ¨¡å‹ã€‚è¿™æ„å‘³ç€æ¯ä¸ªä»»åŠ¡éƒ½å°†è¿è¡Œç›´åˆ°å®Œæˆï¼Œæ— è®ºå®ƒé˜»å¡ä¸»çº¿ç¨‹å¤šé•¿æ—¶é—´ã€‚\n:::\n\n![20231116194228](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116194228.png)\n*A single functionÂ `saveSettings()`Â that calls five functions. The work is run as part of one long monolithic task.*\n\n*è°ƒç”¨äº”ä¸ªå‡½æ•°çš„å•ä¸ªå‡½æ•°Â `saveSettings()`Â ã€‚è¯¥å·¥ä½œå°†ä½œä¸ºä¸€é¡¹é•¿æœŸæ•´ä½“ä»»åŠ¡çš„ä¸€éƒ¨åˆ†è¿è¡Œã€‚*\n\nIn the best case scenario, even just one of those functions can contribute 50 milliseconds or more to the total length of the task. In the worst case, more of those tasks can run quite a bit longerâ€”especially on resource-constrained devices. What follows is a set of strategies you can use to break up and prioritize tasks.  \n\nåœ¨æœ€å¥½çš„æƒ…å†µä¸‹ï¼Œå³ä½¿åªæœ‰ä¸€ä¸ªå‡½æ•°ä¹Ÿä¼šä¸ºä»»åŠ¡çš„æ€»é•¿åº¦è´¡çŒ® 50 æ¯«ç§’æˆ–æ›´å¤šã€‚åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œè¿™äº›ä»»åŠ¡ä¸­çš„æ›´å¤šä»»åŠ¡å¯èƒ½ä¼šè¿è¡Œæ›´é•¿çš„æ—¶é—´ï¼Œå°¤å…¶æ˜¯åœ¨èµ„æºå—é™çš„è®¾å¤‡ä¸Šã€‚ä»¥ä¸‹æ˜¯ä¸€ç»„å¯ç”¨äºåˆ†è§£ä»»åŠ¡å¹¶ç¡®å®šä»»åŠ¡ä¼˜å…ˆçº§çš„ç­–ç•¥ã€‚\n\n### Manually defer code execution  æ‰‹åŠ¨å»¶è¿Ÿä»£ç æ‰§è¡Œ\n\nOne method developers have used to break up tasks into smaller ones involvesÂ `setTimeout()`. With this technique, you pass the function toÂ `setTimeout()`. This postpones execution of the callback into a separate task, even if you specify a timeout ofÂ `0`.  \n\nå¼€å‘äººå‘˜ç”¨æ¥å°†ä»»åŠ¡åˆ†è§£ä¸ºæ›´å°ä»»åŠ¡çš„ä¸€ç§æ–¹æ³•åŒ…æ‹¬Â `setTimeout()`Â .ä½¿ç”¨æ­¤æŠ€æœ¯ï¼Œå¯ä»¥å°†å‡½æ•°ä¼ é€’ç»™Â `setTimeout()`Â ã€‚è¿™ä¼šå°†å›è°ƒçš„æ‰§è¡Œæ¨è¿Ÿåˆ°å•ç‹¬çš„ä»»åŠ¡ä¸­ï¼Œå³ä½¿æ‚¨æŒ‡å®šäº†è¶…æ—¶Â `0`Â ã€‚\n\n```js\nfunction saveSettings () {\n  // Do critical work that is user-visible:\n  validateForm();\n  showSpinner();\n  updateUI();\n\n  // Defer work that isn't user-visible to a separate task:\n  setTimeout(() => {\n    saveToDatabase();\n    sendAnalytics();\n  }, 0);\n}\n```\n\nThis works well if you have a series of functions that need to run sequentially, but your code may not always be organized this way. For example, you could have a large amount of data that needs to be processed in a loop, and that task could take a very long time if you have millions of items.  \n\nå¦‚æœæ‚¨æœ‰ä¸€ç³»åˆ—éœ€è¦æŒ‰é¡ºåºè¿è¡Œçš„å‡½æ•°ï¼Œè¿™å¾ˆæœ‰æ•ˆï¼Œä½†æ‚¨çš„ä»£ç å¯èƒ½å¹¶ä¸æ€»æ˜¯ä»¥è¿™ç§æ–¹å¼ç»„ç»‡ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½æœ‰å¤§é‡æ•°æ®éœ€è¦åœ¨å¾ªç¯ä¸­å¤„ç†ï¼Œå¦‚æœæ‚¨æœ‰æ•°ç™¾ä¸‡ä¸ªé¡¹ç›®ï¼Œåˆ™è¯¥ä»»åŠ¡å¯èƒ½éœ€è¦å¾ˆé•¿æ—¶é—´ã€‚\n\n```js\nfunction processData () {\n  for (const item of largeDataArray) {\n    // Process the individual item here.\n  }\n}\n```\n\nUsingÂ `setTimeout()`Â here is problematic, because the ergonomics of it make it difficult to implement, and the entire array of data could take a very long time to process, even if each item can be processed very quickly. It all adds up, andÂ `setTimeout()`Â isn't the right tool for the jobâ€”at least not when used this way.  \n\nåœ¨è¿™é‡Œä½¿ç”¨Â `setTimeout()`Â æ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºå®ƒçš„äººä½“å·¥ç¨‹å­¦ä½¿å…¶éš¾ä»¥å®ç°ï¼Œå¹¶ä¸”æ•´ä¸ªæ•°æ®æ•°ç»„å¯èƒ½éœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½å¤„ç†ï¼Œå³ä½¿æ¯ä¸ªé¡¹ç›®éƒ½å¯ä»¥éå¸¸å¿«é€Ÿåœ°å¤„ç†ã€‚è¿™ä¸€åˆ‡åŠ èµ·æ¥ï¼ŒÂ `setTimeout()`Â å¹¶ä¸æ˜¯è¿™é¡¹å·¥ä½œçš„æ­£ç¡®å·¥å…·â€”â€”è‡³å°‘åœ¨ä»¥è¿™ç§æ–¹å¼ä½¿ç”¨æ—¶ä¸æ˜¯ã€‚\n\nIn addition toÂ `setTimeout()`, there are a few other APIs that allow you to defer code execution to a subsequent task. OneÂ [involves usingÂ `postMessage()`Â for faster timeouts](https://dbaron.org/log/20100309-faster-timeouts). You can also break up work usingÂ `requestIdleCallback()`â€”but beware!â€”`requestIdleCallback()`Â schedules tasks at the lowest possible priority, and only during browser idle time. When the main thread is congested, tasks scheduled withÂ `requestIdleCallback()`Â may never get to run.  \n\né™¤äº†Â `setTimeout()`Â ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»– API å…è®¸æ‚¨å°†ä»£ç æ‰§è¡Œæ¨è¿Ÿåˆ°åç»­ä»»åŠ¡ã€‚ä¸€ç§æ˜¯ç”¨äºÂ `postMessage()`Â æ›´å¿«çš„è¶…æ—¶ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ï¼ˆä½†è¦æ³¨æ„ï¼‰Â `requestIdleCallback()`Â ä»¥Â `requestIdleCallback()`Â å°½å¯èƒ½ä½çš„ä¼˜å…ˆçº§å®‰æ’ä»»åŠ¡ï¼Œå¹¶ä¸”ä»…åœ¨æµè§ˆå™¨ç©ºé—²æ—¶é—´å®‰æ’ä»»åŠ¡æ¥åˆ†è§£å·¥ä½œã€‚å½“ä¸»çº¿ç¨‹æ‹¥å¡æ—¶ï¼Œè®¡åˆ’çš„ä»»åŠ¡Â `requestIdleCallback()`Â å¯èƒ½æ°¸è¿œæ— æ³•è¿è¡Œã€‚\n\n### UseÂ `async`/`await`Â to create yield points  (ä½¿ç”¨ / åˆ›å»ºå±ˆæœç‚¹)\n\nA phrase you'll see throughout the rest of this guide is \"yield to the main thread\"â€”but what does that mean? Why should you do it? When should you do it?  \n\nåœ¨æœ¬æŒ‡å—çš„å…¶ä½™éƒ¨åˆ†ï¼Œæ‚¨å°†çœ‹åˆ°ä¸€å¥è¯æ˜¯â€œå±ˆæœäºä¸»çº¿ç¨‹â€â€”â€”ä½†è¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Ÿä»€ä¹ˆæ—¶å€™åº”è¯¥åšï¼Ÿ\n\n:::info\n**Key point:**Â When youÂ _yield_Â to the main thread, you're giving it an opportunity to handle more important tasks than the ones that are currently queued up. Ideally, you should yield to the main thread whenever you have some crucial user-facing work that needs to execute sooner than if you didn't yield.Â **Yielding to the main thread creates opportunities for critical work to run sooner.**  \n\nå…³é”®ç‚¹ï¼šå½“ä½ å±ˆæœäºä¸»çº¿ç¨‹æ—¶ï¼Œä½ å°±ç»™äº†å®ƒä¸€ä¸ªæœºä¼šæ¥å¤„ç†æ¯”å½“å‰æ’é˜Ÿçš„ä»»åŠ¡æ›´é‡è¦çš„ä»»åŠ¡ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæ¯å½“æ‚¨æœ‰ä¸€äº›é¢å‘ç”¨æˆ·çš„å…³é”®å·¥ä½œéœ€è¦æ¯”ä¸è®©æ­¥æ—¶æ›´å¿«åœ°æ‰§è¡Œæ—¶ï¼Œæ‚¨éƒ½åº”è¯¥å±ˆæœäºä¸»çº¿ç¨‹ã€‚å±ˆæœäºä¸»çº¿ç¨‹ä¸ºå…³é”®å·¥ä½œåˆ›é€ äº†æ›´å¿«è¿è¡Œçš„æœºä¼šã€‚\n:::\n\nWhen tasks are broken up, other tasks can be prioritized better by the browser's internal prioritization scheme. One way to yield to the main thread involves using a combination of aÂ `Promise`Â that resolves with a call toÂ `setTimeout()`:  \n\nå½“ä»»åŠ¡è¢«åˆ†è§£æ—¶ï¼Œæµè§ˆå™¨çš„å†…éƒ¨ä¼˜å…ˆçº§æ–¹æ¡ˆå¯ä»¥æ›´å¥½åœ°ç¡®å®šå…¶ä»–ä»»åŠ¡çš„ä¼˜å…ˆçº§ã€‚å±ˆæœäºä¸»çº¿ç¨‹çš„ä¸€ç§æ–¹æ³•æ¶‰åŠä½¿ç”¨ aÂ `Promise`Â çš„ç»„åˆï¼Œè¯¥ç»„åˆé€šè¿‡è°ƒç”¨ to è§£æÂ `setTimeout()`Â ï¼š\n\n```js\nfunction yieldToMain () {\n  return new Promise(resolve => {\n    setTimeout(resolve, 0);\n  });\n}\n```\n\n:::warning\nCaution: While this code example returns a Promise that resolves after a call to setTimeout(), it's not the Promise that is responsible for running the rest of the code in a new task, it's the setTimeout() call. Promise callbacks run as microtasks rather than tasks, and therefore don't yield to the main thread.\n\næ³¨æ„ï¼šè™½ç„¶æ­¤ä»£ç ç¤ºä¾‹è¿”å›åœ¨è°ƒç”¨setTimeoutï¼ˆï¼‰åè§£æçš„Promiseï¼Œä½†ä¸æ˜¯Promiseè´Ÿè´£åœ¨æ–°ä»»åŠ¡ä¸­è¿è¡Œå…¶ä½™ä»£ç ï¼Œè€Œæ˜¯setTimeoutï¼ˆï¼‰è°ƒç”¨ã€‚Promiseå›è°ƒä½œä¸ºå¾®ä»»åŠ¡è€Œä¸æ˜¯ä»»åŠ¡è¿è¡Œï¼Œå› æ­¤ä¸ä¼šå±ˆæœäºä¸»çº¿ç¨‹ã€‚\n:::\n\nIn theÂ `saveSettings()`Â function, you can yield to the main thread after each bit of work if youÂ `await`Â theÂ `yieldToMain()`Â function after each function call:  \n\nåœ¨å‡½æ•°ä¸­Â `saveSettings()`Â ï¼Œå¦‚æœÂ `await`Â `yieldToMain()`Â å‡½æ•°åœ¨æ¯æ¬¡å‡½æ•°è°ƒç”¨åï¼Œå¯ä»¥åœ¨æ¯æ¬¡ä½å·¥ä½œåè®©æ­¥ç»™ä¸»çº¿ç¨‹ï¼š\n\n```js\nasync function saveSettings () {\n  // Create an array of functions to run:\n  const tasks = [\n    validateForm,\n    showSpinner,\n    saveToDatabase,\n    updateUI,\n    sendAnalytics\n  ]\n\n  // Loop over the tasks:\n  while (tasks.length > 0) {\n    // Shift the first task off the tasks array:\n    const task = tasks.shift();\n\n    // Run the task:\n    task();\n\n    // Yield to the main thread:\n    await yieldToMain();\n  }\n}\n```\n\n:::info\n**Key point:**Â You don't have to yield afterÂ _every_Â function call. For example, if you run two functions that result in critical updates to the user interface, you probably don't want to yield in between them. If you can, let that work run first,Â _then_Â consider yielding in between functions that do less critical or background work that the user doesn't see.  \n\næ‚¨ä¸å¿…åœ¨_æ¯ä¸ª_å‡½æ•°è°ƒç”¨åå±ˆæœã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨è¿è¡Œä¸¤ä¸ªå¯¼è‡´ç”¨æˆ·ç•Œé¢å‘ç”Ÿå…³é”®æ›´æ–°çš„å‡½æ•°ï¼Œæ‚¨å¯èƒ½ä¸å¸Œæœ›åœ¨å®ƒä»¬ä¹‹é—´åšå‡ºè®©æ­¥ã€‚å¦‚æœå¯ä»¥çš„è¯ï¼Œè¯·å…ˆè¿è¡Œè¯¥å·¥ä½œï¼Œç„¶åè€ƒè™‘åœ¨æ‰§è¡Œç”¨æˆ·çœ‹ä¸åˆ°çš„ä¸å¤ªé‡è¦æˆ–åå°å·¥ä½œçš„å‡½æ•°ä¹‹é—´è¿›è¡Œè®©æ­¥ã€‚\n:::\n\nThe result is that the once-monolithic task is now broken up into separate tasks.  \n\nç»“æœæ˜¯ï¼Œæ›¾ç»å•ä¸€çš„ä»»åŠ¡ç°åœ¨è¢«åˆ†è§£ä¸ºå•ç‹¬çš„ä»»åŠ¡ã€‚\n\n![20231116195416](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116195416.png)\n*TheÂ `saveSettings()`Â function now executes its child functions as separate tasks.*\n\n*è¯¥Â `saveSettings()`Â å‡½æ•°ç°åœ¨å°†å…¶å­å‡½æ•°ä½œä¸ºå•ç‹¬çš„ä»»åŠ¡æ‰§è¡Œã€‚*\n\nThe benefit of using a promise-based approach to yielding rather than manual use ofÂ `setTimeout()`Â is better ergonomics. Yield points become declarative, and therefore easier to write, read, and understand.  \n\nä½¿ç”¨åŸºäºæ‰¿è¯ºçš„å±ˆæœæ–¹æ³•è€Œä¸æ˜¯æ‰‹åŠ¨ä½¿ç”¨çš„å¥½å¤„Â `setTimeout()`Â æ˜¯æ›´å¥½çš„äººä½“å·¥ç¨‹å­¦ã€‚å±ˆæœç‚¹å˜å¾—å…·æœ‰å£°æ˜æ€§ï¼Œå› æ­¤æ›´æ˜“äºç¼–å†™ã€é˜…è¯»å’Œç†è§£ã€‚\n\n### Yield only when necessary  ä»…åœ¨å¿…è¦æ—¶æ‰å±ˆæœ\n\nWhat if you have a bunch of tasks, but you only want to yield if the user attempts to interact with the page? That's the kind of thing thatÂ [`isInputPending()`](https://developer.chrome.com/articles/isinputpending/)Â was made for.  \n\nå¦‚æœä½ æœ‰ä¸€å †ä»»åŠ¡ï¼Œä½†ä½ åªæƒ³åœ¨ç”¨æˆ·å°è¯•ä¸é¡µé¢äº¤äº’æ—¶è®©æ­¥ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿè¿™å°±æ˜¯ä¸ºä¹‹è€Œç”Ÿçš„é‚£ç§ä¸œè¥¿Â `isInputPending()`Â ã€‚\n\n`isInputPending()`Â is a function you can run at any time to determine if the user is attempting to interact with a page element: a call toÂ `isInputPending()`Â will returnÂ `true`. It returnsÂ `false`Â otherwise.  \n\n`isInputPending()`Â æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ‚¨å¯ä»¥éšæ—¶è¿è¡Œä»¥ç¡®å®šç”¨æˆ·æ˜¯å¦æ­£åœ¨å°è¯•ä¸é¡µé¢å…ƒç´ è¿›è¡Œäº¤äº’ï¼šå¯¹Â `isInputPending()`Â çš„è°ƒç”¨å°†è¿”å›Â `true`Â ã€‚å¦åˆ™è¿”å›Â `false`Â ã€‚\n\nSay you have a queue of tasks you need to run, but you don't want to get in the way of any inputs. This codeâ€”which uses bothÂ `isInputPending()`Â and our customÂ `yieldToMain()`Â functionâ€”ensures that an input won't be delayed while the user is trying to interact with the page:  \n\nå‡è®¾æ‚¨æœ‰ä¸€ä¸ªéœ€è¦è¿è¡Œçš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œä½†æ‚¨ä¸æƒ³å¦¨ç¢ä»»ä½•è¾“å…¥ã€‚æ­¤ä»£ç ï¼ˆåŒæ—¶ä½¿ç”¨ä¸¤è€…Â `isInputPending()`Â å’Œæˆ‘ä»¬çš„è‡ªå®šä¹‰Â `yieldToMain()`Â å‡½æ•°ï¼‰å¯ç¡®ä¿åœ¨ç”¨æˆ·å°è¯•ä¸é¡µé¢äº¤äº’æ—¶è¾“å…¥ä¸ä¼šå»¶è¿Ÿï¼š\n\n```js\nasync function saveSettings () {\n  // A task queue of functions\n  const tasks = [\n    validateForm,\n    showSpinner,\n    saveToDatabase,\n    updateUI,\n    sendAnalytics\n  ];\n  \n  while (tasks.length > 0) {\n    // Yield to a pending user input:\n    if (navigator.scheduling.isInputPending()) {\n      // There's a pending user input. Yield here:\n      await yieldToMain();\n    } else {\n      // Shift the task out of the queue:\n      const task = tasks.shift();\n\n      // Run the task:\n      task();\n    }\n  }\n}\n```\n\nWhileÂ `saveSettings()`Â runs, it will loop over the tasks in the queue. IfÂ `isInputPending()`Â returnsÂ `true`Â during the loop,Â `saveSettings()`Â will callÂ `yieldToMain()`Â so the user input can be handled. Otherwise, it will shift the next task off the front of the queue and run it continuously. It will do this until no more tasks are left.  \n\nåœ¨Â `saveSettings()`Â è¿è¡Œæ—¶ï¼Œå®ƒå°†éå†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚å¦‚æœÂ `isInputPending()`Â åœ¨å¾ªç¯æœŸé—´è¿”å›Â `true`Â ï¼ŒÂ `saveSettings()`Â å°†è°ƒç”¨Â `yieldToMain()`Â ä»¥ä¾¿å¯ä»¥å¤„ç†ç”¨æˆ·è¾“å…¥ã€‚å¦åˆ™ï¼Œå®ƒä¼šå°†ä¸‹ä¸€ä¸ªä»»åŠ¡ä»é˜Ÿåˆ—çš„å‰é¢ç§»å¼€å¹¶è¿ç»­è¿è¡Œã€‚å®ƒå°†è¿™æ ·åšï¼Œç›´åˆ°æ²¡æœ‰æ›´å¤šä»»åŠ¡ç•™ä¸‹ã€‚\n\n![20231116195750](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116195750.png)\n*`saveSettings()`Â runs a task queue for five tasks, but the user has clicked to open a menu while the second work item was running.Â `isInputPending()`Â yields to the main thread to handle the interaction, and resume running the rest of the tasks.*\n\n*`saveSettings()`Â ä¸ºäº”ä¸ªä»»åŠ¡è¿è¡Œä»»åŠ¡é˜Ÿåˆ—ï¼Œä½†ç”¨æˆ·åœ¨ç¬¬äºŒä¸ªå·¥ä½œé¡¹è¿è¡Œæ—¶å•å‡»ä»¥æ‰“å¼€èœå•ã€‚Â `isInputPending()`Â è®©ä½äºä¸»çº¿ç¨‹æ¥å¤„ç†äº¤äº’ï¼Œå¹¶ç»§ç»­è¿è¡Œå…¶ä½™ä»»åŠ¡ã€‚*\n\n:::info\n**Note:**Â `isInputPending()`Â may not always returnÂ `true`Â immediately after user input. This is because it takes time for the operating system to tell the browser that the interaction occurred. This means that other code may have already started executing (as you can see with theÂ `saveToDatabase()`Â function in the above screenshot). Even if you useÂ `isInputPending()`Â it's still crucial that you limit the amount of work you do in each function.  \n\næ³¨æ„ï¼šÂ `isInputPending()`Â ç”¨æˆ·è¾“å…¥åå¯èƒ½å¹¶ä¸æ€»æ˜¯ç«‹å³è¿”å›Â `true`Â ã€‚è¿™æ˜¯å› ä¸ºæ“ä½œç³»ç»Ÿéœ€è¦æ—¶é—´æ¥å‘ŠçŸ¥æµè§ˆå™¨å‘ç”Ÿäº†äº¤äº’ã€‚è¿™æ„å‘³ç€å…¶ä»–ä»£ç å¯èƒ½å·²ç»å¼€å§‹æ‰§è¡Œï¼ˆå¦‚ä¸Šé¢å±å¹•æˆªå›¾ä¸­çš„Â `saveToDatabase()`Â å‡½æ•°æ‰€ç¤ºï¼‰ã€‚å³ä½¿ä½ ä½¿ç”¨Â `isInputPending()`Â ï¼Œé™åˆ¶ä½ åœ¨æ¯ä¸ªåŠŸèƒ½ä¸­æ‰€åšçš„å·¥ä½œé‡ä»ç„¶å¾ˆé‡è¦ã€‚\n:::\n\nUsingÂ `isInputPending()`Â in combination with a yielding mechanism is a great way to get the browser to stop whatever tasks it's processing so that it can respond to critical user-facing interactions. That can help improve your page's ability to respond to the user in many situations when a lot of tasks are in flight.  \n\nä¸ç”Ÿæˆæœºåˆ¶ç»“åˆä½¿ç”¨Â `isInputPending()`Â æ˜¯è®©æµè§ˆå™¨åœæ­¢å®ƒæ­£åœ¨å¤„ç†çš„ä»»ä½•ä»»åŠ¡çš„å¥½æ–¹æ³•ï¼Œä»¥ä¾¿å®ƒå¯ä»¥å“åº”é¢å‘ç”¨æˆ·çš„å…³é”®äº¤äº’ã€‚è¿™æœ‰åŠ©äºæé«˜é¡µé¢åœ¨å¤§é‡ä»»åŠ¡æ­£åœ¨ä¼ è¾“çš„æƒ…å†µä¸‹å“åº”ç”¨æˆ·çš„èƒ½åŠ›ã€‚\n\nAnother way to useÂ `isInputPending()`â€”particularly if you're concerned about providing a fallback for browsers that don't support itâ€”is to use a time-based approach in conjunction with theÂ [optional chaining operator](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Operators/Optional_chaining):  \n\nå¦ä¸€ç§ä½¿ç”¨Â `isInputPending()`Â æ–¹å¼ï¼ˆç‰¹åˆ«æ˜¯å¦‚æœæ‚¨æ‹…å¿ƒä¸ºä¸æ”¯æŒå®ƒçš„æµè§ˆå™¨æä¾›å›é€€ï¼‰æ˜¯å°†åŸºäºæ—¶é—´çš„æ–¹æ³•ä¸å¯é€‰çš„é“¾æ¥è¿ç®—ç¬¦ç»“åˆä½¿ç”¨ï¼š\n\n```js\nasync function saveSettings () {\n  // A task queue of functions\n  const tasks = [\n    validateForm,\n    showSpinner,\n    saveToDatabase,\n    updateUI,\n    sendAnalytics\n  ];\n  \n  let deadline = performance.now() + 50;\n\n  while (tasks.length > 0) {\n    // Optional chaining operator used here helps to avoid\n    // errors in browsers that don't support `isInputPending`:\n    if (navigator.scheduling?.isInputPending() || performance.now() >= deadline) {\n      // There's a pending user input, or the\n      // deadline has been reached. Yield here:\n      await yieldToMain();\n\n      // Extend the deadline:\n      deadline = performance.now() + 50;\n\n      // Stop the execution of the current loop and\n      // move onto the next iteration:\n      continue;\n    }\n\n    // Shift the task out of the queue:\n    const task = tasks.shift();\n\n    // Run the task:\n    task();\n  }\n}\n```\n\nWith this approach, you get a fallback for browsers that don't supportÂ `isInputPending()`Â by using a time-based approach that uses (and adjusts) a deadline so that work will be broken up where necessary, whether by yielding to user input, or by a certain point in time.  \n\nä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨åŸºäºæ—¶é—´çš„æ–¹æ³•ä¸ºä¸æ”¯æŒÂ `isInputPending()`Â çš„æµè§ˆå™¨æä¾›å›é€€ï¼Œè¯¥æ–¹æ³•ä½¿ç”¨ï¼ˆå¹¶è°ƒæ•´ï¼‰æˆªæ­¢æ—¶é—´ï¼Œä»¥ä¾¿åœ¨å¿…è¦æ—¶åˆ†è§£å·¥ä½œï¼Œæ— è®ºæ˜¯é€šè¿‡å±ˆæœäºç”¨æˆ·è¾“å…¥ï¼Œè¿˜æ˜¯åœ¨æŸä¸ªæ—¶é—´ç‚¹ã€‚\n\n## Gaps in current APIs\n\nThe APIs mentioned so far can help you break up tasks, but they have a significant downside: when you yield to the main thread by deferring code to run in a subsequent task, that code gets added to the very end of the task queue.  \nåˆ°ç›®å‰ä¸ºæ­¢æåˆ°çš„ API å¯ä»¥å¸®åŠ©æ‚¨åˆ†è§£ä»»åŠ¡ï¼Œä½†å®ƒä»¬æœ‰ä¸€ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹ï¼šå½“æ‚¨é€šè¿‡å°†ä»£ç å»¶è¿Ÿåˆ°åç»­ä»»åŠ¡ä¸­è¿è¡Œæ—¶æ¥å±ˆæœäºä¸»çº¿ç¨‹æ—¶ï¼Œè¯¥ä»£ç ä¼šè¢«æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—çš„æœ€æœ«å°¾ã€‚\n\nIf you control all the code on your page, it's possible to create your own scheduler with the ability to prioritize tasks, but third-party scripts won't use your scheduler. In effect, you're not really able toÂ _prioritize_Â work in such environments. You can only chunk it up, or explicitly yield to user interactions.  \nå¦‚æœæ‚¨æ§åˆ¶é¡µé¢ä¸Šçš„æ‰€æœ‰ä»£ç ï¼Œåˆ™å¯ä»¥åˆ›å»ºè‡ªå·±çš„è®¡åˆ’ç¨‹åºï¼Œå¹¶èƒ½å¤Ÿç¡®å®šä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œä½†ç¬¬ä¸‰æ–¹è„šæœ¬ä¸ä¼šä½¿ç”¨æ‚¨çš„è®¡åˆ’ç¨‹åºã€‚å®é™…ä¸Šï¼Œåœ¨è¿™æ ·çš„ç¯å¢ƒä¸­ï¼Œæ‚¨å®é™…ä¸Šæ— æ³•ç¡®å®šå·¥ä½œçš„ä¼˜å…ˆçº§ã€‚æ‚¨åªèƒ½å°†å…¶åˆ†å—ï¼Œæˆ–æ˜¾å¼åœ°å±ˆæœäºç”¨æˆ·äº¤äº’ã€‚\n\nFortunately, there is a dedicated scheduler API that is currently in development that addresses these problems.  \nå¹¸è¿çš„æ˜¯ï¼Œç›®å‰æ­£åœ¨å¼€å‘ä¸€ä¸ªä¸“ç”¨çš„è°ƒåº¦ç¨‹åº API æ¥è§£å†³è¿™äº›é—®é¢˜ã€‚\n\n### A dedicated scheduler API  ä¸“ç”¨è°ƒåº¦ç¨‹åº API\n\nThe scheduler API currently offers theÂ `postTask()`Â function which, at the time of writing, is available in Chromium browsers, and in Firefox behind a flag.Â `postTask()`Â allows for finer-grained scheduling of tasks, and is one way to help the browser prioritize work so that low priority tasks yield to the main thread.Â `postTask()`Â uses promises, and accepts aÂ `priority`Â setting.  \n\nè°ƒåº¦ç¨‹åº API ç›®å‰æä¾›äº†è¯¥Â `postTask()`Â åŠŸèƒ½ï¼Œåœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œè¯¥åŠŸèƒ½åœ¨ Chromium æµè§ˆå™¨å’Œ Firefox ä¸­å¯ç”¨ã€‚Â `postTask()`Â å…è®¸å¯¹ä»»åŠ¡è¿›è¡Œæ›´ç»†ç²’åº¦çš„è°ƒåº¦ï¼Œå¹¶ä¸”æ˜¯å¸®åŠ©æµè§ˆå™¨ç¡®å®šå·¥ä½œä¼˜å…ˆçº§çš„ä¸€ç§æ–¹å¼ï¼Œä»¥ä¾¿ä½ä¼˜å…ˆçº§ä»»åŠ¡è®©ä½äºä¸»çº¿ç¨‹ã€‚Â `postTask()`Â ä½¿ç”¨ promisesï¼Œå¹¶æ¥å—è®¾ç½®Â `priority`Â ã€‚\n\nTheÂ `postTask()`Â API has three priorities you can use:  \n\nè¯¥Â `postTask()`Â API æœ‰ä¸‰ä¸ªå¯ä»¥ä½¿ç”¨çš„ä¼˜å…ˆçº§ï¼š\n\n*   `'background'`Â for the lowest priority tasks.  \n\n    `'background'`Â å¯¹äºä¼˜å…ˆçº§æœ€ä½çš„ä»»åŠ¡ã€‚\n*   `'user-visible'`Â for medium priority tasks. This is the default if noÂ `priority`Â is set.  \n\n    `'user-visible'`Â å¯¹äºä¸­ç­‰ä¼˜å…ˆçº§çš„ä»»åŠ¡ã€‚å¦‚æœè®¾ç½®äº† noÂ `priority`Â ï¼Œåˆ™è¿™æ˜¯é»˜è®¤å€¼ã€‚\n*   `'user-blocking'`Â for critical tasks that need to run at high priority.  \n\n    `'user-blocking'`Â é€‚ç”¨äºéœ€è¦ä»¥é«˜ä¼˜å…ˆçº§è¿è¡Œçš„å…³é”®ä»»åŠ¡ã€‚\n\nTake the following code as an example, where theÂ `postTask()`Â API is used to run three tasks at the highest possible priority, and the remaining two tasks at the lowest possible priority.  \n\nä»¥ä»¥ä¸‹ä»£ç ä¸ºä¾‹ï¼ŒÂ `postTask()`Â å…¶ä¸­ API ç”¨äºä»¥å°½å¯èƒ½é«˜çš„ä¼˜å…ˆçº§è¿è¡Œä¸‰ä¸ªä»»åŠ¡ï¼Œå¹¶ä»¥å°½å¯èƒ½ä½çš„ä¼˜å…ˆçº§è¿è¡Œå…¶ä½™ä¸¤ä¸ªä»»åŠ¡ã€‚\n\n```js\nfunction saveSettings () {\n  // Validate the form at high priority\n  scheduler.postTask(validateForm, {priority: 'user-blocking'});\n\n  // Show the spinner at high priority:\n  scheduler.postTask(showSpinner, {priority: 'user-blocking'});\n\n  // Update the database in the background:\n  scheduler.postTask(saveToDatabase, {priority: 'background'});\n\n  // Update the user interface at high priority:\n  scheduler.postTask(updateUI, {priority: 'user-blocking'});\n\n  // Send analytics data in the background:\n  scheduler.postTask(sendAnalytics, {priority: 'background'});\n};\n```\n\nHere, the priority of tasks is scheduled in such a way that browser-prioritized tasksâ€”such as user interactionsâ€”can work their way in.  \n\nåœ¨è¿™é‡Œï¼Œä»»åŠ¡çš„ä¼˜å…ˆçº§æ˜¯ä»¥è¿™æ ·ä¸€ç§æ–¹å¼å®‰æ’çš„ï¼Œå³æµè§ˆå™¨ä¼˜å…ˆçš„ä»»åŠ¡ï¼ˆä¾‹å¦‚ç”¨æˆ·äº¤äº’ï¼‰å¯ä»¥å‘æŒ¥ä½œç”¨ã€‚\n\n![20231116200045](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116200045.png)\n*WhenÂ `saveSettings()`Â is run, the function schedules the individual functions usingÂ `postTask()`. The critical user-facing work is scheduled at high priority, while work the user doesn't know about is scheduled to run in the background. This allows for user interactions to execute more quickly, as the work is both broken upÂ _and_Â prioritized appropriately.*\n\n*`saveSettings()`Â è¿è¡Œæ—¶ï¼Œè¯¥å‡½æ•°ä½¿ç”¨Â `postTask()`Â è°ƒåº¦å„ä¸ªå‡½æ•°ã€‚é¢å‘ç”¨æˆ·çš„å…³é”®å·¥ä½œè¢«å®‰æ’ä¸ºé«˜ä¼˜å…ˆçº§ï¼Œè€Œç”¨æˆ·ä¸çŸ¥é“çš„å·¥ä½œè¢«å®‰æ’åœ¨åå°è¿è¡Œã€‚è¿™å…è®¸ç”¨æˆ·äº¤äº’æ›´å¿«åœ°æ‰§è¡Œï¼Œå› ä¸ºå·¥ä½œè¢«é€‚å½“åœ°åˆ†è§£å’Œç¡®å®šä¼˜å…ˆçº§ã€‚*\n\nThis is a simplistic example of howÂ `postTask()`Â can be used. It's possible to instantiate differentÂ `TaskController`Â objects that can share priorities between tasks, including the ability to change priorities for differentÂ `TaskController`Â instances as needed.  \n\nè¿™æ˜¯ä¸€ä¸ªå¦‚ä½•ä½¿ç”¨çš„ç®€å•ç¤ºä¾‹Â `postTask()`Â ã€‚å¯ä»¥å®ä¾‹åŒ–å¯ä»¥åœ¨ä»»åŠ¡ä¹‹é—´å…±äº«ä¼˜å…ˆçº§çš„ä¸åŒÂ `TaskController`Â å¯¹è±¡ï¼ŒåŒ…æ‹¬æ ¹æ®éœ€è¦æ›´æ”¹ä¸åŒÂ `TaskController`Â å®ä¾‹çš„ä¼˜å…ˆçº§çš„èƒ½åŠ›ã€‚\n\n:::info\n**Key point:**Â [`postTask()`Â is not supported in all browsers](https://caniuse.com/mdn-api_scheduler_posttask). You can use feature detection to see if it's available, or consider usingÂ [a polyfill](https://www.npmjs.com/package/scheduler-polyfill).  \n\nå…³é”®ç‚¹ï¼šÂ `postTask()`Â å¹¶éæ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒã€‚æ‚¨å¯ä»¥ä½¿ç”¨ç‰¹å¾æ£€æµ‹æ¥æŸ¥çœ‹å®ƒæ˜¯å¦å¯ç”¨ï¼Œæˆ–è€…è€ƒè™‘ä½¿ç”¨ polyfillã€‚\n:::\n\n### Built-in yield with continuation via (å†…ç½®äº§é‡ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼å»¶ç»­`scheduler.yield`)\n\n:::info\n**Key point:**Â For a more detailed explanation onÂ `scheduler.yield`, readÂ [this post about its origin trial](https://developer.chrome.com/blog/introducing-scheduler-yield-origin-trial/), as well asÂ [its explainer](https://github.com/WICG/scheduling-apis/blob/main/explainers/yield-and-continuation.md).  \n\nå…³é”®ç‚¹ï¼šæœ‰å…³æ›´Â `scheduler.yield`Â è¯¦ç»†çš„è§£é‡Šï¼Œè¯·é˜…è¯»è¿™ç¯‡å…³äºå…¶èµ·æºè¯•éªŒåŠå…¶è§£é‡Šå™¨çš„æ–‡ç« ã€‚\n:::\n\n*One proposed part of the scheduler API isÂ `scheduler.yield`, an API specifically designed for yielding to the main thread in the browserÂ [which is currently available to try as an origin trial](https://developer.chrome.com/origintrials/#/view_trial/836543630784069633). Its use resembles theÂ `yieldToMain()`Â function demonstrated earlier in this article:*\n\n*è°ƒåº¦ç¨‹åº API çš„ä¸€ä¸ªå»ºè®®éƒ¨åˆ†æ˜¯ ï¼Œè¯¥ API ä¸“é—¨è®¾è®¡ç”¨äºå±ˆæœäºæµè§ˆå™¨ä¸­çš„ä¸»çº¿ç¨‹Â `scheduler.yield`Â ï¼Œç›®å‰å¯ä½œä¸ºæºè¯•ç”¨è¿›è¡Œå°è¯•ã€‚å®ƒçš„ç”¨æ³•ç±»ä¼¼äºæœ¬æ–‡å‰é¢æ¼”ç¤ºçš„Â `yieldToMain()`Â å‡½æ•°ï¼š*\n\n```js\nasync function saveSettings () {\n  // Create an array of functions to run:\n  const tasks = [\n    validateForm,\n    showSpinner,\n    saveToDatabase,\n    updateUI,\n    sendAnalytics\n  ]\n\n  // Loop over the tasks:\n  while (tasks.length > 0) {\n    // Shift the first task off the tasks array:\n    const task = tasks.shift();\n\n    // Run the task:\n    task();\n\n    // Yield to the main thread with the scheduler\n    // API's own yielding mechanism:\n    await scheduler.yield();\n  }\n}\n```\n\nYou'll note that the code above is largely familiar, but instead of usingÂ `yieldToMain()`, you call andÂ `await scheduler.yield()`Â instead.  \n\næ‚¨ä¼šæ³¨æ„åˆ°ï¼Œä¸Šé¢çš„ä»£ç åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ç†Ÿæ‚‰çš„ï¼Œä½†ä¸æ˜¯ä½¿ç”¨Â `yieldToMain()`Â ï¼Œè€Œæ˜¯è°ƒç”¨ å’ŒÂ `await scheduler.yield()`Â ã€‚\n\n![20231116201606](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116201606.png)\n*A visualization of task execution without yielding, with yielding, and with yielding and continuation. WhenÂ `scheduler.yield()`Â is used, task execution picks up where it left off even after the yield point.*\n\n*ä»»åŠ¡æ‰§è¡Œçš„å¯è§†åŒ–ï¼Œä¸å±ˆæœï¼Œå±ˆæœï¼Œå±ˆæœå’Œå»¶ç»­ã€‚ä½¿ç”¨æ—¶Â `scheduler.yield()`Â ï¼Œå³ä½¿åœ¨å±ˆæœç‚¹ä¹‹åï¼Œä»»åŠ¡æ‰§è¡Œä¹Ÿä¼šä»ä¸­æ–­çš„åœ°æ–¹ç»§ç»­æ‰§è¡Œã€‚*\n\n:::info\nä½¿ç”¨`scheduler.yield()`åˆ†å‰²çš„ä»»åŠ¡åœ¨ç´§æ€¥ä»»åŠ¡ï¼ˆå¦‚ç”¨æˆ·äº¤äº’ï¼‰ç»“æŸåä¼šæ¥ç€è¿è¡Œï¼Œä½†æ˜¯è¢«`yieldToMain()`å’Œ`await scheduler.yield()`åˆ†å‰²çš„ä»»åŠ¡ä¼šè¿›å…¥äº‹ä»¶å¾ªç¯çš„æœ«å°¾ã€‚\n:::\n\nThe benefit ofÂ `scheduler.yield()`Â is continuation, which means that if you yield in the middle of a set of tasks, the other scheduled tasks will continue in the same order after the yield point.Â **This avoids code from third-party scripts from usurping the order of your code's execution.**  \n\nè¿™æ ·åšçš„å¥½å¤„Â `scheduler.yield()`Â æ˜¯å»¶ç»­ï¼Œè¿™æ„å‘³ç€å¦‚æœæ‚¨åœ¨ä¸€ç»„ä»»åŠ¡çš„ä¸­é—´è®©æ­¥ï¼Œå…¶ä»–è®¡åˆ’ä»»åŠ¡å°†åœ¨è®©æ­¥ç‚¹ä¹‹åä»¥ç›¸åŒçš„é¡ºåºç»§ç»­ã€‚è¿™æ ·å¯ä»¥é¿å…æ¥è‡ªç¬¬ä¸‰æ–¹è„šæœ¬çš„ä»£ç ç¯¡å¤ºä»£ç çš„æ‰§è¡Œé¡ºåºã€‚\n\n## Conclusion\n\nManaging tasks is challenging, but doing so helps your page respond more quickly to user interactions. There's no one single piece of advice for managing and prioritizing tasks. Rather, it's a number of different techniques. To reiterate, these are the main things you'll want to consider when managing tasks:  \n\nç®¡ç†ä»»åŠ¡å…·æœ‰æŒ‘æˆ˜æ€§ï¼Œä½†è¿™æ ·åšæœ‰åŠ©äºé¡µé¢æ›´å¿«åœ°å“åº”ç”¨æˆ·äº¤äº’ã€‚æ²¡æœ‰ä¸€æ¡å…³äºç®¡ç†å’Œç¡®å®šä»»åŠ¡ä¼˜å…ˆçº§çš„å»ºè®®ã€‚ç›¸åï¼Œå®ƒæ˜¯è®¸å¤šä¸åŒçš„æŠ€æœ¯ã€‚é‡ç”³ä¸€ä¸‹ï¼Œè¿™äº›æ˜¯ç®¡ç†ä»»åŠ¡æ—¶è¦è€ƒè™‘çš„ä¸»è¦äº‹é¡¹ï¼š\n\n*   Yield to the main thread for critical, user-facing tasks.  \n\n    è®©ä½äºä¸»çº¿ç¨‹æ‰§è¡Œé¢å‘ç”¨æˆ·çš„å…³é”®ä»»åŠ¡ã€‚\n*   UseÂ `isInputPending()`Â to yield to the main thread when the user is trying to interact with the page.  \n\n    ç”¨äºÂ `isInputPending()`Â åœ¨ç”¨æˆ·å°è¯•ä¸é¡µé¢äº¤äº’æ—¶å±ˆæœäºä¸»çº¿ç¨‹ã€‚\n*   Prioritize tasks withÂ `postTask()`.  \n\n    ä½¿ç”¨Â `postTask()`Â ç¡®å®šä»»åŠ¡çš„ä¼˜å…ˆçº§ã€‚\n*   Finally,Â **do as little work as possible in your functions.**  \n\n    æœ€åï¼Œåœ¨å‡½æ•°ä¸­å°½å¯èƒ½å°‘åœ°åšå·¥ä½œã€‚\n\nWith one or more of these tools, you should be able to structure the work in your application so that it prioritizes the user's needs, while ensuring that less critical work still gets done. That's going to create a better user experience which is more responsive and more enjoyable to use.  \n\nä½¿ç”¨è¿™äº›å·¥å…·ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿæ„å»ºåº”ç”¨ç¨‹åºä¸­çš„å·¥ä½œï¼Œä»¥ä¾¿å®ƒä¼˜å…ˆè€ƒè™‘ç”¨æˆ·çš„éœ€æ±‚ï¼ŒåŒæ—¶ç¡®ä¿ä»ç„¶å®Œæˆä¸å¤ªé‡è¦çš„å·¥ä½œã€‚è¿™å°†åˆ›é€ æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œå“åº”é€Ÿåº¦æ›´å¿«ï¼Œä½¿ç”¨èµ·æ¥æ›´æ„‰å¿«ã€‚\n\n_Special thanks toÂ [Philip Walton](https://philipwalton.com/)Â for his technical vetting of this article.  \n\nç‰¹åˆ«æ„Ÿè°¢ Philip Walton å¯¹æœ¬æ–‡çš„æŠ€æœ¯å®¡æŸ¥ã€‚_\n\n_Hero image sourced fromÂ [Unsplash](https://unsplash.com/), courtesy ofÂ [Amirali Mirhashemian](https://unsplash.com/@amir_v_ali).  \n\nä¸»å›¾ç‰‡æ¥è‡ª Unsplashï¼Œç”± Amirali Mirhashemian æä¾›ã€‚_\n","pageType":"doc","routePath":"/chrome/performance/optimize-long-tasks"};</script>
      
      <script type="module" src="/client-entry.js"></script>
    </body>
  </html>