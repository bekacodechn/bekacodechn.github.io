<!DOCTYPE html>
  <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <link rel="icon" href="" type="image/svg+xml"></link>
      <script  id="check-dark-light">
        ;(() => {
          const saved = localStorage.getItem('island-theme-appearance')
          const prefereDark = window.matchMedia('(prefers-color-scheme: dark)').matches
          if (!saved || saved === 'auto' ? prefereDark : saved === 'dark') {
            document.documentElement.classList.add('dark')
          }
        })()
      </script>
      <title data-rh="true">使用导航定时和资源定时评估现场的负载性能</title>
      <meta data-rh="true" name="description" content="Island"/>
      
      
      <script defer src='https://ga.jspm.io/npm:es-module-shims@1.6.0/dist/es-module-shims.js'></script>
      <script type="importmap">
        {
          "imports": {
            "react": "/react.js","react-dom": "/react-dom.js","react-dom/client": "/react-dom_client.js","react/jsx-runtime": "/react_jsx-runtime.js"
          }
        }
      </script>

      <link rel="stylesheet" href="/assets/style.81be0ec3.css">

    </head>
    <body>
      <div id="root"><div style="height:100%"><header relative="" z="4" fixed="md:~" class="top-0 left-0" w="100%"><div relative="" p="l-8 sm:x-8" transition="background-color duration-500" class="divider-bottom md:border-b-transparent lg:border-b-transparent" nav-h="mobile lg:desktop"><div flex="" justify="between" m="0 auto" nav-h="mobile lg:desktop" class="_container_1ic07_52  _has-sidebar_1ic07_16"><div border="border t-0 b-1 border-solid transparent" class="_nav-bar-title_1ic07_16"><a href="/" w="100%" h="100%" text="1rem" font="semibold" transition="opacity duration-300" hover="opacity-60" class="flex items-center"><span>beka的博客</span></a></div><div class="_content_1ic07_24" flex="~ 1" justify="end" items-center=""><div class="search" flex="sm:1" pl="sm:8"><div flex="" items-center="~" relative="" mr="2" font="semibold"><svg width="32" height="32" viewBox="0 0 32 32" w="5" h="5" fill="currentColor"><path fill="#888888" d="m29 27.586l-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9a9.01 9.01 0 0 1-9-9Z"></path></svg><input disabled="" cursor="text focus:auto" placeholder="Search" height="8" border="none" type="text" text="sm" p="t-0 r-2 b-0 l-2" transition="all duration-200 ease" class="rounded-sm _searchInput_y03a3_1 " aria-label="Search" autoComplete="off"/><div m="r-3" w="10" h="6" p="x-1.5" rounded="md" border="1px solid gray-light-3" text="xs gray-light-3" flex="~" items-center="~" justify="around" class="_searchCommand_y03a3_7"><span>⌘</span><span>K</span></div></div></div><div class="_rightNav_1ic07_42"><div class="menu"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article-set</a></div><div text="sm" font="medium" m="x-3" class="text-brand"><a class="_link_r3fql_1 " target="" cursor="pointer">Chrome</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Design-pattern</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Open-source</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Promise</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Typescript</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Webpack</a></div></div><div class="appearance" before="menu-item-before" display="none sm:flex" items-center="center"><button class="_switch_1tqe3_1 undefined" id="" type="button" role="switch"><span class="_check_1tqe3_17"><span class="_icon_1tqe3_34"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_sun_8e60k_1"><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_moon_8e60k_5"><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg></span></span></button></div></div><button class=" _navHamburger_14nz8_1"><span class="_container_14nz8_14"><span class="_top_14nz8_21"></span><span class="_middle_14nz8_27"></span><span class="_bottom_14nz8_33"></span></span></button><div class="_navScreen_1mkpq_1 " id="navScreen"><div class="_container_1mkpq_21"><div class="_navMenu_1mkpq_27"><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article-set</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class="text-brand"><a class="_link_r3fql_1 " target="" cursor="pointer">Chrome</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Design-pattern</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Open-source</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Promise</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Typescript</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Webpack</a></div></div></div><div class="_socialAndAppearance_1mkpq_50" flex="~" justify="center" items-center="center"><div class="items-center appearance pa-2 _navAppearance_1mkpq_46" flex="~" justify="center"><button class="_switch_1tqe3_1 undefined" id="" type="button" role="switch"><span class="_check_1tqe3_17"><span class="_icon_1tqe3_34"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_sun_8e60k_1"><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_moon_8e60k_5"><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg></span></span></button></div></div></div></div></div></div></div></header><section style="padding-top:var(--island-nav-height)"><div p="t-0 x-6 b-24 sm:6" class="_docLayout_5cssi_8"><div class="_localNav_ncerp_1"><button flex="center" class="_menu_ncerp_16"><div text="md" mr="2" class="i-carbon:menu"></div><span text="md ">Menu</span></button></div><aside class="_sidebar_iav29_1 "><nav><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">Chrome</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:28px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">以用户为中心的效果指标</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">浏览器工作原理</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:168px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Web 浏览器如何逐步工作 — 高级体系结构（第 1 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Web 浏览器如何逐步工作 — 导航阶段（第 2 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">浏览器如何逐步工作 — 渲染阶段（第 3 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">浏览器如何逐步工作 — 加载阶段的优化（第 4 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">浏览器如何一步一步地工作 — 交互阶段的优化（第 5 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">什么强制了重排/回流</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">Html</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:84px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Metadata</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">html</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer"># 文档结构</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">关键指标</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:84px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">First Contentful Paint (FCP) 首次内容绘制</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Largest Contentful Paint (LCP) 最大内容填充</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Time to First Byte (TTFB) 首次字节加载时间</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">现代网络浏览器内幕</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:112px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">现代网络浏览器内幕 — 1</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">现代网络浏览器内幕 — 2</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">现代网络浏览器内幕 — 3</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">现代网络浏览器内幕 — 4</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">性能</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:224px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">1. Welcome to Lean performance</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">2. 一般 HTML 性能注意事项</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-brand"><a class="_link_r3fql_1 " target="" cursor="pointer">使用导航定时和资源定时评估现场的负载性能</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">优化长任务</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">optimize-resource-loading 优化资源负载</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">通过摇树减少 JavaScript 有效负载</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">asdf</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">速度为什么重要</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">性能技巧</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:476px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Web 上的多进程：浏览器进程模型</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Browser Rendering Pipeline</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">通过火焰图找到有问题的代码</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">如何收集 Web 性能跟踪</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">事件循环基础知识</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">深度讲解火焰图 🔥🔥</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">长任务：它们是什么以及为什么应该避免它们</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">performance 查看主线程（颜色含义）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">检测浏览器何时在 JavaScript 中绘制Frame</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">如何阅读 Chromium Profiler</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">使用 Chromium 网络标签页获取性能详情</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">使用性能时序标记进行📏测量</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Chromium F12 性能分析器的基本概述</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">【--空文件--】: performance/tips/resource-size-vs-transfer-size.md</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">如何阅读火焰图 🔥</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">识别 Web 应用中的未压缩资源</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">asdfadsasdsdfasdf</a></div></div></div></div></section></nav></aside><div flex="~ 1 shrink-0" m="x-auto" class="_content_5cssi_2"><div m="x-auto" flex="~ col" class="max-w-100%"><div relative="~" m="x-auto" p="l-2" class="w-100% md:max-w-712px lg:min-w-640px "><div class="island-doc "><!--$--><h1 id="使用导航定时和资源定时评估现场的负载性能"><a class="header-anchor" aria-hidden="true" href="#使用导航定时和资源定时评估现场的负载性能">#</a>使用导航定时和资源定时评估现场的负载性能</h1>
<p><code>metadata:</code></p>
<p><strong>原标题:</strong> Assessing loading performance in the field with Navigation Timing and Resource Timing</p>
<p><strong>链接:</strong> <a href="https://web.dev/articles/navigation-and-resource-timing" target="_blank" rel="nofollow">https://web.dev/articles/navigation-and-resource-timing</a></p>
<hr/>
<p>Learn the basics of using the Navigation and Resource Timing APIs to assess loading performance in the field.</p>
<p>了解使用导航和资源计时 API 评估外业加载性能的基础知识。</p>
<p>If you&#x27;ve used connection throttling in the network panel in a browser&#x27;s developer tools (or Lighthouse in Chrome) to assess loading performance, you know how convenient those tools are for performance tuning. You can quickly measure the impact of performance optimizations with a consistent and stable baseline connection speed. The only problem is that this is synthetic testing, which yields lab data, not field data.</p>
<p>如果您曾在浏览器的开发者工具（或 Chrome 中的 Lighthouse）的网络面板中使用过连接限制来评估加载性能，您就会知道这些工具在性能调整方面是多么方便。您可以使用一致且稳定的基准连接速度快速衡量性能优化的影响。唯一的问题是，这是综合测试，它产生的是实验室数据，而不是现场数据。</p>
<p>Synthetic testing isn&#x27;t inherently bad, but it&#x27;s not representative of how fast your website is loading for real users. That requires field data, which you can collect from the Navigation Timing and Resource Timing APIs.</p>
<p>综合测试本身并不坏，但它并不能代表您的网站为真实用户加载的速度。这需要字段数据，您可以从 Navigation Timing 和 Resource Timing API 收集这些数据。</p>
<h2 id="apis-to-help-you-assess-loading-performance-in-the-field--帮助您评估现场装载性能的-api"><a class="header-anchor" aria-hidden="true" href="#apis-to-help-you-assess-loading-performance-in-the-field--帮助您评估现场装载性能的-api">#</a>APIs to help you assess loading performance in the field  (帮助您评估现场装载性能的 API)</h2>
<p>Navigation Timing and Resource Timing are two similar APIs with significant overlap that measure two distinct things:</p>
<p>Navigation Timing 和 Resource Timing 是两个相似的 API，它们有很大的重叠，用于测量两个截然不同的内容：</p>
<ul>
<li>
<p><a href="https://w3c.github.io/navigation-timing/" target="_blank" rel="nofollow">Navigation Timing</a> measures the speed of requests for HTML documents (that is, navigation requests).</p>
<p>导航计时测量 HTML 文档请求（即导航请求）的速度。</p>
</li>
<li>
<p><a href="https://w3c.github.io/resource-timing/" target="_blank" rel="nofollow">Resource Timing</a> measures the speed of requests for document-dependent resources such as CSS, JavaScript, images, and so on.</p>
<p>资源计时测量对文档相关资源（如 CSS、JavaScript、图像等）的请求速度。</p>
</li>
</ul>
<p>These APIs expose their data in a <em>performance entry buffer</em>, which can be accessed in the browser with JavaScript. There are multiple ways to query a performance buffer, but a common way is by using <a href="https://developer.mozilla.org/docs/Web/API/Performance/getEntriesByType" target="_blank" rel="nofollow"><code>performance.getEntriesByType</code></a>:</p>
<p>这些 API 在性能条目缓冲区中公开其数据，可以使用 JavaScript 在浏览器中访问该缓冲区。有多种方法可以查询性能缓冲区，但一种常见的方法是使用 <code>performance.getEntriesByType</code> ：</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#616E88">// Get Navigation Timing entries:</span></span>
<span class="line"><span style="color:#D8DEE9">performance</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">getEntriesByType</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#A3BE8C">navigation</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88">// Get Resource Timing entries:</span></span>
<span class="line"><span style="color:#D8DEE9">performance</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">getEntriesByType</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#A3BE8C">resource</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span></div></div>
<p><code>performance.getEntriesByType</code> accepts a string describing the type of entries you want to retrieve from the performance entry buffer. <code>&#x27;navigation&#x27;</code> and <code>&#x27;resource&#x27;</code> retrieve timings for the Navigation Timing and Resource Timing APIs, respectively.</p>
<p><code>performance.getEntriesByType</code> 接受一个字符串，该字符串描述要从性能条目缓冲区中检索的条目类型。 <code>&#x27;navigation&#x27;</code> 并 <code>&#x27;resource&#x27;</code> 分别检索 Navigation Timing 和 Resource Timing API 的计时。</p>
<div class="island-directive info"><p class="island-directive-title">INFO</p><div class="island-directive-content"><p><strong>Note:</strong> Try loading a website and then enter either of the commands in the above code snippet in your browser&#x27;s console to see actual timings captured by your browser.</p><p>注意：尝试加载网站，然后在浏览器控制台中输入上述代码片段中的任何命令，以查看浏览器捕获的实际计时。</p></div></div>
<p>The amount of information these APIs provide can be overwhelming, but they&#x27;re your key to measuring loading performance in the field, as you can gather these timings from users as they visit your website.</p>
<p>这些 API 提供的信息量可能会让人不知所措，但它们是衡量现场加载性能的关键，因为您可以在用户访问您的网站时收集这些时间。</p>
<h2 id="the-life-and-timings-of-a-network-request--网络请求的生存期和计时"><a class="header-anchor" aria-hidden="true" href="#the-life-and-timings-of-a-network-request--网络请求的生存期和计时">#</a>The life and timings of a network request  (网络请求的生存期和计时)</h2>
<p>Gathering and analyzing navigation and resource timings is sort of like archeology in that you&#x27;re reconstructing the fleeting life of a network request after the fact. Sometimes it helps to visualize concepts, and where network requests are concerned, your browser&#x27;s developer tools can help.</p>
<p>收集和分析导航和资源时序有点像考古学，因为你是在事后重建网络请求的短暂生命。有时，它有助于可视化概念，而在涉及网络请求时，浏览器的开发人员工具可以提供帮助。</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116001628.png" alt="20231116001628"/></p>
<p>The life of a network request has distinct phases, such as DNS lookup, connection establishment, TLS negotiation, and so on. These timings are represented as a <a href="https://developer.mozilla.org/docs/Web/API/DOMHighResTimeStamp" target="_blank" rel="nofollow"><code>DOMHighResTimestamp</code></a>. Depending on your browser, the granularity of timings may be down to the microsecond, or be rounded up to milliseconds. Let&#x27;s examine these phases in detail, and how they relate to Navigation Timing and Resource Timing.</p>
<p>网络请求的生命周期具有不同的阶段，例如 DNS 查找、连接建立、TLS 协商等。这些计时表示为 <code>DOMHighResTimestamp</code> .根据您的浏览器，计时粒度可能低至微秒，或四舍五入到毫秒。让我们详细研究一下这些阶段，以及它们与导航计时和资源计时的关系。</p>
<div class="island-directive info"><p class="island-directive-title">INFO</p><div class="island-directive-content"><p><strong>Note:</strong> As you read this guide, <a href="https://www.w3.org/TR/navigation-timing-2/#processing-model" target="_blank" rel="nofollow">this diagram</a> for both Navigation Timing and Resource Timing may help you to visualize the order of the timings they provide.</p><p>注意：在阅读本指南时，此导航计时和资源计时图可帮助您直观地了解它们提供的计时顺序。</p></div></div>
<h3 id="dns-lookupdns查询"><a class="header-anchor" aria-hidden="true" href="#dns-lookupdns查询">#</a>DNS lookup DNS查询</h3>
<p>When a user goes to a URL, the Domain Name System (DNS) is queried to translate a domain to an IP address. This process may take significant time—time you&#x27;ll want to measure in the field, even. Navigation Timing and Resource Timing expose two DNS-related timings:</p>
<p>当用户转到 URL 时，将查询域名系统 （DNS） 以将域转换为 IP 地址。此过程可能需要大量时间，甚至需要在现场测量。“导航计时”和“资源计时”公开了两个与 DNS 相关的计时：</p>
<ul>
<li>
<p><code>domainLookupStart</code> is when DNS lookup begins.</p>
<p><code>domainLookupStart</code> 是 DNS 查找开始的时间。</p>
</li>
<li>
<p><code>domainLookupEnd</code> is when DNS lookup ends.</p>
<p><code>domainLookupEnd</code> 是 DNS 查找结束的时间。</p>
</li>
</ul>
<p>Calculating total DNS lookup time can be done by subtracting the start metric from the end metric:</p>
<p>可以通过从结束指标中减去开始指标来计算总 DNS 查找时间：</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#616E88">// Measuring DNS lookup time</span></span>
<span class="line"><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">[</span><span style="color:#D8DEE9">pageNav</span><span style="color:#ECEFF4">]</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">performance</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">getEntriesByType</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#A3BE8C">navigation</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">totalLookupTime</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">pageNav</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">domainLookupEnd</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">-</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">pageNav</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">domainLookupStart</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span></div></div>
<div class="island-directive warning"><p class="island-directive-title">WARNING</p><div class="island-directive-content"><p><strong>Caution:</strong> You can&#x27;t <em>always</em> rely on timings to be populated. Timings provided in both APIs will have a value of <code>0</code> in some cases. For example, a DNS lookup may be served by a local cache. Additionally, any timings for cross-origin requests may be unavailable if those origins don&#x27;t set a <a href="https://developer.mozilla.org/docs/Web/HTTP/Headers/Timing-Allow-Origin" target="_blank" rel="nofollow"><code>Timing-Allow-Origin</code> response header</a>.</p><p>注意：您不能总是依赖要填充的时间。在某些情况下，这两个 API 中提供的计时值 <code>0</code> 为 。例如，DNS 查找可能由本地缓存提供。此外，如果跨源请求未设置 <code>Timing-Allow-Origin</code> 响应标头，则这些请求的任何计时都可能不可用。</p></div></div>
<h3 id="connection-negotiation连接协商"><a class="header-anchor" aria-hidden="true" href="#connection-negotiation连接协商">#</a>Connection negotiation 连接协商</h3>
<p>Another contributing factor to loading performance is connection negotiation, which is latency incurred when connecting to a web server. If HTTPS is involved, this process will also include TLS negotiation time. The connection phase consists of three timings:</p>
<p>影响加载性能的另一个因素是连接协商，这是连接到 Web 服务器时产生的延迟。如果涉及 HTTPS，则此过程还将包括 TLS 协商时间。连接阶段包括三个计时：</p>
<ul>
<li>
<p><code>connectStart</code> is when the browser starts to open a connection to a web server.</p>
<p><code>connectStart</code> 是浏览器开始打开与 Web 服务器的连接时。</p>
</li>
<li>
<p><code>secureConnectionStart</code> marks when the client begins TLS negotiation.</p>
<p><code>secureConnectionStart</code> 标记客户端何时开始 TLS 协商。</p>
</li>
<li>
<p><code>connectEnd</code> is when the connection to the web server has been established.</p>
<p><code>connectEnd</code> 是与 Web 服务器建立连接的时间。</p>
</li>
</ul>
<p>Measuring total connection time is similar to measuring total DNS lookup time: you subtract the start timing from the end timing. However, there&#x27;s an additional <code>secureConnectionStart</code> property that may be <code>0</code> if HTTPS isn&#x27;t used or <a href="https://en.wikipedia.org/wiki/HTTP_persistent_connection" target="_blank" rel="nofollow">if the connection is persistent</a>. If you want to measure TLS negotiation time, you&#x27;ll need to keep that in mind:</p>
<p>测量总连接时间与测量总 DNS 查找时间类似：从结束时间中减去开始时间。但是， <code>0</code> 如果不使用 HTTPS 或连接是持久的，则可能还有一个附加 <code>secureConnectionStart</code> 属性。如果要测量 TLS 协商时间，需要牢记这一点：</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#616E88">// Quantifying total connection time</span></span>
<span class="line"><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">[</span><span style="color:#D8DEE9">pageNav</span><span style="color:#ECEFF4">]</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">performance</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">getEntriesByType</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#A3BE8C">navigation</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">connectionTime</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">pageNav</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">connectEnd</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">-</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">pageNav</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">connectStart</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#81A1C1">let</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">tlsTime</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#B48EAD">0</span><span style="color:#81A1C1">;</span><span style="color:#D8DEE9FF"> </span><span style="color:#616E88">// &lt;-- Assume 0 to start with</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88">// Was there TLS negotiation?</span></span>
<span class="line"><span style="color:#81A1C1">if</span><span style="color:#D8DEE9FF"> (</span><span style="color:#D8DEE9">pageNav</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">secureConnectionStart</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">&gt;</span><span style="color:#D8DEE9FF"> </span><span style="color:#B48EAD">0</span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">  </span><span style="color:#616E88">// Awesome! Calculate it!</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#D8DEE9">tlsTime</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">pageNav</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">connectEnd</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">-</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">pageNav</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">secureConnectionStart</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span></div></div>
<p>Once DNS lookup and connection negotiation ends, timings related to fetching documents and their dependent resources come into play.</p>
<p>一旦 DNS 查找和连接协商结束，与获取文档及其依赖资源相关的时间就会发挥作用。</p>
<h3 id="requests-and-responses请求和响应"><a class="header-anchor" aria-hidden="true" href="#requests-and-responses请求和响应">#</a>Requests and responses 请求和响应</h3>
<p>Loading performance is affected by two types of factors:</p>
<p>加载性能受以下两种因素的影响：</p>
<ul>
<li>
<p><strong>Extrinsic factors:</strong> These are things like latency and bandwidth. Beyond choosing a hosting company and a CDN, they&#x27;re (mostly) out of our control, as users can access the web from anywhere.</p>
<p>外部因素：这些因素包括延迟和带宽等因素。除了选择托管公司和 CDN 之外，它们（大部分）超出了我们的控制范围，因为用户可以从任何地方访问网络。</p>
</li>
<li>
<p><strong>Intrinsic factors:</strong> These are things like server and client-side architectures, as well as resource size and our ability to optimize for those things, which are within our control.</p>
<p>内在因素：这些因素包括服务器和客户端架构，以及资源大小和我们针对这些因素进行优化的能力，这些因素都在我们的控制范围内。</p>
</li>
</ul>
<p>Both types of factors affect loading performance. Timings related to these factors are vital, as they describe how long resources take to download. Both Navigation Timing and Resource Timing describe loading performance with the following metrics:</p>
<p>这两种类型的因素都会影响加载性能。与这些因素相关的时间至关重要，因为它们描述了下载资源所需的时间。“导航计时”和“资源计时”都使用以下指标描述加载性能：</p>
<ul>
<li>
<p><code>fetchStart</code> marks when the browser begins to fetch a resource (Resource Timing) or a document for a navigation request (Navigation Timing). This precedes the actual request, and is the point at which the browser is checking caches (for example, HTTP and <a href="https://developer.mozilla.org/docs/Web/API/Cache" target="_blank" rel="nofollow"><code>Cache</code> instances</a>).</p>
<p><code>fetchStart</code> 标记浏览器何时开始获取资源（资源计时）或导航请求的文档（导航计时）。这先于实际请求，并且是浏览器检查缓存（例如，HTTP 和 <code>Cache</code> 实例）的点。</p>
</li>
<li>
<p><code>workerStart</code> marks when a request starts being handled within a service worker&#x27;s <a href="https://developer.mozilla.org/docs/Web/API/FetchEvent" target="_blank" rel="nofollow"><code>fetch</code> event handler</a>. This will be <code>0</code> when no service worker is controlling the current page.</p>
<p><code>workerStart</code> 标记何时开始在 Service Worker <code>fetch</code> 的事件处理程序中处理请求。这将是当没有 Service Worker 控制当前页面 <code>0</code> 时。</p>
</li>
<li>
<p><code>requestStart</code> is when the browser makes the request.</p>
<p><code>requestStart</code> 是浏览器发出请求的时间。</p>
</li>
<li>
<p><code>responseStart</code> is when the first byte of the response arrives.</p>
<p><code>responseStart</code> 是响应的第一个字节到达的时间。</p>
</li>
<li>
<p><code>responseEnd</code> is when the last byte of the response arrives.</p>
<p><code>responseEnd</code> 是响应的最后一个字节到达的时间。</p>
</li>
</ul>
<p>These timings allow you to measure multiple aspects of loading performance, such as cache lookup within a service worker <em>and</em> download time:</p>
<p>这些计时允许您衡量加载性能的多个方面，例如 Service Worker 中的缓存查找和下载时间：</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#616E88">// Cache seek plus response time of the current document</span></span>
<span class="line"><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">[</span><span style="color:#D8DEE9">pageNav</span><span style="color:#ECEFF4">]</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">performance</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">getEntriesByType</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#A3BE8C">navigation</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">fetchTime</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">pageNav</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">responseEnd</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">-</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">pageNav</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">fetchStart</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88">// Service worker time plus response time</span></span>
<span class="line"><span style="color:#81A1C1">let</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">workerTime</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#B48EAD">0</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1">if</span><span style="color:#D8DEE9FF"> (</span><span style="color:#D8DEE9">pageNav</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">workerStart</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">&gt;</span><span style="color:#D8DEE9FF"> </span><span style="color:#B48EAD">0</span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#D8DEE9">workerTime</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">pageNav</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">responseEnd</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">-</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">pageNav</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">workerStart</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span></div></div>
<p>You can also measure other aspects of request/response latency:</p>
<p>您还可以测量请求/响应延迟的其他方面：</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">[</span><span style="color:#D8DEE9">pageNav</span><span style="color:#ECEFF4">]</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">performance</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">getEntriesByType</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#A3BE8C">navigation</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88">// Request time only (excluding redirects, DNS, and connection/TLS time)</span></span>
<span class="line"><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">requestTime</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">pageNav</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">responseStart</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">-</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">pageNav</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">requestStart</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88">// Response time only (download)</span></span>
<span class="line"><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">responseTime</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">pageNav</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">responseEnd</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">-</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">pageNav</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">responseStart</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88">// Request + response time</span></span>
<span class="line"><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">requestResponseTime</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">pageNav</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">responseEnd</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">-</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">pageNav</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">requestStart</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span></div></div>
<h3 id="other-measurements-you-can-make--您可以进行的其他测量"><a class="header-anchor" aria-hidden="true" href="#other-measurements-you-can-make--您可以进行的其他测量">#</a>Other measurements you can make  (您可以进行的其他测量)</h3>
<p>Navigation Timing and Resource Timing is useful for more than what the examples above outline. Here are some other situations with relevant timings that may be worth exploring:</p>
<p>导航计时和资源计时的用途远不止上述示例所概述的。以下是一些其他情况，这些情况可能值得探讨：</p>
<ul>
<li>
<p><strong>Page redirects:</strong> Redirects are an overlooked source of added latency, especially redirect chains. Latency gets added in a number of ways, such as HTTP-to-HTTPs hops, as well as 302/uncached 301 redirects. The <code>redirectStart</code>, <code>redirectEnd</code>, and <code>redirectCount</code> timings are helpful in assessing redirect latency.</p>
<p>页面重定向：重定向是导致延迟增加的一个被忽视的来源，尤其是重定向链。延迟以多种方式增加，例如 HTTP 到 HTTPs 跃点，以及 302/未缓存的 301 重定向。 <code>redirectStart</code> 、 <code>redirectEnd</code> 和 <code>redirectCount</code> 计时有助于评估重定向延迟。</p>
</li>
<li>
<p><strong>Document unloading:</strong> In pages that run code in an <a href="https://developer.mozilla.org/docs/Web/Events/unload" target="_blank" rel="nofollow"><code>unload</code> event handler</a>, the browser must execute that code before it can navigate to the next page. <code>unloadEventStart</code> and <code>unloadEventEnd</code> measure document unloading.</p>
<p>文档卸载：在 <code>unload</code> 事件处理程序中运行代码的页面中，浏览器必须先执行该代码，然后才能导航到下一页。 <code>unloadEventStart</code> 并 <code>unloadEventEnd</code> 测量文档卸载。</p>
</li>
<li>
<p><strong>Document processing:</strong> Document processing time may not be consequential unless your website sends very large HTML payloads. If this describes your situation, the <code>domInteractive</code>, <code>domContentLoadedEventStart</code>, <code>domContentLoadedEventEnd</code>, and <code>domComplete</code> timings may be of interest.</p>
<p>文档处理：除非您的网站发送非常大的 HTML 有效负载，否则文档处理时间可能无关紧要。如果这描述了您的情况，则 、 <code>domInteractive</code> 、 <code>domContentLoadedEventStart</code> <code>domContentLoadedEventEnd</code> 和 <code>domComplete</code> 时间可能会引起您的兴趣。</p>
</li>
</ul>
<div class="island-directive warning"><p class="island-directive-title">WARNING</p><div class="island-directive-content"><p><strong>Warning:</strong> Timings related to document unloading and processing are available only in Navigation Timing, as they only apply to navigation requests.</p><p>警告：与文档卸载和处理相关的计时仅在导航计时中可用，因为它们仅适用于导航请求。</p></div></div>
<h2 id="acquiring-timings-in-application-code--在应用程序代码中获取时序"><a class="header-anchor" aria-hidden="true" href="#acquiring-timings-in-application-code--在应用程序代码中获取时序">#</a>Acquiring timings in application code  (在应用程序代码中获取时序)</h2>
<p>All of the examples shown so far use <code>performance.getEntriesByType</code>, but there are other ways to query the performance entry buffer, such as <a href="https://developer.mozilla.org/docs/Web/API/Performance/getEntriesByName" target="_blank" rel="nofollow"><code>performance.getEntriesByName</code></a> and <a href="https://developer.mozilla.org/docs/Web/API/Performance/getEntries" target="_blank" rel="nofollow"><code>performance.getEntries</code></a>. These methods are fine when only light analysis is needed. In other situations, though, they can introduce excessive main thread work by iterating over a large number of entries, or even repeatedly polling the performance buffer to find new entries.</p>
<p>到目前为止，显示的所有示例都使用 <code>performance.getEntriesByType</code> ，但还有其他方法可以查询性能条目缓冲区，例如 <code>performance.getEntriesByName</code> 和 <code>performance.getEntries</code> 。当只需要光分析时，这些方法很好。但是，在其他情况下，它们可能会通过迭代大量条目，甚至重复轮询性能缓冲区以查找新条目来引入过多的主线程工作。</p>
<p>The recommended approach for collecting entries from the performance entry buffer is to use a <a href="https://developer.mozilla.org/docs/Web/API/PerformanceObserver" target="_blank" rel="nofollow"><code>PerformanceObserver</code></a>. <code>PerformanceObserver</code> listens for performance entries, and provides them as they&#x27;re added to the buffer:</p>
<p>从性能条目缓冲区收集条目的推荐方法是使用 <code>PerformanceObserver</code> . <code>PerformanceObserver</code> 侦听性能条目，并在将它们添加到缓冲区时提供它们：</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#616E88">// Create the performance observer:</span></span>
<span class="line"><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">perfObserver</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">new</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0">PerformanceObserver</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">(</span><span style="color:#D8DEE9">observedEntries</span><span style="color:#ECEFF4">)</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=&gt;</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">  </span><span style="color:#616E88">// Get all resource entries collected so far:</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">entries</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">observedEntries</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">getEntries</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ECEFF4">  </span><span style="color:#616E88">// Iterate over entries:</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#81A1C1">for</span><span style="color:#D8DEE9FF"> (</span><span style="color:#81A1C1">let</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">i</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#B48EAD">0</span><span style="color:#81A1C1">;</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">i</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">&lt;</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">entries</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9FF">length</span><span style="color:#81A1C1">;</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">i</span><span style="color:#81A1C1">++</span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">    </span><span style="color:#616E88">// Do the work!</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#ECEFF4">}</span></span>
<span class="line"><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88">// Run the observer for Navigation Timing entries:</span></span>
<span class="line"><span style="color:#D8DEE9">perfObserver</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">observe</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#88C0D0">type</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&#x27;</span><span style="color:#A3BE8C">navigation</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#88C0D0">buffered</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">true</span></span>
<span class="line"><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88">// Run the observer for Resource Timing entries:</span></span>
<span class="line"><span style="color:#D8DEE9">perfObserver</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">observe</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#88C0D0">type</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&#x27;</span><span style="color:#A3BE8C">resource</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#88C0D0">buffered</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">true</span></span>
<span class="line"><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span><span class="line-number">17</span><span class="line-number">18</span><span class="line-number">19</span><span class="line-number">20</span><span class="line-number">21</span><span class="line-number">22</span></div></div>
<div class="island-directive info"><p class="island-directive-title">INFO</p><div class="island-directive-content"><p><strong>Note:</strong> Adding the <code>buffered</code> option to a performance observer&#x27;s <code>observe</code> event ensures that performance entries added to the buffer prior to the instantiation of the performance observer are observable.</p><p>注： 将选项 <code>buffered</code> 添加到性能观察程序 <code>observe</code> 的事件可确保在性能观察程序实例化之前添加到缓冲区的性能条目是可观察的。</p></div></div>
<p>This method of collecting timings may feel awkward when compared to directly accessing the performance entry buffer, but it&#x27;s preferable to tying up the main thread with work that doesn&#x27;t serve a critical and user-facing purpose.</p>
<p>与直接访问性能输入缓冲区相比，这种收集计时的方法可能会让人感到尴尬，但最好不要将主线程与不用于关键和面向用户的工作捆绑在一起。</p>
<h2 id="phoning-home给家里打电话"><a class="header-anchor" aria-hidden="true" href="#phoning-home给家里打电话">#</a>Phoning home 给家里打电话</h2>
<p>Once you&#x27;ve collected all the timings you need, you can send them to an endpoint for further analysis. Two ways to do this are with either <a href="https://developer.mozilla.org/docs/Web/API/Navigator/sendBeacon" target="_blank" rel="nofollow"><code>navigator.sendBeacon</code></a> or a <a href="https://developer.mozilla.org/docs/Web/API/fetch" target="_blank" rel="nofollow"><code>fetch</code> with the <code>keepalive</code> option</a> set. Both methods will send a request to a specified endpoint in a non-blocking way, and the request will be queued in a way that outlives the current page session if need be:</p>
<p>收集所需的所有计时后，可以将它们发送到终结点进行进一步分析。执行此操作的两种方法是使用 <code>keepalive</code> 选项集或 <code>navigator.sendBeacon</code> 选项 <code>fetch</code> 集。这两种方法都将以非阻塞方式向指定的终结点发送请求，如果需要，请求将以比当前页面会话更长的方式排队：</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#616E88">// Caution: If you have lots of performance entries, don&#x27;t</span></span>
<span class="line"><span style="color:#616E88">// do this. This is an example for illustrative purposes.</span></span>
<span class="line"><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">data</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">JSON</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">stringify</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">performance</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">getEntries</span><span style="color:#D8DEE9FF">()))</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88">// The endpoint to transmit the encoded data to</span></span>
<span class="line"><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">endpoint</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&#x27;</span><span style="color:#A3BE8C">/analytics</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88">// Check for fetch keepalive support</span></span>
<span class="line"><span style="color:#81A1C1">if</span><span style="color:#D8DEE9FF"> (</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#A3BE8C">keepalive</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">in</span><span style="color:#D8DEE9FF"> </span><span style="color:#8FBCBB">Request</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9FF">prototype) </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#88C0D0">fetch</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">endpoint</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#88C0D0">method</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&#x27;</span><span style="color:#A3BE8C">POST</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#88C0D0">body</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">data</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#88C0D0">keepalive</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">true</span><span style="color:#ECEFF4">,</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#88C0D0">headers</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">      </span><span style="color:#ECEFF4">&#x27;</span><span style="color:#A3BE8C">Content-Type</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">&#x27;</span><span style="color:#A3BE8C">application/json</span><span style="color:#ECEFF4">&#x27;</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#ECEFF4">}</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">else</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">if</span><span style="color:#D8DEE9FF"> (</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#A3BE8C">sendBeacon</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">in</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">navigator</span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#ECEFF4">  </span><span style="color:#616E88">// Use sendBeacon as a fallback</span></span>
<span class="line"><span style="color:#D8DEE9FF">  </span><span style="color:#D8DEE9">navigator</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">sendBeacon</span><span style="color:#D8DEE9FF">(</span><span style="color:#D8DEE9">endpoint</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">data</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span><span class="line-number">17</span><span class="line-number">18</span><span class="line-number">19</span><span class="line-number">20</span><span class="line-number">21</span></div></div>
<p>In this example, the JSON string will arrive in a <code>POST</code> payload that you can decode and process/store in an application backend as needed.</p>
<p>在此示例中，JSON 字符串将到达有效 <code>POST</code> 负载中，您可以根据需要在应用程序后端中解码和处理/存储该有效负载。</p>
<h2 id="wrapping-up结束语"><a class="header-anchor" aria-hidden="true" href="#wrapping-up结束语">#</a>Wrapping up 结束语</h2>
<p>Once you have metrics collected, it&#x27;s up to you to figure out how to analyze that field data. When analyzing field data, there are a few general rules to follow to ensure you&#x27;re drawing meaningful conclusions:</p>
<p>收集指标后，由您决定如何分析该字段数据。在分析外业数据时，需要遵循一些一般规则，以确保得出有意义的结论：</p>
<ul>
<li>
<p><a href="https://www.igvita.com/2016/01/12/the-average-page-is-a-myth/" target="_blank" rel="nofollow">Avoid averages</a>, as they&#x27;re not representative of any one user&#x27;s experience, and may be skewed by outliers.</p>
<p>避免使用平均值，因为它们不能代表任何一个用户的体验，并且可能会因异常值而出现偏差。</p>
</li>
<li>
<p>Rely on percentiles. In datasets of time-based performance metrics, lower is better. This means that when you prioritize low percentiles, you&#x27;re only paying attention to the fastest experiences.</p>
<p>依靠百分位数。在基于时间的性能指标数据集中，越低越好。这意味着，当您优先考虑低百分位数时，您只会关注最快的体验。</p>
</li>
<li>
<p><a href="https://timkadlec.com/remembers/2018-06-07-prioritizing-the-long-tail-of-performance/" target="_blank" rel="nofollow">Prioritize the long tail of values</a>. When you prioritize experiences at the 75th percentile or higher, you&#x27;re putting your focus where it belongs: on the slowest experiences.</p>
<p>优先考虑值的长尾。当您将体验的优先级排在第 75 个百分位或更高时，您就将重点放在了它所属的地方：最慢的体验上。</p>
</li>
</ul>
<p>This guide isn&#x27;t meant to be an exhaustive resource on Navigation or Resource Timing, but a starting point. Below are some additional resources you may find helpful:<br/>
<!-- -->本指南并不是有关导航或资源计时的详尽资源，而是一个起点。以下是一些可能对您有帮助的其他资源：</p>
<ul>
<li>
<p><a href="https://www.w3.org/TR/navigation-timing-2/" target="_blank" rel="nofollow">Navigation Timing Spec</a>. 导航时序规范</p>
</li>
<li>
<p><a href="https://www.w3.org/TR/resource-timing-2/" target="_blank" rel="nofollow">Resource Timing Spec</a>. 资源计时规范</p>
</li>
<li>
<p><a href="https://nicj.net/resourcetiming-in-practice/" target="_blank" rel="nofollow">ResourceTiming in Practice</a>.</p>
<p>ResourceTiming 在实践中。</p>
</li>
<li>
<p>[Navigation Timing API (MDN)</p>
<p>导航计时 API （MDN）](<a href="https://developer.mozilla.org/docs/Web/API/Navigation_timing_API" target="_blank" rel="nofollow">https://developer.mozilla.org/docs/Web/API/Navigation_timing_API</a>)</p>
</li>
<li>
<p>[Resource Timing API (MDN)</p>
<p>资源计时 API （MDN）](<a href="https://developer.mozilla.org/docs/Web/API/Resource_Timing_API" target="_blank" rel="nofollow">https://developer.mozilla.org/docs/Web/API/Resource_Timing_API</a>)</p>
</li>
</ul>
<p>With these APIs and the data they provide, you&#x27;ll be better equipped to understand how loading performance is experienced by real users, which will give you more confidence in diagnosing and addressing loading performance problems in the field.</p>
<p>借助这些 API 及其提供的数据，您将能够更好地了解真实用户对加载性能的体验，这将使您在现场诊断和解决加载性能问题时更有信心。</p><!--/$--></div><footer mt="8"><div class="xs:flex" p="b-5" justify="between" items-center="~"><div flex="" text="sm text-2" leading-6="~" leading-8="sm:~" font-medium=""><p>Last Updated: </p><span>2023/11/16 20:32:02</span></div></div><div flex="~ col sm:row" justify="sm:around" gap="2" divider-top="" pt="6"><div flex="~ col" class="_prev_1f77m_13"><a href="/chrome/performance/2-general-html-performance" class="_pager-link_1f77m_20"><span class="_desc_1f77m_43">Previous Page</span><span class="_title_1f77m_34">2. 一般 HTML 性能注意事项</span></a></div><div flex="~ col" class="_next_1f77m_16"><a href="/chrome/performance/optimize-long-tasks" class="_pager-link_1f77m_20 _next_1f77m_16"><span class="_desc_1f77m_43">Next page</span><span class="_title_1f77m_34">优化长任务</span></a></div></div></footer></div></div><div relative="~" display="none lg:block" order="2" flex="1" p="l-8" class="max-w-256px"><div class="_aside-container_5cssi_32"><div flex="~ col" p="b-8" style="min-height:calc(100vh - (var(--island-nav-height-desktop) + 32px))"><div><div flex="~ col 1"><div display="lg:block"><div relative="" divider-left="" p="l-4" text="13px" font-medium="" id="aside-container"><div absolute="" pos="top-33px" opacity="0" w="1px" h="18px" bg="brand" style="left:-1px;transition:top 0.25s cubic-bezier(0, 1, 0.5, 1), background-color 0.5s, opacity 0.25s" id="aside-marker"></div><div block="~" leading-7="" text="13px" font="semibold">目录</div><nav><ul relative=""><li><a href="#apis-to-help-you-assess-loading-performance-in-the-field--帮助您评估现场装载性能的-api" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">APIs to help you assess loading performance in the field  (帮助您评估现场装载性能的 API)</a></li><li><a href="#the-life-and-timings-of-a-network-request--网络请求的生存期和计时" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">The life and timings of a network request  (网络请求的生存期和计时)</a></li><li><a href="#dns-lookupdns查询" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">DNS lookup DNS查询</a></li><li><a href="#connection-negotiation连接协商" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">Connection negotiation 连接协商</a></li><li><a href="#requests-and-responses请求和响应" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">Requests and responses 请求和响应</a></li><li><a href="#other-measurements-you-can-make--您可以进行的其他测量" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">Other measurements you can make  (您可以进行的其他测量)</a></li><li><a href="#acquiring-timings-in-application-code--在应用程序代码中获取时序" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Acquiring timings in application code  (在应用程序代码中获取时序)</a></li><li><a href="#phoning-home给家里打电话" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Phoning home 给家里打电话</a></li><li><a href="#wrapping-up结束语" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Wrapping up 结束语</a></li></ul></nav></div></div></div></div></div></div></div></div></div></section></div></div>
      <script>window.ISLAND_PAGE_DATA={"siteData":{"lang":"en-US","title":"beka的博客","description":"Island","themeConfig":{"lastUpdatedText":"上次更新","outlineTitle":"目录","nav":[{"text":"Article","link":"/article/astro","activeMatch":"/article/"},{"text":"Article-set","link":"/article-set/URL-SET","activeMatch":"/article-set/"},{"text":"Chrome","link":"/chrome/fast-load-time/user-centric-performance-metrics","activeMatch":"/chrome/"},{"text":"Design-pattern","link":"/design-pattern/indexs","activeMatch":"/design-pattern/"},{"text":"Open-source","link":"/open-source/delay","activeMatch":"/open-source/"},{"text":"Promise","link":"/promise/first-resolved","activeMatch":"/promise/"},{"text":"Typescript","link":"/typescript/tip","activeMatch":"/typescript/"},{"text":"Webpack","link":"/webpack/build-result","activeMatch":"/webpack/"}],"sidebar":{"article":[{"text":"Article","items":[{"text":"Astro","link":"/article/astro"},{"text":"新一代全栈框架 Fresh","link":"/article/fresh"}],"collapsable":true}],"article-set":[{"text":"Article-set","items":[{"text":"外链合集","link":"/article-set/URL-SET"},{"text":"requestAnimationFrame","link":"/article-set/raf"}],"collapsable":true}],"chrome":[{"text":"Chrome","items":[{"text":"以用户为中心的效果指标","link":"/chrome/fast-load-time/user-centric-performance-metrics"}],"collapsable":true},{"text":"浏览器工作原理","items":[{"text":"Web 浏览器如何逐步工作 — 高级体系结构（第 1 部分）","link":"/chrome/how-web-browser-works/part-1_high-level-architecture"},{"text":"Web 浏览器如何逐步工作 — 导航阶段（第 2 部分）","link":"/chrome/how-web-browser-works/part-2_navigation-phase"},{"text":"浏览器如何逐步工作 — 渲染阶段（第 3 部分）","link":"/chrome/how-web-browser-works/part-3_rendering-phase"},{"text":"浏览器如何逐步工作 — 加载阶段的优化（第 4 部分）","link":"/chrome/how-web-browser-works/part-4_optimization-in-the-loading-stage"},{"text":"浏览器如何一步一步地工作 — 交互阶段的优化（第 5 部分）","link":"/chrome/how-web-browser-works/part-5_optimization-in-the-interaction-stage"},{"text":"什么强制了重排/回流","link":"/chrome/how-web-browser-works/what-forces-layout-reflow"}],"collapsable":true},{"text":"Html","items":[{"text":"Metadata","link":"/chrome/html/metadata"},{"text":"html","link":"/chrome/html/overview"},{"text":"# 文档结构","link":"/chrome/html/structure"}],"collapsable":true},{"text":"关键指标","items":[{"text":"First Contentful Paint (FCP) 首次内容绘制","link":"/chrome/metrics/FCP"},{"text":"Largest Contentful Paint (LCP) 最大内容填充","link":"/chrome/metrics/LCP"},{"text":"Time to First Byte (TTFB) 首次字节加载时间","link":"/chrome/metrics/TTFB"}],"collapsable":true},{"text":"现代网络浏览器内幕","items":[{"text":"现代网络浏览器内幕 — 1","link":"/chrome/modern-web-browser/inside-browser-part-1"},{"text":"现代网络浏览器内幕 — 2","link":"/chrome/modern-web-browser/inside-browser-part-2"},{"text":"现代网络浏览器内幕 — 3","link":"/chrome/modern-web-browser/inside-browser-part-3"},{"text":"现代网络浏览器内幕 — 4","link":"/chrome/modern-web-browser/inside-browser-part-4"}],"collapsable":true},{"text":"性能","items":[{"text":"1. Welcome to Lean performance","link":"/chrome/performance/1-welcome"},{"text":"2. 一般 HTML 性能注意事项","link":"/chrome/performance/2-general-html-performance"},{"text":"使用导航定时和资源定时评估现场的负载性能","link":"/chrome/performance/navigation-and-resource-timing"},{"text":"优化长任务","link":"/chrome/performance/optimize-long-tasks"},{"text":"optimize-resource-loading 优化资源负载","link":"/chrome/performance/optimize-resource-loading"},{"text":"通过摇树减少 JavaScript 有效负载","link":"/chrome/performance/reduce-javascript-payloads-with-tree-shaking"},{"text":"asdf","link":"/chrome/performance/welcome-copy"},{"text":"速度为什么重要","link":"/chrome/performance/why-speed-matters"}],"collapsable":true},{"text":"性能技巧","items":[{"text":"Web 上的多进程：浏览器进程模型","link":"/chrome/performance/tips/browser-process-model"},{"text":"Browser Rendering Pipeline","link":"/chrome/performance/tips/browser-rendering-pipeline"},{"text":"通过火焰图找到有问题的代码","link":"/chrome/performance/tips/codepath-scoping"},{"text":"如何收集 Web 性能跟踪","link":"/chrome/performance/tips/collect-a-trace"},{"text":"事件循环基础知识","link":"/chrome/performance/tips/event-loop"},{"text":"深度讲解火焰图 🔥🔥","link":"/chrome/performance/tips/flamegraphs-in-depth"},{"text":"长任务：它们是什么以及为什么应该避免它们","link":"/chrome/performance/tips/long-tasks"},{"text":"performance 查看主线程（颜色含义）","link":"/chrome/performance/tips/main-profiler-pane"},{"text":"检测浏览器何时在 JavaScript 中绘制Frame","link":"/chrome/performance/tips/measuring-paint-time"},{"text":"如何阅读 Chromium Profiler","link":"/chrome/performance/tips/network-profiler-pane"},{"text":"使用 Chromium 网络标签页获取性能详情","link":"/chrome/performance/tips/network-tab"},{"text":"使用性能时序标记进行📏测量","link":"/chrome/performance/tips/performance-timing-markers"},{"text":"Chromium F12 性能分析器的基本概述","link":"/chrome/performance/tips/profiler-basic-ui"},{"text":"【--空文件--】: performance/tips/resource-size-vs-transfer-size.md","link":"/chrome/performance/tips/resource-size-vs-transfer-size"},{"text":"如何阅读火焰图 🔥","link":"/chrome/performance/tips/understanding-flamegraphs"},{"text":"识别 Web 应用中的未压缩资源","link":"/chrome/performance/tips/validating-compression"},{"text":"asdfadsasdsdfasdf","link":"/chrome/performance/tips/aa/a"}],"collapsable":true}],"design-pattern":[{"text":"Design-pattern","items":[{"text":"# 资源列表","link":"/design-pattern/indexs"},{"text":"代理模式","link":"/design-pattern/proxy-pattern"},{"text":"Singleton Pattern","link":"/design-pattern/singleton-pattern"},{"text":"状态模式","link":"/design-pattern/state-pattern"},{"text":"策略模式","link":"/design-pattern/strategy-pattern"}],"collapsable":true}],"open-source":[{"text":"Open-source","items":[{"text":"delay","link":"/open-source/delay"},{"text":"dot-prop","link":"/open-source/dot-prop"},{"text":"glob-to-regexp","link":"/open-source/glob-to-regexp"},{"text":"koa 洋葱模型","link":"/open-source/koa-compose"},{"text":"quick-lru","link":"/open-source/lru-cache"},{"text":"p-defer","link":"/open-source/p-defer"},{"text":"p-lazy","link":"/open-source/p-lazy"},{"text":"p-limit","link":"/open-source/p-limit"},{"text":"p-locate","link":"/open-source/p-locate"},{"text":"p-settle","link":"/open-source/p-settle"},{"text":"yocto-queue","link":"/open-source/yocto-queue"}],"collapsable":true}],"promise":[{"text":"Promise","items":[{"text":"顺序执行任务直到第一个resolved。","link":"/promise/first-resolved"},{"text":"reduce实现多个promise顺序执行.","link":"/promise/sequential-execution"}],"collapsable":true}],"typescript":[{"text":"Typescript","items":[{"text":"Typescript 技巧","link":"/typescript/tip"}],"collapsable":true}],"webpack":[{"text":"Webpack","items":[{"text":"webpack 打包代码分析","link":"/webpack/build-result"},{"text":"mini-webpack","link":"/webpack/mini-webpack"},{"text":"minipack-explain","link":"/webpack/minipack"},{"text":"tapable","link":"/webpack/tapable"}],"collapsable":true}]},"footer":{"message":"Released under the MIT License.","copyright":"Copyright © 2022-present Beka"}},"head":[["script",{"id":"check-dark-light"},"\n        ;(() => {\n          const saved = localStorage.getItem('island-theme-appearance')\n          const prefereDark = window.matchMedia('(prefers-color-scheme: dark)').matches\n          if (!saved || saved === 'auto' ? prefereDark : saved === 'dark') {\n            document.documentElement.classList.add('dark')\n          }\n        })()\n      "]],"base":"","icon":"","root":"/Users/beka/Desktop/code/bekacodechn.github.io/blog","appearance":true},"pagePath":"/Users/beka/Desktop/code/bekacodechn.github.io/blog/chrome/performance/navigation-and-resource-timing.md","relativePagePath":"chrome/performance/navigation-and-resource-timing.md","toc":[{"id":"apis-to-help-you-assess-loading-performance-in-the-field--帮助您评估现场装载性能的-api","text":"APIs to help you assess loading performance in the field  (帮助您评估现场装载性能的 API)","depth":2},{"id":"the-life-and-timings-of-a-network-request--网络请求的生存期和计时","text":"The life and timings of a network request  (网络请求的生存期和计时)","depth":2},{"id":"dns-lookupdns查询","text":"DNS lookup DNS查询","depth":3},{"id":"connection-negotiation连接协商","text":"Connection negotiation 连接协商","depth":3},{"id":"requests-and-responses请求和响应","text":"Requests and responses 请求和响应","depth":3},{"id":"other-measurements-you-can-make--您可以进行的其他测量","text":"Other measurements you can make  (您可以进行的其他测量)","depth":3},{"id":"acquiring-timings-in-application-code--在应用程序代码中获取时序","text":"Acquiring timings in application code  (在应用程序代码中获取时序)","depth":2},{"id":"phoning-home给家里打电话","text":"Phoning home 给家里打电话","depth":2},{"id":"wrapping-up结束语","text":"Wrapping up 结束语","depth":2}],"title":"使用导航定时和资源定时评估现场的负载性能","lastUpdatedTime":"2023/11/16 20:32:02","content":"# 使用导航定时和资源定时评估现场的负载性能\n\n`metadata:`\n\n**原标题:** Assessing loading performance in the field with Navigation Timing and Resource Timing\n\n**链接:** https://web.dev/articles/navigation-and-resource-timing\n\n---\n\nLearn the basics of using the Navigation and Resource Timing APIs to assess loading performance in the field.\n\n了解使用导航和资源计时 API 评估外业加载性能的基础知识。\n\nIf you've used connection throttling in the network panel in a browser's developer tools (or Lighthouse in Chrome) to assess loading performance, you know how convenient those tools are for performance tuning. You can quickly measure the impact of performance optimizations with a consistent and stable baseline connection speed. The only problem is that this is synthetic testing, which yields lab data, not field data.\n\n如果您曾在浏览器的开发者工具（或 Chrome 中的 Lighthouse）的网络面板中使用过连接限制来评估加载性能，您就会知道这些工具在性能调整方面是多么方便。您可以使用一致且稳定的基准连接速度快速衡量性能优化的影响。唯一的问题是，这是综合测试，它产生的是实验室数据，而不是现场数据。\n\nSynthetic testing isn't inherently bad, but it's not representative of how fast your website is loading for real users. That requires field data, which you can collect from the Navigation Timing and Resource Timing APIs.\n\n综合测试本身并不坏，但它并不能代表您的网站为真实用户加载的速度。这需要字段数据，您可以从 Navigation Timing 和 Resource Timing API 收集这些数据。\n\n## APIs to help you assess loading performance in the field  (帮助您评估现场装载性能的 API)\n\nNavigation Timing and Resource Timing are two similar APIs with significant overlap that measure two distinct things:  \n\nNavigation Timing 和 Resource Timing 是两个相似的 API，它们有很大的重叠，用于测量两个截然不同的内容：\n\n*   [Navigation Timing](https://w3c.github.io/navigation-timing/) measures the speed of requests for HTML documents (that is, navigation requests).  \n\n    导航计时测量 HTML 文档请求（即导航请求）的速度。\n*   [Resource Timing](https://w3c.github.io/resource-timing/) measures the speed of requests for document-dependent resources such as CSS, JavaScript, images, and so on.  \n\n    资源计时测量对文档相关资源（如 CSS、JavaScript、图像等）的请求速度。\n\nThese APIs expose their data in a _performance entry buffer_, which can be accessed in the browser with JavaScript. There are multiple ways to query a performance buffer, but a common way is by using [`performance.getEntriesByType`](https://developer.mozilla.org/docs/Web/API/Performance/getEntriesByType):  \n\n这些 API 在性能条目缓冲区中公开其数据，可以使用 JavaScript 在浏览器中访问该缓冲区。有多种方法可以查询性能缓冲区，但一种常见的方法是使用 `performance.getEntriesByType` ：\n\n```js\n// Get Navigation Timing entries:\nperformance.getEntriesByType('navigation');\n\n// Get Resource Timing entries:\nperformance.getEntriesByType('resource');\n```\n\n`performance.getEntriesByType` accepts a string describing the type of entries you want to retrieve from the performance entry buffer. `'navigation'` and `'resource'` retrieve timings for the Navigation Timing and Resource Timing APIs, respectively.  \n\n`performance.getEntriesByType` 接受一个字符串，该字符串描述要从性能条目缓冲区中检索的条目类型。 `'navigation'` 并 `'resource'` 分别检索 Navigation Timing 和 Resource Timing API 的计时。\n\n:::info\n**Note:** Try loading a website and then enter either of the commands in the above code snippet in your browser's console to see actual timings captured by your browser.  \n\n注意：尝试加载网站，然后在浏览器控制台中输入上述代码片段中的任何命令，以查看浏览器捕获的实际计时。\n:::\n\nThe amount of information these APIs provide can be overwhelming, but they're your key to measuring loading performance in the field, as you can gather these timings from users as they visit your website.  \n\n这些 API 提供的信息量可能会让人不知所措，但它们是衡量现场加载性能的关键，因为您可以在用户访问您的网站时收集这些时间。\n\n## The life and timings of a network request  (网络请求的生存期和计时)\n\nGathering and analyzing navigation and resource timings is sort of like archeology in that you're reconstructing the fleeting life of a network request after the fact. Sometimes it helps to visualize concepts, and where network requests are concerned, your browser's developer tools can help.  \n\n收集和分析导航和资源时序有点像考古学，因为你是在事后重建网络请求的短暂生命。有时，它有助于可视化概念，而在涉及网络请求时，浏览器的开发人员工具可以提供帮助。\n\n![20231116001628](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116001628.png)\n\nThe life of a network request has distinct phases, such as DNS lookup, connection establishment, TLS negotiation, and so on. These timings are represented as a [`DOMHighResTimestamp`](https://developer.mozilla.org/docs/Web/API/DOMHighResTimeStamp). Depending on your browser, the granularity of timings may be down to the microsecond, or be rounded up to milliseconds. Let's examine these phases in detail, and how they relate to Navigation Timing and Resource Timing.  \n\n网络请求的生命周期具有不同的阶段，例如 DNS 查找、连接建立、TLS 协商等。这些计时表示为 `DOMHighResTimestamp` .根据您的浏览器，计时粒度可能低至微秒，或四舍五入到毫秒。让我们详细研究一下这些阶段，以及它们与导航计时和资源计时的关系。\n\n:::info\n**Note:** As you read this guide, [this diagram](https://www.w3.org/TR/navigation-timing-2/#processing-model) for both Navigation Timing and Resource Timing may help you to visualize the order of the timings they provide.  \n\n注意：在阅读本指南时，此导航计时和资源计时图可帮助您直观地了解它们提供的计时顺序。\n:::\n\n### DNS lookup DNS查询\n\nWhen a user goes to a URL, the Domain Name System (DNS) is queried to translate a domain to an IP address. This process may take significant time—time you'll want to measure in the field, even. Navigation Timing and Resource Timing expose two DNS-related timings:  \n\n当用户转到 URL 时，将查询域名系统 （DNS） 以将域转换为 IP 地址。此过程可能需要大量时间，甚至需要在现场测量。“导航计时”和“资源计时”公开了两个与 DNS 相关的计时：\n\n*   `domainLookupStart` is when DNS lookup begins.  \n\n    `domainLookupStart` 是 DNS 查找开始的时间。\n*   `domainLookupEnd` is when DNS lookup ends.  \n\n    `domainLookupEnd` 是 DNS 查找结束的时间。\n\nCalculating total DNS lookup time can be done by subtracting the start metric from the end metric:  \n\n可以通过从结束指标中减去开始指标来计算总 DNS 查找时间：\n\n```js\n// Measuring DNS lookup time\nconst [pageNav] = performance.getEntriesByType('navigation');\nconst totalLookupTime = pageNav.domainLookupEnd - pageNav.domainLookupStart;\n```\n\n:::warning\n**Caution:** You can't _always_ rely on timings to be populated. Timings provided in both APIs will have a value of `0` in some cases. For example, a DNS lookup may be served by a local cache. Additionally, any timings for cross-origin requests may be unavailable if those origins don't set a [`Timing-Allow-Origin` response header](https://developer.mozilla.org/docs/Web/HTTP/Headers/Timing-Allow-Origin).  \n\n注意：您不能总是依赖要填充的时间。在某些情况下，这两个 API 中提供的计时值 `0` 为 。例如，DNS 查找可能由本地缓存提供。此外，如果跨源请求未设置 `Timing-Allow-Origin` 响应标头，则这些请求的任何计时都可能不可用。\n:::\n\n### Connection negotiation 连接协商\n\nAnother contributing factor to loading performance is connection negotiation, which is latency incurred when connecting to a web server. If HTTPS is involved, this process will also include TLS negotiation time. The connection phase consists of three timings:  \n\n影响加载性能的另一个因素是连接协商，这是连接到 Web 服务器时产生的延迟。如果涉及 HTTPS，则此过程还将包括 TLS 协商时间。连接阶段包括三个计时：\n\n*   `connectStart` is when the browser starts to open a connection to a web server.  \n\n    `connectStart` 是浏览器开始打开与 Web 服务器的连接时。\n*   `secureConnectionStart` marks when the client begins TLS negotiation.  \n\n    `secureConnectionStart` 标记客户端何时开始 TLS 协商。\n*   `connectEnd` is when the connection to the web server has been established.  \n\n    `connectEnd` 是与 Web 服务器建立连接的时间。\n\nMeasuring total connection time is similar to measuring total DNS lookup time: you subtract the start timing from the end timing. However, there's an additional `secureConnectionStart` property that may be `0` if HTTPS isn't used or [if the connection is persistent](https://en.wikipedia.org/wiki/HTTP_persistent_connection). If you want to measure TLS negotiation time, you'll need to keep that in mind:  \n\n测量总连接时间与测量总 DNS 查找时间类似：从结束时间中减去开始时间。但是， `0` 如果不使用 HTTPS 或连接是持久的，则可能还有一个附加 `secureConnectionStart` 属性。如果要测量 TLS 协商时间，需要牢记这一点：\n\n```js\n// Quantifying total connection time\nconst [pageNav] = performance.getEntriesByType('navigation');\nconst connectionTime = pageNav.connectEnd - pageNav.connectStart;\nlet tlsTime = 0; // <-- Assume 0 to start with\n\n// Was there TLS negotiation?\nif (pageNav.secureConnectionStart > 0) {\n  // Awesome! Calculate it!\n  tlsTime = pageNav.connectEnd - pageNav.secureConnectionStart;\n}\n```\n\nOnce DNS lookup and connection negotiation ends, timings related to fetching documents and their dependent resources come into play.  \n\n一旦 DNS 查找和连接协商结束，与获取文档及其依赖资源相关的时间就会发挥作用。\n\n### Requests and responses 请求和响应\n\nLoading performance is affected by two types of factors:  \n\n加载性能受以下两种因素的影响：\n\n*   **Extrinsic factors:** These are things like latency and bandwidth. Beyond choosing a hosting company and a CDN, they're (mostly) out of our control, as users can access the web from anywhere.  \n\n    外部因素：这些因素包括延迟和带宽等因素。除了选择托管公司和 CDN 之外，它们（大部分）超出了我们的控制范围，因为用户可以从任何地方访问网络。\n*   **Intrinsic factors:** These are things like server and client-side architectures, as well as resource size and our ability to optimize for those things, which are within our control.  \n\n    内在因素：这些因素包括服务器和客户端架构，以及资源大小和我们针对这些因素进行优化的能力，这些因素都在我们的控制范围内。\n\nBoth types of factors affect loading performance. Timings related to these factors are vital, as they describe how long resources take to download. Both Navigation Timing and Resource Timing describe loading performance with the following metrics:  \n\n这两种类型的因素都会影响加载性能。与这些因素相关的时间至关重要，因为它们描述了下载资源所需的时间。“导航计时”和“资源计时”都使用以下指标描述加载性能：\n\n*   `fetchStart` marks when the browser begins to fetch a resource (Resource Timing) or a document for a navigation request (Navigation Timing). This precedes the actual request, and is the point at which the browser is checking caches (for example, HTTP and [`Cache` instances](https://developer.mozilla.org/docs/Web/API/Cache)).  \n\n    `fetchStart` 标记浏览器何时开始获取资源（资源计时）或导航请求的文档（导航计时）。这先于实际请求，并且是浏览器检查缓存（例如，HTTP 和 `Cache` 实例）的点。\n*   `workerStart` marks when a request starts being handled within a service worker's [`fetch` event handler](https://developer.mozilla.org/docs/Web/API/FetchEvent). This will be `0` when no service worker is controlling the current page.  \n\n    `workerStart` 标记何时开始在 Service Worker `fetch` 的事件处理程序中处理请求。这将是当没有 Service Worker 控制当前页面 `0` 时。\n*   `requestStart` is when the browser makes the request.  \n\n    `requestStart` 是浏览器发出请求的时间。\n*   `responseStart` is when the first byte of the response arrives.  \n\n    `responseStart` 是响应的第一个字节到达的时间。\n*   `responseEnd` is when the last byte of the response arrives.  \n\n    `responseEnd` 是响应的最后一个字节到达的时间。\n\nThese timings allow you to measure multiple aspects of loading performance, such as cache lookup within a service worker _and_ download time:  \n\n这些计时允许您衡量加载性能的多个方面，例如 Service Worker 中的缓存查找和下载时间：\n\n```js\n// Cache seek plus response time of the current document\nconst [pageNav] = performance.getEntriesByType('navigation');\nconst fetchTime = pageNav.responseEnd - pageNav.fetchStart;\n\n// Service worker time plus response time\nlet workerTime = 0;\n\nif (pageNav.workerStart > 0) {\n  workerTime = pageNav.responseEnd - pageNav.workerStart;\n}\n```\n\nYou can also measure other aspects of request/response latency:  \n\n您还可以测量请求/响应延迟的其他方面：\n\n```js\nconst [pageNav] = performance.getEntriesByType('navigation');\n\n// Request time only (excluding redirects, DNS, and connection/TLS time)\nconst requestTime = pageNav.responseStart - pageNav.requestStart;\n\n// Response time only (download)\nconst responseTime = pageNav.responseEnd - pageNav.responseStart;\n\n// Request + response time\nconst requestResponseTime = pageNav.responseEnd - pageNav.requestStart;\n```\n\n### Other measurements you can make  (您可以进行的其他测量)\n\nNavigation Timing and Resource Timing is useful for more than what the examples above outline. Here are some other situations with relevant timings that may be worth exploring:  \n\n导航计时和资源计时的用途远不止上述示例所概述的。以下是一些其他情况，这些情况可能值得探讨：\n\n*   **Page redirects:** Redirects are an overlooked source of added latency, especially redirect chains. Latency gets added in a number of ways, such as HTTP-to-HTTPs hops, as well as 302/uncached 301 redirects. The `redirectStart`, `redirectEnd`, and `redirectCount` timings are helpful in assessing redirect latency.  \n\n    页面重定向：重定向是导致延迟增加的一个被忽视的来源，尤其是重定向链。延迟以多种方式增加，例如 HTTP 到 HTTPs 跃点，以及 302/未缓存的 301 重定向。 `redirectStart` 、 `redirectEnd` 和 `redirectCount` 计时有助于评估重定向延迟。\n*   **Document unloading:** In pages that run code in an [`unload` event handler](https://developer.mozilla.org/docs/Web/Events/unload), the browser must execute that code before it can navigate to the next page. `unloadEventStart` and `unloadEventEnd` measure document unloading.  \n\n    文档卸载：在 `unload` 事件处理程序中运行代码的页面中，浏览器必须先执行该代码，然后才能导航到下一页。 `unloadEventStart` 并 `unloadEventEnd` 测量文档卸载。\n*   **Document processing:** Document processing time may not be consequential unless your website sends very large HTML payloads. If this describes your situation, the `domInteractive`, `domContentLoadedEventStart`, `domContentLoadedEventEnd`, and `domComplete` timings may be of interest.  \n\n    文档处理：除非您的网站发送非常大的 HTML 有效负载，否则文档处理时间可能无关紧要。如果这描述了您的情况，则 、 `domInteractive` 、 `domContentLoadedEventStart` `domContentLoadedEventEnd` 和 `domComplete` 时间可能会引起您的兴趣。\n\n:::warning\n**Warning:** Timings related to document unloading and processing are available only in Navigation Timing, as they only apply to navigation requests.  \n\n警告：与文档卸载和处理相关的计时仅在导航计时中可用，因为它们仅适用于导航请求。\n:::\n\n## Acquiring timings in application code  (在应用程序代码中获取时序)\n\nAll of the examples shown so far use `performance.getEntriesByType`, but there are other ways to query the performance entry buffer, such as [`performance.getEntriesByName`](https://developer.mozilla.org/docs/Web/API/Performance/getEntriesByName) and [`performance.getEntries`](https://developer.mozilla.org/docs/Web/API/Performance/getEntries). These methods are fine when only light analysis is needed. In other situations, though, they can introduce excessive main thread work by iterating over a large number of entries, or even repeatedly polling the performance buffer to find new entries.  \n\n到目前为止，显示的所有示例都使用 `performance.getEntriesByType` ，但还有其他方法可以查询性能条目缓冲区，例如 `performance.getEntriesByName` 和 `performance.getEntries` 。当只需要光分析时，这些方法很好。但是，在其他情况下，它们可能会通过迭代大量条目，甚至重复轮询性能缓冲区以查找新条目来引入过多的主线程工作。\n\nThe recommended approach for collecting entries from the performance entry buffer is to use a [`PerformanceObserver`](https://developer.mozilla.org/docs/Web/API/PerformanceObserver). `PerformanceObserver` listens for performance entries, and provides them as they're added to the buffer:  \n\n从性能条目缓冲区收集条目的推荐方法是使用 `PerformanceObserver` . `PerformanceObserver` 侦听性能条目，并在将它们添加到缓冲区时提供它们：\n\n```js\n// Create the performance observer:\nconst perfObserver = new PerformanceObserver((observedEntries) => {\n  // Get all resource entries collected so far:\n  const entries = observedEntries.getEntries();\n\n  // Iterate over entries:\n  for (let i = 0; i < entries.length; i++) {\n    // Do the work!\n  }\n});\n\n// Run the observer for Navigation Timing entries:\nperfObserver.observe({\n  type: 'navigation',\n  buffered: true\n});\n\n// Run the observer for Resource Timing entries:\nperfObserver.observe({\n  type: 'resource',\n  buffered: true\n});\n```\n\n:::info\n**Note:** Adding the `buffered` option to a performance observer's `observe` event ensures that performance entries added to the buffer prior to the instantiation of the performance observer are observable.  \n\n注： 将选项 `buffered` 添加到性能观察程序 `observe` 的事件可确保在性能观察程序实例化之前添加到缓冲区的性能条目是可观察的。\n:::\n\nThis method of collecting timings may feel awkward when compared to directly accessing the performance entry buffer, but it's preferable to tying up the main thread with work that doesn't serve a critical and user-facing purpose.  \n\n与直接访问性能输入缓冲区相比，这种收集计时的方法可能会让人感到尴尬，但最好不要将主线程与不用于关键和面向用户的工作捆绑在一起。\n\n## Phoning home 给家里打电话\n\nOnce you've collected all the timings you need, you can send them to an endpoint for further analysis. Two ways to do this are with either [`navigator.sendBeacon`](https://developer.mozilla.org/docs/Web/API/Navigator/sendBeacon) or a [`fetch` with the `keepalive` option](https://developer.mozilla.org/docs/Web/API/fetch) set. Both methods will send a request to a specified endpoint in a non-blocking way, and the request will be queued in a way that outlives the current page session if need be:  \n\n收集所需的所有计时后，可以将它们发送到终结点进行进一步分析。执行此操作的两种方法是使用 `keepalive` 选项集或 `navigator.sendBeacon` 选项 `fetch` 集。这两种方法都将以非阻塞方式向指定的终结点发送请求，如果需要，请求将以比当前页面会话更长的方式排队：\n\n```js\n// Caution: If you have lots of performance entries, don't\n// do this. This is an example for illustrative purposes.\nconst data = JSON.stringify(performance.getEntries()));\n\n// The endpoint to transmit the encoded data to\nconst endpoint = '/analytics';\n\n// Check for fetch keepalive support\nif ('keepalive' in Request.prototype) {\n  fetch(endpoint, {\n    method: 'POST',\n    body: data,\n    keepalive: true,\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n} else if ('sendBeacon' in navigator) {\n  // Use sendBeacon as a fallback\n  navigator.sendBeacon(endpoint, data);\n}\n```\n\nIn this example, the JSON string will arrive in a `POST` payload that you can decode and process/store in an application backend as needed.  \n\n在此示例中，JSON 字符串将到达有效 `POST` 负载中，您可以根据需要在应用程序后端中解码和处理/存储该有效负载。\n\n## Wrapping up 结束语\n\nOnce you have metrics collected, it's up to you to figure out how to analyze that field data. When analyzing field data, there are a few general rules to follow to ensure you're drawing meaningful conclusions:  \n\n收集指标后，由您决定如何分析该字段数据。在分析外业数据时，需要遵循一些一般规则，以确保得出有意义的结论：\n\n*   [Avoid averages](https://www.igvita.com/2016/01/12/the-average-page-is-a-myth/), as they're not representative of any one user's experience, and may be skewed by outliers.  \n\n    避免使用平均值，因为它们不能代表任何一个用户的体验，并且可能会因异常值而出现偏差。\n*   Rely on percentiles. In datasets of time-based performance metrics, lower is better. This means that when you prioritize low percentiles, you're only paying attention to the fastest experiences.  \n\n    依靠百分位数。在基于时间的性能指标数据集中，越低越好。这意味着，当您优先考虑低百分位数时，您只会关注最快的体验。\n*   [Prioritize the long tail of values](https://timkadlec.com/remembers/2018-06-07-prioritizing-the-long-tail-of-performance/). When you prioritize experiences at the 75th percentile or higher, you're putting your focus where it belongs: on the slowest experiences.  \n\n    优先考虑值的长尾。当您将体验的优先级排在第 75 个百分位或更高时，您就将重点放在了它所属的地方：最慢的体验上。\n\nThis guide isn't meant to be an exhaustive resource on Navigation or Resource Timing, but a starting point. Below are some additional resources you may find helpful:  \n本指南并不是有关导航或资源计时的详尽资源，而是一个起点。以下是一些可能对您有帮助的其他资源：\n\n*   [Navigation Timing Spec](https://www.w3.org/TR/navigation-timing-2/). 导航时序规范\n\n*   [Resource Timing Spec](https://www.w3.org/TR/resource-timing-2/). 资源计时规范\n\n*   [ResourceTiming in Practice](https://nicj.net/resourcetiming-in-practice/).  \n\n    ResourceTiming 在实践中。\n*   [Navigation Timing API (MDN)  \n\n    导航计时 API （MDN）](https://developer.mozilla.org/docs/Web/API/Navigation_timing_API)\n*   [Resource Timing API (MDN)  \n\n    资源计时 API （MDN）](https://developer.mozilla.org/docs/Web/API/Resource_Timing_API)\n\nWith these APIs and the data they provide, you'll be better equipped to understand how loading performance is experienced by real users, which will give you more confidence in diagnosing and addressing loading performance problems in the field.  \n\n借助这些 API 及其提供的数据，您将能够更好地了解真实用户对加载性能的体验，这将使您在现场诊断和解决加载性能问题时更有信心。\n","pageType":"doc","routePath":"/chrome/performance/navigation-and-resource-timing"};</script>
      
      <script type="module" src="/client-entry.js"></script>
    </body>
  </html>