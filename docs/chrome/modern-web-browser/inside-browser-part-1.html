<!DOCTYPE html>
  <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <link rel="icon" href="" type="image/svg+xml"></link>
      <script  id="check-dark-light">
        ;(() => {
          const saved = localStorage.getItem('island-theme-appearance')
          const prefereDark = window.matchMedia('(prefers-color-scheme: dark)').matches
          if (!saved || saved === 'auto' ? prefereDark : saved === 'dark') {
            document.documentElement.classList.add('dark')
          }
        })()
      </script>
      <title data-rh="true">现代网络浏览器内幕 — 1</title>
      <meta data-rh="true" name="description" content="Island"/>
      
      
      <script defer src='https://ga.jspm.io/npm:es-module-shims@1.6.0/dist/es-module-shims.js'></script>
      <script type="importmap">
        {
          "imports": {
            "react": "/react.js","react-dom": "/react-dom.js","react-dom/client": "/react-dom_client.js","react/jsx-runtime": "/react_jsx-runtime.js"
          }
        }
      </script>

      <link rel="stylesheet" href="/assets/style.81be0ec3.css">

    </head>
    <body>
      <div id="root"><div style="height:100%"><header relative="" z="4" fixed="md:~" class="top-0 left-0" w="100%"><div relative="" p="l-8 sm:x-8" transition="background-color duration-500" class="divider-bottom md:border-b-transparent lg:border-b-transparent" nav-h="mobile lg:desktop"><div flex="" justify="between" m="0 auto" nav-h="mobile lg:desktop" class="_container_1ic07_52  _has-sidebar_1ic07_16"><div border="border t-0 b-1 border-solid transparent" class="_nav-bar-title_1ic07_16"><a href="/" w="100%" h="100%" text="1rem" font="semibold" transition="opacity duration-300" hover="opacity-60" class="flex items-center"><span>beka的博客</span></a></div><div class="_content_1ic07_24" flex="~ 1" justify="end" items-center=""><div class="search" flex="sm:1" pl="sm:8"><div flex="" items-center="~" relative="" mr="2" font="semibold"><svg width="32" height="32" viewBox="0 0 32 32" w="5" h="5" fill="currentColor"><path fill="#888888" d="m29 27.586l-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9a9.01 9.01 0 0 1-9-9Z"></path></svg><input disabled="" cursor="text focus:auto" placeholder="Search" height="8" border="none" type="text" text="sm" p="t-0 r-2 b-0 l-2" transition="all duration-200 ease" class="rounded-sm _searchInput_y03a3_1 " aria-label="Search" autoComplete="off"/><div m="r-3" w="10" h="6" p="x-1.5" rounded="md" border="1px solid gray-light-3" text="xs gray-light-3" flex="~" items-center="~" justify="around" class="_searchCommand_y03a3_7"><span>⌘</span><span>K</span></div></div></div><div class="_rightNav_1ic07_42"><div class="menu"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article-set</a></div><div text="sm" font="medium" m="x-3" class="text-brand"><a class="_link_r3fql_1 " target="" cursor="pointer">Chrome</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Design-pattern</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Open-source</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Promise</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Typescript</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Webpack</a></div></div><div class="appearance" before="menu-item-before" display="none sm:flex" items-center="center"><button class="_switch_1tqe3_1 undefined" id="" type="button" role="switch"><span class="_check_1tqe3_17"><span class="_icon_1tqe3_34"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_sun_8e60k_1"><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_moon_8e60k_5"><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg></span></span></button></div></div><button class=" _navHamburger_14nz8_1"><span class="_container_14nz8_14"><span class="_top_14nz8_21"></span><span class="_middle_14nz8_27"></span><span class="_bottom_14nz8_33"></span></span></button><div class="_navScreen_1mkpq_1 " id="navScreen"><div class="_container_1mkpq_21"><div class="_navMenu_1mkpq_27"><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article-set</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class="text-brand"><a class="_link_r3fql_1 " target="" cursor="pointer">Chrome</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Design-pattern</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Open-source</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Promise</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Typescript</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Webpack</a></div></div></div><div class="_socialAndAppearance_1mkpq_50" flex="~" justify="center" items-center="center"><div class="items-center appearance pa-2 _navAppearance_1mkpq_46" flex="~" justify="center"><button class="_switch_1tqe3_1 undefined" id="" type="button" role="switch"><span class="_check_1tqe3_17"><span class="_icon_1tqe3_34"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_sun_8e60k_1"><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_moon_8e60k_5"><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg></span></span></button></div></div></div></div></div></div></div></header><section style="padding-top:var(--island-nav-height)"><div p="t-0 x-6 b-24 sm:6" class="_docLayout_5cssi_8"><div class="_localNav_ncerp_1"><button flex="center" class="_menu_ncerp_16"><div text="md" mr="2" class="i-carbon:menu"></div><span text="md ">Menu</span></button></div><aside class="_sidebar_iav29_1 "><nav><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">Chrome</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:28px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">以用户为中心的效果指标</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">浏览器工作原理</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:168px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Web 浏览器如何逐步工作 — 高级体系结构（第 1 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Web 浏览器如何逐步工作 — 导航阶段（第 2 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">浏览器如何逐步工作 — 渲染阶段（第 3 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">浏览器如何逐步工作 — 加载阶段的优化（第 4 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">浏览器如何一步一步地工作 — 交互阶段的优化（第 5 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">什么强制了重排/回流</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">Html</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:84px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Metadata</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">html</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer"># 文档结构</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">关键指标</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:84px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">First Contentful Paint (FCP) 首次内容绘制</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Largest Contentful Paint (LCP) 最大内容填充</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Time to First Byte (TTFB) 首次字节加载时间</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">现代网络浏览器内幕</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:112px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-brand"><a class="_link_r3fql_1 " target="" cursor="pointer">现代网络浏览器内幕 — 1</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">现代网络浏览器内幕 — 2</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">现代网络浏览器内幕 — 3</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">现代网络浏览器内幕 — 4</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">性能</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:224px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">1. Welcome to Lean performance</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">2. 一般 HTML 性能注意事项</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">使用导航定时和资源定时评估现场的负载性能</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">优化长任务</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">optimize-resource-loading 优化资源负载</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">通过摇树减少 JavaScript 有效负载</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">asdf</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">速度为什么重要</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">性能技巧</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:476px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Web 上的多进程：浏览器进程模型</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Browser Rendering Pipeline</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">通过火焰图找到有问题的代码</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">如何收集 Web 性能跟踪</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">事件循环基础知识</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">深度讲解火焰图 🔥🔥</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">长任务：它们是什么以及为什么应该避免它们</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">performance 查看主线程（颜色含义）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">检测浏览器何时在 JavaScript 中绘制Frame</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">如何阅读 Chromium Profiler</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">使用 Chromium 网络标签页获取性能详情</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">使用性能时序标记进行📏测量</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Chromium F12 性能分析器的基本概述</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">【--空文件--】: performance/tips/resource-size-vs-transfer-size.md</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">如何阅读火焰图 🔥</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">识别 Web 应用中的未压缩资源</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">asdfadsasdsdfasdf</a></div></div></div></div></section></nav></aside><div flex="~ 1 shrink-0" m="x-auto" class="_content_5cssi_2"><div m="x-auto" flex="~ col" class="max-w-100%"><div relative="~" m="x-auto" p="l-2" class="w-100% md:max-w-712px lg:min-w-640px "><div class="island-doc "><!--$--><h1 id="现代网络浏览器内幕--1"><a class="header-anchor" aria-hidden="true" href="#现代网络浏览器内幕--1">#</a>现代网络浏览器内幕 — 1</h1>
<p><code>metadata:</code></p>
<p><strong>原标题:</strong> Inside look at modern web browser (part 1)</p>
<p><strong>链接:</strong> <a href="https://developer.chrome.com/blog/inside-browser-part1/" target="_blank" rel="nofollow">https://developer.chrome.com/blog/inside-browser-part1/</a></p>
<hr/>
<h2 id="cpu-gpu-memory-and-multi-process-architecture-中央处理器图形处理器内存和多进程架构"><a class="header-anchor" aria-hidden="true" href="#cpu-gpu-memory-and-multi-process-architecture-中央处理器图形处理器内存和多进程架构">#</a>CPU, GPU, Memory, and multi-process architecture (中央处理器、图形处理器、内存和多进程架构)</h2>
<p>在这个由 4 部分组成的博客系列中，我们将深入了解 Chrome 浏览器，从高级架构到渲染管道的具体细节。如果您曾想知道浏览器是如何将您的代码转化为功能性网站的，或者您不清楚为什么建议使用特定技术来提高性能，那么本系列就是为您量身打造的。</p>
<p>作为本系列的第一部分，我们将介绍核心计算术语和 Chrome 浏览器的多进程架构。</p>
<h2 id="计算机的核心是-cpu-和-gpu"><a class="header-anchor" aria-hidden="true" href="#计算机的核心是-cpu-和-gpu">#</a>计算机的核心是 CPU 和 GPU</h2>
<p>为了了解浏览器的运行环境，我们需要了解一些计算机部件及其作用。</p>
<h3 id="cup"><a class="header-anchor" aria-hidden="true" href="#cup">#</a>CUP</h3>
<p>首先是中央处理器，简称 CPU(<strong>C</strong>entral <strong>P</strong>rocessing <strong>U</strong>nit)。中央处理器可以说是电脑的大脑。图中的 CPU 核心是一名办公室工作人员，它可以逐一处理许多不同的任务。它可以处理从数学到艺术的所有任务，同时知道如何回复客户来电。过去，大多数 CPU 都是一个芯片。一个内核就像住在同一芯片中的另一个 CPU。而在现代硬件中，通常会有一个以上的内核，为手机和笔记本电脑提供更强的计算能力。</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231112194004.png" alt="20231112194004"/>
<em>图 1：4 个 CPU 内核就像坐在每张办公桌前的办公人员，随时处理送来的任务</em></p>
<h3 id="gpu"><a class="header-anchor" aria-hidden="true" href="#gpu">#</a>GPU</h3>
<p>图形处理单元GPU(<strong>G</strong>raphics <strong>P</strong>rocessing <strong>U</strong>nit)是计算机的另一部分。与CPU不同，GPU擅长处理简单的任务，但同时跨越多个内核。顾名思义，它最初是为了处理图形而开发的。这就是为什么在图形的上下文中，“使用GPU”或“GPU支持”与快速渲染和流畅交互相关联。近年来，随着GPU加速计算，越来越多的计算仅在GPU上成为可能。</p>
<p>当您在计算机或手机上启动应用程序时，CPU和GPU是为应用程序提供动力的。通常，应用程序使用操作系统提供的机制在CPU和GPU上运行。</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231112194439.png" alt="20231112194439"/>
<em>图 2：许多 GPU 内核的扳手表明它们只能处理有限的任务</em></p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231112194621.png" alt="20231112194621"/>
<em><strong>图 3：计算机架构的三个层次。机器硬件在底部，操作系统在中间，应用程序在顶部。</strong></em></p>
<h2 id="executing-program-on-process-and-thread-在进程和线程上执行程序"><a class="header-anchor" aria-hidden="true" href="#executing-program-on-process-and-thread-在进程和线程上执行程序">#</a>Executing program on Process and Thread (在进程和线程上执行程序)</h2>
<p>在深入研究浏览器架构之前，还需要掌握另一个概念，那就是进程（Process）和线程（Thread）。进程可以描述为应用程序的执行程序。线程则是住在进程中并执行其进程程序任何部分的程序。</p>
<p>启动应用程序时，会创建一个进程。程序可能会创建线程来帮助它工作，但这是可选的。操作系统会为进程提供一个内存 &quot;板块&quot;，所有应用程序的状态都保存在这个私有内存空间中。关闭程序时，进程也会消失，操作系统会释放内存。</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231112200931.png" alt="20231112200931"/>
<em>图 4：进程是一个边界框，线程是进程内游动的抽象鱼类</em></p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231112201013.png" alt="20231112201013"/>
<em>图 5：使用内存空间和存储应用程序数据的进程示意图</em></p>
<p>一个进程可以要求操作系统启动另一个进程来运行不同的任务。此时，内存的不同部分将分配给新进程。如果两个进程需要对话，它们可以通过使用进程间通信（IPC）来实现。许多应用程序都是这样设计的，这样如果一个工作进程没有响应，就可以重新启动它，而无需停止其他运行中的其他进程。</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231112201428.png" alt="20231112201428"/>
<em>图 6：通过 IPC 进行通信的独立进程示意图</em></p>
<h2 id="browser-architecture"><a class="header-anchor" aria-hidden="true" href="#browser-architecture">#</a>Browser Architecture</h2>
<p>那么，网络浏览器是如何使用进程和线程构建的呢？可以是一个进程包含多个不同的线程，也可以是多个不同的进程包含几个线程，通过 IPC 进行通信。</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231112201541.png" alt="20231112201541"/>
<em>图 7：进程/线程图中的不同浏览器架构</em></p>
<p>这里需要注意的是，这些不同的架构都是实施细节。目前还没有关于如何构建网络浏览器的标准规范。一个浏览器的方法可能与另一个完全不同。</p>
<p>在本系列博客中，我们将使用下图中描述的 Chrome 浏览器最新架构。</p>
<p>顶部是浏览器进程，与负责应用程序不同部分的其他进程进行协调。对于渲染器进程(renderer process)，会创建多个进程并将其分配给每个选项卡。直到最近，Chrome 还在可能的情况下为每个选项卡提供了一个进程。现在，它尝试为每个站点提供自己的进程，包括 iframe（请参阅站点隔离）。</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231112201925.png" alt="20231112201925"/>
<em>图 8：Chrome 浏览器的多进程架构图。渲染器进程下显示了多个图层，代表 Chrome 浏览器为每个标签页运行多个渲染器进程。</em></p>
<h2 id="which-process-controls-what-哪个程序控制什么"><a class="header-anchor" aria-hidden="true" href="#which-process-controls-what-哪个程序控制什么">#</a>Which process controls what? (哪个程序控制什么？)</h2>
<p>下表介绍了 Chrome 浏览器的每个程序及其控制内容：</p>
<p><strong>Process and What it controls</strong>:</p>
<table><thead><tr><th>Process</th><th>Description</th></tr></thead><tbody><tr><td>Browser</td><td>Controls &quot;chrome&quot; part of the application including address bar, bookmarks, back and forward buttons.  Also handles the invisible, privileged parts of a web browser such as network requests and file access.</td></tr><tr><td>Renderer</td><td>Controls anything inside of the tab where a website is displayed.</td></tr><tr><td>Plugin</td><td>Controls any plugins used by the website, for example, flash.</td></tr><tr><td>GPU</td><td>Handles GPU tasks in isolation from other processes. It is separated into different process because GPUs handles requests from multiple apps and draw them in the same surface.(处理与其他进程隔离的 GPU 任务。它被分离成不同的进程，因为 GPU 会处理来自多个应用程序的请求，并在同一表面绘制它们。)</td></tr></tbody></table>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231112204145.png" alt="20231112204145"/>
<em>图 9：指向浏览器用户界面不同部分的不同进程</em></p>
<p>There are even more processes like the Extension process and utility processes. If you want to see how many processes are running in your Chrome, click the options menu icon more_vert at the top right corner, select More Tools, then select Task Manager. This opens up a window with a list of processes that are currently running and how much CPU/Memory they are using.</p>
<h2 id="the-benefit-of-multi-process-architecture-in-chrome多进程架构在-chrome-浏览器中的优势"><a class="header-anchor" aria-hidden="true" href="#the-benefit-of-multi-process-architecture-in-chrome多进程架构在-chrome-浏览器中的优势">#</a>The benefit of multi-process architecture in Chrome(多进程架构在 Chrome 浏览器中的优势)</h2>
<p>前面我提到 Chrome 浏览器使用了多个渲染器进程。在最简单的情况下，你可以想象每个标签页都有自己的渲染器进程。假设你打开了 3 个标签页，每个标签页都由一个独立的渲染器进程运行。如果有一个标签页没有响应，那么你可以关闭没有响应的标签页，然后继续打开其他标签页。如果所有标签页都在一个进程上运行，当一个标签页无响应时，所有标签页都会无响应。这太可悲了。</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231112205211.png" alt="20231112205211"/>
<em>图 10：显示每个选项卡运行多个进程的示意图</em></p>
<p>将浏览器的工作分离成多个进程的另一个好处是安全性和沙盒。由于操作系统提供了限制进程权限的方法，因此浏览器可以对某些进程的某些功能进行沙箱化。例如，Chrome 浏览器会限制处理任意用户输入的进程（如渲染器进程）的任意文件访问权限。</p>
<p>由于进程拥有自己的私有内存空间，因此它们通常包含通用基础架构的副本（如 Chrome 浏览器的 JavaScript 引擎 V8）。这意味着内存使用量会增加，因为它们无法像同一进程内的线程那样共享。为了节省内存，Chrome 浏览器会限制进程的数量。该限制根据设备的内存和 CPU 容量而有所不同，但当 Chrome 浏览器达到限制时，它就会开始在一个进程中运行来自同一网站的多个标签页。</p>
<h2 id="saving-more-memory---servicification-in-chrome-节省更多内存---chrome-浏览器中的服务化功能"><a class="header-anchor" aria-hidden="true" href="#saving-more-memory---servicification-in-chrome-节省更多内存---chrome-浏览器中的服务化功能">#</a>Saving more memory - Servicification in Chrome (节省更多内存 - Chrome 浏览器中的服务化功能)</h2>
<p>同样的方法也适用于浏览器进程。Chrome 浏览器正在进行架构调整，以便将浏览器程序的每个部分作为服务运行，从而可以轻松拆分为不同的进程或合并为一个进程。</p>
<p>总体思路是，当 Chrome 浏览器运行在功能强大的硬件上时，它可以将每个服务拆分为不同的进程，从而提高稳定性；但如果运行在资源有限的设备上，Chrome 浏览器则会将服务合并为一个进程，以节省内存占用。类似的合并进程以减少内存使用量的方法，在这一改变之前已经在安卓等平台上使用过。</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231112205935.png" alt="20231112205935"/>
<em>图 11：Chrome 浏览器的服务化示意图，将不同服务移入多个进程和单一浏览器进程中</em></p>
<h2 id="per-frame-renderer-processes---site-isolation-每帧渲染器进程---站点隔离"><a class="header-anchor" aria-hidden="true" href="#per-frame-renderer-processes---site-isolation-每帧渲染器进程---站点隔离">#</a>Per-frame renderer processes - Site Isolation (每帧渲染器进程 - 站点隔离)</h2>
<p>站点隔离（<a href="https://developers.google.com//web/updates/2018/07/site-isolation" target="_blank" rel="nofollow">Site Isolation</a>）是 Chrome 浏览器最近推出的一项功能，可为每个跨站 iframe 运行单独的渲染器进程。我们一直在讨论每个标签页一个渲染器进程的模式，这种模式允许跨站 iframe 在一个渲染器进程中运行，不同网站共享内存空间。在同一个渲染器进程中运行 a.com 和 b.com 看起来似乎没什么问题。<a href="https://developer.mozilla.org/docs/Web/Security/Same-origin_policy" target="_blank" rel="nofollow">同源策略</a>是网络的核心安全模式；它确保一个网站在未经同意的情况下不能访问其他网站的数据。绕过这一策略是安全攻击的主要目标。进程隔离是分离网站的最有效方法。随着 <a href="https://developers.google.com/web/updates/2018/02/meltdown-spectre" target="_blank" rel="nofollow">Meltdown 和 Spectre</a> 的出现，我们需要使用进程隔离网站的必要性变得更加明显。自 Chrome 浏览器 67 在桌面上默认启用 &quot;站点隔离 &quot;后，标签页中的每个跨站 iframe 都会获得一个独立的渲染器进程。</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231112210406.png" alt="20231112210406"/>
<em>图 12：站点隔离示意图；站点内指向 iframe 的多个渲染器进程</em></p>
<p>启用站点隔离是一项多年的工程工作。站点隔离并不像分配不同的渲染器进程那么简单；它从根本上改变了 iframe 相互通信的方式。在页面上打开 devtools，并且 iframe 在不同进程上运行，这意味着 devtools 必须实现幕后工作才能使其看起来无缝。即使运行简单的 Ctrl+F 在页面中查找单词也意味着在不同的渲染器进程中进行搜索。您可以看到为什么浏览器工程师将站点隔离的发布视为一个重大里程碑！</p>
<h2 id="wrap-up"><a class="header-anchor" aria-hidden="true" href="#wrap-up">#</a>Wrap-up</h2>
<p>在这篇文章中，我们介绍了浏览器架构的高级视图，并介绍了多进程架构的优势。我们还介绍了 Chrome 浏览器中与多进程架构密切相关的服务化和站点隔离。在下一篇文章中，我们将开始深入探讨这些进程和线程之间为显示网站而发生的事情。</p><!--/$--></div><footer mt="8"><div class="xs:flex" p="b-5" justify="between" items-center="~"><div flex="" text="sm text-2" leading-6="~" leading-8="sm:~" font-medium=""><p>Last Updated: </p><span>2023/11/13 00:40:11</span></div></div><div flex="~ col sm:row" justify="sm:around" gap="2" divider-top="" pt="6"><div flex="~ col" class="_prev_1f77m_13"><a href="/chrome/metrics/TTFB" class="_pager-link_1f77m_20"><span class="_desc_1f77m_43">Previous Page</span><span class="_title_1f77m_34">Time to First Byte (TTFB) 首次字节加载时间</span></a></div><div flex="~ col" class="_next_1f77m_16"><a href="/chrome/modern-web-browser/inside-browser-part-2" class="_pager-link_1f77m_20 _next_1f77m_16"><span class="_desc_1f77m_43">Next page</span><span class="_title_1f77m_34">现代网络浏览器内幕 — 2</span></a></div></div></footer></div></div><div relative="~" display="none lg:block" order="2" flex="1" p="l-8" class="max-w-256px"><div class="_aside-container_5cssi_32"><div flex="~ col" p="b-8" style="min-height:calc(100vh - (var(--island-nav-height-desktop) + 32px))"><div><div flex="~ col 1"><div display="lg:block"><div relative="" divider-left="" p="l-4" text="13px" font-medium="" id="aside-container"><div absolute="" pos="top-33px" opacity="0" w="1px" h="18px" bg="brand" style="left:-1px;transition:top 0.25s cubic-bezier(0, 1, 0.5, 1), background-color 0.5s, opacity 0.25s" id="aside-marker"></div><div block="~" leading-7="" text="13px" font="semibold">目录</div><nav><ul relative=""><li><a href="#cpu-gpu-memory-and-multi-process-architecture-中央处理器图形处理器内存和多进程架构" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">CPU, GPU, Memory, and multi-process architecture (中央处理器、图形处理器、内存和多进程架构)</a></li><li><a href="#计算机的核心是-cpu-和-gpu" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">计算机的核心是 CPU 和 GPU</a></li><li><a href="#cup" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">CUP</a></li><li><a href="#gpu" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">GPU</a></li><li><a href="#executing-program-on-process-and-thread-在进程和线程上执行程序" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Executing program on Process and Thread (在进程和线程上执行程序)</a></li><li><a href="#browser-architecture" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Browser Architecture</a></li><li><a href="#which-process-controls-what-哪个程序控制什么" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Which process controls what? (哪个程序控制什么？)</a></li><li><a href="#the-benefit-of-multi-process-architecture-in-chrome多进程架构在-chrome-浏览器中的优势" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">The benefit of multi-process architecture in Chrome(多进程架构在 Chrome 浏览器中的优势)</a></li><li><a href="#saving-more-memory---servicification-in-chrome-节省更多内存---chrome-浏览器中的服务化功能" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Saving more memory - Servicification in Chrome (节省更多内存 - Chrome 浏览器中的服务化功能)</a></li><li><a href="#per-frame-renderer-processes---site-isolation-每帧渲染器进程---站点隔离" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Per-frame renderer processes - Site Isolation (每帧渲染器进程 - 站点隔离)</a></li><li><a href="#wrap-up" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Wrap-up</a></li></ul></nav></div></div></div></div></div></div></div></div></div></section></div></div>
      <script>window.ISLAND_PAGE_DATA={"siteData":{"lang":"en-US","title":"beka的博客","description":"Island","themeConfig":{"lastUpdatedText":"上次更新","outlineTitle":"目录","nav":[{"text":"Article","link":"/article/astro","activeMatch":"/article/"},{"text":"Article-set","link":"/article-set/URL-SET","activeMatch":"/article-set/"},{"text":"Chrome","link":"/chrome/fast-load-time/user-centric-performance-metrics","activeMatch":"/chrome/"},{"text":"Design-pattern","link":"/design-pattern/indexs","activeMatch":"/design-pattern/"},{"text":"Open-source","link":"/open-source/delay","activeMatch":"/open-source/"},{"text":"Promise","link":"/promise/first-resolved","activeMatch":"/promise/"},{"text":"Typescript","link":"/typescript/tip","activeMatch":"/typescript/"},{"text":"Webpack","link":"/webpack/build-result","activeMatch":"/webpack/"}],"sidebar":{"article":[{"text":"Article","items":[{"text":"Astro","link":"/article/astro"},{"text":"新一代全栈框架 Fresh","link":"/article/fresh"}],"collapsable":true}],"article-set":[{"text":"Article-set","items":[{"text":"外链合集","link":"/article-set/URL-SET"},{"text":"requestAnimationFrame","link":"/article-set/raf"}],"collapsable":true}],"chrome":[{"text":"Chrome","items":[{"text":"以用户为中心的效果指标","link":"/chrome/fast-load-time/user-centric-performance-metrics"}],"collapsable":true},{"text":"浏览器工作原理","items":[{"text":"Web 浏览器如何逐步工作 — 高级体系结构（第 1 部分）","link":"/chrome/how-web-browser-works/part-1_high-level-architecture"},{"text":"Web 浏览器如何逐步工作 — 导航阶段（第 2 部分）","link":"/chrome/how-web-browser-works/part-2_navigation-phase"},{"text":"浏览器如何逐步工作 — 渲染阶段（第 3 部分）","link":"/chrome/how-web-browser-works/part-3_rendering-phase"},{"text":"浏览器如何逐步工作 — 加载阶段的优化（第 4 部分）","link":"/chrome/how-web-browser-works/part-4_optimization-in-the-loading-stage"},{"text":"浏览器如何一步一步地工作 — 交互阶段的优化（第 5 部分）","link":"/chrome/how-web-browser-works/part-5_optimization-in-the-interaction-stage"},{"text":"什么强制了重排/回流","link":"/chrome/how-web-browser-works/what-forces-layout-reflow"}],"collapsable":true},{"text":"Html","items":[{"text":"Metadata","link":"/chrome/html/metadata"},{"text":"html","link":"/chrome/html/overview"},{"text":"# 文档结构","link":"/chrome/html/structure"}],"collapsable":true},{"text":"关键指标","items":[{"text":"First Contentful Paint (FCP) 首次内容绘制","link":"/chrome/metrics/FCP"},{"text":"Largest Contentful Paint (LCP) 最大内容填充","link":"/chrome/metrics/LCP"},{"text":"Time to First Byte (TTFB) 首次字节加载时间","link":"/chrome/metrics/TTFB"}],"collapsable":true},{"text":"现代网络浏览器内幕","items":[{"text":"现代网络浏览器内幕 — 1","link":"/chrome/modern-web-browser/inside-browser-part-1"},{"text":"现代网络浏览器内幕 — 2","link":"/chrome/modern-web-browser/inside-browser-part-2"},{"text":"现代网络浏览器内幕 — 3","link":"/chrome/modern-web-browser/inside-browser-part-3"},{"text":"现代网络浏览器内幕 — 4","link":"/chrome/modern-web-browser/inside-browser-part-4"}],"collapsable":true},{"text":"性能","items":[{"text":"1. Welcome to Lean performance","link":"/chrome/performance/1-welcome"},{"text":"2. 一般 HTML 性能注意事项","link":"/chrome/performance/2-general-html-performance"},{"text":"使用导航定时和资源定时评估现场的负载性能","link":"/chrome/performance/navigation-and-resource-timing"},{"text":"优化长任务","link":"/chrome/performance/optimize-long-tasks"},{"text":"optimize-resource-loading 优化资源负载","link":"/chrome/performance/optimize-resource-loading"},{"text":"通过摇树减少 JavaScript 有效负载","link":"/chrome/performance/reduce-javascript-payloads-with-tree-shaking"},{"text":"asdf","link":"/chrome/performance/welcome-copy"},{"text":"速度为什么重要","link":"/chrome/performance/why-speed-matters"}],"collapsable":true},{"text":"性能技巧","items":[{"text":"Web 上的多进程：浏览器进程模型","link":"/chrome/performance/tips/browser-process-model"},{"text":"Browser Rendering Pipeline","link":"/chrome/performance/tips/browser-rendering-pipeline"},{"text":"通过火焰图找到有问题的代码","link":"/chrome/performance/tips/codepath-scoping"},{"text":"如何收集 Web 性能跟踪","link":"/chrome/performance/tips/collect-a-trace"},{"text":"事件循环基础知识","link":"/chrome/performance/tips/event-loop"},{"text":"深度讲解火焰图 🔥🔥","link":"/chrome/performance/tips/flamegraphs-in-depth"},{"text":"长任务：它们是什么以及为什么应该避免它们","link":"/chrome/performance/tips/long-tasks"},{"text":"performance 查看主线程（颜色含义）","link":"/chrome/performance/tips/main-profiler-pane"},{"text":"检测浏览器何时在 JavaScript 中绘制Frame","link":"/chrome/performance/tips/measuring-paint-time"},{"text":"如何阅读 Chromium Profiler","link":"/chrome/performance/tips/network-profiler-pane"},{"text":"使用 Chromium 网络标签页获取性能详情","link":"/chrome/performance/tips/network-tab"},{"text":"使用性能时序标记进行📏测量","link":"/chrome/performance/tips/performance-timing-markers"},{"text":"Chromium F12 性能分析器的基本概述","link":"/chrome/performance/tips/profiler-basic-ui"},{"text":"【--空文件--】: performance/tips/resource-size-vs-transfer-size.md","link":"/chrome/performance/tips/resource-size-vs-transfer-size"},{"text":"如何阅读火焰图 🔥","link":"/chrome/performance/tips/understanding-flamegraphs"},{"text":"识别 Web 应用中的未压缩资源","link":"/chrome/performance/tips/validating-compression"},{"text":"asdfadsasdsdfasdf","link":"/chrome/performance/tips/aa/a"}],"collapsable":true}],"design-pattern":[{"text":"Design-pattern","items":[{"text":"# 资源列表","link":"/design-pattern/indexs"},{"text":"代理模式","link":"/design-pattern/proxy-pattern"},{"text":"Singleton Pattern","link":"/design-pattern/singleton-pattern"},{"text":"状态模式","link":"/design-pattern/state-pattern"},{"text":"策略模式","link":"/design-pattern/strategy-pattern"}],"collapsable":true}],"open-source":[{"text":"Open-source","items":[{"text":"delay","link":"/open-source/delay"},{"text":"dot-prop","link":"/open-source/dot-prop"},{"text":"glob-to-regexp","link":"/open-source/glob-to-regexp"},{"text":"koa 洋葱模型","link":"/open-source/koa-compose"},{"text":"quick-lru","link":"/open-source/lru-cache"},{"text":"p-defer","link":"/open-source/p-defer"},{"text":"p-lazy","link":"/open-source/p-lazy"},{"text":"p-limit","link":"/open-source/p-limit"},{"text":"p-locate","link":"/open-source/p-locate"},{"text":"p-settle","link":"/open-source/p-settle"},{"text":"yocto-queue","link":"/open-source/yocto-queue"}],"collapsable":true}],"promise":[{"text":"Promise","items":[{"text":"顺序执行任务直到第一个resolved。","link":"/promise/first-resolved"},{"text":"reduce实现多个promise顺序执行.","link":"/promise/sequential-execution"}],"collapsable":true}],"typescript":[{"text":"Typescript","items":[{"text":"Typescript 技巧","link":"/typescript/tip"}],"collapsable":true}],"webpack":[{"text":"Webpack","items":[{"text":"webpack 打包代码分析","link":"/webpack/build-result"},{"text":"mini-webpack","link":"/webpack/mini-webpack"},{"text":"minipack-explain","link":"/webpack/minipack"},{"text":"tapable","link":"/webpack/tapable"}],"collapsable":true}]},"footer":{"message":"Released under the MIT License.","copyright":"Copyright © 2022-present Beka"}},"head":[["script",{"id":"check-dark-light"},"\n        ;(() => {\n          const saved = localStorage.getItem('island-theme-appearance')\n          const prefereDark = window.matchMedia('(prefers-color-scheme: dark)').matches\n          if (!saved || saved === 'auto' ? prefereDark : saved === 'dark') {\n            document.documentElement.classList.add('dark')\n          }\n        })()\n      "]],"base":"","icon":"","root":"/Users/beka/Desktop/code/bekacodechn.github.io/blog","appearance":true},"pagePath":"/Users/beka/Desktop/code/bekacodechn.github.io/blog/chrome/modern-web-browser/inside-browser-part-1.md","relativePagePath":"chrome/modern-web-browser/inside-browser-part-1.md","toc":[{"id":"cpu-gpu-memory-and-multi-process-architecture-中央处理器图形处理器内存和多进程架构","text":"CPU, GPU, Memory, and multi-process architecture (中央处理器、图形处理器、内存和多进程架构)","depth":2},{"id":"计算机的核心是-cpu-和-gpu","text":"计算机的核心是 CPU 和 GPU","depth":2},{"id":"cup","text":"CUP","depth":3},{"id":"gpu","text":"GPU","depth":3},{"id":"executing-program-on-process-and-thread-在进程和线程上执行程序","text":"Executing program on Process and Thread (在进程和线程上执行程序)","depth":2},{"id":"browser-architecture","text":"Browser Architecture","depth":2},{"id":"which-process-controls-what-哪个程序控制什么","text":"Which process controls what? (哪个程序控制什么？)","depth":2},{"id":"the-benefit-of-multi-process-architecture-in-chrome多进程架构在-chrome-浏览器中的优势","text":"The benefit of multi-process architecture in Chrome(多进程架构在 Chrome 浏览器中的优势)","depth":2},{"id":"saving-more-memory---servicification-in-chrome-节省更多内存---chrome-浏览器中的服务化功能","text":"Saving more memory - Servicification in Chrome (节省更多内存 - Chrome 浏览器中的服务化功能)","depth":2},{"id":"per-frame-renderer-processes---site-isolation-每帧渲染器进程---站点隔离","text":"Per-frame renderer processes - Site Isolation (每帧渲染器进程 - 站点隔离)","depth":2},{"id":"wrap-up","text":"Wrap-up","depth":2}],"title":"现代网络浏览器内幕 — 1","lastUpdatedTime":"2023/11/13 00:40:11","content":"# 现代网络浏览器内幕 — 1\n\n`metadata:`\n\n**原标题:** Inside look at modern web browser (part 1)\n\n**链接:** https://developer.chrome.com/blog/inside-browser-part1/\n\n---\n\n##  CPU, GPU, Memory, and multi-process architecture (中央处理器、图形处理器、内存和多进程架构)\n\n在这个由 4 部分组成的博客系列中，我们将深入了解 Chrome 浏览器，从高级架构到渲染管道的具体细节。如果您曾想知道浏览器是如何将您的代码转化为功能性网站的，或者您不清楚为什么建议使用特定技术来提高性能，那么本系列就是为您量身打造的。\n\n作为本系列的第一部分，我们将介绍核心计算术语和 Chrome 浏览器的多进程架构。\n\n## 计算机的核心是 CPU 和 GPU\n\n为了了解浏览器的运行环境，我们需要了解一些计算机部件及其作用。\n\n### CUP\n\n首先是中央处理器，简称 CPU(**C**entral **P**rocessing **U**nit)。中央处理器可以说是电脑的大脑。图中的 CPU 核心是一名办公室工作人员，它可以逐一处理许多不同的任务。它可以处理从数学到艺术的所有任务，同时知道如何回复客户来电。过去，大多数 CPU 都是一个芯片。一个内核就像住在同一芯片中的另一个 CPU。而在现代硬件中，通常会有一个以上的内核，为手机和笔记本电脑提供更强的计算能力。\n\n![20231112194004](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231112194004.png)\n*图 1：4 个 CPU 内核就像坐在每张办公桌前的办公人员，随时处理送来的任务*\n\n### GPU\n\n图形处理单元GPU(**G**raphics **P**rocessing **U**nit)是计算机的另一部分。与CPU不同，GPU擅长处理简单的任务，但同时跨越多个内核。顾名思义，它最初是为了处理图形而开发的。这就是为什么在图形的上下文中，“使用GPU”或“GPU支持”与快速渲染和流畅交互相关联。近年来，随着GPU加速计算，越来越多的计算仅在GPU上成为可能。\n\n当您在计算机或手机上启动应用程序时，CPU和GPU是为应用程序提供动力的。通常，应用程序使用操作系统提供的机制在CPU和GPU上运行。\n\n![20231112194439](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231112194439.png)\n*图 2：许多 GPU 内核的扳手表明它们只能处理有限的任务*\n\n![20231112194621](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231112194621.png)\n***图 3：计算机架构的三个层次。机器硬件在底部，操作系统在中间，应用程序在顶部。***\n\n## Executing program on Process and Thread (在进程和线程上执行程序)\n\n在深入研究浏览器架构之前，还需要掌握另一个概念，那就是进程（Process）和线程（Thread）。进程可以描述为应用程序的执行程序。线程则是住在进程中并执行其进程程序任何部分的程序。\n\n启动应用程序时，会创建一个进程。程序可能会创建线程来帮助它工作，但这是可选的。操作系统会为进程提供一个内存 \"板块\"，所有应用程序的状态都保存在这个私有内存空间中。关闭程序时，进程也会消失，操作系统会释放内存。\n\n![20231112200931](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231112200931.png)\n*图 4：进程是一个边界框，线程是进程内游动的抽象鱼类*\n\n![20231112201013](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231112201013.png)\n*图 5：使用内存空间和存储应用程序数据的进程示意图*\n\n一个进程可以要求操作系统启动另一个进程来运行不同的任务。此时，内存的不同部分将分配给新进程。如果两个进程需要对话，它们可以通过使用进程间通信（IPC）来实现。许多应用程序都是这样设计的，这样如果一个工作进程没有响应，就可以重新启动它，而无需停止其他运行中的其他进程。\n\n![20231112201428](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231112201428.png)\n*图 6：通过 IPC 进行通信的独立进程示意图*\n\n## Browser Architecture\n\n那么，网络浏览器是如何使用进程和线程构建的呢？可以是一个进程包含多个不同的线程，也可以是多个不同的进程包含几个线程，通过 IPC 进行通信。\n\n![20231112201541](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231112201541.png)\n*图 7：进程/线程图中的不同浏览器架构*\n\n这里需要注意的是，这些不同的架构都是实施细节。目前还没有关于如何构建网络浏览器的标准规范。一个浏览器的方法可能与另一个完全不同。\n\n在本系列博客中，我们将使用下图中描述的 Chrome 浏览器最新架构。\n\n顶部是浏览器进程，与负责应用程序不同部分的其他进程进行协调。对于渲染器进程(renderer process)，会创建多个进程并将其分配给每个选项卡。直到最近，Chrome 还在可能的情况下为每个选项卡提供了一个进程。现在，它尝试为每个站点提供自己的进程，包括 iframe（请参阅站点隔离）。\n\n![20231112201925](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231112201925.png)\n*图 8：Chrome 浏览器的多进程架构图。渲染器进程下显示了多个图层，代表 Chrome 浏览器为每个标签页运行多个渲染器进程。*\n\n## Which process controls what? (哪个程序控制什么？)\n\n下表介绍了 Chrome 浏览器的每个程序及其控制内容：\n\n**Process and What it controls**:\n\n| Process | Description |\n| ----------- | ----------- |\n| Browser |Controls \"chrome\" part of the application including address bar, bookmarks, back and forward buttons.  Also handles the invisible, privileged parts of a web browser such as network requests and file access. |\n| Renderer | Controls anything inside of the tab where a website is displayed. |\n| Plugin | Controls any plugins used by the website, for example, flash. |\n| GPU | Handles GPU tasks in isolation from other processes. It is separated into different process because GPUs handles requests from multiple apps and draw them in the same surface.(处理与其他进程隔离的 GPU 任务。它被分离成不同的进程，因为 GPU 会处理来自多个应用程序的请求，并在同一表面绘制它们。) |\n\n![20231112204145](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231112204145.png)\n*图 9：指向浏览器用户界面不同部分的不同进程*\n\nThere are even more processes like the Extension process and utility processes. If you want to see how many processes are running in your Chrome, click the options menu icon more_vert at the top right corner, select More Tools, then select Task Manager. This opens up a window with a list of processes that are currently running and how much CPU/Memory they are using.\n\n## The benefit of multi-process architecture in Chrome(多进程架构在 Chrome 浏览器中的优势)\n\n前面我提到 Chrome 浏览器使用了多个渲染器进程。在最简单的情况下，你可以想象每个标签页都有自己的渲染器进程。假设你打开了 3 个标签页，每个标签页都由一个独立的渲染器进程运行。如果有一个标签页没有响应，那么你可以关闭没有响应的标签页，然后继续打开其他标签页。如果所有标签页都在一个进程上运行，当一个标签页无响应时，所有标签页都会无响应。这太可悲了。\n\n![20231112205211](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231112205211.png)\n*图 10：显示每个选项卡运行多个进程的示意图*\n\n将浏览器的工作分离成多个进程的另一个好处是安全性和沙盒。由于操作系统提供了限制进程权限的方法，因此浏览器可以对某些进程的某些功能进行沙箱化。例如，Chrome 浏览器会限制处理任意用户输入的进程（如渲染器进程）的任意文件访问权限。\n\n由于进程拥有自己的私有内存空间，因此它们通常包含通用基础架构的副本（如 Chrome 浏览器的 JavaScript 引擎 V8）。这意味着内存使用量会增加，因为它们无法像同一进程内的线程那样共享。为了节省内存，Chrome 浏览器会限制进程的数量。该限制根据设备的内存和 CPU 容量而有所不同，但当 Chrome 浏览器达到限制时，它就会开始在一个进程中运行来自同一网站的多个标签页。\n\n## Saving more memory - Servicification in Chrome (节省更多内存 - Chrome 浏览器中的服务化功能)\n\n同样的方法也适用于浏览器进程。Chrome 浏览器正在进行架构调整，以便将浏览器程序的每个部分作为服务运行，从而可以轻松拆分为不同的进程或合并为一个进程。\n\n总体思路是，当 Chrome 浏览器运行在功能强大的硬件上时，它可以将每个服务拆分为不同的进程，从而提高稳定性；但如果运行在资源有限的设备上，Chrome 浏览器则会将服务合并为一个进程，以节省内存占用。类似的合并进程以减少内存使用量的方法，在这一改变之前已经在安卓等平台上使用过。\n\n![20231112205935](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231112205935.png)\n*图 11：Chrome 浏览器的服务化示意图，将不同服务移入多个进程和单一浏览器进程中*\n\n## Per-frame renderer processes - Site Isolation (每帧渲染器进程 - 站点隔离)\n\n站点隔离（[Site Isolation](https://developers.google.com//web/updates/2018/07/site-isolation)）是 Chrome 浏览器最近推出的一项功能，可为每个跨站 iframe 运行单独的渲染器进程。我们一直在讨论每个标签页一个渲染器进程的模式，这种模式允许跨站 iframe 在一个渲染器进程中运行，不同网站共享内存空间。在同一个渲染器进程中运行 a.com 和 b.com 看起来似乎没什么问题。[同源策略](https://developer.mozilla.org/docs/Web/Security/Same-origin_policy)是网络的核心安全模式；它确保一个网站在未经同意的情况下不能访问其他网站的数据。绕过这一策略是安全攻击的主要目标。进程隔离是分离网站的最有效方法。随着 [Meltdown 和 Spectre](https://developers.google.com/web/updates/2018/02/meltdown-spectre) 的出现，我们需要使用进程隔离网站的必要性变得更加明显。自 Chrome 浏览器 67 在桌面上默认启用 \"站点隔离 \"后，标签页中的每个跨站 iframe 都会获得一个独立的渲染器进程。\n\n![20231112210406](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231112210406.png)\n*图 12：站点隔离示意图；站点内指向 iframe 的多个渲染器进程*\n\n启用站点隔离是一项多年的工程工作。站点隔离并不像分配不同的渲染器进程那么简单；它从根本上改变了 iframe 相互通信的方式。在页面上打开 devtools，并且 iframe 在不同进程上运行，这意味着 devtools 必须实现幕后工作才能使其看起来无缝。即使运行简单的 Ctrl+F 在页面中查找单词也意味着在不同的渲染器进程中进行搜索。您可以看到为什么浏览器工程师将站点隔离的发布视为一个重大里程碑！\n\n## Wrap-up\n\n在这篇文章中，我们介绍了浏览器架构的高级视图，并介绍了多进程架构的优势。我们还介绍了 Chrome 浏览器中与多进程架构密切相关的服务化和站点隔离。在下一篇文章中，我们将开始深入探讨这些进程和线程之间为显示网站而发生的事情。\n","pageType":"doc","routePath":"/chrome/modern-web-browser/inside-browser-part-1"};</script>
      
      <script type="module" src="/client-entry.js"></script>
    </body>
  </html>