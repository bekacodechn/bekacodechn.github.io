<!DOCTYPE html>
  <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <link rel="icon" href="" type="image/svg+xml"></link>
      <script  id="check-dark-light">
        ;(() => {
          const saved = localStorage.getItem('island-theme-appearance')
          const prefereDark = window.matchMedia('(prefers-color-scheme: dark)').matches
          if (!saved || saved === 'auto' ? prefereDark : saved === 'dark') {
            document.documentElement.classList.add('dark')
          }
        })()
      </script>
      <title data-rh="true">现代网络浏览器内幕 — 4</title>
      <meta data-rh="true" name="description" content="Island"/>
      
      
      <script defer src='https://ga.jspm.io/npm:es-module-shims@1.6.0/dist/es-module-shims.js'></script>
      <script type="importmap">
        {
          "imports": {
            "react": "/react.js","react-dom": "/react-dom.js","react-dom/client": "/react-dom_client.js","react/jsx-runtime": "/react_jsx-runtime.js"
          }
        }
      </script>

      <link rel="stylesheet" href="/assets/style.81be0ec3.css">

    </head>
    <body>
      <div id="root"><div style="height:100%"><header relative="" z="4" fixed="md:~" class="top-0 left-0" w="100%"><div relative="" p="l-8 sm:x-8" transition="background-color duration-500" class="divider-bottom md:border-b-transparent lg:border-b-transparent" nav-h="mobile lg:desktop"><div flex="" justify="between" m="0 auto" nav-h="mobile lg:desktop" class="_container_1ic07_52  _has-sidebar_1ic07_16"><div border="border t-0 b-1 border-solid transparent" class="_nav-bar-title_1ic07_16"><a href="/" w="100%" h="100%" text="1rem" font="semibold" transition="opacity duration-300" hover="opacity-60" class="flex items-center"><span>beka的博客</span></a></div><div class="_content_1ic07_24" flex="~ 1" justify="end" items-center=""><div class="search" flex="sm:1" pl="sm:8"><div flex="" items-center="~" relative="" mr="2" font="semibold"><svg width="32" height="32" viewBox="0 0 32 32" w="5" h="5" fill="currentColor"><path fill="#888888" d="m29 27.586l-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9a9.01 9.01 0 0 1-9-9Z"></path></svg><input disabled="" cursor="text focus:auto" placeholder="Search" height="8" border="none" type="text" text="sm" p="t-0 r-2 b-0 l-2" transition="all duration-200 ease" class="rounded-sm _searchInput_y03a3_1 " aria-label="Search" autoComplete="off"/><div m="r-3" w="10" h="6" p="x-1.5" rounded="md" border="1px solid gray-light-3" text="xs gray-light-3" flex="~" items-center="~" justify="around" class="_searchCommand_y03a3_7"><span>⌘</span><span>K</span></div></div></div><div class="_rightNav_1ic07_42"><div class="menu"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article-set</a></div><div text="sm" font="medium" m="x-3" class="text-brand"><a class="_link_r3fql_1 " target="" cursor="pointer">Chrome</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Design-pattern</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Open-source</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Promise</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Typescript</a></div><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Webpack</a></div></div><div class="appearance" before="menu-item-before" display="none sm:flex" items-center="center"><button class="_switch_1tqe3_1 undefined" id="" type="button" role="switch"><span class="_check_1tqe3_17"><span class="_icon_1tqe3_34"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_sun_8e60k_1"><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_moon_8e60k_5"><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg></span></span></button></div></div><button class=" _navHamburger_14nz8_1"><span class="_container_14nz8_14"><span class="_top_14nz8_21"></span><span class="_middle_14nz8_27"></span><span class="_bottom_14nz8_33"></span></span></button><div class="_navScreen_1mkpq_1 " id="navScreen"><div class="_container_1mkpq_21"><div class="_navMenu_1mkpq_27"><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Article-set</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class="text-brand"><a class="_link_r3fql_1 " target="" cursor="pointer">Chrome</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Design-pattern</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Open-source</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Promise</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Typescript</a></div></div><div w="100%" class="_navMenuItem_1mkpq_34"><div text="sm" font="medium" m="x-3" class=""><a class="_link_r3fql_1 " target="" cursor="pointer">Webpack</a></div></div></div><div class="_socialAndAppearance_1mkpq_50" flex="~" justify="center" items-center="center"><div class="items-center appearance pa-2 _navAppearance_1mkpq_46" flex="~" justify="center"><button class="_switch_1tqe3_1 undefined" id="" type="button" role="switch"><span class="_check_1tqe3_17"><span class="_icon_1tqe3_34"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_sun_8e60k_1"><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 24 24" class="_moon_8e60k_5"><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg></span></span></button></div></div></div></div></div></div></div></header><section style="padding-top:var(--island-nav-height)"><div p="t-0 x-6 b-24 sm:6" class="_docLayout_5cssi_8"><div class="_localNav_ncerp_1"><button flex="center" class="_menu_ncerp_16"><div text="md" mr="2" class="i-carbon:menu"></div><span text="md ">Menu</span></button></div><aside class="_sidebar_iav29_1 "><nav><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">Chrome</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:28px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">以用户为中心的效果指标</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">浏览器工作原理</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:168px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Web 浏览器如何逐步工作 — 高级体系结构（第 1 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Web 浏览器如何逐步工作 — 导航阶段（第 2 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">浏览器如何逐步工作 — 渲染阶段（第 3 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">浏览器如何逐步工作 — 加载阶段的优化（第 4 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">浏览器如何一步一步地工作 — 交互阶段的优化（第 5 部分）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">什么强制了重排/回流</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">Html</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:84px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Metadata</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">html</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer"># 文档结构</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">关键指标</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:84px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">First Contentful Paint (FCP) 首次内容绘制</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Largest Contentful Paint (LCP) 最大内容填充</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Time to First Byte (TTFB) 首次字节加载时间</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">现代网络浏览器内幕</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:112px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">现代网络浏览器内幕 — 1</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">现代网络浏览器内幕 — 2</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">现代网络浏览器内幕 — 3</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-brand"><a class="_link_r3fql_1 " target="" cursor="pointer">现代网络浏览器内幕 — 4</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">性能</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:224px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">1. Welcome to Lean performance</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">2. 一般 HTML 性能注意事项</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">使用导航定时和资源定时评估现场的负载性能</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">优化长任务</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">optimize-resource-loading 优化资源负载</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">通过摇树减少 JavaScript 有效负载</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">asdf</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">速度为什么重要</a></div></div></div></div></section><section block="~" not-first="divider-top mt-4"><div flex="~" justify="between" items-start="~" class="items-center"><h2 m="t-3 b-2" text="1rem text-1" font="bold">性能技巧</h2><div class="i-carbon-chevron-right" cursor-pointer="~" style="transition:transform 0.2s ease-out;transform:rotate(90deg)"></div></div><div mb="1.4 sm:1" style="transition:height 0.2s ease-out;height:476px;overflow:hidden"><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Web 上的多进程：浏览器进程模型</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Browser Rendering Pipeline</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">通过火焰图找到有问题的代码</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">如何收集 Web 性能跟踪</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">事件循环基础知识</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">深度讲解火焰图 🔥🔥</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">长任务：它们是什么以及为什么应该避免它们</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">performance 查看主线程（颜色含义）</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">检测浏览器何时在 JavaScript 中绘制Frame</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">如何阅读 Chromium Profiler</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">使用 Chromium 网络标签页获取性能详情</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">使用性能时序标记进行📏测量</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">Chromium F12 性能分析器的基本概述</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">【--空文件--】: performance/tips/resource-size-vs-transfer-size.md</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">如何阅读火焰图 🔥</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">识别 Web 应用中的未压缩资源</a></div></div></div><div><div style="margin-left:0px"><div p="1" block="~" text="sm" font-medium="~" class="text-text-2"><a class="_link_r3fql_1 " target="" cursor="pointer">asdfadsasdsdfasdf</a></div></div></div></div></section></nav></aside><div flex="~ 1 shrink-0" m="x-auto" class="_content_5cssi_2"><div m="x-auto" flex="~ col" class="max-w-100%"><div relative="~" m="x-auto" p="l-2" class="w-100% md:max-w-712px lg:min-w-640px "><div class="island-doc "><!--$--><h1 id="现代网络浏览器内幕--4"><a class="header-anchor" aria-hidden="true" href="#现代网络浏览器内幕--4">#</a>现代网络浏览器内幕 — 4</h1>
<p><code>metadata:</code></p>
<p><strong>原标题:</strong> Inside look at modern web browser (part 4)</p>
<p><strong>链接:</strong> <a href="https://developer.chrome.com/blog/inside-browser-part4/" target="_blank" rel="nofollow">https://developer.chrome.com/blog/inside-browser-part4/</a></p>
<hr/>
<h2 id="input-is-coming-to-the-compositor-输入到合成器"><a class="header-anchor" aria-hidden="true" href="#input-is-coming-to-the-compositor-输入到合成器">#</a>Input is coming to the Compositor 输入到合成器</h2>
<p>这是 Chrome 浏览器四部曲系列博客的最后一篇，探讨了 Chrome 浏览器是如何处理我们的代码以显示网站的。在上一篇文章中，我们了解了<a href="/chrome/modern-web-browser/inside-browser-part-3">渲染过程并学习了合成器</a>。在本篇博文中，我们将了解合成器如何在用户输入时实现流畅的交互。</p>
<h2 id="input-events-from-the-browsers-point-of-view-从浏览器角度看输入事件"><a class="header-anchor" aria-hidden="true" href="#input-events-from-the-browsers-point-of-view-从浏览器角度看输入事件">#</a>Input events from the browser&#x27;s point of view 从浏览器角度看输入事件</h2>
<p>当您听到 &quot;输入事件 &quot;时，您可能只会想到在文本框中打字或点击鼠标，但从浏览器的角度来看，输入意味着用户的任何手势。鼠标滚轮滚动是一个输入事件，触摸或鼠标移过也是一个输入事件。</p>
<p>当用户在屏幕上做出触摸等手势时，浏览器进程会首先接收到该手势。不过，浏览器进程只知道手势发生的位置，因为标签页内的内容是由呈现器进程处理的。因此，浏览器进程会向呈现器进程发送事件类型（如 touchstart）及其坐标。呈现器进程通过查找事件目标和运行附加的事件监听器来适当处理该事件。</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231113164433.png" alt="20231113164433"/>
<em>图 1：输入事件通过浏览器进程传递到呈现器进程</em></p>
<h2 id="compositor-receives-input-events-合成器接收输入事件"><a class="header-anchor" aria-hidden="true" href="#compositor-receives-input-events-合成器接收输入事件">#</a>Compositor receives input events 合成器接收输入事件</h2>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/202311131647540.gif?imageSlim" alt="202311131647540"/></p>
<p>在上一篇文章中，我们了解了合成器如何通过合成光栅化图层来平滑处理滚动。如果页面上没有附加输入事件侦听器，合成器线程就可以完全独立于主线程创建新的合成帧。但如果页面上有一些事件监听器呢？合成器线程如何确定事件是否需要处理？</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231113164955.png" alt="20231113164955"/>
<em>图 3：描述输入到非快速滚动区域的示意图</em></p>
<h3 id="be-aware-when-you-write-event-handlers-编写事件处理程序时要注意"><a class="header-anchor" aria-hidden="true" href="#be-aware-when-you-write-event-handlers-编写事件处理程序时要注意">#</a>Be aware when you write event handlers 编写事件处理程序时要注意</h3>
<p>网络开发中常见的事件处理模式是事件委托。由于事件会冒泡，因此可以在最顶层的元素上附加一个事件处理程序，然后根据事件目标委托任务。您可能见过或写过类似下面这样的代码。</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#D8DEE9">document</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">body</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">addEventListener</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#A3BE8C">touchstart</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">event</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=&gt;</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#81A1C1">if</span><span style="color:#D8DEE9FF"> (</span><span style="color:#D8DEE9">event</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">target</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">===</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">area</span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">        </span><span style="color:#D8DEE9">event</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">preventDefault</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#ECEFF4">}</span></span>
<span class="line"><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span></div></div>
<p>由于只需为所有元素编写一个事件处理程序，因此这种事件委托模式非常符合人体工程学。但是，如果从浏览器的角度来看这段代码，现在整个页面都被标记为不可快速滚动区域。这意味着，即使您的应用程序不关心页面某些部分的输入，合成器线程也必须与主线程通信，并在每次输入事件到来时等待主线程。这样，合成器的平滑滚动功能就无法实现了。</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231113165223.png" alt="20231113165223"/>
<em>图 4：对覆盖整个页面的非快速滚动区域的描述输入示意图</em></p>
<p>为了避免这种情况发生，您可以在事件监听器中使用 passive: true 选项。这样浏览器就会知道你仍想在主线程中监听事件，但合成器也可以继续合成新帧。</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#D8DEE9">document</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">body</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">addEventListener</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#A3BE8C">touchstart</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">event</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=&gt;</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#81A1C1">if</span><span style="color:#D8DEE9FF"> (</span><span style="color:#D8DEE9">event</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">target</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">===</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">area</span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">        </span><span style="color:#D8DEE9">event</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">preventDefault</span><span style="color:#D8DEE9FF">()</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#ECEFF4">}</span></span>
<span class="line"><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">},</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span><span style="color:#88C0D0">passive</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">true</span><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span></div></div>
<h2 id="check-if-the-event-is-cancelable-检查事件是否可取消"><a class="header-anchor" aria-hidden="true" href="#check-if-the-event-is-cancelable-检查事件是否可取消">#</a>Check if the event is cancelable 检查事件是否可取消</h2>
<p>试想一下，如果您想将页面中的一个方框的滚动方向限制为只能横向滚动，您会怎么做呢？</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231113165516.png" alt="20231113165516"/>
<em>图 5：部分页面固定为水平滚动的网页</em></p>
<p>在指针事件中使用 <code>passive: true</code> 选项意味着页面滚动可以平滑，但当您想要<code>preventDefault</code>以限制滚动方向时，垂直滚动可能已经开始。您可以使用 <code>event.cancelable</code> 方法来检查这一点</p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#D8DEE9">document</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">body</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">addEventListener</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#A3BE8C">pointermove</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">event</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=&gt;</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#81A1C1">if</span><span style="color:#D8DEE9FF"> (</span><span style="color:#D8DEE9">event</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">cancelable</span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">        </span><span style="color:#D8DEE9">event</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">preventDefault</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span><span style="color:#D8DEE9FF"> </span><span style="color:#616E88">// block the native scroll</span></span>
<span class="line"><span style="color:#D8DEE9FF">        </span><span style="color:#616E88">/*</span></span>
<span class="line"><span style="color:#616E88">        *  do what you want the application to do here</span></span>
<span class="line"><span style="color:#616E88">        */</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#ECEFF4">}</span></span>
<span class="line"><span style="color:#ECEFF4">},</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span><span style="color:#88C0D0">passive</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">true</span><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span></div></div>
<p>或者，您也可以使用 CSS 规则（如 <code>touch-action</code>）来完全消除事件处理程序。</p>
<div class="language-scss line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">scss</span><pre><code class=""><span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#ECEFF4">#</span><span style="color:#8FBCBB">area</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span><span style="color:#D8DEE9FF">  </span><span style="color:#D8DEE9">touch-action</span><span style="color:#ECEFF4">:</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">pan-x;</span><span style="color:#ECEFF4">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span></div></div>
<h2 id="finding-the-event-target"><a class="header-anchor" aria-hidden="true" href="#finding-the-event-target">#</a>Finding the event target</h2>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231113170030.png" alt="20231113170030"/>
<em>图 6：主线程查看绘制记录，询问在 x.y 点上绘制了什么。</em></p>
<p>当合成器线程将输入事件发送到主线程时，首先要运行的是找到事件目标的命中测试。命中测试使用渲染过程中生成的绘制记录数据来找出事件发生的点坐标下的内容。</p>
<div class="island-directive tip"><p class="island-directive-title">原文</p><div class="island-directive-content"><p>When the compositor thread sends an input event to the main thread, the first thing to run is a hit test to find the event target. Hit test uses paint records data that was generated in the rendering process to find out what is underneath the point coordinates in which the event occurred.</p></div></div>
<h2 id="minimizing-event-dispatches-to-the-main-thread-尽量减少主线程的事件派发"><a class="header-anchor" aria-hidden="true" href="#minimizing-event-dispatches-to-the-main-thread-尽量减少主线程的事件派发">#</a>Minimizing event dispatches to the main thread 尽量减少主线程的事件派发</h2>
<p>在上一篇文章中，我们讨论了典型显示器每秒刷新屏幕 60 次的情况，以及我们需要如何跟上节奏以实现流畅的动画效果。在输入方面，典型的触摸屏设备每秒会产生 60-120 次触摸事件，而典型的鼠标每秒会产生 100 次事件。输入事件的保真度高于我们的屏幕刷新速度。</p>
<p>如果像 <code>touchmove</code> 这样的连续事件每秒向主线程发送 120 次，那么与屏幕刷新的速度相比，可能会触发过多的命中测试(hit test)和 JavaScript 执行。</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231113170425.png" alt="20231113170425"/>
<em>Figure 7: Events flooding(洪水) the frame timeline causing page jank(事件太多导致页面卡顿)</em></p>
<p>为了尽量减少对主线程的过多调用，Chrome 浏览器会将连续事件（如<code>wheel</code>, <code>mousewheel</code>, <code>mousemove</code>, <code>pointermove</code>, <code>touchmove</code>）聚合在一起，并将分派延迟到下一个 <code>requestAnimationFrame</code> 之前。</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231113170824.png" alt="20231113170824"/>
<em>图 8：时间线与之前相同，但事件正在凝聚和延迟</em></p>
<p>任何离散事件，如<code>keydown</code>, <code>keyup</code>, <code>mouseup</code>, <code>mousedown</code>, <code>touchstart</code>, 和 <code>touchend</code>，都会立即被派发。</p>
<h2 id="usegetcoalescedeventsto-get-intra-frame-events-使用-getcoalescedevents-获取帧内事件"><a class="header-anchor" aria-hidden="true" href="#usegetcoalescedeventsto-get-intra-frame-events-使用-getcoalescedevents-获取帧内事件">#</a>Use <code>getCoalescedEvents</code> to get intra-frame events (使用 getCoalescedEvents 获取帧内事件)</h2>
<p>对于大多数网络应用程序来说，凝聚事件足以提供良好的用户体验。但是，如果您正在构建绘图应用程序并根据 <code>touchmove</code> 坐标绘制路径，您可能会丢失中间的坐标来绘制平滑的线条。在这种情况下，您可以使用指针事件中的 <code>getCoalescedEvents</code> 方法来获取有关这些聚合事件的信息。</p>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231113171116.png" alt="20231113171116"/>
<em>图 9：左侧是平滑的触摸手势路径，右侧是凝聚的有限路径</em></p>
<div class="language-js line-numbers-mode" style="background-color:#2e3440ff"><button class="copy"></button><span class="lang">js</span><pre><code class=""><span class="line"><span style="color:#D8DEE9">window</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">addEventListener</span><span style="color:#D8DEE9FF">(</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#A3BE8C">pointermove</span><span style="color:#ECEFF4">&#x27;</span><span style="color:#ECEFF4">,</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">event</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=&gt;</span><span style="color:#D8DEE9FF"> </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">events</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">event</span><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">getCoalescedEvents</span><span style="color:#D8DEE9FF">()</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#81A1C1">for</span><span style="color:#D8DEE9FF"> (</span><span style="color:#81A1C1">let</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">event</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">of</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">events</span><span style="color:#D8DEE9FF">) </span><span style="color:#ECEFF4">{</span></span>
<span class="line"><span style="color:#D8DEE9FF">        </span><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">x</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">event</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">pageX</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#D8DEE9FF">        </span><span style="color:#81A1C1">const</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">y</span><span style="color:#D8DEE9FF"> </span><span style="color:#81A1C1">=</span><span style="color:#D8DEE9FF"> </span><span style="color:#D8DEE9">event</span><span style="color:#ECEFF4">.</span><span style="color:#D8DEE9">pageY</span><span style="color:#81A1C1">;</span></span>
<span class="line"><span style="color:#ECEFF4">        </span><span style="color:#616E88">// draw a line using x and y coordinates.</span></span>
<span class="line"><span style="color:#D8DEE9FF">    </span><span style="color:#ECEFF4">}</span></span>
<span class="line"><span style="color:#ECEFF4">}</span><span style="color:#D8DEE9FF">)</span><span style="color:#81A1C1">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span></div></div>
<h2 id="next-steps"><a class="header-anchor" aria-hidden="true" href="#next-steps">#</a>Next steps</h2>
<p>在本系列中，我们介绍了网络浏览器的内部工作原理。如果您从未想过 DevTools 为什么建议在事件处理程序中添加 <code>{passive: true}</code> 或为什么要在脚本标签中写入 <code>async</code> 属性，我希望本系列能让您了解浏览器为什么需要这些信息来提供更快、更流畅的网络体验。</p>
<h3 id="use-lighthouse"><a class="header-anchor" aria-hidden="true" href="#use-lighthouse">#</a>Use Lighthouse</h3>
<p>如果你想让自己的代码对浏览器更友好，但又不知道从何下手，那么 <a href="https://developer.chrome.com/docs/lighthouse/overview/" target="_blank" rel="nofollow">Lighthouse</a> 是一款可以对任何网站进行审计的工具，它能为你提供一份报告，说明哪些做法是正确的，哪些需要改进。阅读审核列表还能让你了解浏览器关注哪些方面。</p>
<h3 id="learn-how-to-measure-performance"><a class="header-anchor" aria-hidden="true" href="#learn-how-to-measure-performance">#</a>Learn how to measure performance</h3>
<p>不同网站的性能调整可能会有所不同，因此您必须测量网站的性能并决定最适合您网站的调整。Chrome DevTools 团队有一些关于<a href="https://developers.google.com/web/tools/chrome-devtools/speed/get-started" target="_blank" rel="nofollow">如何衡量网站性能</a>的教程。</p>
<h3 id="add-feature-policy-to-your-site"><a class="header-anchor" aria-hidden="true" href="#add-feature-policy-to-your-site">#</a>Add Feature Policy to your site</h3>
<p>如果您想多走一步，<a href="https://developers.google.com/web/updates/2018/06/feature-policy" target="_blank" rel="nofollow">功能策略</a>是一项新的网络平台功能，它可以在您创建项目时为您提供保护。打开功能策略可以保证应用程序的特定行为，防止您犯错。例如，如果你想确保你的应用程序永远不会阻塞解析，你可以在同步脚本策略下运行你的应用程序。当启用 <code>sync-script：none</code> 时，会阻止阻塞解析器的 JavaScript 执行。这样，您的任何代码都不会阻塞解析器，浏览器也无需担心会暂停解析器。</p>
<h2 id="wrap-up"><a class="header-anchor" aria-hidden="true" href="#wrap-up">#</a>Wrap up</h2>
<p><img src="https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231113171720.png" alt="20231113171720"/></p>
<p>当我开始创建网站时，我几乎只关心如何编写代码以及怎样才能提高工作效率。这些都很重要，但我们还应该考虑浏<strong>览器如何使用我们编写的代码</strong>。现代浏览器已经并将继续致力于为用户提供更好的网络体验。通过组织我们的代码来善待浏览器，反过来也能改善用户体验。我希望您和我一起努力，善待浏览器！</p><!--/$--></div><footer mt="8"><div class="xs:flex" p="b-5" justify="between" items-center="~"><div flex="" text="sm text-2" leading-6="~" leading-8="sm:~" font-medium=""><p>Last Updated: </p><span>2023/11/13 20:59:38</span></div></div><div flex="~ col sm:row" justify="sm:around" gap="2" divider-top="" pt="6"><div flex="~ col" class="_prev_1f77m_13"><a href="/chrome/modern-web-browser/inside-browser-part-3" class="_pager-link_1f77m_20"><span class="_desc_1f77m_43">Previous Page</span><span class="_title_1f77m_34">现代网络浏览器内幕 — 3</span></a></div><div flex="~ col" class="_next_1f77m_16"><a href="/chrome/performance/1-welcome" class="_pager-link_1f77m_20 _next_1f77m_16"><span class="_desc_1f77m_43">Next page</span><span class="_title_1f77m_34">1. Welcome to Lean performance</span></a></div></div></footer></div></div><div relative="~" display="none lg:block" order="2" flex="1" p="l-8" class="max-w-256px"><div class="_aside-container_5cssi_32"><div flex="~ col" p="b-8" style="min-height:calc(100vh - (var(--island-nav-height-desktop) + 32px))"><div><div flex="~ col 1"><div display="lg:block"><div relative="" divider-left="" p="l-4" text="13px" font-medium="" id="aside-container"><div absolute="" pos="top-33px" opacity="0" w="1px" h="18px" bg="brand" style="left:-1px;transition:top 0.25s cubic-bezier(0, 1, 0.5, 1), background-color 0.5s, opacity 0.25s" id="aside-marker"></div><div block="~" leading-7="" text="13px" font="semibold">目录</div><nav><ul relative=""><li><a href="#input-is-coming-to-the-compositor-输入到合成器" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Input is coming to the Compositor 输入到合成器</a></li><li><a href="#input-events-from-the-browsers-point-of-view-从浏览器角度看输入事件" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Input events from the browser&#x27;s point of view 从浏览器角度看输入事件</a></li><li><a href="#compositor-receives-input-events-合成器接收输入事件" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Compositor receives input events 合成器接收输入事件</a></li><li><a href="#be-aware-when-you-write-event-handlers-编写事件处理程序时要注意" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">Be aware when you write event handlers 编写事件处理程序时要注意</a></li><li><a href="#check-if-the-event-is-cancelable-检查事件是否可取消" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Check if the event is cancelable 检查事件是否可取消</a></li><li><a href="#finding-the-event-target" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Finding the event target</a></li><li><a href="#minimizing-event-dispatches-to-the-main-thread-尽量减少主线程的事件派发" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Minimizing event dispatches to the main thread 尽量减少主线程的事件派发</a></li><li><a href="#usegetcoalescedeventsto-get-intra-frame-events-使用-getcoalescedevents-获取帧内事件" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Use getCoalescedEvents to get intra-frame events (使用 getCoalescedEvents 获取帧内事件)</a></li><li><a href="#next-steps" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Next steps</a></li><li><a href="#use-lighthouse" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">Use Lighthouse</a></li><li><a href="#learn-how-to-measure-performance" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">Learn how to measure performance</a></li><li><a href="#add-feature-policy-to-your-site" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:12px">Add Feature Policy to your site</a></li><li><a href="#wrap-up" block="" leading-7="" text="text-2" avoid-text-overflow="" hover="text-text-1" transition="color duration-300" style="padding-left:0">Wrap up</a></li></ul></nav></div></div></div></div></div></div></div></div></div></section></div></div>
      <script>window.ISLAND_PAGE_DATA={"siteData":{"lang":"en-US","title":"beka的博客","description":"Island","themeConfig":{"lastUpdatedText":"上次更新","outlineTitle":"目录","nav":[{"text":"Article","link":"/article/astro","activeMatch":"/article/"},{"text":"Article-set","link":"/article-set/URL-SET","activeMatch":"/article-set/"},{"text":"Chrome","link":"/chrome/fast-load-time/user-centric-performance-metrics","activeMatch":"/chrome/"},{"text":"Design-pattern","link":"/design-pattern/indexs","activeMatch":"/design-pattern/"},{"text":"Open-source","link":"/open-source/delay","activeMatch":"/open-source/"},{"text":"Promise","link":"/promise/first-resolved","activeMatch":"/promise/"},{"text":"Typescript","link":"/typescript/tip","activeMatch":"/typescript/"},{"text":"Webpack","link":"/webpack/build-result","activeMatch":"/webpack/"}],"sidebar":{"article":[{"text":"Article","items":[{"text":"Astro","link":"/article/astro"},{"text":"新一代全栈框架 Fresh","link":"/article/fresh"}],"collapsable":true}],"article-set":[{"text":"Article-set","items":[{"text":"外链合集","link":"/article-set/URL-SET"},{"text":"requestAnimationFrame","link":"/article-set/raf"}],"collapsable":true}],"chrome":[{"text":"Chrome","items":[{"text":"以用户为中心的效果指标","link":"/chrome/fast-load-time/user-centric-performance-metrics"}],"collapsable":true},{"text":"浏览器工作原理","items":[{"text":"Web 浏览器如何逐步工作 — 高级体系结构（第 1 部分）","link":"/chrome/how-web-browser-works/part-1_high-level-architecture"},{"text":"Web 浏览器如何逐步工作 — 导航阶段（第 2 部分）","link":"/chrome/how-web-browser-works/part-2_navigation-phase"},{"text":"浏览器如何逐步工作 — 渲染阶段（第 3 部分）","link":"/chrome/how-web-browser-works/part-3_rendering-phase"},{"text":"浏览器如何逐步工作 — 加载阶段的优化（第 4 部分）","link":"/chrome/how-web-browser-works/part-4_optimization-in-the-loading-stage"},{"text":"浏览器如何一步一步地工作 — 交互阶段的优化（第 5 部分）","link":"/chrome/how-web-browser-works/part-5_optimization-in-the-interaction-stage"},{"text":"什么强制了重排/回流","link":"/chrome/how-web-browser-works/what-forces-layout-reflow"}],"collapsable":true},{"text":"Html","items":[{"text":"Metadata","link":"/chrome/html/metadata"},{"text":"html","link":"/chrome/html/overview"},{"text":"# 文档结构","link":"/chrome/html/structure"}],"collapsable":true},{"text":"关键指标","items":[{"text":"First Contentful Paint (FCP) 首次内容绘制","link":"/chrome/metrics/FCP"},{"text":"Largest Contentful Paint (LCP) 最大内容填充","link":"/chrome/metrics/LCP"},{"text":"Time to First Byte (TTFB) 首次字节加载时间","link":"/chrome/metrics/TTFB"}],"collapsable":true},{"text":"现代网络浏览器内幕","items":[{"text":"现代网络浏览器内幕 — 1","link":"/chrome/modern-web-browser/inside-browser-part-1"},{"text":"现代网络浏览器内幕 — 2","link":"/chrome/modern-web-browser/inside-browser-part-2"},{"text":"现代网络浏览器内幕 — 3","link":"/chrome/modern-web-browser/inside-browser-part-3"},{"text":"现代网络浏览器内幕 — 4","link":"/chrome/modern-web-browser/inside-browser-part-4"}],"collapsable":true},{"text":"性能","items":[{"text":"1. Welcome to Lean performance","link":"/chrome/performance/1-welcome"},{"text":"2. 一般 HTML 性能注意事项","link":"/chrome/performance/2-general-html-performance"},{"text":"使用导航定时和资源定时评估现场的负载性能","link":"/chrome/performance/navigation-and-resource-timing"},{"text":"优化长任务","link":"/chrome/performance/optimize-long-tasks"},{"text":"optimize-resource-loading 优化资源负载","link":"/chrome/performance/optimize-resource-loading"},{"text":"通过摇树减少 JavaScript 有效负载","link":"/chrome/performance/reduce-javascript-payloads-with-tree-shaking"},{"text":"asdf","link":"/chrome/performance/welcome-copy"},{"text":"速度为什么重要","link":"/chrome/performance/why-speed-matters"}],"collapsable":true},{"text":"性能技巧","items":[{"text":"Web 上的多进程：浏览器进程模型","link":"/chrome/performance/tips/browser-process-model"},{"text":"Browser Rendering Pipeline","link":"/chrome/performance/tips/browser-rendering-pipeline"},{"text":"通过火焰图找到有问题的代码","link":"/chrome/performance/tips/codepath-scoping"},{"text":"如何收集 Web 性能跟踪","link":"/chrome/performance/tips/collect-a-trace"},{"text":"事件循环基础知识","link":"/chrome/performance/tips/event-loop"},{"text":"深度讲解火焰图 🔥🔥","link":"/chrome/performance/tips/flamegraphs-in-depth"},{"text":"长任务：它们是什么以及为什么应该避免它们","link":"/chrome/performance/tips/long-tasks"},{"text":"performance 查看主线程（颜色含义）","link":"/chrome/performance/tips/main-profiler-pane"},{"text":"检测浏览器何时在 JavaScript 中绘制Frame","link":"/chrome/performance/tips/measuring-paint-time"},{"text":"如何阅读 Chromium Profiler","link":"/chrome/performance/tips/network-profiler-pane"},{"text":"使用 Chromium 网络标签页获取性能详情","link":"/chrome/performance/tips/network-tab"},{"text":"使用性能时序标记进行📏测量","link":"/chrome/performance/tips/performance-timing-markers"},{"text":"Chromium F12 性能分析器的基本概述","link":"/chrome/performance/tips/profiler-basic-ui"},{"text":"【--空文件--】: performance/tips/resource-size-vs-transfer-size.md","link":"/chrome/performance/tips/resource-size-vs-transfer-size"},{"text":"如何阅读火焰图 🔥","link":"/chrome/performance/tips/understanding-flamegraphs"},{"text":"识别 Web 应用中的未压缩资源","link":"/chrome/performance/tips/validating-compression"},{"text":"asdfadsasdsdfasdf","link":"/chrome/performance/tips/aa/a"}],"collapsable":true}],"design-pattern":[{"text":"Design-pattern","items":[{"text":"# 资源列表","link":"/design-pattern/indexs"},{"text":"代理模式","link":"/design-pattern/proxy-pattern"},{"text":"Singleton Pattern","link":"/design-pattern/singleton-pattern"},{"text":"状态模式","link":"/design-pattern/state-pattern"},{"text":"策略模式","link":"/design-pattern/strategy-pattern"}],"collapsable":true}],"open-source":[{"text":"Open-source","items":[{"text":"delay","link":"/open-source/delay"},{"text":"dot-prop","link":"/open-source/dot-prop"},{"text":"glob-to-regexp","link":"/open-source/glob-to-regexp"},{"text":"koa 洋葱模型","link":"/open-source/koa-compose"},{"text":"quick-lru","link":"/open-source/lru-cache"},{"text":"p-defer","link":"/open-source/p-defer"},{"text":"p-lazy","link":"/open-source/p-lazy"},{"text":"p-limit","link":"/open-source/p-limit"},{"text":"p-locate","link":"/open-source/p-locate"},{"text":"p-settle","link":"/open-source/p-settle"},{"text":"yocto-queue","link":"/open-source/yocto-queue"}],"collapsable":true}],"promise":[{"text":"Promise","items":[{"text":"顺序执行任务直到第一个resolved。","link":"/promise/first-resolved"},{"text":"reduce实现多个promise顺序执行.","link":"/promise/sequential-execution"}],"collapsable":true}],"typescript":[{"text":"Typescript","items":[{"text":"Typescript 技巧","link":"/typescript/tip"}],"collapsable":true}],"webpack":[{"text":"Webpack","items":[{"text":"webpack 打包代码分析","link":"/webpack/build-result"},{"text":"mini-webpack","link":"/webpack/mini-webpack"},{"text":"minipack-explain","link":"/webpack/minipack"},{"text":"tapable","link":"/webpack/tapable"}],"collapsable":true}]},"footer":{"message":"Released under the MIT License.","copyright":"Copyright © 2022-present Beka"}},"head":[["script",{"id":"check-dark-light"},"\n        ;(() => {\n          const saved = localStorage.getItem('island-theme-appearance')\n          const prefereDark = window.matchMedia('(prefers-color-scheme: dark)').matches\n          if (!saved || saved === 'auto' ? prefereDark : saved === 'dark') {\n            document.documentElement.classList.add('dark')\n          }\n        })()\n      "]],"base":"","icon":"","root":"/Users/beka/Desktop/code/bekacodechn.github.io/blog","appearance":true},"pagePath":"/Users/beka/Desktop/code/bekacodechn.github.io/blog/chrome/modern-web-browser/inside-browser-part-4.md","relativePagePath":"chrome/modern-web-browser/inside-browser-part-4.md","toc":[{"id":"input-is-coming-to-the-compositor-输入到合成器","text":"Input is coming to the Compositor 输入到合成器","depth":2},{"id":"input-events-from-the-browsers-point-of-view-从浏览器角度看输入事件","text":"Input events from the browser's point of view 从浏览器角度看输入事件","depth":2},{"id":"compositor-receives-input-events-合成器接收输入事件","text":"Compositor receives input events 合成器接收输入事件","depth":2},{"id":"be-aware-when-you-write-event-handlers-编写事件处理程序时要注意","text":"Be aware when you write event handlers 编写事件处理程序时要注意","depth":3},{"id":"check-if-the-event-is-cancelable-检查事件是否可取消","text":"Check if the event is cancelable 检查事件是否可取消","depth":2},{"id":"finding-the-event-target","text":"Finding the event target","depth":2},{"id":"minimizing-event-dispatches-to-the-main-thread-尽量减少主线程的事件派发","text":"Minimizing event dispatches to the main thread 尽量减少主线程的事件派发","depth":2},{"id":"usegetcoalescedeventsto-get-intra-frame-events-使用-getcoalescedevents-获取帧内事件","text":"Use getCoalescedEvents to get intra-frame events (使用 getCoalescedEvents 获取帧内事件)","depth":2},{"id":"next-steps","text":"Next steps","depth":2},{"id":"use-lighthouse","text":"Use Lighthouse","depth":3},{"id":"learn-how-to-measure-performance","text":"Learn how to measure performance","depth":3},{"id":"add-feature-policy-to-your-site","text":"Add Feature Policy to your site","depth":3},{"id":"wrap-up","text":"Wrap up","depth":2}],"title":"现代网络浏览器内幕 — 4","lastUpdatedTime":"2023/11/13 20:59:38","content":"# 现代网络浏览器内幕 — 4\n\n`metadata:`\n\n**原标题:** Inside look at modern web browser (part 4)\n\n**链接:** https://developer.chrome.com/blog/inside-browser-part4/\n\n---\n\n## Input is coming to the Compositor 输入到合成器\n\n这是 Chrome 浏览器四部曲系列博客的最后一篇，探讨了 Chrome 浏览器是如何处理我们的代码以显示网站的。在上一篇文章中，我们了解了[渲染过程并学习了合成器](./inside-browser-part-3.md)。在本篇博文中，我们将了解合成器如何在用户输入时实现流畅的交互。\n\n## Input events from the browser's point of view 从浏览器角度看输入事件\n\n当您听到 \"输入事件 \"时，您可能只会想到在文本框中打字或点击鼠标，但从浏览器的角度来看，输入意味着用户的任何手势。鼠标滚轮滚动是一个输入事件，触摸或鼠标移过也是一个输入事件。\n\n当用户在屏幕上做出触摸等手势时，浏览器进程会首先接收到该手势。不过，浏览器进程只知道手势发生的位置，因为标签页内的内容是由呈现器进程处理的。因此，浏览器进程会向呈现器进程发送事件类型（如 touchstart）及其坐标。呈现器进程通过查找事件目标和运行附加的事件监听器来适当处理该事件。\n\n![20231113164433](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231113164433.png)\n*图 1：输入事件通过浏览器进程传递到呈现器进程*\n\n## Compositor receives input events 合成器接收输入事件\n\n![202311131647540](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/202311131647540.gif?imageSlim)\n\n在上一篇文章中，我们了解了合成器如何通过合成光栅化图层来平滑处理滚动。如果页面上没有附加输入事件侦听器，合成器线程就可以完全独立于主线程创建新的合成帧。但如果页面上有一些事件监听器呢？合成器线程如何确定事件是否需要处理？\n\n![20231113164955](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231113164955.png)\n*图 3：描述输入到非快速滚动区域的示意图*\n\n### Be aware when you write event handlers 编写事件处理程序时要注意\n\n网络开发中常见的事件处理模式是事件委托。由于事件会冒泡，因此可以在最顶层的元素上附加一个事件处理程序，然后根据事件目标委托任务。您可能见过或写过类似下面这样的代码。\n\n```js\ndocument.body.addEventListener('touchstart', event => {\n    if (event.target === area) {\n        event.preventDefault();\n    }\n});\n```\n\n由于只需为所有元素编写一个事件处理程序，因此这种事件委托模式非常符合人体工程学。但是，如果从浏览器的角度来看这段代码，现在整个页面都被标记为不可快速滚动区域。这意味着，即使您的应用程序不关心页面某些部分的输入，合成器线程也必须与主线程通信，并在每次输入事件到来时等待主线程。这样，合成器的平滑滚动功能就无法实现了。\n\n![20231113165223](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231113165223.png)\n*图 4：对覆盖整个页面的非快速滚动区域的描述输入示意图*\n\n为了避免这种情况发生，您可以在事件监听器中使用 passive: true 选项。这样浏览器就会知道你仍想在主线程中监听事件，但合成器也可以继续合成新帧。\n\n```js\ndocument.body.addEventListener('touchstart', event => {\n    if (event.target === area) {\n        event.preventDefault()\n    }\n }, {passive: true});\n```\n\n## Check if the event is cancelable 检查事件是否可取消\n\n试想一下，如果您想将页面中的一个方框的滚动方向限制为只能横向滚动，您会怎么做呢？\n\n![20231113165516](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231113165516.png)\n*图 5：部分页面固定为水平滚动的网页*\n\n在指针事件中使用 `passive: true` 选项意味着页面滚动可以平滑，但当您想要`preventDefault`以限制滚动方向时，垂直滚动可能已经开始。您可以使用 `event.cancelable` 方法来检查这一点\n\n```js\ndocument.body.addEventListener('pointermove', event => {\n    if (event.cancelable) {\n        event.preventDefault(); // block the native scroll\n        /*\n        *  do what you want the application to do here\n        */\n    }\n}, {passive: true});\n```\n\n或者，您也可以使用 CSS 规则（如 `touch-action`）来完全消除事件处理程序。\n\n```scss\n    #area {  touch-action: pan-x;}\n```\n\n## Finding the event target\n\n![20231113170030](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231113170030.png)\n*图 6：主线程查看绘制记录，询问在 x.y 点上绘制了什么。*\n\n当合成器线程将输入事件发送到主线程时，首先要运行的是找到事件目标的命中测试。命中测试使用渲染过程中生成的绘制记录数据来找出事件发生的点坐标下的内容。\n\n:::tip{title=原文}\nWhen the compositor thread sends an input event to the main thread, the first thing to run is a hit test to find the event target. Hit test uses paint records data that was generated in the rendering process to find out what is underneath the point coordinates in which the event occurred.\n:::\n\n## Minimizing event dispatches to the main thread 尽量减少主线程的事件派发\n\n在上一篇文章中，我们讨论了典型显示器每秒刷新屏幕 60 次的情况，以及我们需要如何跟上节奏以实现流畅的动画效果。在输入方面，典型的触摸屏设备每秒会产生 60-120 次触摸事件，而典型的鼠标每秒会产生 100 次事件。输入事件的保真度高于我们的屏幕刷新速度。\n\n如果像 `touchmove` 这样的连续事件每秒向主线程发送 120 次，那么与屏幕刷新的速度相比，可能会触发过多的命中测试(hit test)和 JavaScript 执行。\n\n![20231113170425](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231113170425.png)\n*Figure 7: Events flooding(洪水) the frame timeline causing page jank(事件太多导致页面卡顿)*\n\n为了尽量减少对主线程的过多调用，Chrome 浏览器会将连续事件（如`wheel`, `mousewheel`, `mousemove`, `pointermove`, `touchmove`）聚合在一起，并将分派延迟到下一个 `requestAnimationFrame` 之前。\n\n![20231113170824](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231113170824.png)\n*图 8：时间线与之前相同，但事件正在凝聚和延迟*\n\n任何离散事件，如`keydown`, `keyup`, `mouseup`, `mousedown`, `touchstart`, 和 `touchend`，都会立即被派发。\n\n## Use `getCoalescedEvents` to get intra-frame events (使用 getCoalescedEvents 获取帧内事件)\n\n对于大多数网络应用程序来说，凝聚事件足以提供良好的用户体验。但是，如果您正在构建绘图应用程序并根据 `touchmove` 坐标绘制路径，您可能会丢失中间的坐标来绘制平滑的线条。在这种情况下，您可以使用指针事件中的 `getCoalescedEvents` 方法来获取有关这些聚合事件的信息。\n\n![20231113171116](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231113171116.png)\n*图 9：左侧是平滑的触摸手势路径，右侧是凝聚的有限路径*\n\n```js\nwindow.addEventListener('pointermove', event => {\n    const events = event.getCoalescedEvents();\n    for (let event of events) {\n        const x = event.pageX;\n        const y = event.pageY;\n        // draw a line using x and y coordinates.\n    }\n});\n```\n\n## Next steps\n\n在本系列中，我们介绍了网络浏览器的内部工作原理。如果您从未想过 DevTools 为什么建议在事件处理程序中添加 `{passive: true}` 或为什么要在脚本标签中写入 `async` 属性，我希望本系列能让您了解浏览器为什么需要这些信息来提供更快、更流畅的网络体验。\n\n### Use Lighthouse\n\n如果你想让自己的代码对浏览器更友好，但又不知道从何下手，那么 [Lighthouse](https://developer.chrome.com/docs/lighthouse/overview/) 是一款可以对任何网站进行审计的工具，它能为你提供一份报告，说明哪些做法是正确的，哪些需要改进。阅读审核列表还能让你了解浏览器关注哪些方面。\n\n### Learn how to measure performance\n\n不同网站的性能调整可能会有所不同，因此您必须测量网站的性能并决定最适合您网站的调整。Chrome DevTools 团队有一些关于[如何衡量网站性能](https://developers.google.com/web/tools/chrome-devtools/speed/get-started)的教程。\n\n### Add Feature Policy to your site\n\n如果您想多走一步，[功能策略](https://developers.google.com/web/updates/2018/06/feature-policy)是一项新的网络平台功能，它可以在您创建项目时为您提供保护。打开功能策略可以保证应用程序的特定行为，防止您犯错。例如，如果你想确保你的应用程序永远不会阻塞解析，你可以在同步脚本策略下运行你的应用程序。当启用 `sync-script：none` 时，会阻止阻塞解析器的 JavaScript 执行。这样，您的任何代码都不会阻塞解析器，浏览器也无需担心会暂停解析器。\n\n## Wrap up\n\n![20231113171720](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231113171720.png)\n\n当我开始创建网站时，我几乎只关心如何编写代码以及怎样才能提高工作效率。这些都很重要，但我们还应该考虑浏**览器如何使用我们编写的代码**。现代浏览器已经并将继续致力于为用户提供更好的网络体验。通过组织我们的代码来善待浏览器，反过来也能改善用户体验。我希望您和我一起努力，善待浏览器！\n\n\n\n\n\n\n\n\n\n\n\n\n\n","pageType":"doc","routePath":"/chrome/modern-web-browser/inside-browser-part-4"};</script>
      
      <script type="module" src="/client-entry.js"></script>
    </body>
  </html>