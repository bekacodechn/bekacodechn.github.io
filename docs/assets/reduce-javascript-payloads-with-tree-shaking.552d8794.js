import{jsx as n,jsxs as l,Fragment as a}from"react/jsx-runtime";const i=void 0,t=[{id:"what-is-tree-shaking--\u4EC0\u4E48\u662F\u6447\u6811",text:"What is tree shaking?  \u4EC0\u4E48\u662F\u6447\u6811\uFF1F",depth:2},{id:"finding-opportunities-to-shake-a-tree--\u5BFB\u627E\u673A\u4F1A\u6447\u6643\u4E00\u68F5\u6811",text:"Finding opportunities to shake a tree  \u5BFB\u627E\u673A\u4F1A\u6447\u6643\u4E00\u68F5\u6811",depth:2},{id:"keeping-babel-from-transpiling-es6-modules-to-commonjs-modules--\u9632\u6B62-babel-\u5C06-es6-\u6A21\u5757\u8F6C\u8BD1\u4E3A-commonjs-\u6A21\u5757",text:"Keeping Babel from transpiling ES6 modules to CommonJS modules  \u9632\u6B62 Babel \u5C06 ES6 \u6A21\u5757\u8F6C\u8BD1\u4E3A CommonJS \u6A21\u5757",depth:2},{id:"keeping-side-effects-in-mind--\u7262\u8BB0\u526F\u4F5C\u7528",text:"Keeping side effects in mind  \u7262\u8BB0\u526F\u4F5C\u7528",depth:2},{id:"importing-only-whats-needed--\u4EC5\u5BFC\u5165\u6240\u9700\u5185\u5BB9",text:"Importing only what's needed  \u4EC5\u5BFC\u5165\u6240\u9700\u5185\u5BB9",depth:2},{id:"go-shake-some-trees\u53BB\u6447\u6643\u4E00\u4E9B\u6811",text:"Go shake some trees!\xA0\u53BB\u6447\u6643\u4E00\u4E9B\u6811\uFF01",depth:2}],c="\u901A\u8FC7\u6447\u6811\u51CF\u5C11 JavaScript \u6709\u6548\u8D1F\u8F7D";function o(s){const e=Object.assign({h1:"h1",a:"a",p:"p",code:"code",strong:"strong",hr:"hr",em:"em",img:"img",h2:"h2",div:"div",button:"button",span:"span",pre:"pre"},s.components);return l(a,{children:[l(e.h1,{id:"\u901A\u8FC7\u6447\u6811\u51CF\u5C11-javascript-\u6709\u6548\u8D1F\u8F7D",children:[n(e.a,{className:"header-anchor","aria-hidden":"true",href:"#\u901A\u8FC7\u6447\u6811\u51CF\u5C11-javascript-\u6709\u6548\u8D1F\u8F7D",children:"#"}),"\u901A\u8FC7\u6447\u6811\u51CF\u5C11 JavaScript \u6709\u6548\u8D1F\u8F7D"]}),`
`,n(e.p,{children:n(e.code,{children:"metadata:"})}),`
`,l(e.p,{children:[n(e.strong,{children:"\u539F\u6807\u9898:"})," Reduce JavaScript payloads with tree shaking"]}),`
`,l(e.p,{children:[n(e.strong,{children:"\u94FE\u63A5:"})," ",n(e.a,{href:"https://web.dev/articles/reduce-javascript-payloads-with-tree-shaking",target:"_blank",rel:"nofollow",children:"https://web.dev/articles/reduce-javascript-payloads-with-tree-shaking"})]}),`
`,n(e.hr,{}),`
`,l(e.p,{children:["Today's web applications can get pretty big, especially the JavaScript part of them. As of mid-2018, HTTP Archive puts the\xA0",n(e.a,{href:"https://httparchive.org/reports/state-of-javascript#bytesJs",target:"_blank",rel:"nofollow",children:"median transfer size of JavaScript on mobile devices"}),"\xA0at approximately 350 KB. And this is just transfer size! JavaScript is often compressed when sent over the network, meaning that the\xA0",n(e.em,{children:"actual"}),"\xA0amount of JavaScript is quite a bit more after the browser decompresses it. That's important to point out, because as far as resource\xA0",n(e.em,{children:"processing"}),"\xA0is concerned, compression is irrelevant. 900 KB of decompressed JavaScript is still 900 KB to the parser and compiler, even though it may be roughly 300 KB when compressed."]}),`
`,n(e.p,{children:"\u4ECA\u5929\u7684 Web \u5E94\u7528\u7A0B\u5E8F\u53EF\u80FD\u4F1A\u53D8\u5F97\u975E\u5E38\u5927\uFF0C\u5C24\u5176\u662F\u5176\u4E2D\u7684 JavaScript \u90E8\u5206\u3002\u622A\u81F3 2018 \u5E74\u5E74\u4E2D\uFF0CHTTP Archive \u5C06 JavaScript \u5728\u79FB\u52A8\u8BBE\u5907\u4E0A\u7684\u4F20\u8F93\u5927\u5C0F\u4E2D\u4F4D\u6570\u5B9A\u4E3A\u7EA6 350 KB\u3002\u800C\u8FD9\u53EA\u662F\u4F20\u8F93\u5927\u5C0F\uFF01JavaScript \u5728\u901A\u8FC7\u7F51\u7EDC\u53D1\u9001\u65F6\u901A\u5E38\u4F1A\u88AB\u538B\u7F29\uFF0C\u8FD9\u610F\u5473\u7740\u5728\u6D4F\u89C8\u5668\u89E3\u538B\u7F29\u540E\uFF0CJavaScript \u7684\u5B9E\u9645\u6570\u91CF\u4F1A\u591A\u5F97\u591A\u3002\u9700\u8981\u6307\u51FA\u7684\u662F\uFF0C\u5C31\u8D44\u6E90\u5904\u7406\u800C\u8A00\uFF0C\u538B\u7F29\u662F\u65E0\u5173\u7D27\u8981\u7684\u3002900 KB \u7684\u89E3\u538B\u7F29 JavaScript \u5BF9\u4E8E\u89E3\u6790\u5668\u548C\u7F16\u8BD1\u5668\u6765\u8BF4\u4ECD\u7136\u662F 900 KB\uFF0C\u5373\u4F7F\u538B\u7F29\u540E\u53EF\u80FD\u5927\u7EA6 300 KB\u3002"}),`
`,l(e.p,{children:[n(e.img,{src:"https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116112020.png",alt:"20231116112020"}),`
`,n(e.em,{children:"The process of downloading and running JavaScript. Note that even though the transfer size of the script is 300 KB compressed, it is still 900 KB worth of JavaScript that must be parsed, compiled, and executed."})]}),`
`,n(e.p,{children:n(e.em,{children:"\u4E0B\u8F7D\u548C\u8FD0\u884C JavaScript \u7684\u8FC7\u7A0B\u3002\u8BF7\u6CE8\u610F\uFF0C\u5373\u4F7F\u811A\u672C\u7684\u4F20\u8F93\u5927\u5C0F\u538B\u7F29\u4E3A 300 KB\uFF0C\u4F46\u4ECD\u5FC5\u987B\u89E3\u6790\u3001\u7F16\u8BD1\u548C\u6267\u884C 900 KB \u7684 JavaScript\u3002"})}),`
`,n(e.p,{children:"JavaScript is an expensive resource to process. Unlike images which only incur relatively trivial decode time once downloaded, JavaScript must be parsed, compiled, and then finally executed. Byte for byte, this makes JavaScript more expensive than other types of resources."}),`
`,n(e.p,{children:"JavaScript \u662F\u4E00\u79CD\u6602\u8D35\u7684\u5904\u7406\u8D44\u6E90\u3002\u4E0E\u4E0B\u8F7D\u540E\u4EC5\u4EA7\u751F\u76F8\u5BF9\u5FAE\u4E0D\u8DB3\u9053\u7684\u89E3\u7801\u65F6\u95F4\u7684\u56FE\u50CF\u4E0D\u540C\uFF0CJavaScript \u5FC5\u987B\u7ECF\u8FC7\u89E3\u6790\u3001\u7F16\u8BD1\uFF0C\u7136\u540E\u6700\u7EC8\u6267\u884C\u3002\u9010\u5B57\u8282\uFF0C\u8FD9\u4F7F\u5F97 JavaScript \u6BD4\u5176\u4ED6\u7C7B\u578B\u7684\u8D44\u6E90\u66F4\u6602\u8D35\u3002"}),`
`,l(e.p,{children:[n(e.img,{src:"https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116112125.png",alt:"20231116112125"}),`
`,l(e.em,{children:["The processing cost of parsing/compiling 170 KB of JavaScript vs decode time of an equivalently sized JPEG. (",n(e.a,{href:"https://medium.com/dev-channel/the-cost-of-javascript-84009f51e99e",target:"_blank",rel:"nofollow",children:"source"}),")."]})]}),`
`,n(e.p,{children:n(e.em,{children:"\u89E3\u6790/\u7F16\u8BD1 170 KB JavaScript \u7684\u5904\u7406\u6210\u672C\u4E0E\u540C\u7B49\u5927\u5C0F\u7684 JPEG \u7684\u89E3\u7801\u65F6\u95F4\u4E4B\u6BD4\u3002\uFF08\u6765\u6E90\uFF09."})}),`
`,l(e.p,{children:[n(e.a,{href:"https://v8.dev/blog/background-compilation",target:"_blank",rel:"nofollow",children:"While improvements are continually being made"}),"\xA0to\xA0",n(e.a,{href:"https://blog.mozilla.org/javascript/2017/12/12/javascript-startup-bytecode-cache/",target:"_blank",rel:"nofollow",children:"improve the efficiency of JavaScript engines"}),", improving JavaScript performance is\u2014as always\u2014a task for developers."]}),`
`,n(e.p,{children:"\u867D\u7136\u4E0D\u65AD\u8FDB\u884C\u6539\u8FDB\u4EE5\u63D0\u9AD8 JavaScript \u5F15\u64CE\u7684\u6548\u7387\uFF0C\u4F46\u63D0\u9AD8 JavaScript \u6027\u80FD\u4E00\u5982\u65E2\u5F80\u5730\u662F\u5F00\u53D1\u4EBA\u5458\u7684\u4EFB\u52A1\u3002"}),`
`,l(e.p,{children:["To that end, there are techniques to improve JavaScript performance.\xA0",n(e.a,{href:"https://web.dev/articles/reduce-javascript-payloads-with-code-splitting",target:"_blank",rel:"nofollow",children:"Code splitting"}),", is one such technique that improves performance by partitioning application JavaScript into chunks, and serving those chunks to only the routes of an application that need them."]}),`
`,n(e.p,{children:"\u4E3A\u6B64\uFF0C\u6709\u4E00\u4E9B\u6280\u672F\u53EF\u4EE5\u63D0\u9AD8 JavaScript \u6027\u80FD\u3002\u4EE3\u7801\u62C6\u5206\u5C31\u662F\u8FD9\u6837\u4E00\u79CD\u6280\u672F\uFF0C\u5B83\u901A\u8FC7\u5C06\u5E94\u7528\u7A0B\u5E8F JavaScript \u5212\u5206\u4E3A\u591A\u4E2A\u5757\uFF0C\u5E76\u5C06\u8FD9\u4E9B\u5757\u4EC5\u63D0\u4F9B\u7ED9\u9700\u8981\u5B83\u4EEC\u7684\u5E94\u7528\u7A0B\u5E8F\u7684\u8DEF\u7531\u6765\u63D0\u9AD8\u6027\u80FD\u3002"}),`
`,n(e.p,{children:"While this technique works, it doesn't address a common problem of JavaScript-heavy applications, which is the inclusion of code that's never used. Tree shaking attempts to solve this problem."}),`
`,n(e.p,{children:"\u867D\u7136\u8FD9\u79CD\u6280\u672F\u6709\u6548\uFF0C\u4F46\u5B83\u5E76\u6CA1\u6709\u89E3\u51B3 JavaScript \u5BC6\u96C6\u578B\u5E94\u7528\u7A0B\u5E8F\u7684\u5E38\u89C1\u95EE\u9898\uFF0C\u5373\u5305\u542B\u4ECE\u672A\u4F7F\u7528\u8FC7\u7684\u4EE3\u7801\u3002\u6447\u6811\u8BD5\u56FE\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\u3002"}),`
`,l(e.h2,{id:"what-is-tree-shaking--\u4EC0\u4E48\u662F\u6447\u6811",children:[n(e.a,{className:"header-anchor","aria-hidden":"true",href:"#what-is-tree-shaking--\u4EC0\u4E48\u662F\u6447\u6811",children:"#"}),"What is tree shaking?  \u4EC0\u4E48\u662F\u6447\u6811\uFF1F"]}),`
`,l(e.p,{children:[n(e.a,{href:"https://en.wikipedia.org/wiki/Tree_shaking",target:"_blank",rel:"nofollow",children:"Tree shaking"}),"\xA0is a form of dead code elimination.\xA0",n(e.a,{href:"https://github.com/rollup/rollup#tree-shaking",target:"_blank",rel:"nofollow",children:"The term was popularized by Rollup"}),", but the concept of dead code elimination has existed for some time. The concept has also found purchase in\xA0",n(e.a,{href:"https://webpack.js.org/guides/tree-shaking/",target:"_blank",rel:"nofollow",children:"webpack"}),", which is demonstrated in this article by way of a sample app."]}),`
`,n(e.p,{children:"\u6447\u6811\u662F\u6D88\u9664\u6B7B\u4EE3\u7801\u7684\u4E00\u79CD\u5F62\u5F0F\u3002\u8BE5\u672F\u8BED\u7531 Rollup \u63A8\u5E7F\uFF0C\u4F46\u6B7B\u4EE3\u7801\u6D88\u9664\u7684\u6982\u5FF5\u5DF2\u7ECF\u5B58\u5728\u4E86\u4E00\u6BB5\u65F6\u95F4\u3002\u8FD9\u4E2A\u6982\u5FF5\u5728 webpack \u4E2D\u4E5F\u5F97\u5230\u4E86\u8D2D\u4E70\uFF0C\u672C\u6587\u901A\u8FC7\u4E00\u4E2A\u793A\u4F8B\u5E94\u7528\u7A0B\u5E8F\u8FDB\u884C\u4E86\u6F14\u793A\u3002"}),`
`,l(e.p,{children:['The term "tree shaking" comes from the mental model of your application and its dependencies as a tree-like structure. Each node in the tree represents a dependency that provides distinct functionality for your app. In modern apps, these dependencies are brought in via\xA0',l(e.a,{href:"https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/import",target:"_blank",rel:"nofollow",children:["static\xA0",n(e.code,{children:"import"}),"\xA0statements"]}),"\xA0like so:"]}),`
`,l(e.p,{children:["\u672F\u8BED\u201C\u6447\u6811\u201D\u6765\u81EA\u5E94\u7528\u7A0B\u5E8F\u7684\u5FC3\u667A\u6A21\u578B\u53CA\u5176\u4F5C\u4E3A\u6811\u72B6\u7ED3\u6784\u7684\u4F9D\u8D56\u5173\u7CFB\u3002\u6811\u4E2D\u7684\u6BCF\u4E2A\u8282\u70B9\u90FD\u8868\u793A\u4E00\u4E2A\u4F9D\u8D56\u9879\uFF0C\u8BE5\u4F9D\u8D56\u9879\u4E3A\u5E94\u7528\u63D0\u4F9B\u4E0D\u540C\u7684\u529F\u80FD\u3002\u5728\u73B0\u4EE3\u5E94\u7528\u4E2D\uFF0C\u8FD9\u4E9B\u4F9D\u8D56\u9879\u662F\u901A\u8FC7\u9759\u6001\xA0",n(e.code,{children:"import"}),"\xA0\u8BED\u53E5\u5F15\u5165\u7684\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A"]}),`
`,l(e.div,{className:"language-js line-numbers-mode",style:{backgroundColor:"#2e3440ff"},children:[n(e.button,{className:"copy"}),n(e.span,{className:"lang",children:"js"}),n(e.pre,{children:l(e.code,{className:"",children:[n(e.span,{className:"line",children:n(e.span,{style:{color:"#616E88"},children:"// Import all the array utilities!"})}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#81A1C1"},children:"import"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#8FBCBB"},children:"arrayUtils"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"from"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"array-utils"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#81A1C1"},children:";"})]}),`
`,n(e.span,{className:"line"})]})}),l(e.div,{className:"line-numbers-wrapper",children:[n(e.span,{className:"line-number",children:"1"}),n(e.span,{className:"line-number",children:"2"})]})]}),`
`,l(e.div,{className:"island-directive info",children:[n(e.p,{className:"island-directive-title",children:"INFO"}),l(e.div,{className:"island-directive-content",children:[l(e.p,{children:[n(e.strong,{children:"Note:"})," If you're not sure what ES6 modules are,\xA0",n(e.a,{href:"https://ponyfoo.com/articles/es6-modules-in-depth",target:"_blank",rel:"nofollow",children:"this explainer at Pony Foo"}),"\xA0is worth a look. This guide assumes you have working knowledge of how ES6 modules work, so if you don't know anything about them, give that article a read!"]}),n(e.p,{children:"\u6CE8\u610F\uFF1A\u5982\u679C\u60A8\u4E0D\u786E\u5B9A ES6 \u6A21\u5757\u662F\u4EC0\u4E48\uFF0CPony Foo \u7684\u8FD9\u4E2A\u89E3\u91CA\u5668\u503C\u5F97\u4E00\u770B\u3002\u672C\u6307\u5357\u5047\u8BBE\u60A8\u5BF9 ES6 \u6A21\u5757\u7684\u5DE5\u4F5C\u539F\u7406\u6709\u4E00\u5B9A\u7684\u4E86\u89E3\uFF0C\u6240\u4EE5\u5982\u679C\u4F60\u5BF9\u5B83\u4EEC\u4E00\u65E0\u6240\u77E5\uFF0C\u8BF7\u9605\u8BFB\u8FD9\u7BC7\u6587\u7AE0\uFF01"})]})]}),`
`,l(e.p,{children:["When an app is young\u2014a sapling, if you will\u2014it may have few dependencies. It's also using most\u2014if not all\u2014the dependencies you add. As your app matures, however, more dependencies can get added. To compound matters, older dependencies fall out of use, but may not get pruned from your codebase. The end result is that an app ends up shipping with a lot of\xA0",n(e.a,{href:"https://web.dev/unused-javascript",target:"_blank",rel:"nofollow",children:"unused JavaScript"}),". Tree shaking addresses this by taking advantage of how static\xA0",n(e.code,{children:"import"}),"\xA0statements pull in specific parts of ES6 modules:"]}),`
`,l(e.p,{children:["\u5F53\u4E00\u4E2A\u5E94\u7528\u7A0B\u5E8F\u8FD8\u5F88\u5E74\u8F7B\u65F6\uFF08\u5982\u679C\u4F60\u613F\u610F\u7684\u8BDD\uFF0C\u5B83\u662F\u4E00\u68F5\u6811\u82D7\uFF09\uFF0C\u5B83\u53EF\u80FD\u51E0\u4E4E\u6CA1\u6709\u4F9D\u8D56\u5173\u7CFB\u3002\u5B83\u8FD8\u4F7F\u7528\u60A8\u6DFB\u52A0\u7684\u5927\u591A\u6570\uFF08\u5982\u679C\u4E0D\u662F\u5168\u90E8\uFF09\u4F9D\u8D56\u9879\u3002\u4F46\u662F\uFF0C\u968F\u7740\u5E94\u7528\u7684\u6210\u719F\uFF0C\u53EF\u4EE5\u6DFB\u52A0\u66F4\u591A\u4F9D\u8D56\u9879\u3002\u96EA\u4E0A\u52A0\u971C\u7684\u662F\uFF0C\u8F83\u65E7\u7684\u4F9D\u8D56\u9879\u4E0D\u518D\u4F7F\u7528\uFF0C\u4F46\u53EF\u80FD\u4E0D\u4F1A\u4ECE\u4EE3\u7801\u5E93\u4E2D\u5220\u9664\u3002\u6700\u7EC8\u7ED3\u679C\u662F\uFF0C\u4E00\u4E2A\u5E94\u7528\u7A0B\u5E8F\u6700\u7EC8\u4F1A\u9644\u5E26\u5927\u91CF\u672A\u4F7F\u7528\u7684 JavaScript\u3002\u6447\u6811\u901A\u8FC7\u5229\u7528\u9759\u6001\xA0",n(e.code,{children:"import"}),"\xA0\u8BED\u53E5\u5982\u4F55\u62C9\u5165 ES6 \u6A21\u5757\u7684\u7279\u5B9A\u90E8\u5206\u6765\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\uFF1A"]}),`
`,l(e.div,{className:"language-js line-numbers-mode",style:{backgroundColor:"#2e3440ff"},children:[n(e.button,{className:"copy"}),n(e.span,{className:"lang",children:"js"}),n(e.pre,{children:l(e.code,{className:"",children:[n(e.span,{className:"line",children:n(e.span,{style:{color:"#616E88"},children:"// Import only some of the utilities!"})}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#81A1C1"},children:"import"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#ECEFF4"},children:"{"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#8FBCBB"},children:"unique"}),n(e.span,{style:{color:"#ECEFF4"},children:","}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#8FBCBB"},children:"implode"}),n(e.span,{style:{color:"#ECEFF4"},children:","}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#8FBCBB"},children:"explode"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#ECEFF4"},children:"}"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"from"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"array-utils"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#81A1C1"},children:";"})]}),`
`,n(e.span,{className:"line"})]})}),l(e.div,{className:"line-numbers-wrapper",children:[n(e.span,{className:"line-number",children:"1"}),n(e.span,{className:"line-number",children:"2"})]})]}),`
`,l(e.p,{children:["The difference between this\xA0",n(e.code,{children:"import"}),"\xA0example and the previous one is that rather than importing\xA0",n(e.em,{children:"everything"}),"\xA0from the\xA0",n(e.code,{children:'"array-utils"'}),`\xA0module\u2014which could be a lot of code)\u2014this example imports only specific parts of it. In dev builds, this doesn't change anything, as the entire module gets imported regardless. In production builds, webpack can be configured to "shake" off\xA0`,n(e.a,{href:"https://developer.mozilla.org/docs/web/javascript/reference/statements/export",target:"_blank",rel:"nofollow",children:"exports"}),"\xA0from ES6 modules that weren't explicitly imported, making those production builds smaller. In this guide, you'll learn how to do just that!"]}),`
`,l(e.p,{children:["\u6B64\u793A\u4F8B\u4E0E\u4E0A\u4E00\u4E2A\u793A\u4F8B\u7684\u533A\u522B\u5728\u4E8E\uFF0C\u6B64\xA0",n(e.code,{children:"import"}),"\xA0\u793A\u4F8B\u4E0D\u662F\u4ECE\u6A21\u5757\u4E2D\u5BFC\u5165\u6240\u6709\u5185\u5BB9\uFF08\u53EF\u80FD\u662F\u5927\u91CF\u4EE3\u7801\uFF09\uFF0C\u800C\u662F\u4EC5\u5BFC\u5165\xA0",n(e.code,{children:'"array-utils"'}),"\xA0\u6A21\u5757\u7684\u7279\u5B9A\u90E8\u5206\u3002\u5728\u5F00\u53D1\u7248\u672C\u4E2D\uFF0C\u8FD9\u4E0D\u4F1A\u6539\u53D8\u4EFB\u4F55\u4E8B\u60C5\uFF0C\u56E0\u4E3A\u65E0\u8BBA\u5982\u4F55\u90FD\u4F1A\u5BFC\u5165\u6574\u4E2A\u6A21\u5757\u3002\u5728\u751F\u4EA7\u7248\u672C\u4E2D\uFF0Cwebpack \u53EF\u4EE5\u914D\u7F6E\u4E3A\u201C\u6446\u8131\u201D\u672A\u663E\u5F0F\u5BFC\u5165\u7684 ES6 \u6A21\u5757\u7684\u5BFC\u51FA\uFF0C\u4ECE\u800C\u4F7F\u8FD9\u4E9B\u751F\u4EA7\u7248\u672C\u66F4\u5C0F\u3002\u5728\u672C\u6307\u5357\u4E2D\uFF0C\u60A8\u5C06\u5B66\u4E60\u5982\u4F55\u505A\u5230\u8FD9\u4E00\u70B9\uFF01"]}),`
`,l(e.h2,{id:"finding-opportunities-to-shake-a-tree--\u5BFB\u627E\u673A\u4F1A\u6447\u6643\u4E00\u68F5\u6811",children:[n(e.a,{className:"header-anchor","aria-hidden":"true",href:"#finding-opportunities-to-shake-a-tree--\u5BFB\u627E\u673A\u4F1A\u6447\u6643\u4E00\u68F5\u6811",children:"#"}),"Finding opportunities to shake a tree  \u5BFB\u627E\u673A\u4F1A\u6447\u6643\u4E00\u68F5\u6811"]}),`
`,l(e.p,{children:["For illustrative purposes,\xA0",n(e.a,{href:"https://github.com/malchata/webpack-tree-shaking-example",target:"_blank",rel:"nofollow",children:"a sample one-page app"}),"\xA0is available that demonstrates how tree shaking works. You can clone it and follow along if you like, but we'll cover every step of the way together in this guide, so cloning isn't necessary (unless hands-on learning is your thing)."]}),`
`,n(e.p,{children:"\u4E3A\u4E86\u4FBF\u4E8E\u8BF4\u660E\uFF0C\u63D0\u4F9B\u4E86\u4E00\u4E2A\u793A\u4F8B\u5355\u9875\u5E94\u7528\u7A0B\u5E8F\uFF0C\u7528\u4E8E\u6F14\u793A\u6447\u6811\u7684\u5DE5\u4F5C\u539F\u7406\u3002\u5982\u679C\u60A8\u613F\u610F\uFF0C\u60A8\u53EF\u4EE5\u514B\u9686\u5B83\u5E76\u8DDF\u968F\u5B83\uFF0C\u4F46\u6211\u4EEC\u5C06\u5728\u672C\u6307\u5357\u4E2D\u4E00\u8D77\u4ECB\u7ECD\u6BCF\u4E00\u6B65\uFF0C\u56E0\u6B64\u514B\u9686\u4E0D\u662F\u5FC5\u9700\u7684\uFF08\u9664\u975E\u60A8\u559C\u6B22\u52A8\u624B\u5B66\u4E60\uFF09\u3002"}),`
`,n(e.p,{children:"The sample app is a searchable database of guitar effect pedals. You enter a query and a list of effect pedals will appear."}),`
`,n(e.p,{children:"\u793A\u4F8B\u5E94\u7528\u662F\u5409\u4ED6\u6548\u679C\u8E0F\u677F\u7684\u53EF\u641C\u7D22\u6570\u636E\u5E93\u3002\u60A8\u8F93\u5165\u67E5\u8BE2\uFF0C\u5C06\u51FA\u73B0\u6548\u679C\u8E0F\u677F\u5217\u8868\u3002"}),`
`,n(e.p,{children:n(e.img,{src:"https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116112856.png",alt:"20231116112856"})}),`
`,l(e.p,{children:["The behavior that drives this app is separated into vendor (i.e.,\xA0",n(e.a,{href:"https://preactjs.com/",target:"_blank",rel:"nofollow",children:"Preact"}),"\xA0and\xA0",n(e.a,{href:"https://emotion.sh/",target:"_blank",rel:"nofollow",children:"Emotion"}),') and app-specific code bundles (or "chunks", as webpack calls them):']}),`
`,n(e.p,{children:"\u9A71\u52A8\u6B64\u5E94\u7528\u7A0B\u5E8F\u7684\u884C\u4E3A\u5206\u4E3A\u4F9B\u5E94\u5546\uFF08\u5373 Preact \u548C Emotion\uFF09\u548C\u7279\u5B9A\u4E8E\u5E94\u7528\u7A0B\u5E8F\u7684\u4EE3\u7801\u5305\uFF08\u6216 webpack \u79F0\u4E4B\u4E3A\u201C\u5757\u201D\uFF09\uFF1A"}),`
`,n(e.p,{children:n(e.img,{src:"https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116112919.png",alt:"20231116112919"})}),`
`,n(e.p,{children:"The JavaScript bundles shown in the figure above are production builds, meaning they're optimized through uglification. 21.1 KB for an app-specific bundle isn't bad, but it should be noted that no tree shaking is occurring whatsoever. Let's look at the app code and see what can be done to fix that."}),`
`,n(e.p,{children:"\u4E0A\u56FE\u4E2D\u663E\u793A\u7684 JavaScript \u5305\u662F\u751F\u4EA7\u7248\u672C\uFF0C\u8FD9\u610F\u5473\u7740\u5B83\u4EEC\u901A\u8FC7\u4E11\u5316\u8FDB\u884C\u4E86\u4F18\u5316\u300221.1 KB \u5BF9\u4E8E\u7279\u5B9A\u4E8E\u5E94\u7528\u7A0B\u5E8F\u7684\u6346\u7ED1\u5305\u6765\u8BF4\u8FD8\u4E0D\u9519\uFF0C\u4F46\u5E94\u8BE5\u6CE8\u610F\u7684\u662F\uFF0C\u6CA1\u6709\u53D1\u751F\u4EFB\u4F55\u6447\u6811\u3002\u8BA9\u6211\u4EEC\u770B\u4E00\u4E0B\u5E94\u7528\u4EE3\u7801\uFF0C\u770B\u770B\u53EF\u4EE5\u505A\u4E9B\u4EC0\u4E48\u6765\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\u3002"}),`
`,l(e.div,{className:"island-directive info",children:[n(e.p,{className:"island-directive-title",children:"INFO"}),l(e.div,{className:"island-directive-content",children:[l(e.p,{children:[n(e.strong,{children:"Note:"}),"\xA0If you don't care for a long-winded explanation, and want to dive into code, go ahead and check out\xA0",l(e.a,{href:"https://github.com/malchata/webpack-tree-shaking-example/tree/tree-shake",target:"_blank",rel:"nofollow",children:["the\xA0",n(e.code,{children:"tree-shake"}),"\xA0branch"]}),"\xA0in the app's GitHub repo. You can also\xA0",n(e.a,{href:"https://github.com/malchata/webpack-tree-shaking-example/compare/tree-shake",target:"_blank",rel:"nofollow",children:"diff this branch"}),"\xA0to see exactly what was changed to make tree shaking work!"]}),l(e.p,{children:["\u6CE8\u610F\uFF1A\u5982\u679C\u60A8\u4E0D\u5173\u5FC3\u5197\u957F\u7684\u89E3\u91CA\uFF0C\u5E76\u4E14\u60F3\u8981\u6DF1\u5165\u7814\u7A76\u4EE3\u7801\uFF0C\u8BF7\u7EE7\u7EED\u67E5\u770B\u5E94\u7528\u7A0B\u5E8F\u7684 GitHub \u5B58\u50A8\u5E93\u4E2D\u7684\xA0",n(e.code,{children:"tree-shake"}),"\xA0\u5206\u652F\u3002\u60A8\u8FD8\u53EF\u4EE5\u6BD4\u8F83\u6B64\u5206\u652F\uFF0C\u4EE5\u786E\u5207\u5730\u67E5\u770B\u4E3A\u4F7F\u6447\u6811\u5DE5\u4F5C\u800C\u66F4\u6539\u7684\u5185\u5BB9\uFF01"]})]})]}),`
`,l(e.p,{children:["In any application, finding tree shaking opportunities are going to involve looking for static\xA0",n(e.code,{children:"import"}),"\xA0statements.\xA0",n(e.a,{href:"https://github.com/malchata/webpack-tree-shaking-example/blob/master/src/components/FilterablePedalList/FilterablePedalList.js#L4",target:"_blank",rel:"nofollow",children:"Near the top of the main component file"}),", you'll see a line like this:"]}),`
`,l(e.p,{children:["\u5728\u4EFB\u4F55\u5E94\u7528\u7A0B\u5E8F\u4E2D\uFF0C\u5BFB\u627E\u6447\u6811\u673A\u4F1A\u90FD\u5C06\u6D89\u53CA\u5BFB\u627E\u9759\u6001\xA0",n(e.code,{children:"import"}),"\xA0\u8BED\u53E5\u3002\u5728\u4E3B\u7EC4\u4EF6\u6587\u4EF6\u7684\u9876\u90E8\u9644\u8FD1\uFF0C\u60A8\u4F1A\u770B\u5230\u5982\u4E0B\u884C\uFF1A"]}),`
`,l(e.div,{className:"language-js line-numbers-mode",style:{backgroundColor:"#2e3440ff"},children:[n(e.button,{className:"copy"}),n(e.span,{className:"lang",children:"js"}),n(e.pre,{children:l(e.code,{className:"",children:[l(e.span,{className:"line",children:[n(e.span,{style:{color:"#81A1C1"},children:"import"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"*"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"as"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#8FBCBB"},children:"utils"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"from"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"../../utils/utils"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#81A1C1"},children:";"})]}),`
`,n(e.span,{className:"line"})]})}),n(e.div,{className:"line-numbers-wrapper",children:n(e.span,{className:"line-number",children:"1"})})]}),`
`,l(e.p,{children:["You can\xA0",n(e.a,{href:"https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/import#description",target:"_blank",rel:"nofollow",children:"import ES6 modules in a variety of ways"}),', but ones like this should get your attention. This specific line says "',n(e.code,{children:"import"}),"\xA0",n(e.em,{children:"everything"}),"\xA0from the\xA0",n(e.code,{children:"utils"}),"\xA0module, and put it in a namespace called\xA0",n(e.code,{children:"utils"}),'." The big question to ask here is, "just how much\xA0',n(e.em,{children:"stuff"}),'\xA0is in that module?"']}),`
`,l(e.p,{children:["\u60A8\u53EF\u4EE5\u901A\u8FC7\u591A\u79CD\u65B9\u5F0F\u5BFC\u5165 ES6 \u6A21\u5757\uFF0C\u4F46\u50CF\u8FD9\u6837\u7684\u6A21\u5757\u5E94\u8BE5\u5F15\u8D77\u60A8\u7684\u6CE8\u610F\u3002\u8FD9\u4E00\u884C\u8BF4\u201C\xA0",n(e.code,{children:"import"}),"\xA0",n(e.code,{children:"utils"}),"\xA0\u6A21\u5757\u4E2D\u7684\u6240\u6709\u5185\u5BB9\uFF0C\u5E76\u5C06\u5176\u653E\u5728\u540D\u4E3A\xA0",n(e.code,{children:"utils"}),"\xA0\u7684\u547D\u540D\u7A7A\u95F4\u4E2D\u3002\u8FD9\u91CC\u8981\u95EE\u7684\u4E00\u4E2A\u5927\u95EE\u9898\u662F\uFF0C\u201C\u90A3\u4E2A\u6A21\u5757\u4E2D\u5230\u5E95\u6709\u591A\u5C11\u4E1C\u897F\uFF1F"]}),`
`,l(e.p,{children:["If you look at\xA0",l(e.a,{href:"https://github.com/malchata/webpack-tree-shaking-example/blob/master/src/utils/utils.js",target:"_blank",rel:"nofollow",children:["the\xA0",n(e.code,{children:"utils"}),"\xA0module source code"]}),", you'll find there's about 1,300 lines of code."]}),`
`,l(e.p,{children:["\u5982\u679C\u4F60\u770B\u4E00\u4E0B\xA0",n(e.code,{children:"utils"}),"\xA0\u6A21\u5757\u7684\u6E90\u4EE3\u7801\uFF0C\u4F60\u4F1A\u53D1\u73B0\u5927\u7EA6\u6709 1,300 \u884C\u4EE3\u7801\u3002"]}),`
`,l(e.p,{children:["Do you\xA0",n(e.em,{children:"need"}),"\xA0all that stuff? Let's double check by searching\xA0",n(e.a,{href:"https://github.com/malchata/webpack-tree-shaking-example/blob/master/src/components/FilterablePedalList/FilterablePedalList.js",target:"_blank",rel:"nofollow",children:"the main component file"}),"\xA0that imports the\xA0",n(e.code,{children:"utils"}),"\xA0module to see how many instances of that namespace come up."]}),`
`,l(e.p,{children:["\u4F60\u9700\u8981\u6240\u6709\u8FD9\u4E9B\u4E1C\u897F\u5417\uFF1F\u8BA9\u6211\u4EEC\u901A\u8FC7\u641C\u7D22\u5BFC\u5165\xA0",n(e.code,{children:"utils"}),"\xA0\u6A21\u5757\u7684\u4E3B\u7EC4\u4EF6\u6587\u4EF6\u6765\u4ED4\u7EC6\u68C0\u67E5\uFF0C\u770B\u770B\u8BE5\u547D\u540D\u7A7A\u95F4\u6709\u591A\u5C11\u4E2A\u5B9E\u4F8B\u3002"]}),`
`,l(e.p,{children:[n(e.img,{src:"https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116113023.png",alt:"20231116113023"}),`
`,l(e.em,{children:["The\xA0",n(e.code,{children:"utils"}),"\xA0namespace we've imported tons of modules from is only invoked three times within the main component file."]})]}),`
`,n(e.p,{children:l(e.em,{children:["\u6211\u4EEC\u4ECE\u4E2D\u5BFC\u5165\u4E86\u5927\u91CF\u6A21\u5757\u7684\xA0",n(e.code,{children:"utils"}),"\xA0\u547D\u540D\u7A7A\u95F4\u5728\u4E3B\u7EC4\u4EF6\u6587\u4EF6\u4E2D\u53EA\u8C03\u7528\u4E86\u4E09\u6B21\u3002"]})}),`
`,l(e.p,{children:["As it turns out, the\xA0",n(e.code,{children:"utils"}),"\xA0namespace appears in only three spots in our application\u2014but for what functions? If you take a look at the main component file again, it appears to be only one function, which is\xA0",n(e.code,{children:"utils.simpleSort"}),", which is used to sort the search results list by a number of criteria when the sorting dropdowns are changed:"]}),`
`,l(e.p,{children:["\u4E8B\u5B9E\u8BC1\u660E\uFF0C\xA0",n(e.code,{children:"utils"}),"\xA0\u547D\u540D\u7A7A\u95F4\u5728\u6211\u4EEC\u7684\u5E94\u7528\u7A0B\u5E8F\u4E2D\u53EA\u51FA\u73B0\u5728\u4E09\u4E2A\u4F4D\u7F6E\uFF0C\u4F46\u7528\u4E8E\u4EC0\u4E48\u529F\u80FD\uFF1F\u5982\u679C\u518D\u6B21\u67E5\u770B\u4E3B\u7EC4\u4EF6\u6587\u4EF6\uFF0C\u5B83\u4F3C\u4E4E\u53EA\u6709\u4E00\u4E2A\u51FD\u6570\uFF0C\u5373\xA0",n(e.code,{children:"utils.simpleSort"}),"\xA0\uFF0C\u7528\u4E8E\u5728\u66F4\u6539\u6392\u5E8F\u4E0B\u62C9\u5217\u8868\u65F6\u6309\u591A\u4E2A\u6761\u4EF6\u5BF9\u641C\u7D22\u7ED3\u679C\u5217\u8868\u8FDB\u884C\u6392\u5E8F\uFF1A"]}),`
`,l(e.div,{className:"language-js line-numbers-mode",style:{backgroundColor:"#2e3440ff"},children:[n(e.button,{className:"copy"}),n(e.span,{className:"lang",children:"js"}),n(e.pre,{children:l(e.code,{className:"",children:[l(e.span,{className:"line",children:[n(e.span,{style:{color:"#81A1C1"},children:"if"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" ("}),n(e.span,{style:{color:"#81A1C1"},children:"this"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9"},children:"state"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9"},children:"sortBy"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"==="}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"model"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#D8DEE9FF"},children:") "}),n(e.span,{style:{color:"#ECEFF4"},children:"{"})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#ECEFF4"},children:"  "}),n(e.span,{style:{color:"#616E88"},children:"// `simpleSort` gets used here..."})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9FF"},children:"  "}),n(e.span,{style:{color:"#D8DEE9"},children:"json"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"="}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#D8DEE9"},children:"utils"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#88C0D0"},children:"simpleSort"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"("}),n(e.span,{style:{color:"#D8DEE9"},children:"json"}),n(e.span,{style:{color:"#ECEFF4"},children:","}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"model"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#ECEFF4"},children:","}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"this"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9"},children:"state"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9"},children:"sortOrder"}),n(e.span,{style:{color:"#D8DEE9FF"},children:")"}),n(e.span,{style:{color:"#81A1C1"},children:";"})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#ECEFF4"},children:"}"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"else"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"if"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" ("}),n(e.span,{style:{color:"#81A1C1"},children:"this"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9"},children:"state"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9"},children:"sortBy"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"==="}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"type"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#D8DEE9FF"},children:") "}),n(e.span,{style:{color:"#ECEFF4"},children:"{"})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#ECEFF4"},children:"  "}),n(e.span,{style:{color:"#616E88"},children:"// ..and here..."})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9FF"},children:"  "}),n(e.span,{style:{color:"#D8DEE9"},children:"json"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"="}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#D8DEE9"},children:"utils"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#88C0D0"},children:"simpleSort"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"("}),n(e.span,{style:{color:"#D8DEE9"},children:"json"}),n(e.span,{style:{color:"#ECEFF4"},children:","}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"type"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#ECEFF4"},children:","}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"this"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9"},children:"state"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9"},children:"sortOrder"}),n(e.span,{style:{color:"#D8DEE9FF"},children:")"}),n(e.span,{style:{color:"#81A1C1"},children:";"})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#ECEFF4"},children:"}"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"else"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#ECEFF4"},children:"{"})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#ECEFF4"},children:"  "}),n(e.span,{style:{color:"#616E88"},children:"// ..and here."})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9FF"},children:"  "}),n(e.span,{style:{color:"#D8DEE9"},children:"json"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"="}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#D8DEE9"},children:"utils"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#88C0D0"},children:"simpleSort"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"("}),n(e.span,{style:{color:"#D8DEE9"},children:"json"}),n(e.span,{style:{color:"#ECEFF4"},children:","}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"manufacturer"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#ECEFF4"},children:","}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"this"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9"},children:"state"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9"},children:"sortOrder"}),n(e.span,{style:{color:"#D8DEE9FF"},children:")"}),n(e.span,{style:{color:"#81A1C1"},children:";"})]}),`
`,n(e.span,{className:"line",children:n(e.span,{style:{color:"#ECEFF4"},children:"}"})}),`
`,n(e.span,{className:"line"})]})}),l(e.div,{className:"line-numbers-wrapper",children:[n(e.span,{className:"line-number",children:"1"}),n(e.span,{className:"line-number",children:"2"}),n(e.span,{className:"line-number",children:"3"}),n(e.span,{className:"line-number",children:"4"}),n(e.span,{className:"line-number",children:"5"}),n(e.span,{className:"line-number",children:"6"}),n(e.span,{className:"line-number",children:"7"}),n(e.span,{className:"line-number",children:"8"}),n(e.span,{className:"line-number",children:"9"}),n(e.span,{className:"line-number",children:"10"})]})]}),`
`,n(e.p,{children:"Out of a 1,300 line file with a bunch of exports, only one of them is used. This results in shipping a lot of unused JavaScript."}),`
`,n(e.p,{children:"\u5728\u5305\u542B\u4E00\u5806\u5BFC\u51FA\u7684 1,300 \u884C\u6587\u4EF6\u4E2D\uFF0C\u53EA\u4F7F\u7528\u4E86\u5176\u4E2D\u4E00\u4E2A\u3002\u8FD9\u5BFC\u81F4\u5927\u91CF\u672A\u4F7F\u7528\u7684 JavaScript \u53D1\u5E03\u3002"}),`
`,l(e.div,{className:"island-directive info",children:[n(e.p,{className:"island-directive-title",children:"INFO"}),l(e.div,{className:"island-directive-content",children:[l(e.p,{children:[n(e.strong,{children:"Note:"})," This project is purposefully kept simple, so it's a bit easier in this case to find out where the bloat is coming from. In large projects with many modules, however, things get more complicated. Tools such as\xA0",n(e.a,{href:"https://www.npmjs.com/package/webpack-bundle-analyzer",target:"_blank",rel:"nofollow",children:"Webpack Bundle Analyzer"}),"\xA0and\xA0",n(e.a,{href:"https://www.npmjs.com/package/source-map-explorer",target:"_blank",rel:"nofollow",children:"source-map-explorer"}),"\xA0may provide further insight."]}),n(e.p,{children:"\u6CE8\u610F\uFF1A\u8FD9\u4E2A\u9879\u76EE\u7279\u610F\u4FDD\u6301\u7B80\u5355\uFF0C\u6240\u4EE5\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B\uFF0C\u627E\u51FA\u81A8\u80C0\u7684\u6765\u6E90\u4F1A\u66F4\u5BB9\u6613\u4E00\u4E9B\u3002\u7136\u800C\uFF0C\u5728\u5177\u6709\u8BB8\u591A\u6A21\u5757\u7684\u5927\u578B\u9879\u76EE\u4E2D\uFF0C\u4E8B\u60C5\u53D8\u5F97\u66F4\u52A0\u590D\u6742\u3002Webpack Bundle Analyzer \u548C source-map-explorer \u7B49\u5DE5\u5177\u53EF\u80FD\u4F1A\u63D0\u4F9B\u8FDB\u4E00\u6B65\u7684\u89C1\u89E3\u3002"})]})]}),`
`,n(e.p,{children:"While this example app is admittedly a bit contrived, it doesn't change the fact that this synthetic sort of scenario resembles actual optimization opportunities you may encounter in a production web app. Now that you've identified an opportunity for tree shaking to be useful, how is it actually done?"}),`
`,n(e.p,{children:"\u867D\u7136\u6B64\u793A\u4F8B\u5E94\u7528\u786E\u5B9E\u6709\u70B9\u505A\u4F5C\uFF0C\u4F46\u5B83\u5E76\u6CA1\u6709\u6539\u53D8\u8FD9\u6837\u4E00\u4E2A\u4E8B\u5B9E\uFF0C\u5373\u8FD9\u79CD\u5408\u6210\u7C7B\u578B\u7684\u65B9\u6848\u7C7B\u4F3C\u4E8E\u60A8\u5728\u751F\u4EA7 Web \u5E94\u7528\u4E2D\u53EF\u80FD\u9047\u5230\u7684\u5B9E\u9645\u4F18\u5316\u673A\u4F1A\u3002\u65E2\u7136\u60A8\u5DF2\u7ECF\u786E\u5B9A\u4E86\u6447\u6811\u6709\u7528\u7684\u673A\u4F1A\uFF0C\u90A3\u4E48\u5B83\u5B9E\u9645\u4E0A\u662F\u5982\u4F55\u5B8C\u6210\u7684\uFF1F"}),`
`,l(e.h2,{id:"keeping-babel-from-transpiling-es6-modules-to-commonjs-modules--\u9632\u6B62-babel-\u5C06-es6-\u6A21\u5757\u8F6C\u8BD1\u4E3A-commonjs-\u6A21\u5757",children:[n(e.a,{className:"header-anchor","aria-hidden":"true",href:"#keeping-babel-from-transpiling-es6-modules-to-commonjs-modules--\u9632\u6B62-babel-\u5C06-es6-\u6A21\u5757\u8F6C\u8BD1\u4E3A-commonjs-\u6A21\u5757",children:"#"}),"Keeping Babel from transpiling ES6 modules to CommonJS modules  \u9632\u6B62 Babel \u5C06 ES6 \u6A21\u5757\u8F6C\u8BD1\u4E3A CommonJS \u6A21\u5757"]}),`
`,l(e.p,{children:[n(e.a,{href:"https://babeljs.io/",target:"_blank",rel:"nofollow",children:"Babel"}),"\xA0is an indispensable tool, but it may make the effects of tree shaking a bit more difficult to observe. If you're using\xA0",n(e.a,{href:"https://babeljs.io/docs/en/babel-preset-env",target:"_blank",rel:"nofollow",children:n(e.code,{children:"@babel/preset-env"})}),", Babel\xA0",n(e.em,{children:"may"}),"\xA0transform ES6 modules into more widely compatible CommonJS modules\u2014that is, modules you\xA0",n(e.code,{children:"require"}),"\xA0instead of\xA0",n(e.code,{children:"import"}),"."]}),`
`,l(e.p,{children:["\u5DF4\u522B\u5854\u662F\u4E0D\u53EF\u6216\u7F3A\u7684\u5DE5\u5177\uFF0C\u4F46\u5B83\u53EF\u80FD\u4F1A\u4F7F\u6811\u6728\u6447\u6643\u7684\u5F71\u54CD\u66F4\u96BE\u89C2\u5BDF\u3002\u5982\u679C\u60A8\u4F7F\u7528\u7684\xA0",n(e.code,{children:"@babel/preset-env"}),"\xA0\u662F \uFF0CBabel \u53EF\u80FD\u4F1A\u5C06 ES6 \u6A21\u5757\u8F6C\u6362\u4E3A\u66F4\u5E7F\u6CDB\u517C\u5BB9\u7684 CommonJS \u6A21\u5757\uFF0C\u5373 u\xA0",n(e.code,{children:"require"}),"\xA0\u6A21\u5757\u800C\u4E0D\u662F\xA0",n(e.code,{children:"import"}),"\xA0."]}),`
`,l(e.p,{children:["Because tree shaking is more difficult to do for CommonJS modules, webpack won't know what to prune from bundles if you decide to use them. The solution is to configure\xA0",n(e.code,{children:"@babel/preset-env"}),"\xA0to explicitly leave ES6 modules alone. Wherever you configure Babel\u2014be it in\xA0",n(e.code,{children:"babel.config.js"}),"\xA0or\xA0",n(e.code,{children:"package.json"}),"\u2014this involves adding a little something extra:"]}),`
`,l(e.p,{children:["\u56E0\u4E3A CommonJS \u6A21\u5757\u66F4\u96BE\u505A\u6447\u6811\uFF0C\u6240\u4EE5\u5982\u679C\u4F60\u51B3\u5B9A\u4F7F\u7528\u5B83\u4EEC\uFF0Cwebpack \u5C06\u4E0D\u77E5\u9053\u8981\u4ECE\u6346\u7ED1\u5305\u4E2D\u5220\u9664\u4EC0\u4E48\u3002\u89E3\u51B3\u65B9\u6848\u662F\u914D\u7F6E\u4E3A\xA0",n(e.code,{children:"@babel/preset-env"}),"\xA0\u663E\u5F0F\u4FDD\u7559 ES6 \u6A21\u5757\u3002\u65E0\u8BBA\u4F60\u5728\u4EC0\u4E48\u5730\u65B9\u914D\u7F6E Babel\u2014\u2014\u65E0\u8BBA\u662F\u5728 in\xA0",n(e.code,{children:"babel.config.js"}),"\xA0\u4E2D\u8FD8\u662F\u5728\xA0",n(e.code,{children:"package.json"}),"\xA0- \u8FD9\u90FD\u6D89\u53CA\u6DFB\u52A0\u4E00\u4E9B\u989D\u5916\u7684\u4E1C\u897F\uFF1A"]}),`
`,l(e.div,{className:"language-js line-numbers-mode",style:{backgroundColor:"#2e3440ff"},children:[n(e.button,{className:"copy"}),n(e.span,{className:"lang",children:"js"}),n(e.pre,{children:l(e.code,{className:"",children:[n(e.span,{className:"line",children:n(e.span,{style:{color:"#616E88"},children:"// babel.config.js"})}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#81A1C1"},children:"export"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"default"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#ECEFF4"},children:"{"})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9FF"},children:"  "}),n(e.span,{style:{color:"#88C0D0"},children:"presets"}),n(e.span,{style:{color:"#ECEFF4"},children:":"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" ["})]}),`
`,n(e.span,{className:"line",children:n(e.span,{style:{color:"#D8DEE9FF"},children:"    ["})}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9FF"},children:"      "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"@babel/preset-env"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#ECEFF4"},children:","}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#ECEFF4"},children:"{"})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9FF"},children:"        "}),n(e.span,{style:{color:"#88C0D0"},children:"modules"}),n(e.span,{style:{color:"#ECEFF4"},children:":"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"false"})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9FF"},children:"      "}),n(e.span,{style:{color:"#ECEFF4"},children:"}"})]}),`
`,n(e.span,{className:"line",children:n(e.span,{style:{color:"#D8DEE9FF"},children:"    ]"})}),`
`,n(e.span,{className:"line",children:n(e.span,{style:{color:"#D8DEE9FF"},children:"  ]"})}),`
`,n(e.span,{className:"line",children:n(e.span,{style:{color:"#ECEFF4"},children:"}"})}),`
`,n(e.span,{className:"line"})]})}),l(e.div,{className:"line-numbers-wrapper",children:[n(e.span,{className:"line-number",children:"1"}),n(e.span,{className:"line-number",children:"2"}),n(e.span,{className:"line-number",children:"3"}),n(e.span,{className:"line-number",children:"4"}),n(e.span,{className:"line-number",children:"5"}),n(e.span,{className:"line-number",children:"6"}),n(e.span,{className:"line-number",children:"7"}),n(e.span,{className:"line-number",children:"8"}),n(e.span,{className:"line-number",children:"9"}),n(e.span,{className:"line-number",children:"10"})]})]}),`
`,l(e.p,{children:["Specifying\xA0",n(e.code,{children:"modules: false"}),"\xA0in your\xA0",n(e.code,{children:"@babel/preset-env"}),"\xA0config gets Babel to behave as desired, which allows webpack to analyze your dependency tree and shake off unused dependencies."]}),`
`,l(e.p,{children:["\u5728\u4F60\u7684\xA0",n(e.code,{children:"@babel/preset-env"}),"\xA0\u914D\u7F6E\u4E2D\u6307\u5B9A\xA0",n(e.code,{children:"modules: false"}),"\xA0\u53EF\u4EE5\u8BA9 Babel \u6309\u7167\u9884\u671F\u8FD0\u884C\uFF0C\u8FD9\u5141\u8BB8 webpack \u5206\u6790\u4F60\u7684\u4F9D\u8D56\u6811\u5E76\u6446\u8131\u672A\u4F7F\u7528\u7684\u4F9D\u8D56\u3002"]}),`
`,l(e.h2,{id:"keeping-side-effects-in-mind--\u7262\u8BB0\u526F\u4F5C\u7528",children:[n(e.a,{className:"header-anchor","aria-hidden":"true",href:"#keeping-side-effects-in-mind--\u7262\u8BB0\u526F\u4F5C\u7528",children:"#"}),"Keeping side effects in mind  \u7262\u8BB0\u526F\u4F5C\u7528"]}),`
`,l(e.p,{children:["Another aspect to consider when shaking dependencies from your app is whether your project's modules have side effects. An example of a side effect is when a function modifies something outside of its own scope, which is a\xA0",n(e.em,{children:"side effect"}),"\xA0of its execution:"]}),`
`,n(e.p,{children:"\u4ECE\u5E94\u7528\u4E2D\u6447\u52A8\u4F9D\u8D56\u9879\u65F6\u8981\u8003\u8651\u7684\u53E6\u4E00\u4E2A\u65B9\u9762\u662F\u9879\u76EE\u7684\u6A21\u5757\u662F\u5426\u6709\u526F\u4F5C\u7528\u3002\u526F\u4F5C\u7528\u7684\u4E00\u4E2A\u4F8B\u5B50\u662F\uFF0C\u5F53\u4E00\u4E2A\u51FD\u6570\u4FEE\u6539\u4E86\u5B83\u81EA\u5DF1\u7684\u8303\u56F4\u4E4B\u5916\u7684\u4E1C\u897F\u65F6\uFF0C\u8FD9\u662F\u5176\u6267\u884C\u7684\u526F\u4F5C\u7528\uFF1A"}),`
`,l(e.div,{className:"language-js line-numbers-mode",style:{backgroundColor:"#2e3440ff"},children:[n(e.button,{className:"copy"}),n(e.span,{className:"lang",children:"js"}),n(e.pre,{children:l(e.code,{className:"",children:[l(e.span,{className:"line",children:[n(e.span,{style:{color:"#81A1C1"},children:"let"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#D8DEE9"},children:"fruits"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"="}),n(e.span,{style:{color:"#D8DEE9FF"},children:" ["}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"apple"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#ECEFF4"},children:","}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"orange"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#ECEFF4"},children:","}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"pear"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#D8DEE9FF"},children:"]"}),n(e.span,{style:{color:"#81A1C1"},children:";"})]}),`
`,n(e.span,{className:"line"}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9"},children:"console"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#88C0D0"},children:"log"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"("}),n(e.span,{style:{color:"#D8DEE9"},children:"fruits"}),n(e.span,{style:{color:"#D8DEE9FF"},children:")"}),n(e.span,{style:{color:"#81A1C1"},children:";"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#616E88"},children:'// (3) ["apple", "orange", "pear"]'})]}),`
`,n(e.span,{className:"line"}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#81A1C1"},children:"const"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#88C0D0"},children:"addFruit"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"="}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"function"}),n(e.span,{style:{color:"#ECEFF4"},children:"("}),n(e.span,{style:{color:"#D8DEE9"},children:"fruit"}),n(e.span,{style:{color:"#ECEFF4"},children:")"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#ECEFF4"},children:"{"})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9FF"},children:"  "}),n(e.span,{style:{color:"#D8DEE9"},children:"fruits"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#88C0D0"},children:"push"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"("}),n(e.span,{style:{color:"#D8DEE9"},children:"fruit"}),n(e.span,{style:{color:"#D8DEE9FF"},children:")"}),n(e.span,{style:{color:"#81A1C1"},children:";"})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#ECEFF4"},children:"}"}),n(e.span,{style:{color:"#81A1C1"},children:";"})]}),`
`,n(e.span,{className:"line"}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#88C0D0"},children:"addFruit"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"("}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"kiwi"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#D8DEE9FF"},children:")"}),n(e.span,{style:{color:"#81A1C1"},children:";"})]}),`
`,n(e.span,{className:"line"}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9"},children:"console"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#88C0D0"},children:"log"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"("}),n(e.span,{style:{color:"#D8DEE9"},children:"fruits"}),n(e.span,{style:{color:"#D8DEE9FF"},children:")"}),n(e.span,{style:{color:"#81A1C1"},children:";"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#616E88"},children:'// (4) ["apple", "orange", "pear", "kiwi"]'})]}),`
`,n(e.span,{className:"line"})]})}),l(e.div,{className:"line-numbers-wrapper",children:[n(e.span,{className:"line-number",children:"1"}),n(e.span,{className:"line-number",children:"2"}),n(e.span,{className:"line-number",children:"3"}),n(e.span,{className:"line-number",children:"4"}),n(e.span,{className:"line-number",children:"5"}),n(e.span,{className:"line-number",children:"6"}),n(e.span,{className:"line-number",children:"7"}),n(e.span,{className:"line-number",children:"8"}),n(e.span,{className:"line-number",children:"9"}),n(e.span,{className:"line-number",children:"10"}),n(e.span,{className:"line-number",children:"11"})]})]}),`
`,l(e.p,{children:["In this example,\xA0",n(e.code,{children:"addFruit"}),"\xA0produces a side effect when it modifies the\xA0",n(e.code,{children:"fruits"}),"\xA0array, which is outside its scope."]}),`
`,l(e.p,{children:["\u5728\u6B64\u793A\u4F8B\u4E2D\uFF0C\u5F53\u5B83\u4FEE\u6539\xA0",n(e.code,{children:"fruits"}),"\xA0\u6570\u7EC4\u65F6\u4F1A\u4EA7\u751F\u526F\u4F5C\u7528\uFF0C\xA0",n(e.code,{children:"addFruit"}),"\xA0\u8FD9\u8D85\u51FA\u4E86\u5176\u8303\u56F4\u3002"]}),`
`,l(e.p,{children:["Side effects also apply to ES6 modules, and that matters in the context of tree shaking. Modules that take predictable inputs and produce equally predictable outputs without modifying anything outside of their own scope are dependencies that can be safely dropped if we're not using them. They're self-contained,\xA0",n(e.em,{children:"modular"}),'\xA0pieces of code. Hence, "modules".']}),`
`,n(e.p,{children:"\u526F\u4F5C\u7528\u4E5F\u9002\u7528\u4E8E ES6 \u6A21\u5757\uFF0C\u8FD9\u5728\u6447\u6811\u7684\u80CC\u666F\u4E0B\u5F88\u91CD\u8981\u3002\u91C7\u7528\u53EF\u9884\u6D4B\u7684\u8F93\u5165\u5E76\u4EA7\u751F\u540C\u6837\u53EF\u9884\u6D4B\u7684\u8F93\u51FA\u800C\u4E0D\u4FEE\u6539\u5176\u81EA\u8EAB\u8303\u56F4\u4E4B\u5916\u7684\u4EFB\u4F55\u5185\u5BB9\u7684\u6A21\u5757\u662F\u4F9D\u8D56\u9879\uFF0C\u5982\u679C\u6211\u4EEC\u4E0D\u4F7F\u7528\u5B83\u4EEC\uFF0C\u5219\u53EF\u4EE5\u5B89\u5168\u5730\u5220\u9664\u5B83\u4EEC\u3002\u5B83\u4EEC\u662F\u72EC\u7ACB\u7684\u6A21\u5757\u5316\u4EE3\u7801\u7247\u6BB5\u3002\u56E0\u6B64\uFF0C\u201C\u6A21\u5757\u201D\u3002"}),`
`,l(e.p,{children:["Where webpack is concerned, a hint can be used to specify that a package and its dependencies are free of side effects by specifying\xA0",n(e.code,{children:'"sideEffects": false'}),"\xA0in a project's\xA0",n(e.code,{children:"package.json"}),"\xA0file:"]}),`
`,l(e.p,{children:["\u5C31 webpack \u800C\u8A00\uFF0C\u53EF\u4EE5\u901A\u8FC7\u5728\u9879\u76EE\xA0",n(e.code,{children:"package.json"}),"\xA0\u6587\u4EF6\u4E2D\u6307\u5B9A\u6765\u6307\u5B9A\xA0",n(e.code,{children:'"sideEffects": false'}),"\xA0\u5305\u53CA\u5176\u4F9D\u8D56\u9879\u6CA1\u6709\u526F\u4F5C\u7528\uFF1A"]}),`
`,l(e.div,{className:"language-js line-numbers-mode",style:{backgroundColor:"#2e3440ff"},children:[n(e.button,{className:"copy"}),n(e.span,{className:"lang",children:"js"}),n(e.pre,{children:l(e.code,{className:"",children:[n(e.span,{className:"line",children:n(e.span,{style:{color:"#ECEFF4"},children:"{"})}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9FF"},children:"  "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"name"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#D8DEE9FF"},children:": "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"webpack-tree-shaking-example"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#ECEFF4"},children:","})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9FF"},children:"  "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"version"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#D8DEE9FF"},children:": "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"1.0.0"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#ECEFF4"},children:","})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9FF"},children:"  "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"sideEffects"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#D8DEE9FF"},children:": "}),n(e.span,{style:{color:"#81A1C1"},children:"false"})]}),`
`,n(e.span,{className:"line",children:n(e.span,{style:{color:"#ECEFF4"},children:"}"})}),`
`,n(e.span,{className:"line"})]})}),l(e.div,{className:"line-numbers-wrapper",children:[n(e.span,{className:"line-number",children:"1"}),n(e.span,{className:"line-number",children:"2"}),n(e.span,{className:"line-number",children:"3"}),n(e.span,{className:"line-number",children:"4"}),n(e.span,{className:"line-number",children:"5"})]})]}),`
`,n(e.p,{children:"Alternatively, you can tell webpack which specific files are not side effect-free:"}),`
`,n(e.p,{children:"\u6216\u8005\uFF0C\u4F60\u53EF\u4EE5\u544A\u8BC9 webpack \u54EA\u4E9B\u7279\u5B9A\u6587\u4EF6\u4E0D\u662F\u6CA1\u6709\u526F\u4F5C\u7528\u7684\uFF1A"}),`
`,l(e.div,{className:"language-js line-numbers-mode",style:{backgroundColor:"#2e3440ff"},children:[n(e.button,{className:"copy"}),n(e.span,{className:"lang",children:"js"}),n(e.pre,{children:l(e.code,{className:"",children:[n(e.span,{className:"line",children:n(e.span,{style:{color:"#ECEFF4"},children:"{"})}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9FF"},children:"  "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"name"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#D8DEE9FF"},children:": "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"webpack-tree-shaking-example"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#ECEFF4"},children:","})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9FF"},children:"  "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"version"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#D8DEE9FF"},children:": "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"1.0.0"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#ECEFF4"},children:","})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9FF"},children:"  "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"sideEffects"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#D8DEE9FF"},children:": ["})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9FF"},children:"    "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"./src/utils/utils.js"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'})]}),`
`,n(e.span,{className:"line",children:n(e.span,{style:{color:"#D8DEE9FF"},children:"  ]"})}),`
`,n(e.span,{className:"line",children:n(e.span,{style:{color:"#ECEFF4"},children:"}"})}),`
`,n(e.span,{className:"line"})]})}),l(e.div,{className:"line-numbers-wrapper",children:[n(e.span,{className:"line-number",children:"1"}),n(e.span,{className:"line-number",children:"2"}),n(e.span,{className:"line-number",children:"3"}),n(e.span,{className:"line-number",children:"4"}),n(e.span,{className:"line-number",children:"5"}),n(e.span,{className:"line-number",children:"6"}),n(e.span,{className:"line-number",children:"7"})]})]}),`
`,l(e.p,{children:["In the latter example, any file that isn't specified will be assumed to be free of side effects. If you don't want to add this to your\xA0",n(e.code,{children:"package.json"}),"\xA0file,\xA0",l(e.a,{href:"https://github.com/webpack/webpack/issues/6065#issuecomment-351060570",target:"_blank",rel:"nofollow",children:["you can also specify this flag in your webpack config via\xA0",n(e.code,{children:"module.rules"})]}),"."]}),`
`,l(e.p,{children:["\u5728\u540E\u4E00\u4E2A\u793A\u4F8B\u4E2D\uFF0C\u4EFB\u4F55\u672A\u6307\u5B9A\u7684\u6587\u4EF6\u90FD\u5C06\u88AB\u5047\u5B9A\u4E3A\u6CA1\u6709\u526F\u4F5C\u7528\u3002\u5982\u679C\u60A8\u4E0D\u60F3\u5C06\u5176\u6DFB\u52A0\u5230\u6587\u4EF6\u4E2D\xA0",n(e.code,{children:"package.json"}),"\xA0\uFF0C\u4E5F\u53EF\u4EE5\u901A\u8FC7\xA0",n(e.code,{children:"module.rules"}),"\xA0\u5728 webpack \u914D\u7F6E\u4E2D\u6307\u5B9A\u6B64\u6807\u5FD7\u3002"]}),`
`,l(e.h2,{id:"importing-only-whats-needed--\u4EC5\u5BFC\u5165\u6240\u9700\u5185\u5BB9",children:[n(e.a,{className:"header-anchor","aria-hidden":"true",href:"#importing-only-whats-needed--\u4EC5\u5BFC\u5165\u6240\u9700\u5185\u5BB9",children:"#"}),"Importing only what's needed  \u4EC5\u5BFC\u5165\u6240\u9700\u5185\u5BB9"]}),`
`,l(e.p,{children:["After instructing Babel to leave ES6 modules alone, a slight adjustment to our\xA0",n(e.code,{children:"import"}),"\xA0syntax is required to bring in only the functions needed from the\xA0",n(e.code,{children:"utils"}),"\xA0module. In this guide's example, all that's needed is the\xA0",n(e.code,{children:"simpleSort"}),"\xA0function:"]}),`
`,l(e.p,{children:["\u5728\u6307\u793A Babel \u4E0D\u7406\u4F1A ES6 \u6A21\u5757\u4E4B\u540E\uFF0C\u9700\u8981\u5BF9\u6211\u4EEC\u7684\xA0",n(e.code,{children:"import"}),"\xA0\u8BED\u6CD5\u7A0D\u4F5C\u8C03\u6574\uFF0C\u4EE5\u4EC5\u5F15\u5165\xA0",n(e.code,{children:"utils"}),"\xA0\u6A21\u5757\u6240\u9700\u7684\u51FD\u6570\u3002\u5728\u672C\u6307\u5357\u7684\u793A\u4F8B\u4E2D\uFF0C\u53EA\u9700\u8981\u51FD\u6570\xA0",n(e.code,{children:"simpleSort"}),"\xA0\uFF1A"]}),`
`,l(e.div,{className:"language-js line-numbers-mode",style:{backgroundColor:"#2e3440ff"},children:[n(e.button,{className:"copy"}),n(e.span,{className:"lang",children:"js"}),n(e.pre,{children:l(e.code,{className:"",children:[l(e.span,{className:"line",children:[n(e.span,{style:{color:"#81A1C1"},children:"import"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#ECEFF4"},children:"{"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#8FBCBB"},children:"simpleSort"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#ECEFF4"},children:"}"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"from"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"../../utils/utils"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#81A1C1"},children:";"})]}),`
`,n(e.span,{className:"line"})]})}),n(e.div,{className:"line-numbers-wrapper",children:n(e.span,{className:"line-number",children:"1"})})]}),`
`,l(e.p,{children:["Because only\xA0",n(e.code,{children:"simpleSort"}),"\xA0is being imported instead of the entire\xA0",n(e.code,{children:"utils"}),"\xA0module, every instance of\xA0",n(e.code,{children:"utils.simpleSort"}),"\xA0will need to changed to\xA0",n(e.code,{children:"simpleSort"}),":"]}),`
`,l(e.p,{children:["\u56E0\u4E3A\u53EA\xA0",n(e.code,{children:"simpleSort"}),"\xA0\u5BFC\u5165\u800C\u4E0D\u662F\u5BFC\u5165\u6574\u4E2A\xA0",n(e.code,{children:"utils"}),"\xA0\u6A21\u5757\uFF0C\u6240\u4EE5\u6BCF\u4E2A\xA0",n(e.code,{children:"utils.simpleSort"}),"\xA0\u5B9E\u4F8B\u90FD\u9700\u8981\u66F4\u6539\u4E3A\xA0",n(e.code,{children:"simpleSort"}),"\xA0\uFF1A"]}),`
`,l(e.div,{className:"language-js line-numbers-mode",style:{backgroundColor:"#2e3440ff"},children:[n(e.button,{className:"copy"}),n(e.span,{className:"lang",children:"js"}),n(e.pre,{children:l(e.code,{className:"",children:[l(e.span,{className:"line",children:[n(e.span,{style:{color:"#81A1C1"},children:"if"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" ("}),n(e.span,{style:{color:"#81A1C1"},children:"this"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9"},children:"state"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9"},children:"sortBy"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"==="}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"model"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#D8DEE9FF"},children:") "}),n(e.span,{style:{color:"#ECEFF4"},children:"{"})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9FF"},children:"  "}),n(e.span,{style:{color:"#D8DEE9"},children:"json"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"="}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#88C0D0"},children:"simpleSort"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"("}),n(e.span,{style:{color:"#D8DEE9"},children:"json"}),n(e.span,{style:{color:"#ECEFF4"},children:","}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"model"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#ECEFF4"},children:","}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"this"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9"},children:"state"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9"},children:"sortOrder"}),n(e.span,{style:{color:"#D8DEE9FF"},children:")"}),n(e.span,{style:{color:"#81A1C1"},children:";"})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#ECEFF4"},children:"}"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"else"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"if"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" ("}),n(e.span,{style:{color:"#81A1C1"},children:"this"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9"},children:"state"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9"},children:"sortBy"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"==="}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"type"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#D8DEE9FF"},children:") "}),n(e.span,{style:{color:"#ECEFF4"},children:"{"})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9FF"},children:"  "}),n(e.span,{style:{color:"#D8DEE9"},children:"json"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"="}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#88C0D0"},children:"simpleSort"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"("}),n(e.span,{style:{color:"#D8DEE9"},children:"json"}),n(e.span,{style:{color:"#ECEFF4"},children:","}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"type"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#ECEFF4"},children:","}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"this"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9"},children:"state"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9"},children:"sortOrder"}),n(e.span,{style:{color:"#D8DEE9FF"},children:")"}),n(e.span,{style:{color:"#81A1C1"},children:";"})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#ECEFF4"},children:"}"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"else"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#ECEFF4"},children:"{"})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9FF"},children:"  "}),n(e.span,{style:{color:"#D8DEE9"},children:"json"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"="}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#88C0D0"},children:"simpleSort"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"("}),n(e.span,{style:{color:"#D8DEE9"},children:"json"}),n(e.span,{style:{color:"#ECEFF4"},children:","}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#A3BE8C"},children:"manufacturer"}),n(e.span,{style:{color:"#ECEFF4"},children:'"'}),n(e.span,{style:{color:"#ECEFF4"},children:","}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#81A1C1"},children:"this"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9"},children:"state"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9"},children:"sortOrder"}),n(e.span,{style:{color:"#D8DEE9FF"},children:")"}),n(e.span,{style:{color:"#81A1C1"},children:";"})]}),`
`,n(e.span,{className:"line",children:n(e.span,{style:{color:"#ECEFF4"},children:"}"})}),`
`,n(e.span,{className:"line"})]})}),l(e.div,{className:"line-numbers-wrapper",children:[n(e.span,{className:"line-number",children:"1"}),n(e.span,{className:"line-number",children:"2"}),n(e.span,{className:"line-number",children:"3"}),n(e.span,{className:"line-number",children:"4"}),n(e.span,{className:"line-number",children:"5"}),n(e.span,{className:"line-number",children:"6"}),n(e.span,{className:"line-number",children:"7"})]})]}),`
`,n(e.p,{children:"This should be all that's needed for tree shaking to work in this example. This is the webpack output before shaking the dependency tree:"}),`
`,n(e.p,{children:"\u5728\u6B64\u793A\u4F8B\u4E2D\uFF0C\u8FD9\u5E94\u8BE5\u662F\u6447\u6811\u5DE5\u4F5C\u6240\u9700\u7684\u5168\u90E8\u5185\u5BB9\u3002\u8FD9\u662F\u52A8\u6447\u4F9D\u8D56\u6811\u4E4B\u524D\u7684 webpack \u8F93\u51FA\uFF1A"}),`
`,l(e.div,{className:"language-js line-numbers-mode",style:{backgroundColor:"#2e3440ff"},children:[n(e.button,{className:"copy"}),n(e.span,{className:"lang",children:"js"}),n(e.pre,{children:l(e.code,{className:"",children:[l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9FF"},children:"                 "}),n(e.span,{style:{color:"#D8DEE9"},children:"Asset"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"      "}),n(e.span,{style:{color:"#D8DEE9"},children:"Size"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"  "}),n(e.span,{style:{color:"#D8DEE9"},children:"Chunks"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"             "}),n(e.span,{style:{color:"#D8DEE9"},children:"Chunk"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#D8DEE9"},children:"Names"})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9"},children:"js"}),n(e.span,{style:{color:"#81A1C1"},children:"/"}),n(e.span,{style:{color:"#D8DEE9"},children:"vendors"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9FF"},children:"16262743"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9"},children:"js"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"  "}),n(e.span,{style:{color:"#B48EAD"},children:"37.1"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#D8DEE9"},children:"KiB"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"       "}),n(e.span,{style:{color:"#B48EAD"},children:"0"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"  ["}),n(e.span,{style:{color:"#D8DEE9"},children:"emitted"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"]  "}),n(e.span,{style:{color:"#D8DEE9"},children:"vendors"})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9FF"},children:"   "}),n(e.span,{style:{color:"#D8DEE9"},children:"js"}),n(e.span,{style:{color:"#81A1C1"},children:"/"}),n(e.span,{style:{color:"#D8DEE9"},children:"main"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9FF"},children:"797"}),n(e.span,{style:{color:"#D8DEE9"},children:"ebb8b"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9"},children:"js"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"  "}),n(e.span,{style:{color:"#B48EAD"},children:"20.8"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#D8DEE9"},children:"KiB"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"       "}),n(e.span,{style:{color:"#B48EAD"},children:"1"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"  ["}),n(e.span,{style:{color:"#D8DEE9"},children:"emitted"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"]  "}),n(e.span,{style:{color:"#D8DEE9"},children:"main"})]}),`
`,n(e.span,{className:"line"})]})}),l(e.div,{className:"line-numbers-wrapper",children:[n(e.span,{className:"line-number",children:"1"}),n(e.span,{className:"line-number",children:"2"}),n(e.span,{className:"line-number",children:"3"})]})]}),`
`,l(e.p,{children:["This is the output\xA0",n(e.em,{children:"after"}),"\xA0tree shaking is successful:"]}),`
`,n(e.p,{children:"\u8FD9\u662F\u6447\u6811\u6210\u529F\u540E\u7684\u8F93\u51FA\uFF1A"}),`
`,l(e.div,{className:"language-js line-numbers-mode",style:{backgroundColor:"#2e3440ff"},children:[n(e.button,{className:"copy"}),n(e.span,{className:"lang",children:"js"}),n(e.pre,{children:l(e.code,{className:"",children:[l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9FF"},children:"                 "}),n(e.span,{style:{color:"#D8DEE9"},children:"Asset"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"      "}),n(e.span,{style:{color:"#D8DEE9"},children:"Size"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"  "}),n(e.span,{style:{color:"#D8DEE9"},children:"Chunks"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"             "}),n(e.span,{style:{color:"#D8DEE9"},children:"Chunk"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#D8DEE9"},children:"Names"})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9"},children:"js"}),n(e.span,{style:{color:"#81A1C1"},children:"/"}),n(e.span,{style:{color:"#D8DEE9"},children:"vendors"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9FF"},children:"45"}),n(e.span,{style:{color:"#D8DEE9"},children:"ce9b64"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9"},children:"js"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"  "}),n(e.span,{style:{color:"#B48EAD"},children:"36.9"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#D8DEE9"},children:"KiB"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"       "}),n(e.span,{style:{color:"#B48EAD"},children:"0"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"  ["}),n(e.span,{style:{color:"#D8DEE9"},children:"emitted"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"]  "}),n(e.span,{style:{color:"#D8DEE9"},children:"vendors"})]}),`
`,l(e.span,{className:"line",children:[n(e.span,{style:{color:"#D8DEE9FF"},children:"   "}),n(e.span,{style:{color:"#D8DEE9"},children:"js"}),n(e.span,{style:{color:"#81A1C1"},children:"/"}),n(e.span,{style:{color:"#D8DEE9"},children:"main"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9FF"},children:"559652"}),n(e.span,{style:{color:"#D8DEE9"},children:"be"}),n(e.span,{style:{color:"#ECEFF4"},children:"."}),n(e.span,{style:{color:"#D8DEE9"},children:"js"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"  "}),n(e.span,{style:{color:"#B48EAD"},children:"8.46"}),n(e.span,{style:{color:"#D8DEE9FF"},children:" "}),n(e.span,{style:{color:"#D8DEE9"},children:"KiB"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"       "}),n(e.span,{style:{color:"#B48EAD"},children:"1"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"  ["}),n(e.span,{style:{color:"#D8DEE9"},children:"emitted"}),n(e.span,{style:{color:"#D8DEE9FF"},children:"]  "}),n(e.span,{style:{color:"#D8DEE9"},children:"main"})]}),`
`,n(e.span,{className:"line"})]})}),l(e.div,{className:"line-numbers-wrapper",children:[n(e.span,{className:"line-number",children:"1"}),n(e.span,{className:"line-number",children:"2"}),n(e.span,{className:"line-number",children:"3"})]})]}),`
`,l(e.p,{children:["While both bundles shrank, it's really the\xA0",n(e.code,{children:"main"}),"\xA0bundle that benefits most. By shaking off the unused parts of the\xA0",n(e.code,{children:"utils"}),"\xA0module, the\xA0",n(e.code,{children:"main"}),"\xA0bundle shrinks by about 60%. This not only lowers the amount of time the script takes to the download, but processing time as well."]}),`
`,l(e.p,{children:["\u867D\u7136\u4E24\u4E2A\u6346\u7ED1\u5305\u90FD\u7F29\u5C0F\u4E86\uFF0C\u4F46\u53D7\u76CA\u6700\u5927\u7684\u786E\u5B9E\u662F\xA0",n(e.code,{children:"main"}),"\xA0\u6346\u7ED1\u5305\u3002\u901A\u8FC7\u7529\u6389\xA0",n(e.code,{children:"utils"}),"\xA0\u6A21\u5757\u4E2D\u672A\u4F7F\u7528\u7684\u90E8\u5206\uFF0C\xA0",n(e.code,{children:"main"}),"\xA0\u675F\u6536\u7F29\u7EA660%\u3002\u8FD9\u4E0D\u4EC5\u51CF\u5C11\u4E86\u811A\u672C\u4E0B\u8F7D\u6240\u9700\u7684\u65F6\u95F4\uFF0C\u8FD8\u51CF\u5C11\u4E86\u5904\u7406\u65F6\u95F4\u3002"]}),`
`,l(e.h2,{id:"go-shake-some-trees\u53BB\u6447\u6643\u4E00\u4E9B\u6811",children:[n(e.a,{className:"header-anchor","aria-hidden":"true",href:"#go-shake-some-trees\u53BB\u6447\u6643\u4E00\u4E9B\u6811",children:"#"}),"Go shake some trees!\xA0\u53BB\u6447\u6643\u4E00\u4E9B\u6811\uFF01"]}),`
`,n(e.p,{children:"Whatever mileage you get out of tree shaking depends on your app and its dependencies and architecture. Try it! If you know for a fact you haven't set up your module bundler to perform this optimization, there's no harm trying and seeing how it benefits your application."}),`
`,n(e.p,{children:"\u65E0\u8BBA\u60A8\u4ECE\u6447\u6811\u4E2D\u83B7\u5F97\u4EC0\u4E48\u597D\u5904\uFF0C\u90FD\u53D6\u51B3\u4E8E\u60A8\u7684\u5E94\u7528\u53CA\u5176\u4F9D\u8D56\u9879\u548C\u4F53\u7CFB\u7ED3\u6784\u3002\u8BD5\u8BD5\u5427\uFF01\u5982\u679C\u60A8\u77E5\u9053\u60A8\u8FD8\u6CA1\u6709\u8BBE\u7F6E\u6A21\u5757\u6346\u7ED1\u5668\u6765\u6267\u884C\u6B64\u4F18\u5316\uFF0C\u90A3\u4E48\u5C1D\u8BD5\u5E76\u4E86\u89E3\u5B83\u5982\u4F55\u4F7F\u60A8\u7684\u5E94\u7528\u7A0B\u5E8F\u53D7\u76CA\u5E76\u6CA1\u6709\u4EC0\u4E48\u574F\u5904\u3002"}),`
`,n(e.p,{children:"You may realize a significant performance gain from tree shaking, or not much at all. But by configuring your build system to take advantage of this optimization in production builds and selectively importing only what your application needs, you'll be proactively keeping your application bundles as small as possible."}),`
`,n(e.p,{children:"\u60A8\u53EF\u80FD\u4F1A\u4ECE\u6447\u6811\u4E2D\u83B7\u5F97\u663E\u7740\u7684\u6027\u80FD\u63D0\u5347\uFF0C\u6216\u8005\u6839\u672C\u6CA1\u6709\u5B9E\u73B0\u3002\u4F46\u662F\uFF0C\u901A\u8FC7\u914D\u7F6E\u6784\u5EFA\u7CFB\u7EDF\u4EE5\u5728\u751F\u4EA7\u6784\u5EFA\u4E2D\u5229\u7528\u6B64\u4F18\u5316\uFF0C\u5E76\u6709\u9009\u62E9\u5730\u4EC5\u5BFC\u5165\u5E94\u7528\u7A0B\u5E8F\u6240\u9700\u7684\u5185\u5BB9\uFF0C\u60A8\u5C06\u4E3B\u52A8\u4FDD\u6301\u5E94\u7528\u7A0B\u5E8F\u6346\u7ED1\u5305\u5C3D\u53EF\u80FD\u5C0F\u3002"}),`
`,l(e.p,{children:["_Special thanks to Kristofer Baxter,\xA0",n(e.a,{href:"https://web.dev/authors/developit",target:"_blank",rel:"nofollow",children:"Jason Miller"}),",\xA0",n(e.a,{href:"https://web.dev/authors/addyosmani",target:"_blank",rel:"nofollow",children:"Addy Osmani"}),",\xA0",n(e.a,{href:"https://web.dev/authors/jeffposnick",target:"_blank",rel:"nofollow",children:"Jeff Posnick"}),", Sam Saccone, and\xA0",n(e.a,{href:"https://web.dev/authors/philipwalton",target:"_blank",rel:"nofollow",children:"Philip Walton"}),"\xA0for their valuable feedback, which significantly improved the quality of this article."]}),`
`,n(e.p,{children:"\u7279\u522B\u611F\u8C22 Kristofer Baxter\u3001Jason Miller\u3001Addy Osmani\u3001Jeff Posnick\u3001Sam Saccone \u548C Philip Walton \u7684\u5B9D\u8D35\u53CD\u9988\uFF0C\u8FD9\u5927\u5927\u63D0\u9AD8\u4E86\u672C\u6587\u7684\u8D28\u91CF\u3002_"})]})}function d(s={}){const{wrapper:e}=s.components||{};return e?n(e,Object.assign({},s,{children:n(o,s)})):o(s)}const h="2023/11/16 20:32:02",p=`# \u901A\u8FC7\u6447\u6811\u51CF\u5C11 JavaScript \u6709\u6548\u8D1F\u8F7D


\`metadata:\`

**\u539F\u6807\u9898:** Reduce JavaScript payloads with tree shaking

**\u94FE\u63A5:** https://web.dev/articles/reduce-javascript-payloads-with-tree-shaking

---

Today's web applications can get pretty big, especially the JavaScript part of them. As of mid-2018, HTTP Archive puts the\xA0[median transfer size of JavaScript on mobile devices](https://httparchive.org/reports/state-of-javascript#bytesJs)\xA0at approximately 350 KB. And this is just transfer size! JavaScript is often compressed when sent over the network, meaning that the\xA0_actual_\xA0amount of JavaScript is quite a bit more after the browser decompresses it. That's important to point out, because as far as resource\xA0_processing_\xA0is concerned, compression is irrelevant. 900 KB of decompressed JavaScript is still 900 KB to the parser and compiler, even though it may be roughly 300 KB when compressed.  

\u4ECA\u5929\u7684 Web \u5E94\u7528\u7A0B\u5E8F\u53EF\u80FD\u4F1A\u53D8\u5F97\u975E\u5E38\u5927\uFF0C\u5C24\u5176\u662F\u5176\u4E2D\u7684 JavaScript \u90E8\u5206\u3002\u622A\u81F3 2018 \u5E74\u5E74\u4E2D\uFF0CHTTP Archive \u5C06 JavaScript \u5728\u79FB\u52A8\u8BBE\u5907\u4E0A\u7684\u4F20\u8F93\u5927\u5C0F\u4E2D\u4F4D\u6570\u5B9A\u4E3A\u7EA6 350 KB\u3002\u800C\u8FD9\u53EA\u662F\u4F20\u8F93\u5927\u5C0F\uFF01JavaScript \u5728\u901A\u8FC7\u7F51\u7EDC\u53D1\u9001\u65F6\u901A\u5E38\u4F1A\u88AB\u538B\u7F29\uFF0C\u8FD9\u610F\u5473\u7740\u5728\u6D4F\u89C8\u5668\u89E3\u538B\u7F29\u540E\uFF0CJavaScript \u7684\u5B9E\u9645\u6570\u91CF\u4F1A\u591A\u5F97\u591A\u3002\u9700\u8981\u6307\u51FA\u7684\u662F\uFF0C\u5C31\u8D44\u6E90\u5904\u7406\u800C\u8A00\uFF0C\u538B\u7F29\u662F\u65E0\u5173\u7D27\u8981\u7684\u3002900 KB \u7684\u89E3\u538B\u7F29 JavaScript \u5BF9\u4E8E\u89E3\u6790\u5668\u548C\u7F16\u8BD1\u5668\u6765\u8BF4\u4ECD\u7136\u662F 900 KB\uFF0C\u5373\u4F7F\u538B\u7F29\u540E\u53EF\u80FD\u5927\u7EA6 300 KB\u3002

![20231116112020](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116112020.png)
*The process of downloading and running JavaScript. Note that even though the transfer size of the script is 300 KB compressed, it is still 900 KB worth of JavaScript that must be parsed, compiled, and executed.*

*\u4E0B\u8F7D\u548C\u8FD0\u884C JavaScript \u7684\u8FC7\u7A0B\u3002\u8BF7\u6CE8\u610F\uFF0C\u5373\u4F7F\u811A\u672C\u7684\u4F20\u8F93\u5927\u5C0F\u538B\u7F29\u4E3A 300 KB\uFF0C\u4F46\u4ECD\u5FC5\u987B\u89E3\u6790\u3001\u7F16\u8BD1\u548C\u6267\u884C 900 KB \u7684 JavaScript\u3002*

JavaScript is an expensive resource to process. Unlike images which only incur relatively trivial decode time once downloaded, JavaScript must be parsed, compiled, and then finally executed. Byte for byte, this makes JavaScript more expensive than other types of resources.  

JavaScript \u662F\u4E00\u79CD\u6602\u8D35\u7684\u5904\u7406\u8D44\u6E90\u3002\u4E0E\u4E0B\u8F7D\u540E\u4EC5\u4EA7\u751F\u76F8\u5BF9\u5FAE\u4E0D\u8DB3\u9053\u7684\u89E3\u7801\u65F6\u95F4\u7684\u56FE\u50CF\u4E0D\u540C\uFF0CJavaScript \u5FC5\u987B\u7ECF\u8FC7\u89E3\u6790\u3001\u7F16\u8BD1\uFF0C\u7136\u540E\u6700\u7EC8\u6267\u884C\u3002\u9010\u5B57\u8282\uFF0C\u8FD9\u4F7F\u5F97 JavaScript \u6BD4\u5176\u4ED6\u7C7B\u578B\u7684\u8D44\u6E90\u66F4\u6602\u8D35\u3002

![20231116112125](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116112125.png)
*The processing cost of parsing/compiling 170 KB of JavaScript vs decode time of an equivalently sized JPEG. ([source](https://medium.com/dev-channel/the-cost-of-javascript-84009f51e99e)).*

*\u89E3\u6790/\u7F16\u8BD1 170 KB JavaScript \u7684\u5904\u7406\u6210\u672C\u4E0E\u540C\u7B49\u5927\u5C0F\u7684 JPEG \u7684\u89E3\u7801\u65F6\u95F4\u4E4B\u6BD4\u3002\uFF08\u6765\u6E90\uFF09.*

[While improvements are continually being made](https://v8.dev/blog/background-compilation)\xA0to\xA0[improve the efficiency of JavaScript engines](https://blog.mozilla.org/javascript/2017/12/12/javascript-startup-bytecode-cache/), improving JavaScript performance is\u2014as always\u2014a task for developers.  

\u867D\u7136\u4E0D\u65AD\u8FDB\u884C\u6539\u8FDB\u4EE5\u63D0\u9AD8 JavaScript \u5F15\u64CE\u7684\u6548\u7387\uFF0C\u4F46\u63D0\u9AD8 JavaScript \u6027\u80FD\u4E00\u5982\u65E2\u5F80\u5730\u662F\u5F00\u53D1\u4EBA\u5458\u7684\u4EFB\u52A1\u3002

To that end, there are techniques to improve JavaScript performance.\xA0[Code splitting](https://web.dev/articles/reduce-javascript-payloads-with-code-splitting), is one such technique that improves performance by partitioning application JavaScript into chunks, and serving those chunks to only the routes of an application that need them.  

\u4E3A\u6B64\uFF0C\u6709\u4E00\u4E9B\u6280\u672F\u53EF\u4EE5\u63D0\u9AD8 JavaScript \u6027\u80FD\u3002\u4EE3\u7801\u62C6\u5206\u5C31\u662F\u8FD9\u6837\u4E00\u79CD\u6280\u672F\uFF0C\u5B83\u901A\u8FC7\u5C06\u5E94\u7528\u7A0B\u5E8F JavaScript \u5212\u5206\u4E3A\u591A\u4E2A\u5757\uFF0C\u5E76\u5C06\u8FD9\u4E9B\u5757\u4EC5\u63D0\u4F9B\u7ED9\u9700\u8981\u5B83\u4EEC\u7684\u5E94\u7528\u7A0B\u5E8F\u7684\u8DEF\u7531\u6765\u63D0\u9AD8\u6027\u80FD\u3002

While this technique works, it doesn't address a common problem of JavaScript-heavy applications, which is the inclusion of code that's never used. Tree shaking attempts to solve this problem.  

\u867D\u7136\u8FD9\u79CD\u6280\u672F\u6709\u6548\uFF0C\u4F46\u5B83\u5E76\u6CA1\u6709\u89E3\u51B3 JavaScript \u5BC6\u96C6\u578B\u5E94\u7528\u7A0B\u5E8F\u7684\u5E38\u89C1\u95EE\u9898\uFF0C\u5373\u5305\u542B\u4ECE\u672A\u4F7F\u7528\u8FC7\u7684\u4EE3\u7801\u3002\u6447\u6811\u8BD5\u56FE\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\u3002

## What is tree shaking?  \u4EC0\u4E48\u662F\u6447\u6811\uFF1F

[Tree shaking](https://en.wikipedia.org/wiki/Tree_shaking)\xA0is a form of dead code elimination.\xA0[The term was popularized by Rollup](https://github.com/rollup/rollup#tree-shaking), but the concept of dead code elimination has existed for some time. The concept has also found purchase in\xA0[webpack](https://webpack.js.org/guides/tree-shaking/), which is demonstrated in this article by way of a sample app.  

\u6447\u6811\u662F\u6D88\u9664\u6B7B\u4EE3\u7801\u7684\u4E00\u79CD\u5F62\u5F0F\u3002\u8BE5\u672F\u8BED\u7531 Rollup \u63A8\u5E7F\uFF0C\u4F46\u6B7B\u4EE3\u7801\u6D88\u9664\u7684\u6982\u5FF5\u5DF2\u7ECF\u5B58\u5728\u4E86\u4E00\u6BB5\u65F6\u95F4\u3002\u8FD9\u4E2A\u6982\u5FF5\u5728 webpack \u4E2D\u4E5F\u5F97\u5230\u4E86\u8D2D\u4E70\uFF0C\u672C\u6587\u901A\u8FC7\u4E00\u4E2A\u793A\u4F8B\u5E94\u7528\u7A0B\u5E8F\u8FDB\u884C\u4E86\u6F14\u793A\u3002

The term "tree shaking" comes from the mental model of your application and its dependencies as a tree-like structure. Each node in the tree represents a dependency that provides distinct functionality for your app. In modern apps, these dependencies are brought in via\xA0[static\xA0\`import\`\xA0statements](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/import)\xA0like so:  

\u672F\u8BED\u201C\u6447\u6811\u201D\u6765\u81EA\u5E94\u7528\u7A0B\u5E8F\u7684\u5FC3\u667A\u6A21\u578B\u53CA\u5176\u4F5C\u4E3A\u6811\u72B6\u7ED3\u6784\u7684\u4F9D\u8D56\u5173\u7CFB\u3002\u6811\u4E2D\u7684\u6BCF\u4E2A\u8282\u70B9\u90FD\u8868\u793A\u4E00\u4E2A\u4F9D\u8D56\u9879\uFF0C\u8BE5\u4F9D\u8D56\u9879\u4E3A\u5E94\u7528\u63D0\u4F9B\u4E0D\u540C\u7684\u529F\u80FD\u3002\u5728\u73B0\u4EE3\u5E94\u7528\u4E2D\uFF0C\u8FD9\u4E9B\u4F9D\u8D56\u9879\u662F\u901A\u8FC7\u9759\u6001\xA0\`import\`\xA0\u8BED\u53E5\u5F15\u5165\u7684\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A

\`\`\`js
// Import all the array utilities!
import arrayUtils from "array-utils";
\`\`\`

:::info
**Note:** If you're not sure what ES6 modules are,\xA0[this explainer at Pony Foo](https://ponyfoo.com/articles/es6-modules-in-depth)\xA0is worth a look. This guide assumes you have working knowledge of how ES6 modules work, so if you don't know anything about them, give that article a read!  

\u6CE8\u610F\uFF1A\u5982\u679C\u60A8\u4E0D\u786E\u5B9A ES6 \u6A21\u5757\u662F\u4EC0\u4E48\uFF0CPony Foo \u7684\u8FD9\u4E2A\u89E3\u91CA\u5668\u503C\u5F97\u4E00\u770B\u3002\u672C\u6307\u5357\u5047\u8BBE\u60A8\u5BF9 ES6 \u6A21\u5757\u7684\u5DE5\u4F5C\u539F\u7406\u6709\u4E00\u5B9A\u7684\u4E86\u89E3\uFF0C\u6240\u4EE5\u5982\u679C\u4F60\u5BF9\u5B83\u4EEC\u4E00\u65E0\u6240\u77E5\uFF0C\u8BF7\u9605\u8BFB\u8FD9\u7BC7\u6587\u7AE0\uFF01
:::

When an app is young\u2014a sapling, if you will\u2014it may have few dependencies. It's also using most\u2014if not all\u2014the dependencies you add. As your app matures, however, more dependencies can get added. To compound matters, older dependencies fall out of use, but may not get pruned from your codebase. The end result is that an app ends up shipping with a lot of\xA0[unused JavaScript](https://web.dev/unused-javascript). Tree shaking addresses this by taking advantage of how static\xA0\`import\`\xA0statements pull in specific parts of ES6 modules:  

\u5F53\u4E00\u4E2A\u5E94\u7528\u7A0B\u5E8F\u8FD8\u5F88\u5E74\u8F7B\u65F6\uFF08\u5982\u679C\u4F60\u613F\u610F\u7684\u8BDD\uFF0C\u5B83\u662F\u4E00\u68F5\u6811\u82D7\uFF09\uFF0C\u5B83\u53EF\u80FD\u51E0\u4E4E\u6CA1\u6709\u4F9D\u8D56\u5173\u7CFB\u3002\u5B83\u8FD8\u4F7F\u7528\u60A8\u6DFB\u52A0\u7684\u5927\u591A\u6570\uFF08\u5982\u679C\u4E0D\u662F\u5168\u90E8\uFF09\u4F9D\u8D56\u9879\u3002\u4F46\u662F\uFF0C\u968F\u7740\u5E94\u7528\u7684\u6210\u719F\uFF0C\u53EF\u4EE5\u6DFB\u52A0\u66F4\u591A\u4F9D\u8D56\u9879\u3002\u96EA\u4E0A\u52A0\u971C\u7684\u662F\uFF0C\u8F83\u65E7\u7684\u4F9D\u8D56\u9879\u4E0D\u518D\u4F7F\u7528\uFF0C\u4F46\u53EF\u80FD\u4E0D\u4F1A\u4ECE\u4EE3\u7801\u5E93\u4E2D\u5220\u9664\u3002\u6700\u7EC8\u7ED3\u679C\u662F\uFF0C\u4E00\u4E2A\u5E94\u7528\u7A0B\u5E8F\u6700\u7EC8\u4F1A\u9644\u5E26\u5927\u91CF\u672A\u4F7F\u7528\u7684 JavaScript\u3002\u6447\u6811\u901A\u8FC7\u5229\u7528\u9759\u6001\xA0\`import\`\xA0\u8BED\u53E5\u5982\u4F55\u62C9\u5165 ES6 \u6A21\u5757\u7684\u7279\u5B9A\u90E8\u5206\u6765\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\uFF1A

\`\`\`js
// Import only some of the utilities!
import { unique, implode, explode } from "array-utils";
\`\`\`

The difference between this\xA0\`import\`\xA0example and the previous one is that rather than importing\xA0_everything_\xA0from the\xA0\`"array-utils"\`\xA0module\u2014which could be a lot of code)\u2014this example imports only specific parts of it. In dev builds, this doesn't change anything, as the entire module gets imported regardless. In production builds, webpack can be configured to "shake" off\xA0[exports](https://developer.mozilla.org/docs/web/javascript/reference/statements/export)\xA0from ES6 modules that weren't explicitly imported, making those production builds smaller. In this guide, you'll learn how to do just that!  

\u6B64\u793A\u4F8B\u4E0E\u4E0A\u4E00\u4E2A\u793A\u4F8B\u7684\u533A\u522B\u5728\u4E8E\uFF0C\u6B64\xA0\`import\`\xA0\u793A\u4F8B\u4E0D\u662F\u4ECE\u6A21\u5757\u4E2D\u5BFC\u5165\u6240\u6709\u5185\u5BB9\uFF08\u53EF\u80FD\u662F\u5927\u91CF\u4EE3\u7801\uFF09\uFF0C\u800C\u662F\u4EC5\u5BFC\u5165\xA0\`"array-utils"\`\xA0\u6A21\u5757\u7684\u7279\u5B9A\u90E8\u5206\u3002\u5728\u5F00\u53D1\u7248\u672C\u4E2D\uFF0C\u8FD9\u4E0D\u4F1A\u6539\u53D8\u4EFB\u4F55\u4E8B\u60C5\uFF0C\u56E0\u4E3A\u65E0\u8BBA\u5982\u4F55\u90FD\u4F1A\u5BFC\u5165\u6574\u4E2A\u6A21\u5757\u3002\u5728\u751F\u4EA7\u7248\u672C\u4E2D\uFF0Cwebpack \u53EF\u4EE5\u914D\u7F6E\u4E3A\u201C\u6446\u8131\u201D\u672A\u663E\u5F0F\u5BFC\u5165\u7684 ES6 \u6A21\u5757\u7684\u5BFC\u51FA\uFF0C\u4ECE\u800C\u4F7F\u8FD9\u4E9B\u751F\u4EA7\u7248\u672C\u66F4\u5C0F\u3002\u5728\u672C\u6307\u5357\u4E2D\uFF0C\u60A8\u5C06\u5B66\u4E60\u5982\u4F55\u505A\u5230\u8FD9\u4E00\u70B9\uFF01

## Finding opportunities to shake a tree  \u5BFB\u627E\u673A\u4F1A\u6447\u6643\u4E00\u68F5\u6811

For illustrative purposes,\xA0[a sample one-page app](https://github.com/malchata/webpack-tree-shaking-example)\xA0is available that demonstrates how tree shaking works. You can clone it and follow along if you like, but we'll cover every step of the way together in this guide, so cloning isn't necessary (unless hands-on learning is your thing).  

\u4E3A\u4E86\u4FBF\u4E8E\u8BF4\u660E\uFF0C\u63D0\u4F9B\u4E86\u4E00\u4E2A\u793A\u4F8B\u5355\u9875\u5E94\u7528\u7A0B\u5E8F\uFF0C\u7528\u4E8E\u6F14\u793A\u6447\u6811\u7684\u5DE5\u4F5C\u539F\u7406\u3002\u5982\u679C\u60A8\u613F\u610F\uFF0C\u60A8\u53EF\u4EE5\u514B\u9686\u5B83\u5E76\u8DDF\u968F\u5B83\uFF0C\u4F46\u6211\u4EEC\u5C06\u5728\u672C\u6307\u5357\u4E2D\u4E00\u8D77\u4ECB\u7ECD\u6BCF\u4E00\u6B65\uFF0C\u56E0\u6B64\u514B\u9686\u4E0D\u662F\u5FC5\u9700\u7684\uFF08\u9664\u975E\u60A8\u559C\u6B22\u52A8\u624B\u5B66\u4E60\uFF09\u3002

The sample app is a searchable database of guitar effect pedals. You enter a query and a list of effect pedals will appear.  

\u793A\u4F8B\u5E94\u7528\u662F\u5409\u4ED6\u6548\u679C\u8E0F\u677F\u7684\u53EF\u641C\u7D22\u6570\u636E\u5E93\u3002\u60A8\u8F93\u5165\u67E5\u8BE2\uFF0C\u5C06\u51FA\u73B0\u6548\u679C\u8E0F\u677F\u5217\u8868\u3002

![20231116112856](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116112856.png)

The behavior that drives this app is separated into vendor (i.e.,\xA0[Preact](https://preactjs.com/)\xA0and\xA0[Emotion](https://emotion.sh/)) and app-specific code bundles (or "chunks", as webpack calls them):  

\u9A71\u52A8\u6B64\u5E94\u7528\u7A0B\u5E8F\u7684\u884C\u4E3A\u5206\u4E3A\u4F9B\u5E94\u5546\uFF08\u5373 Preact \u548C Emotion\uFF09\u548C\u7279\u5B9A\u4E8E\u5E94\u7528\u7A0B\u5E8F\u7684\u4EE3\u7801\u5305\uFF08\u6216 webpack \u79F0\u4E4B\u4E3A\u201C\u5757\u201D\uFF09\uFF1A

![20231116112919](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116112919.png)

The JavaScript bundles shown in the figure above are production builds, meaning they're optimized through uglification. 21.1 KB for an app-specific bundle isn't bad, but it should be noted that no tree shaking is occurring whatsoever. Let's look at the app code and see what can be done to fix that.  

\u4E0A\u56FE\u4E2D\u663E\u793A\u7684 JavaScript \u5305\u662F\u751F\u4EA7\u7248\u672C\uFF0C\u8FD9\u610F\u5473\u7740\u5B83\u4EEC\u901A\u8FC7\u4E11\u5316\u8FDB\u884C\u4E86\u4F18\u5316\u300221.1 KB \u5BF9\u4E8E\u7279\u5B9A\u4E8E\u5E94\u7528\u7A0B\u5E8F\u7684\u6346\u7ED1\u5305\u6765\u8BF4\u8FD8\u4E0D\u9519\uFF0C\u4F46\u5E94\u8BE5\u6CE8\u610F\u7684\u662F\uFF0C\u6CA1\u6709\u53D1\u751F\u4EFB\u4F55\u6447\u6811\u3002\u8BA9\u6211\u4EEC\u770B\u4E00\u4E0B\u5E94\u7528\u4EE3\u7801\uFF0C\u770B\u770B\u53EF\u4EE5\u505A\u4E9B\u4EC0\u4E48\u6765\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\u3002

:::info
**Note:**\xA0If you don't care for a long-winded explanation, and want to dive into code, go ahead and check out\xA0[the\xA0\`tree-shake\`\xA0branch](https://github.com/malchata/webpack-tree-shaking-example/tree/tree-shake)\xA0in the app's GitHub repo. You can also\xA0[diff this branch](https://github.com/malchata/webpack-tree-shaking-example/compare/tree-shake)\xA0to see exactly what was changed to make tree shaking work!  

\u6CE8\u610F\uFF1A\u5982\u679C\u60A8\u4E0D\u5173\u5FC3\u5197\u957F\u7684\u89E3\u91CA\uFF0C\u5E76\u4E14\u60F3\u8981\u6DF1\u5165\u7814\u7A76\u4EE3\u7801\uFF0C\u8BF7\u7EE7\u7EED\u67E5\u770B\u5E94\u7528\u7A0B\u5E8F\u7684 GitHub \u5B58\u50A8\u5E93\u4E2D\u7684\xA0\`tree-shake\`\xA0\u5206\u652F\u3002\u60A8\u8FD8\u53EF\u4EE5\u6BD4\u8F83\u6B64\u5206\u652F\uFF0C\u4EE5\u786E\u5207\u5730\u67E5\u770B\u4E3A\u4F7F\u6447\u6811\u5DE5\u4F5C\u800C\u66F4\u6539\u7684\u5185\u5BB9\uFF01
:::

In any application, finding tree shaking opportunities are going to involve looking for static\xA0\`import\`\xA0statements.\xA0[Near the top of the main component file](https://github.com/malchata/webpack-tree-shaking-example/blob/master/src/components/FilterablePedalList/FilterablePedalList.js#L4), you'll see a line like this:  

\u5728\u4EFB\u4F55\u5E94\u7528\u7A0B\u5E8F\u4E2D\uFF0C\u5BFB\u627E\u6447\u6811\u673A\u4F1A\u90FD\u5C06\u6D89\u53CA\u5BFB\u627E\u9759\u6001\xA0\`import\`\xA0\u8BED\u53E5\u3002\u5728\u4E3B\u7EC4\u4EF6\u6587\u4EF6\u7684\u9876\u90E8\u9644\u8FD1\uFF0C\u60A8\u4F1A\u770B\u5230\u5982\u4E0B\u884C\uFF1A

\`\`\`js
import * as utils from "../../utils/utils";
\`\`\`
You can\xA0[import ES6 modules in a variety of ways](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/import#description), but ones like this should get your attention. This specific line says "\`import\`\xA0_everything_\xA0from the\xA0\`utils\`\xA0module, and put it in a namespace called\xA0\`utils\`." The big question to ask here is, "just how much\xA0_stuff_\xA0is in that module?"  

\u60A8\u53EF\u4EE5\u901A\u8FC7\u591A\u79CD\u65B9\u5F0F\u5BFC\u5165 ES6 \u6A21\u5757\uFF0C\u4F46\u50CF\u8FD9\u6837\u7684\u6A21\u5757\u5E94\u8BE5\u5F15\u8D77\u60A8\u7684\u6CE8\u610F\u3002\u8FD9\u4E00\u884C\u8BF4\u201C\xA0\`import\`\xA0\`utils\`\xA0\u6A21\u5757\u4E2D\u7684\u6240\u6709\u5185\u5BB9\uFF0C\u5E76\u5C06\u5176\u653E\u5728\u540D\u4E3A\xA0\`utils\`\xA0\u7684\u547D\u540D\u7A7A\u95F4\u4E2D\u3002\u8FD9\u91CC\u8981\u95EE\u7684\u4E00\u4E2A\u5927\u95EE\u9898\u662F\uFF0C\u201C\u90A3\u4E2A\u6A21\u5757\u4E2D\u5230\u5E95\u6709\u591A\u5C11\u4E1C\u897F\uFF1F

If you look at\xA0[the\xA0\`utils\`\xA0module source code](https://github.com/malchata/webpack-tree-shaking-example/blob/master/src/utils/utils.js), you'll find there's about 1,300 lines of code.  

\u5982\u679C\u4F60\u770B\u4E00\u4E0B\xA0\`utils\`\xA0\u6A21\u5757\u7684\u6E90\u4EE3\u7801\uFF0C\u4F60\u4F1A\u53D1\u73B0\u5927\u7EA6\u6709 1,300 \u884C\u4EE3\u7801\u3002

Do you\xA0_need_\xA0all that stuff? Let's double check by searching\xA0[the main component file](https://github.com/malchata/webpack-tree-shaking-example/blob/master/src/components/FilterablePedalList/FilterablePedalList.js)\xA0that imports the\xA0\`utils\`\xA0module to see how many instances of that namespace come up.  

\u4F60\u9700\u8981\u6240\u6709\u8FD9\u4E9B\u4E1C\u897F\u5417\uFF1F\u8BA9\u6211\u4EEC\u901A\u8FC7\u641C\u7D22\u5BFC\u5165\xA0\`utils\`\xA0\u6A21\u5757\u7684\u4E3B\u7EC4\u4EF6\u6587\u4EF6\u6765\u4ED4\u7EC6\u68C0\u67E5\uFF0C\u770B\u770B\u8BE5\u547D\u540D\u7A7A\u95F4\u6709\u591A\u5C11\u4E2A\u5B9E\u4F8B\u3002

![20231116113023](https://blog-1318409910.cos.ap-beijing.myqcloud.com/blog/20231116113023.png)
*The\xA0\`utils\`\xA0namespace we've imported tons of modules from is only invoked three times within the main component file.*

*\u6211\u4EEC\u4ECE\u4E2D\u5BFC\u5165\u4E86\u5927\u91CF\u6A21\u5757\u7684\xA0\`utils\`\xA0\u547D\u540D\u7A7A\u95F4\u5728\u4E3B\u7EC4\u4EF6\u6587\u4EF6\u4E2D\u53EA\u8C03\u7528\u4E86\u4E09\u6B21\u3002*

As it turns out, the\xA0\`utils\`\xA0namespace appears in only three spots in our application\u2014but for what functions? If you take a look at the main component file again, it appears to be only one function, which is\xA0\`utils.simpleSort\`, which is used to sort the search results list by a number of criteria when the sorting dropdowns are changed:  

\u4E8B\u5B9E\u8BC1\u660E\uFF0C\xA0\`utils\`\xA0\u547D\u540D\u7A7A\u95F4\u5728\u6211\u4EEC\u7684\u5E94\u7528\u7A0B\u5E8F\u4E2D\u53EA\u51FA\u73B0\u5728\u4E09\u4E2A\u4F4D\u7F6E\uFF0C\u4F46\u7528\u4E8E\u4EC0\u4E48\u529F\u80FD\uFF1F\u5982\u679C\u518D\u6B21\u67E5\u770B\u4E3B\u7EC4\u4EF6\u6587\u4EF6\uFF0C\u5B83\u4F3C\u4E4E\u53EA\u6709\u4E00\u4E2A\u51FD\u6570\uFF0C\u5373\xA0\`utils.simpleSort\`\xA0\uFF0C\u7528\u4E8E\u5728\u66F4\u6539\u6392\u5E8F\u4E0B\u62C9\u5217\u8868\u65F6\u6309\u591A\u4E2A\u6761\u4EF6\u5BF9\u641C\u7D22\u7ED3\u679C\u5217\u8868\u8FDB\u884C\u6392\u5E8F\uFF1A

\`\`\`js
if (this.state.sortBy === "model") {
  // \`simpleSort\` gets used here...
  json = utils.simpleSort(json, "model", this.state.sortOrder);
} else if (this.state.sortBy === "type") {
  // ..and here...
  json = utils.simpleSort(json, "type", this.state.sortOrder);
} else {
  // ..and here.
  json = utils.simpleSort(json, "manufacturer", this.state.sortOrder);
}
\`\`\`

Out of a 1,300 line file with a bunch of exports, only one of them is used. This results in shipping a lot of unused JavaScript.  

\u5728\u5305\u542B\u4E00\u5806\u5BFC\u51FA\u7684 1,300 \u884C\u6587\u4EF6\u4E2D\uFF0C\u53EA\u4F7F\u7528\u4E86\u5176\u4E2D\u4E00\u4E2A\u3002\u8FD9\u5BFC\u81F4\u5927\u91CF\u672A\u4F7F\u7528\u7684 JavaScript \u53D1\u5E03\u3002

:::info
**Note:** This project is purposefully kept simple, so it's a bit easier in this case to find out where the bloat is coming from. In large projects with many modules, however, things get more complicated. Tools such as\xA0[Webpack Bundle Analyzer](https://www.npmjs.com/package/webpack-bundle-analyzer)\xA0and\xA0[source-map-explorer](https://www.npmjs.com/package/source-map-explorer)\xA0may provide further insight.  

\u6CE8\u610F\uFF1A\u8FD9\u4E2A\u9879\u76EE\u7279\u610F\u4FDD\u6301\u7B80\u5355\uFF0C\u6240\u4EE5\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B\uFF0C\u627E\u51FA\u81A8\u80C0\u7684\u6765\u6E90\u4F1A\u66F4\u5BB9\u6613\u4E00\u4E9B\u3002\u7136\u800C\uFF0C\u5728\u5177\u6709\u8BB8\u591A\u6A21\u5757\u7684\u5927\u578B\u9879\u76EE\u4E2D\uFF0C\u4E8B\u60C5\u53D8\u5F97\u66F4\u52A0\u590D\u6742\u3002Webpack Bundle Analyzer \u548C source-map-explorer \u7B49\u5DE5\u5177\u53EF\u80FD\u4F1A\u63D0\u4F9B\u8FDB\u4E00\u6B65\u7684\u89C1\u89E3\u3002
:::

While this example app is admittedly a bit contrived, it doesn't change the fact that this synthetic sort of scenario resembles actual optimization opportunities you may encounter in a production web app. Now that you've identified an opportunity for tree shaking to be useful, how is it actually done?  

\u867D\u7136\u6B64\u793A\u4F8B\u5E94\u7528\u786E\u5B9E\u6709\u70B9\u505A\u4F5C\uFF0C\u4F46\u5B83\u5E76\u6CA1\u6709\u6539\u53D8\u8FD9\u6837\u4E00\u4E2A\u4E8B\u5B9E\uFF0C\u5373\u8FD9\u79CD\u5408\u6210\u7C7B\u578B\u7684\u65B9\u6848\u7C7B\u4F3C\u4E8E\u60A8\u5728\u751F\u4EA7 Web \u5E94\u7528\u4E2D\u53EF\u80FD\u9047\u5230\u7684\u5B9E\u9645\u4F18\u5316\u673A\u4F1A\u3002\u65E2\u7136\u60A8\u5DF2\u7ECF\u786E\u5B9A\u4E86\u6447\u6811\u6709\u7528\u7684\u673A\u4F1A\uFF0C\u90A3\u4E48\u5B83\u5B9E\u9645\u4E0A\u662F\u5982\u4F55\u5B8C\u6210\u7684\uFF1F

## Keeping Babel from transpiling ES6 modules to CommonJS modules  \u9632\u6B62 Babel \u5C06 ES6 \u6A21\u5757\u8F6C\u8BD1\u4E3A CommonJS \u6A21\u5757

[Babel](https://babeljs.io/)\xA0is an indispensable tool, but it may make the effects of tree shaking a bit more difficult to observe. If you're using\xA0[\`@babel/preset-env\`](https://babeljs.io/docs/en/babel-preset-env), Babel\xA0_may_\xA0transform ES6 modules into more widely compatible CommonJS modules\u2014that is, modules you\xA0\`require\`\xA0instead of\xA0\`import\`.  

\u5DF4\u522B\u5854\u662F\u4E0D\u53EF\u6216\u7F3A\u7684\u5DE5\u5177\uFF0C\u4F46\u5B83\u53EF\u80FD\u4F1A\u4F7F\u6811\u6728\u6447\u6643\u7684\u5F71\u54CD\u66F4\u96BE\u89C2\u5BDF\u3002\u5982\u679C\u60A8\u4F7F\u7528\u7684\xA0\`@babel/preset-env\`\xA0\u662F \uFF0CBabel \u53EF\u80FD\u4F1A\u5C06 ES6 \u6A21\u5757\u8F6C\u6362\u4E3A\u66F4\u5E7F\u6CDB\u517C\u5BB9\u7684 CommonJS \u6A21\u5757\uFF0C\u5373 u\xA0\`require\`\xA0\u6A21\u5757\u800C\u4E0D\u662F\xA0\`import\`\xA0.

Because tree shaking is more difficult to do for CommonJS modules, webpack won't know what to prune from bundles if you decide to use them. The solution is to configure\xA0\`@babel/preset-env\`\xA0to explicitly leave ES6 modules alone. Wherever you configure Babel\u2014be it in\xA0\`babel.config.js\`\xA0or\xA0\`package.json\`\u2014this involves adding a little something extra:  

\u56E0\u4E3A CommonJS \u6A21\u5757\u66F4\u96BE\u505A\u6447\u6811\uFF0C\u6240\u4EE5\u5982\u679C\u4F60\u51B3\u5B9A\u4F7F\u7528\u5B83\u4EEC\uFF0Cwebpack \u5C06\u4E0D\u77E5\u9053\u8981\u4ECE\u6346\u7ED1\u5305\u4E2D\u5220\u9664\u4EC0\u4E48\u3002\u89E3\u51B3\u65B9\u6848\u662F\u914D\u7F6E\u4E3A\xA0\`@babel/preset-env\`\xA0\u663E\u5F0F\u4FDD\u7559 ES6 \u6A21\u5757\u3002\u65E0\u8BBA\u4F60\u5728\u4EC0\u4E48\u5730\u65B9\u914D\u7F6E Babel\u2014\u2014\u65E0\u8BBA\u662F\u5728 in\xA0\`babel.config.js\`\xA0\u4E2D\u8FD8\u662F\u5728\xA0\`package.json\`\xA0- \u8FD9\u90FD\u6D89\u53CA\u6DFB\u52A0\u4E00\u4E9B\u989D\u5916\u7684\u4E1C\u897F\uFF1A

\`\`\`js
// babel.config.js
export default {
  presets: [
    [
      "@babel/preset-env", {
        modules: false
      }
    ]
  ]
}
\`\`\`

Specifying\xA0\`modules: false\`\xA0in your\xA0\`@babel/preset-env\`\xA0config gets Babel to behave as desired, which allows webpack to analyze your dependency tree and shake off unused dependencies.  

\u5728\u4F60\u7684\xA0\`@babel/preset-env\`\xA0\u914D\u7F6E\u4E2D\u6307\u5B9A\xA0\`modules: false\`\xA0\u53EF\u4EE5\u8BA9 Babel \u6309\u7167\u9884\u671F\u8FD0\u884C\uFF0C\u8FD9\u5141\u8BB8 webpack \u5206\u6790\u4F60\u7684\u4F9D\u8D56\u6811\u5E76\u6446\u8131\u672A\u4F7F\u7528\u7684\u4F9D\u8D56\u3002

## Keeping side effects in mind  \u7262\u8BB0\u526F\u4F5C\u7528

Another aspect to consider when shaking dependencies from your app is whether your project's modules have side effects. An example of a side effect is when a function modifies something outside of its own scope, which is a\xA0_side effect_\xA0of its execution:  

\u4ECE\u5E94\u7528\u4E2D\u6447\u52A8\u4F9D\u8D56\u9879\u65F6\u8981\u8003\u8651\u7684\u53E6\u4E00\u4E2A\u65B9\u9762\u662F\u9879\u76EE\u7684\u6A21\u5757\u662F\u5426\u6709\u526F\u4F5C\u7528\u3002\u526F\u4F5C\u7528\u7684\u4E00\u4E2A\u4F8B\u5B50\u662F\uFF0C\u5F53\u4E00\u4E2A\u51FD\u6570\u4FEE\u6539\u4E86\u5B83\u81EA\u5DF1\u7684\u8303\u56F4\u4E4B\u5916\u7684\u4E1C\u897F\u65F6\uFF0C\u8FD9\u662F\u5176\u6267\u884C\u7684\u526F\u4F5C\u7528\uFF1A

\`\`\`js
let fruits = ["apple", "orange", "pear"];

console.log(fruits); // (3) ["apple", "orange", "pear"]

const addFruit = function(fruit) {
  fruits.push(fruit);
};

addFruit("kiwi");

console.log(fruits); // (4) ["apple", "orange", "pear", "kiwi"]
\`\`\`

In this example,\xA0\`addFruit\`\xA0produces a side effect when it modifies the\xA0\`fruits\`\xA0array, which is outside its scope.  

\u5728\u6B64\u793A\u4F8B\u4E2D\uFF0C\u5F53\u5B83\u4FEE\u6539\xA0\`fruits\`\xA0\u6570\u7EC4\u65F6\u4F1A\u4EA7\u751F\u526F\u4F5C\u7528\uFF0C\xA0\`addFruit\`\xA0\u8FD9\u8D85\u51FA\u4E86\u5176\u8303\u56F4\u3002

Side effects also apply to ES6 modules, and that matters in the context of tree shaking. Modules that take predictable inputs and produce equally predictable outputs without modifying anything outside of their own scope are dependencies that can be safely dropped if we're not using them. They're self-contained,\xA0_modular_\xA0pieces of code. Hence, "modules".  

\u526F\u4F5C\u7528\u4E5F\u9002\u7528\u4E8E ES6 \u6A21\u5757\uFF0C\u8FD9\u5728\u6447\u6811\u7684\u80CC\u666F\u4E0B\u5F88\u91CD\u8981\u3002\u91C7\u7528\u53EF\u9884\u6D4B\u7684\u8F93\u5165\u5E76\u4EA7\u751F\u540C\u6837\u53EF\u9884\u6D4B\u7684\u8F93\u51FA\u800C\u4E0D\u4FEE\u6539\u5176\u81EA\u8EAB\u8303\u56F4\u4E4B\u5916\u7684\u4EFB\u4F55\u5185\u5BB9\u7684\u6A21\u5757\u662F\u4F9D\u8D56\u9879\uFF0C\u5982\u679C\u6211\u4EEC\u4E0D\u4F7F\u7528\u5B83\u4EEC\uFF0C\u5219\u53EF\u4EE5\u5B89\u5168\u5730\u5220\u9664\u5B83\u4EEC\u3002\u5B83\u4EEC\u662F\u72EC\u7ACB\u7684\u6A21\u5757\u5316\u4EE3\u7801\u7247\u6BB5\u3002\u56E0\u6B64\uFF0C\u201C\u6A21\u5757\u201D\u3002

Where webpack is concerned, a hint can be used to specify that a package and its dependencies are free of side effects by specifying\xA0\`"sideEffects": false\`\xA0in a project's\xA0\`package.json\`\xA0file:  

\u5C31 webpack \u800C\u8A00\uFF0C\u53EF\u4EE5\u901A\u8FC7\u5728\u9879\u76EE\xA0\`package.json\`\xA0\u6587\u4EF6\u4E2D\u6307\u5B9A\u6765\u6307\u5B9A\xA0\`"sideEffects": false\`\xA0\u5305\u53CA\u5176\u4F9D\u8D56\u9879\u6CA1\u6709\u526F\u4F5C\u7528\uFF1A

\`\`\`js
{
  "name": "webpack-tree-shaking-example",
  "version": "1.0.0",
  "sideEffects": false
}
\`\`\`

Alternatively, you can tell webpack which specific files are not side effect-free:  

\u6216\u8005\uFF0C\u4F60\u53EF\u4EE5\u544A\u8BC9 webpack \u54EA\u4E9B\u7279\u5B9A\u6587\u4EF6\u4E0D\u662F\u6CA1\u6709\u526F\u4F5C\u7528\u7684\uFF1A

\`\`\`js
{
  "name": "webpack-tree-shaking-example",
  "version": "1.0.0",
  "sideEffects": [
    "./src/utils/utils.js"
  ]
}
\`\`\`

In the latter example, any file that isn't specified will be assumed to be free of side effects. If you don't want to add this to your\xA0\`package.json\`\xA0file,\xA0[you can also specify this flag in your webpack config via\xA0\`module.rules\`](https://github.com/webpack/webpack/issues/6065#issuecomment-351060570).  

\u5728\u540E\u4E00\u4E2A\u793A\u4F8B\u4E2D\uFF0C\u4EFB\u4F55\u672A\u6307\u5B9A\u7684\u6587\u4EF6\u90FD\u5C06\u88AB\u5047\u5B9A\u4E3A\u6CA1\u6709\u526F\u4F5C\u7528\u3002\u5982\u679C\u60A8\u4E0D\u60F3\u5C06\u5176\u6DFB\u52A0\u5230\u6587\u4EF6\u4E2D\xA0\`package.json\`\xA0\uFF0C\u4E5F\u53EF\u4EE5\u901A\u8FC7\xA0\`module.rules\`\xA0\u5728 webpack \u914D\u7F6E\u4E2D\u6307\u5B9A\u6B64\u6807\u5FD7\u3002

## Importing only what's needed  \u4EC5\u5BFC\u5165\u6240\u9700\u5185\u5BB9

After instructing Babel to leave ES6 modules alone, a slight adjustment to our\xA0\`import\`\xA0syntax is required to bring in only the functions needed from the\xA0\`utils\`\xA0module. In this guide's example, all that's needed is the\xA0\`simpleSort\`\xA0function:  

\u5728\u6307\u793A Babel \u4E0D\u7406\u4F1A ES6 \u6A21\u5757\u4E4B\u540E\uFF0C\u9700\u8981\u5BF9\u6211\u4EEC\u7684\xA0\`import\`\xA0\u8BED\u6CD5\u7A0D\u4F5C\u8C03\u6574\uFF0C\u4EE5\u4EC5\u5F15\u5165\xA0\`utils\`\xA0\u6A21\u5757\u6240\u9700\u7684\u51FD\u6570\u3002\u5728\u672C\u6307\u5357\u7684\u793A\u4F8B\u4E2D\uFF0C\u53EA\u9700\u8981\u51FD\u6570\xA0\`simpleSort\`\xA0\uFF1A

\`\`\`js
import { simpleSort } from "../../utils/utils";
\`\`\`

Because only\xA0\`simpleSort\`\xA0is being imported instead of the entire\xA0\`utils\`\xA0module, every instance of\xA0\`utils.simpleSort\`\xA0will need to changed to\xA0\`simpleSort\`:  

\u56E0\u4E3A\u53EA\xA0\`simpleSort\`\xA0\u5BFC\u5165\u800C\u4E0D\u662F\u5BFC\u5165\u6574\u4E2A\xA0\`utils\`\xA0\u6A21\u5757\uFF0C\u6240\u4EE5\u6BCF\u4E2A\xA0\`utils.simpleSort\`\xA0\u5B9E\u4F8B\u90FD\u9700\u8981\u66F4\u6539\u4E3A\xA0\`simpleSort\`\xA0\uFF1A

\`\`\`js
if (this.state.sortBy === "model") {
  json = simpleSort(json, "model", this.state.sortOrder);
} else if (this.state.sortBy === "type") {
  json = simpleSort(json, "type", this.state.sortOrder);
} else {
  json = simpleSort(json, "manufacturer", this.state.sortOrder);
}
\`\`\`

This should be all that's needed for tree shaking to work in this example. This is the webpack output before shaking the dependency tree:  

\u5728\u6B64\u793A\u4F8B\u4E2D\uFF0C\u8FD9\u5E94\u8BE5\u662F\u6447\u6811\u5DE5\u4F5C\u6240\u9700\u7684\u5168\u90E8\u5185\u5BB9\u3002\u8FD9\u662F\u52A8\u6447\u4F9D\u8D56\u6811\u4E4B\u524D\u7684 webpack \u8F93\u51FA\uFF1A

\`\`\`js
                 Asset      Size  Chunks             Chunk Names
js/vendors.16262743.js  37.1 KiB       0  [emitted]  vendors
   js/main.797ebb8b.js  20.8 KiB       1  [emitted]  main
\`\`\`

This is the output\xA0_after_\xA0tree shaking is successful:  

\u8FD9\u662F\u6447\u6811\u6210\u529F\u540E\u7684\u8F93\u51FA\uFF1A

\`\`\`js
                 Asset      Size  Chunks             Chunk Names
js/vendors.45ce9b64.js  36.9 KiB       0  [emitted]  vendors
   js/main.559652be.js  8.46 KiB       1  [emitted]  main
\`\`\`

While both bundles shrank, it's really the\xA0\`main\`\xA0bundle that benefits most. By shaking off the unused parts of the\xA0\`utils\`\xA0module, the\xA0\`main\`\xA0bundle shrinks by about 60%. This not only lowers the amount of time the script takes to the download, but processing time as well.  

\u867D\u7136\u4E24\u4E2A\u6346\u7ED1\u5305\u90FD\u7F29\u5C0F\u4E86\uFF0C\u4F46\u53D7\u76CA\u6700\u5927\u7684\u786E\u5B9E\u662F\xA0\`main\`\xA0\u6346\u7ED1\u5305\u3002\u901A\u8FC7\u7529\u6389\xA0\`utils\`\xA0\u6A21\u5757\u4E2D\u672A\u4F7F\u7528\u7684\u90E8\u5206\uFF0C\xA0\`main\`\xA0\u675F\u6536\u7F29\u7EA660%\u3002\u8FD9\u4E0D\u4EC5\u51CF\u5C11\u4E86\u811A\u672C\u4E0B\u8F7D\u6240\u9700\u7684\u65F6\u95F4\uFF0C\u8FD8\u51CF\u5C11\u4E86\u5904\u7406\u65F6\u95F4\u3002

## Go shake some trees!\xA0\u53BB\u6447\u6643\u4E00\u4E9B\u6811\uFF01

Whatever mileage you get out of tree shaking depends on your app and its dependencies and architecture. Try it! If you know for a fact you haven't set up your module bundler to perform this optimization, there's no harm trying and seeing how it benefits your application.  

\u65E0\u8BBA\u60A8\u4ECE\u6447\u6811\u4E2D\u83B7\u5F97\u4EC0\u4E48\u597D\u5904\uFF0C\u90FD\u53D6\u51B3\u4E8E\u60A8\u7684\u5E94\u7528\u53CA\u5176\u4F9D\u8D56\u9879\u548C\u4F53\u7CFB\u7ED3\u6784\u3002\u8BD5\u8BD5\u5427\uFF01\u5982\u679C\u60A8\u77E5\u9053\u60A8\u8FD8\u6CA1\u6709\u8BBE\u7F6E\u6A21\u5757\u6346\u7ED1\u5668\u6765\u6267\u884C\u6B64\u4F18\u5316\uFF0C\u90A3\u4E48\u5C1D\u8BD5\u5E76\u4E86\u89E3\u5B83\u5982\u4F55\u4F7F\u60A8\u7684\u5E94\u7528\u7A0B\u5E8F\u53D7\u76CA\u5E76\u6CA1\u6709\u4EC0\u4E48\u574F\u5904\u3002

You may realize a significant performance gain from tree shaking, or not much at all. But by configuring your build system to take advantage of this optimization in production builds and selectively importing only what your application needs, you'll be proactively keeping your application bundles as small as possible.  

\u60A8\u53EF\u80FD\u4F1A\u4ECE\u6447\u6811\u4E2D\u83B7\u5F97\u663E\u7740\u7684\u6027\u80FD\u63D0\u5347\uFF0C\u6216\u8005\u6839\u672C\u6CA1\u6709\u5B9E\u73B0\u3002\u4F46\u662F\uFF0C\u901A\u8FC7\u914D\u7F6E\u6784\u5EFA\u7CFB\u7EDF\u4EE5\u5728\u751F\u4EA7\u6784\u5EFA\u4E2D\u5229\u7528\u6B64\u4F18\u5316\uFF0C\u5E76\u6709\u9009\u62E9\u5730\u4EC5\u5BFC\u5165\u5E94\u7528\u7A0B\u5E8F\u6240\u9700\u7684\u5185\u5BB9\uFF0C\u60A8\u5C06\u4E3B\u52A8\u4FDD\u6301\u5E94\u7528\u7A0B\u5E8F\u6346\u7ED1\u5305\u5C3D\u53EF\u80FD\u5C0F\u3002

_Special thanks to Kristofer Baxter,\xA0[Jason Miller](https://web.dev/authors/developit),\xA0[Addy Osmani](https://web.dev/authors/addyosmani),\xA0[Jeff Posnick](https://web.dev/authors/jeffposnick), Sam Saccone, and\xA0[Philip Walton](https://web.dev/authors/philipwalton)\xA0for their valuable feedback, which significantly improved the quality of this article.  

\u7279\u522B\u611F\u8C22 Kristofer Baxter\u3001Jason Miller\u3001Addy Osmani\u3001Jeff Posnick\u3001Sam Saccone \u548C Philip Walton \u7684\u5B9D\u8D35\u53CD\u9988\uFF0C\u8FD9\u5927\u5927\u63D0\u9AD8\u4E86\u672C\u6587\u7684\u8D28\u91CF\u3002_
`;export{p as content,d as default,i as frontmatter,h as lastUpdatedTime,c as title,t as toc};
